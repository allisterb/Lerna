(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.StudyJournalEntry=c.StudyJournalEntry||{};j=c.Message=c.Message||{};k=c.Wit=c.Wit||{};l=k.NLUResponse=k.NLUResponse||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=b.Web=b.Web||{};p=o.ClientExtensions=o.ClientExtensions||{};q=o._Html=o._Html||{};r=o.htmModule=o.htmModule||{};s=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};t=b.Bootstrap=b.Bootstrap||{};u=t.Controls=t.Controls||{};v=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};w=o.NLU=o.NLU||{};x=w.Intent=w.Intent||{};y=w.Trait=w.Trait||{};z=w.Entity=w.Entity||{};A=w.Utterance=w.Utterance||{};B=w.Question=w.Question||{};C=w.Voice=w.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=w.Text=w.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=w.Domain=w.Domain||{};K=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};L=o.CUI=o.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};R=o.Main=o.Main||{};S=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};T=o.Study=o.Study||{};U=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};V=o.Client=o.Client||{};W=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};X=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};Y=a.IntelliFactory;Z=Y&&Y.Runtime;_0=a.WebSharper;_1=_0&&_0.Strings;_2=_0&&_0.Utils;_3=a.console;_4=a.jQuery;_5=_0&&_0.Arrays;_6=_0&&_0.List;_7=_0&&_0.Seq;_8=_0&&_0.UI;_9=_8&&_8.Doc;_=_8&&_8.AttrModule;$=_0&&_0.JavaScript;ba=$&&$.Pervasives;bb=_0&&_0.Collections;bc=bb&&bb.Map;bd=b&&b.NLU;be=bd&&bd.Wit;bf=be&&be.WitApi;bg=_0&&_0.Concurrency;bh=_0&&_0.Random;bi=_0&&_0.Operators;bj=_0&&_0.Remoting;bk=bj&&bj.AjaxRemotingProvider;bl=a.Wit;bm=a.document;bn=_0&&_0.Unchecked;bo=bd&&bd.QnAMaker;bp=bb&&bb.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(bq,br){return{Street:bq,Town:br};};f.New=function(bq,br,bs){return{Full:bq,First:br,Last:bs};};g=c.User=Z.Class({toString:function(){return this.Name;}},null,g);g.New=function(bq,br){return new g({Name:bq,LastLoggedIn:br});};h.New=function(bq,br,bs,bt,bu){return{Id:bq,Sex:br,Name:bs,BirthDate:bt,Address:bu};};i.New=function(bq,br,bs,bt){return{UserName:bq,Date:br,Subject:bs,Duration:bt};};j.New=function(bq,br,bs,bt){return{UserName:bq,Date:br,Text:bs,IsRead:bt};};l.New=function(bq,br,bs,bt,bu,bv){return{type:bq,msg:br,action:bs,traits:bt,entities:bu,confidence:bv};};m.New=function(bq,br,bs){return{id:bq,value:br,confidence:bs};};n.New=function(bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA){return{id:bq,name:br,role:bs,start:bt,end:bu,body:bv,confidence:bw,entities:bx,suggested:by,value:bz,type:bA};};p.scriptmd=function(){s.$cctor();return s.scriptmd;};p.mdbold=function(){s.$cctor();return s.mdbold;};p.mdbblockquote=function(){s.$cctor();return s.mdbblockquote;};p.mdh3=function(){s.$cctor();return s.mdh3;};p.mdh2=function(){s.$cctor();return s.mdh2;};p.mdh1=function(){s.$cctor();return s.mdh1;};p.replace_tok=function(bq,br,bs){return _1.Replace(bs,bq,br);};p.toLower=function(bq){return bq.toLowerCase();};p.debug=function(bq,br){p.info((((Z.Curried3(function(bs,bt,bu){return bs("DEBUG: "+_2.toSafe(bt)+": "+_2.prettyPrint(bu));}))(a.id))(bq.toUpperCase()))(br));};p.error=function(bq){_3.error(bq);};p.info=function(bq){_3.info(bq);};p.jserror=function(bq){_4.error(bq);};p.toArray=function(bq){return _5.map(a.id,_4.makeArray(bq));};p["Terminal.EchoHtml'"]=function(bq,br){bq.pause();bq.echo(br,p.rawOpt());bq.resume();};p["Terminal.Echo'"]=function(bq,br){bq.pause();bq.echo(br);bq.resume();};p.rawOpt=function(){s.$cctor();return s.rawOpt;};q=o._Html=Z.Class({toString:function(){return q.toString(this);}},null,q);q.toString=function(bq){function br(bs){return function(bt){var bu,bv,bw,bx,by,bz,bA;bv=_1.replicate(bs," ");switch(bt.$==0?bt.$1.$==1?bt.$1.$0.$==2?bt.$1.$1.$==0?(bu=[bt.$1.$0.$0,bt.$0],1):(bu=[bt.$1,bt.$0],2):(bu=[bt.$1,bt.$0],2):(bu=[bt.$1,bt.$0],2):bt.$==2?(bu=bt.$0,3):(bu=[bt.$0,bt.$1],0)){case 0:return bu[0]+"=\""+bu[1]+"\"";case 1:bw=bu[1];return bv+"<"+bw+">"+bu[0]+"</"+bw+">\r\n";case 2:bx=bu[1];by=_6.partition(function(bB){return bB.$==1;},bu[0]);bz=by[1];bA=by[0];return bz.$==0?bv+"<"+bx+(bA.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bB){return(br(0))(bB);},bA);}))))+"/>\r\n":bv+"<"+bx+(bA.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bB){return(br(0))(bB);},bA);}))))+">\r\n"+_1.concat("",_6.ofSeq(_7.delay(function(){return _7.map(function(bB){return(br(bs+1))(bB);},bz);})))+bv+"</"+bx+">\r\n";case 3:return bv+bu+"\r\n";}};}return(br(0))(bq);};r.alt=function(bq){return new q({$:1,$0:"alt",$1:bq});};r.src=function(bq){return new q({$:1,$0:"src",$1:bq});};r.cls=function(bq){return new q({$:1,$0:"class",$1:bq});};r.str=function(bq){return q.toString(bq);};r.op_PercentEquals=function(bq,br){return new q({$:1,$0:bq,$1:br});};r.op_Splice=function(bq){var br;return _6.ofArray([new q({$:2,$0:(br=bq,a.String(br))})]);};r.strong=function(){s.$cctor();return s.strong;};r.h4=function(){s.$cctor();return s.h4;};r.h3=function(){s.$cctor();return s.h3;};r.h2=function(){s.$cctor();return s.h2;};r.h1=function(){s.$cctor();return s.h1;};r.li=function(){s.$cctor();return s.li;};r.ul=function(){s.$cctor();return s.ul;};r.th=function(){s.$cctor();return s.th;};r.td=function(){s.$cctor();return s.td;};r.tr=function(){s.$cctor();return s.tr;};r.a=function(){s.$cctor();return s.a;};r.p=function(){s.$cctor();return s.p;};r.area=function(){s.$cctor();return s.area;};r.map=function(){s.$cctor();return s.map;};r.img=function(){s.$cctor();return s.img;};r.tfoot=function(){s.$cctor();return s.tfoot;};r.tbody=function(){s.$cctor();return s.tbody;};r.thead=function(){s.$cctor();return s.thead;};r.table=function(){s.$cctor();return s.table;};r.span=function(){s.$cctor();return s.span;};r.section=function(){s.$cctor();return s.section;};r.br=function(){s.$cctor();return s.br;};r.div=function(){s.$cctor();return s.div;};r.body=function(){s.$cctor();return s.body;};r.style=function(){s.$cctor();return s.style;};r.title=function(){s.$cctor();return s.title;};r.head=function(){s.$cctor();return s.head;};r.html=function(){s.$cctor();return s.html;};r.elem=function(bq,br){return new q({$:0,$0:bq,$1:br});};s.$cctor=function(){var bq;s.$cctor=a.ignore;s.rawOpt=(bq={},bq.raw=true,bq);s.mdh1=new a.RegExp("^# (.*$)","gim");s.mdh2=new a.RegExp("^## (.*$)","gim");s.mdh3=new a.RegExp("^### (.*$)","gim");s.mdbblockquote=new a.RegExp("/^\\> (.*$)/","gim");s.mdbold=new a.RegExp("/^\\> (.*$)/","gim");s.scriptmd="function parseMarkdown(markdownText) {\r\n        const htmlText = markdownText\r\n        \u0009.replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n        \u0009.replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n        \u0009.replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n        \u0009.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\r\n        \u0009.replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\r\n        \u0009.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\r\n        \u0009.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\r\n        \u0009.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2'>$1</a>\")\r\n        \u0009.replace(/\\n$/gim, '<br />')\r\n        \r\n        return htmlText.trim()\r\n    }\r\n    ";s.html=function(br){return r.elem("html",br);};s.head=function(br){return r.elem("head",br);};s.title=function(br){return r.elem("title",br);};s.style=function(br){return r.elem("style",br);};s.body=function(br){return r.elem("body",br);};s.div=function(br){return r.elem("div",br);};s.br=function(br){return r.elem("br",br);};s.section=function(br){return r.elem("section",br);};s.span=function(br){return r.elem("span",br);};s.table=function(br){return r.elem("table",br);};s.thead=function(br){return r.elem("thead",br);};s.tbody=function(br){return r.elem("tbody",br);};s.tfoot=function(br){return r.elem("tfoot",br);};s.img=function(br){return r.elem("img",br);};s.map=function(br){return r.elem("map",br);};s.area=function(br){return r.elem("area",br);};s.p=function(br){return r.elem("p",br);};s.a=function(br){return r.elem("a",br);};s.tr=function(br){return r.elem("tr",br);};s.td=function(br){return r.elem("td",br);};s.th=function(br){return r.elem("th",br);};s.ul=function(br){return r.elem("ul",br);};s.li=function(br){return r.elem("li",br);};s.h1=function(br){return r.elem("h1",br);};s.h2=function(br){return r.elem("h1",br);};s.h3=function(br){return r.elem("h1",br);};s.h4=function(br){return r.elem("h1",br);};s.strong=function(br){return r.elem("strong",br);};};u.Radio=function(bq,br,bs,bt,bu){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("radio"),$1:br}),[_9.Element("label",bt,[_9.Radio(bu,true,bs),_9.TextNode(bq)])]);};u.Checkbox=function(bq,br,bs,bt,bu){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("checkbox"),$1:br}),[_9.Element("label",bt,[_9.CheckBox(bu,bs),_9.TextNode(bq)])]);};u.TextArea=function(bq,br,bs,bt,bu){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:br}),[_9.Element("label",bt,[_9.TextNode(bq)]),_9.InputArea(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bu}),bs)]);};u.InputPassword=function(bq,br,bs,bt,bu){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:br}),[_9.Element("label",bt,[_9.TextNode(bq)]),_9.PasswordBox(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bu}),bs)]);};u.Input=function(bq,br,bs,bt,bu){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:br}),[_9.Element("label",bt,[_9.TextNode(bq)]),_9.Input(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bu}),bs)]);};u.Container=function(bq){return _9.Element("div",[(u.cls())("container")],bq);};u.Class=function(){v.$cctor();return v.Class;};u.cls=function(){v.$cctor();return v.cls;};v.$cctor=function(){v.$cctor=a.ignore;v.cls=_.Class;v.Class=_.Class;};x=w.Intent=Z.Class({toString:function(){return(((Z.Curried3(function(bq,br,bs){return bq("Intent("+_2.toSafe(br)+", "+X.p$2(bs)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=w.Trait=Z.Class({toString:function(){return(((Z.Curried3(function(bq,br,bs){return bq("Trait("+_2.toSafe(br)+", "+_2.prettyPrint(bs)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,y);z=w.Entity=Z.Class({toString:function(){return((((Z.Curried(function(bq,br,bs,bt){return bq("Entity("+_2.toSafe(br)+", "+_2.toSafe(bs)+", "+X.p$2(bt)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);A=w.Utterance=Z.Class({toString:function(){return((((Z.Curried(function(bq,br,bs,bt){return bq(X.p(br)+" "+X.p$3(bs)+" "+X.p$5(bt));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bq;bq=this.$2;return bq!=null?{$:1,$0:_6.sortBy(function(br){return br.get_Name();},bq.$0)}:null;},get_Traits:function(){var bq;bq=this.$1;return bq!=null?{$:1,$0:_6.sortBy(function(br){return br.get_Name();},bq.$0)}:null;},get_Intent:function(){return this.$0;}},null,A);B=w.Question=Z.Class({toString:function(){return(((Z.Curried3(function(bq,br,bs){return bq("Name: "+_2.toSafe(br)+" Text: "+_2.toSafe(bs));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);D.New=function(bq,br,bs,bt,bu){return{body:bq,end:br,start:bs,suggested:bt,value:bu};};C["Intent'"]=function(bq,br){return!(br.intent==null)?{$:1,$0:new x({$:0,$0:p.toLower(br.intent.value),$1:null})}:null;};C["Trait'"]=function(bq){return!(bq.domain==null)?{$:1,$0:new y({$:0,$0:"domain",$1:p.toLower(bq.domain.value),$2:null})}:!(bq.dialogue_act==null)?{$:1,$0:new y({$:0,$0:"dialogue_act",$1:p.toLower(bq.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(bq){return!(bq.contact==null)?{$:1,$0:new z({$:0,$0:"contact",$1:p.toLower(bq.contact.value),$2:null})}:null;};F=E["Utterance'"]=Z.Class({get_TopIntent:function(){return _6.head(_6.sortBy(function(bq){return bq.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,F);G=E["Intent'"]=Z.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(bq){var br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE;return bq!=null&&bq.$==1&&(bq.$0.$0.$==0&&(bq.$0.$1.get_Length()>0&&(br=[bq.$0.$1,bq.$0.$2],true)))?(bs=_6.map(function(bF){return new z({$:0,$0:p.toLower(bF.get_Role()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},br[0])),{$:1,$0:new A({$:0,$0:null,$1:{$:1,$0:_6.map(function(bF){return new y({$:0,$0:p.toLower(bF.get_Name()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},br[1]))},$2:{$:1,$0:bs}})}):bq!=null&&bq.$==1&&(bq.$0.$1.$==0&&(bq.$0.$2.$==0&&(bq.$0.$0.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bt=[bq.$0.$0,bq],true))))?(bu=bt[1],{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bu.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bu.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bq!=null&&bq.$==1&&(bq.$0.$2.$==0&&(bq.$0.$0.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bv=[bq.$0.$0,bq],true)))?(bw=bv[1],(bx=_6.map(function(bF){return new z({$:0,$0:p.toLower(bF.get_Role()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},bw.$0.get_Entities())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bw.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bw.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bx}})})):bq!=null&&bq.$==1&&(bq.$0.$1.$==0&&(bq.$0.$0.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(by=[bq.$0.$0,bq],true)))?(bz=by[1],(bA=_6.map(function(bF){return new y({$:0,$0:p.toLower(bF.get_Name()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},bz.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bz.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bz.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bA},$2:null})})):bq!=null&&bq.$==1&&(bq.$0.$0.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bB=[bq.$0.$0,bq],true))?(bC=bB[1],(bD=_6.map(function(bF){return new z({$:0,$0:p.toLower(bF.get_Role()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},bC.$0.get_Entities())),(bE=_6.map(function(bF){return new y({$:0,$0:p.toLower(bF.get_Name()),$1:bF.get_Value(),$2:{$:1,$0:bF.get_Confidence()}});},_6.filter(function(bF){return bF.get_Confidence()>E.entityConfidenceThreshold();},bC.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bC.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bC.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bE},$2:{$:1,$0:bD}})}))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(bq){K.$cctor();K.entityConfidenceThreshold=bq;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(bq){K.$cctor();K.intentConfidenceThreshold=bq;};E.getUtterance=function(bq,br){E.witapi().getMeaning(bq,function(bs){var bt,bu;p.debug("NLU",(function(bv){return function(bw){return bv("Wit.ai returned: "+_2.prettyPrint(bw));};}(a.id))(bs));bt=!(bs.intents==null)?_6.ofArray(_5.map(function(bv){return new G({$:0,$0:bv.name,$1:bv.confidence});},bs.intents)):_6.T.Empty;bu=!(bs.traits==null)?_6.ofSeq(_7.concat(_6.map(function(bv){return _5.map(function(bw){return new I({$:0,$0:bv,$1:bw.confidence,$2:bw.value});},ba.GetJS(bs.traits,[bv]));},_6.filter(function(bv){return!(ba.GetJS(bs.traits,[bv])==null);},E.trait_types())))):_6.T.Empty;return br({$:1,$0:new F({$:0,$0:bt,$1:!(bs.intents==null)?_6.ofSeq(_7.concat(_6.map(function(bv){return _5.map(function(bw){return new H({$:0,$0:bw.name,$1:bw.confidence,$2:bw.role,$3:bw.value});},ba.GetJS(bs.entities,[bv]));},_6.filter(function(bv){return!(ba.GetJS(bs.entities,[bv])==null);},E.entity_types())))):_6.T.Empty,$2:bu})});},function(bs,bt,bu){p.error((((Z.Curried3(function(bv,bw,bx){return bv("Wit.ai returned: "+_2.prettyPrint(bw)+" "+_2.prettyPrint(bx));}))(a.id))(bt))(bu));return br(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.witapi=function(){K.$cctor();return K.witapi;};E.QuickPrograms=function(bq){return bq==="programs"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};E.QuickNumber=function(bq){var br,bs,bt;return(bs=E.One(bq),bs!=null&&bs.$==1?(br=bs.$0,true):(bt=E.Two(bq),bt!=null&&bt.$==1&&(br=bt.$0,true)))?{$:1,$0:br}:null;};E.Three=function(bq){var br;return bq==="3"||bq==="three"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};E.Two=function(bq){var br;return bq==="2"||bq==="two"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};E.One=function(bq){var br;return bq==="1"||bq==="one"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(bq){var br;return bq==="no"||(bq==="NO"||(bq==="No"||(bq==="nope"||(bq==="no way"||(bq==="nah"||(bq==="don't do it"||bq==="stop"))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickYes=function(bq){var br;return bq==="yes"||(bq==="YES"||(bq==="Yes"||(bq==="YEs"||(bq==="ok"||(bq==="sure"||(bq==="yeah"||(bq==="yep"||(bq==="uh huh"||(bq==="go ahead"||bq==="go")))))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHelp=function(bq){var br;return bq==="help"||(bq==="help me"||(bq==="what's this?"||bq==="huh"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHello=function(bq){var br;return bq==="hello"||(bq==="hey"||(bq==="yo"||bq==="hi"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.Voices=function(bq){return bq==="voices"?{$:1,$0:null}:null;};E.Debug=function(bq){return bq==="debug"?{$:1,$0:null}:null;};E.Blank=function(bq){return bq===""?{$:1,$0:null}:null;};J.Study=function(bq){return bq.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};w.No=function(bq){var br,bs,bt,bu,bv,bw;return(bs=w.Intent$1("no",bq),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bq,true))))?{$:1,$0:br}:(bu=w.Intent$1("noresponse",bq),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bq,true))))?{$:1,$0:bt}:(bw=w.Intent$1("NoResponse",bq),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bq,true))))?{$:1,$0:bv}:null;};w.Yes=function(bq){var br,bs,bt,bu,bv,bw;return(bs=w.Intent$1("yes",bq),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bq,true))))?{$:1,$0:br}:(bu=w.Intent$1("yesresponse",bq),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bq,true))))?{$:1,$0:bt}:(bw=w.Intent$1("YesResponse",bq),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bq,true))))?{$:1,$0:bv}:null;};w.EntityManyofMany=function(bq,br){return{$:1,$0:bc.OfArray(_5.ofSeq(_6.map(function(bs){return _6.exists(function(bt){return bt.get_Name()===bs;},br)?[bs,{$:1,$0:_6.filter(function(bt){return bt.get_Name()===bs;},br)}]:[bs,null];},bq)))};};w.EntityManyOf1=function(bq,br){var bs;return br!=null&&br.$==1&&(_6.exists(function(bt){return bt.get_Name()===bq;},br.$0)&&(bs=br.$0,true))?{$:1,$0:_6.filter(function(bt){return bt.get_Name()===bq;},bs)}:null;};w.Entity1OfAny=function(bq,br){var bs;return br!=null&&br.$==1&&(_6.exists(function(bt){return bt.get_Name()===bq;},br.$0)&&(bs=br.$0,true))?{$:1,$0:_6.head(_6.sortBy(function(bt){return bt.get_Name();},_6.filter(function(bt){return bt.get_Name()===bq;},bs)))}:null;};w.Entity1Of1=function(bq,br){var bs;return br!=null&&br.$==1&&(br.$0.$==1&&(br.$0.$1.$==0&&(br.$0.$0.get_Name()===bq&&(bs=br.$0.$0,true))))?{$:1,$0:bs}:null;};w.Intent$1=function(bq,br){return br.get_Intent()!=null&&br.get_Intent().$0.get_Name()===bq?{$:1,$0:[br.get_Traits(),br.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.witapi=new bf.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");K.entity_types=_6.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject"]);K.trait_types=_6.ofArray(["domain","dialogue_act"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=Z.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=Z.Class({SayVoices:function(){var bq,br,bs;bq=this;br=a.speechSynthesis.getVoices();!(br==null)?(bs=p.toArray(br),bq.Say((function(bt){return function(bu){return bt("There are currently "+a.String(bu)+" voices installed on this computer or device.");};}(a.id))(_5.length(bs))),_5.iteri(function(bt,bu){return bq.Say(((((Z.Curried(function(bv,bw,bx,by){return bv("Voice "+a.String(bw)+". Name: "+_2.toSafe(bx)+", Local: "+_2.prettyPrint(by)+".");},4))(a.id))(bt))(bu.name))(bu.localService));},bs)):void 0;},Wait:function(bq){this.Wait$1(function(){bg.Start(bq,null);});},Wait$1:function(bq){this["Echo'"]("please wait...");this.Term.pause();bq();this.Term.resume();},sayRandom:function(bq,br){this.Say(L.getRandomPhrase(bq,br));},Say:function(bq){var br,bs;br=this;bg.Start((bs=null,bg.Delay(function(){a.speechSynthesis.speaking?a.speechSynthesis.cancel():void 0;br.Avatar.addMessage(bq);br.Avatar.processMessages(0);return bg.Zero();})),null);},Debug:function(bq,br){p.debug(bq,br);},"EchoHtml'":function(bq){var br,bs;br=(bs={},bs.raw=true,bs);this.Term.disable();this.Term.echo(bq,br);this.Term.enable();},"Echo'":function(bq){this.Term.disable();this.Term.echo(bq);this.Term.enable();}},null,P);P.New=function(bq,br,bs,bt,bu){return new P({Voice:bq,Mic:br,Term:bs,Avatar:bt,Caption:bu});};L.waitAddPhrases=function(){Q.$cctor();return Q.waitAddPhrases;};L.waitRetrievePhrases=function(){Q.$cctor();return Q.waitRetrievePhrases;};L.helpPhrases=function(){Q.$cctor();return Q.helpPhrases;};L.helloUserPhrases=function(){Q.$cctor();return Q.helloUserPhrases;};L.helloPhrases=function(){Q.$cctor();return Q.helloPhrases;};L["getRandomPhrase'"]=function(bq){return p.replace_tok("$0","",_7.nth(L.rng().Next(0,bq.get_Length()),bq));};L.getRandomPhrase=function(bq,br){return p.replace_tok("$0",br,_7.nth(L.rng().Next(0,bq.get_Length()),bq));};L.rng=function(){Q.$cctor();return Q.rng;};Q.$cctor=function(){Q.$cctor=a.ignore;Q.rng=new bh.New();Q.helloPhrases=_6.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);Q.helloUserPhrases=_6.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);Q.helpPhrases=_6.ofArray(["What can I help you with $0?"]);Q.waitRetrievePhrases=_6.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);Q.waitAddPhrases=_6.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};R.update=function(bq,br,bs,bt,bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;function b$(cp){bq.Say(cp);}function ca(cp){bt.unshift(cp);b$(cp);}function cb(cp,cq){var cr;cr=L.getRandomPhrase(cp,cq);bt.unshift(cr);return bq.Say(cr);}function cc(cp){return br.ContainsKey(cp);}function cd(cp,cq){return br.Add(cp,cq);}function ce(cp){br.Remove(cp);}function cf(){bu.shift();}function cg(){bs.shift();}function ch(cp){var cq;cq=R.getQuestion(cp);cq==null?(function(cr){return function(cs){return cr("No such question: "+_2.toSafe(cs));};}(bi.FailWith))(cp):bs.unshift(cq.$0);}function ci(cp,cq){cd(cp,cq);ch(cp);R.debug((function(cr){return function(cs){return cr("Added question: "+X.p$8(cs)+".");};}(a.id))(bs[0]));return ca(p.replace_tok("$0",cq,R.getQuestion(cp).$0.get_Text()));}function cj(cp,cq){return cc(cp)?{$:1,$0:cq}:null;}function ck(cp,cq){return!cc(cp)?{$:1,$0:cq}:null;}function cl(cp,cq){var cr,cs,ct;return(cs=cj("user",cq),cs!=null&&cs.$==1&&(R.haveQuestion(cp)&&bs.length>0&&bs[0].get_Name()===cp&&(cr=cs.$0,true)))?(cf(),cg(),cc(cp)?(ct=br.get_Item(cp),(ce(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function cm(cp,cq){var cr,cs,ct;return(cs=ck("user",cq),cs!=null&&cs.$==1&&(R.haveQuestion(cp)&&bs.length>0&&bs[0].get_Name()===cp&&(cr=cs.$0,true)))?(cf(),cg(),cc(cp)?(ct=br.get_Item(cp),(ce(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function cn(cp){var cq,cr;return(cr=ck("user",cp),cr!=null&&cr.$==1&&(bs.length===0&&(cq=cr.$0,true)))?(cf(),{$:1,$0:cq}):null;}function co(cp){var cq;return cp!=null&&cp.$==1&&(typeof cp.$0=="string"&&(cq=cp.$0,true))?{$:1,$0:cq}:null;}R.debug((((Z.Curried3(function(cp,cq,cr){return cp("Starting utterances:"+_2.prettyPrint(cq)+". Starting questions: "+_2.prettyPrint(cr)+".");}))(a.id))(bu))(bs));bv=_6.ofSeq(_7.take(bu.length>=5?5:bu.length,bu));bv.$==1&&(bx=(by=ck("started",bv.$0),by!=null&&by.$==1?{$:1,$0:by.$0}:null),bx!=null&&bx.$==1&&(bz=cn(bx.$0),bz!=null&&bz.$==1&&(bA=w.Intent$1("hello",bz.$0),bA!=null&&bA.$==1&&(bA.$0[1]==null&&bv.$1.$==0))))?(br.Add("started",true),cb(L.helloPhrases(),"")):bv.$==1&&(bC=cn(bv.$0),bC!=null&&bC.$==1&&(bD=w.Intent$1("hello",bC.$0),bD!=null&&bD.$==1&&(bD.$0[1]==null&&bv.$1.$==0)))?ca("Hello, tell me your name to get started."):bv.$==1&&(bF=cn(bv.$0),bF!=null&&bF.$==1&&(bG=w.Intent$1("hello",bF.$0),bG!=null&&bG.$==1&&(bH=w.Entity1Of1("contact",bG.$0[1]),bH!=null&&bH.$==1&&(bv.$1.$==0&&(bE=bH.$0,true)))))?(bI=bE.get_Value(),cb(L.waitRetrievePhrases(),"user name"),bg.Start((bJ=null,bg.Delay(function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-448192753",[bI]),function(cp){var cq;return cp==null?(ca((function(cr){return function(cs){return cr("I did not find a user with the name "+_2.toSafe(cs)+".");};}(a.id))(bI)),ci("addUser",bI),bg.Zero()):(cq=cp.$0,bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:2104449810",[cq.Name]),function(){br.Add("user",cq);cb(L.helloUserPhrases(),(function(cr){return function(cs){return cr(_2.prettyPrint(cs));};}(a.id))(br.get_Item("user")));return bg.Combine(cq.LastLoggedIn!=null?bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-923871684",[cq.LastLoggedIn.$0]),function(cr){ca((function(cs){return function(ct){return cs("You last logged in "+_2.toSafe(ct)+".");};}(a.id))(cr));return bg.Zero();}):bg.Zero(),bg.Delay(function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:1484264545",[cq.Name]),function(cr){br.Add("msgs",cr);return cr!=null&&cr.$0.get_Length()>0?(ca((function(cs){return function(ct){return cs("You have "+a.String(ct)+" new messages.");};}(a.id))(cr.$0.get_Length())),bg.Zero()):bg.Zero();});}));}));});})),null)):bv.$==1&&(bL=w.Yes(bv.$0),bL!=null&&bL.$==1&&(bM=cm("addUser",bL.$0),bM!=null&&bM.$==1&&(bN=co(bM.$0[1]),bN!=null&&bN.$==1&&(bv.$1.$==0&&(bK=bN.$0,true)))))?bg.Start((bO=null,bg.Delay(function(){cb(L.waitAddPhrases(),"user");return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:2104449810",[bK]),function(cp){return cp==null?(ca((function(cq){return function(cr){return cq("Sorry I was not able to add the user "+_2.toSafe(cr)+" to the system.");};}(a.id))(bK)),bg.Zero()):(cd("user",bK),bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.addMessage:-1628034647",[bK,"Welcome to Lerna."]),function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:1484264545",[bK]),function(cq){cd("msgs",cq);ca((function(cr){return function(cs){return cr("Hello "+_2.prettyPrint(cs)+", nice to meet you.");};}(a.id))(br.get_Item("user")));return cq!=null&&cq.$0.get_Length()>0?(ca((function(cr){return function(cs){return cr("You have "+a.String(cs)+" new messages.");};}(a.id))(cq.$0.get_Length())),bg.Zero()):bg.Zero();});}));});})),null):bv.$==1&&(bQ=w.No(bv.$0),bQ!=null&&bQ.$==1&&(bR=cm("addUser",bQ.$0),bR!=null&&bR.$==1&&(bS=co(bR.$0[1]),bS!=null&&bS.$==1&&(bv.$1.$==0&&(bP=bS.$0,true)))))?ca((function(cp){return function(cq){return cp("Ok I did not add the user "+_2.toSafe(cq)+". But you must login for me to help you.");};}(a.id))(bP)):bv.$==1&&((bU=cn(bv.$0),bU!=null&&bU.$==1)&&bv.$1.$==0)?ca("Could you introduce yourself so we can get started?"):bv.$==1&&(bW=(bY=cj("user",bv.$0),bY!=null&&bY.$==1&&(bs.length===0&&(bX=bY.$0,true)))?(cf(),{$:1,$0:bX}):null,bW!=null&&bW.$==1&&(bZ=w.Intent$1("hello",bW.$0),bZ!=null&&bZ.$==1&&(bZ.$0[0]==null&&(b0=w.Entity1Of1("contact",bZ.$0[1]),b0!=null&&b0.$==1&&(bv.$1.$==0&&(bV=b0.$0,true))))))?bg.Start((b1=null,bg.Delay(function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-448192753",[bV.get_Value()]),function(cp){return cp==null?(ca((function(cq){return function(cr){return cq("Sorry, the user "+_2.toSafe(cr)+" does not exist.");};}(a.id))(bV.get_Value())),bg.Zero()):(ci("switchUser",cp.$0.Name),bg.Zero());});})),null):bv.$==1&&(b3=w.Yes(bv.$0),b3!=null&&b3.$==1&&(b4=cl("switchUser",b3.$0),b4!=null&&b4.$==1&&(b5=co(b4.$0[1]),b5!=null&&b5.$==1&&(bv.$1.$==0&&(b2=b5.$0,true)))))?(br.set_Item("user",b2),ca((function(cp){return function(cq){return cp("Ok I switched to user "+_2.prettyPrint(cq)+".");};}(a.id))(b2))):bv.$==1&&(b7=w.No(bv.$0),b7!=null&&b7.$==1&&(b8=cl("switchUser",b7.$0),b8!=null&&b8.$==1&&(b9=co(b8.$0[1]),b9!=null&&b9.$==1&&(bv.$1.$==0&&(b6=b9.$0,true)))))?ca((function(cp){return function(cq){return cp("Ok I did not switch to user "+_2.toSafe(cq)+".");};}(a.id))(b6)):(cf(),R.debug("Main interpreter did not understand utterance."),ca("Sorry I didn't understand what you meant."),bs.length>0?(b_=_7.nth(0,bs),cc(b_.get_Name())?ca(p.replace_tok("$0",br.get_Item(b_.get_Name()),b_.get_Text())):ca(b_.get_Text())):void 0);R.debug((((Z.Curried3(function(cp,cq,cr){return cp("Ending utterances: "+_2.prettyPrint(cq)+". Ending questions:"+_2.prettyPrint(cr)+".");}))(a.id))(bu))(bs));};R.haveQuestion=function(bq){return _6.exists(function(br){return br.get_Name()===bq;},R.questions());};R.getQuestion=function(bq){return _7.tryFind(function(br){return br.get_Name()===bq;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(bq){p.debug("Main",bq);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_6.ofArray([new B({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new B({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new B({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new B({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new B({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};T.update=function(bq,br,bs,bt,bu){T.debug((((Z.Curried3(function(bv,bw,bx){return bv("Starting utterances:"+_2.prettyPrint(bw)+". Starting questions: "+_2.prettyPrint(bx)+".");}))(a.id))(bu))(bs));};T.haveQuestion=function(bq){return _6.exists(function(br){return br.get_Name()===bq;},T.questions());};T.getQuestion=function(bq){return _7.tryFind(function(br){return br.get_Name()===bq;},T.questions());};T.questions=function(){U.$cctor();return U.questions;};T.debug=function(bq){p.debug("Study",bq);};U.$cctor=function(){U.$cctor=a.ignore;U.questions=_6.ofArray([new B({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new B({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new B({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};V.run=function(){var bq,br,bs;V.set_CUI((bq=(br=Z.ThisFunc(function(bt,bu){return((V.Main().get_Text())(bt))(bu);}),(bs=V.Main().get_Options(),void a.$("#main").terminal(br,bs))),P.New(V.CUI().Voice,V.CUI().Mic,bq,V.CUI().Avatar,V.CUI().Caption)));return _9.get_Empty();};V.Main=function(){W.$cctor();return W.Main;};V.initMic=function(bq){var br,bs;V.set_CUI((br={$:1,$0:new bl.Microphone(bm.getElementById("microphone"))},P.New(V.CUI().Voice,br,V.CUI().Term,V.CUI().Avatar,V.CUI().Caption)));bs=V.CUI().Mic.$0;bs.onconnecting=function(){V.set_MicState(M.MicConnecting);return V.debug("Mic connecting...");};bs.ondisconnected=function(){V.set_MicState(M.MicDisconnected);return V.debug("Mic disconnected.");};bs.onaudiostart=function(){V.set_MicState(M.MicAudioStart);return V.debug("Mic audio start...");};bs.onaudioend=function(){V.set_MicState(M.MicAudioEnd);return V.debug("Mic audio end.");};bs.onerror=function(bt){V.set_MicState({$:6,$0:bt});return V.debug((function(bu){return function(bv){return bu("Mic error : "+_2.toSafe(bv)+".");};}(a.id))(bt));};bs.onready=function(){V.set_MicState(M.MicReady);return V.debug("Mic ready.");};bs.onresult=function(bt,bu){return V.ClientState().$==2?V.echo("I'm still trying to understand what you said before."):V.ClientState().$==0?p.error("Client is not intialized."):!(bt==null||bu==null)?(V.set_MicState({$:7,$0:bt,$1:bu}),V.debug((((Z.Curried3(function(bv,bw,bx){return bv("Mic result: "+_2.prettyPrint(bw)+" "+_2.prettyPrint(bx)+".");}))(a.id))(bt))(bu)),bq(bs,[bt,bu])):V.debug("Mic: No result returned.");};bs.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};V.sayRandom=function(bq,br){V.say(L.getRandomPhrase(br,bq));};V.sayVoices=function(){var bq;bq=p.toArray(V.synth().getVoices());V["say'"]((function(br){return function(bs){return br("There are currently "+a.String(bs)+" voices installed on this computer or device.");};}(a.id))(_5.length(bq)));_5.iteri(function(br,bs){return V["say'"](((((Z.Curried(function(bt,bu,bv,bw){return bt("Voice "+a.String(bu)+". Name: "+_2.toSafe(bv)+", Local: "+_2.prettyPrint(bw)+".");},4))(a.id))(br))(bs.name))(bs.localService));},bq);};V.say=function(bq){V.Responses().unshift(bq);V["say'"](bq);};V["say'"]=function(bq){V.CUI().Say(bq);};V.initSpeech=function(){var bq,br;bq=p.toArray(V.synth().getVoices());_5.length(bq)>0?(br=_5.find(function(bs){return bs["default"];},bq),V.set_CUI(P.New({$:1,$0:br},V.CUI().Mic,V.CUI().Term,V.CUI().Avatar,V.CUI().Caption)),V.debug((function(bs){return function(bt){return bs("Using default voice "+_2.toSafe(bt)+".");};}(a.id))(V.CUI().Voice.$0.name)),V.CUI().Avatar.nativeVoice=true,V.CUI().Avatar.nativeVoiceName=br.name):V.echo("No speech synthesis voice is available.");};V.synth=function(){W.$cctor();return W.synth;};V.push=function(bq){V.Utterances().unshift(bq);return V.Utterances();};V.Props=function(){W.$cctor();return W.Props;};V.Responses=function(){W.$cctor();return W.Responses;};V.Questions=function(){W.$cctor();return W.Questions;};V.Utterances=function(){W.$cctor();return W.Utterances;};V.wait=function(bq){p["Terminal.Echo'"](V.CUI().Term,"please wait");V.CUI().Term.pause();bq();V.CUI().Term.resume();};V.debug=function(bq){p.debug("CLIENT",bq);};V.echo=function(bq){if(!(V.CUI().Term==null))p["Terminal.EchoHtml'"](V.CUI().Term,(function(br){return function(bs){return br(_2.prettyPrint(bs));};}(a.id))(bq));};V.ClientState=function(){W.$cctor();return W.ClientState;};V.set_ClientState=function(bq){W.$cctor();W.ClientState=bq;};V.MicState=function(){W.$cctor();return W.MicState;};V.set_MicState=function(bq){W.$cctor();W.MicState=bq;};V.CUI=function(){W.$cctor();return W.CUI;};V.set_CUI=function(bq){W.$cctor();W.CUI=bq;};W.$cctor=function(){var bq,br,bs;W.$cctor=a.ignore;function bt(bv,bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG;bx=bw[0];by=bw[1];V.debug((((Z.Curried3(function(bH,bI,bJ){return bH("Voice: "+_2.prettyPrint(bI)+" "+_2.prettyPrint(bJ));}))(a.id))(bx))(by));bz=(bA=C["Intent'"](bx,by),bA!=null&&bA.$==1?{$:1,$0:bA.$0}:null);bB=(bC=C["Trait'"](by),bC!=null&&bC.$==1?{$:1,$0:_6.ofArray([bC.$0])}:null);bD=(bE=C["Entity'$1"](by),bE!=null&&bE.$==1?{$:1,$0:_6.ofArray([bE.$0])}:null);return bz==null&&(bB==null&&bD==null)?null:(V.debug(((((Z.Curried(function(bH,bI,bJ,bK){return bH("Voice: "+X.p(bI)+" "+X.p$3(bJ)+" "+X.p$5(bK));},4))(a.id))(bz))(bB))(bD)),bG=V.push(new A({$:0,$0:bz,$1:bB,$2:bD})),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bG));}function bu(bv,bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;V.set_CUI(P.New(V.CUI().Voice,V.CUI().Mic,bv,V.CUI().Avatar,V.CUI().Caption));bn.Equals(V.CUI().Mic,null)?V.initMic(bt):void 0;bn.Equals(V.CUI().Voice,null)?V.initSpeech():void 0;V.ClientState().$===0?V.set_ClientState(N.ClientReady):void 0;return(bx=E.Blank(bw),bx!=null&&bx.$==1)?V["say'"]("Tell me what you want me to do or ask me a question."):(by=E.Debug(bw),by!=null&&by.$==1)?(V.debug((function(bI){return function(bJ){return bI("Utterances: "+_2.prettyPrint(bJ));};}(a.id))(V.Utterances())),V.debug((function(bI){return function(bJ){return bI("Questions: "+_2.prettyPrint(bJ));};}(a.id))(V.Questions()))):(bz=E.Voices(bw),bz!=null&&bz.$==1)?V.sayVoices():V.ClientState().$==1?(bB=E.QuickHello(bw),bB!=null&&bB.$==1?(bA=bB.$0,true):(bC=E.QuickHelp(bw),bC!=null&&bC.$==1?(bA=bC.$0,true):(bD=E.QuickYes(bw),bD!=null&&bD.$==1?(bA=bD.$0,true):(bE=E.QuickNo(bw),bE!=null&&bE.$==1&&(bA=bE.$0,true)))))?(bg.Start((bF=null,bg.Delay(function(){return bg.Bind(bo.getAnswer("What is an element?"),function(bI){V.debug(_5.get(bI.answers,0).answer);return bg.Zero();});})),null),V.debug((function(bI){return function(bJ){return bI("Quick Text: "+X.p$7(bJ)+".");};}(a.id))(bA)),V.echo("<iframe src=\"https://calendar.google.com/calendar/embed?src=cocnrm4290919hobq1f5he7leg%40group.calendar.google.com&ctz=America%2FPort_of_Spain\" style=\"border: 0\" width=\"800\" height=\"600\" frameborder=\"0\" scrolling=\"no\"></iframe>"),bG=V.push(bA),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bG),V.set_ClientState(N.ClientReady)):V.CUI().Wait((bH=null,bg.Delay(function(){V.set_ClientState(N.ClientUnderstand);E.getUtterance(bw,function(bI){var bJ,bK,bL;bJ=E.HasUtterance(bI);bJ!=null&&bJ.$==1?(bK=bJ.$0,V.debug(((((Z.Curried(function(bM,bN,bO,bP){return bM("Text: Intent: "+X.p(bN)+", Traits: "+X.p$3(bO)+", Entities: "+X.p$5(bP));},4))(a.id))(bK.get_Intent()))(bK.get_Traits()))(bK.get_Entities())),bL=V.push(bK),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bL)):(V.debug("Text: Did not receive a meaning from the server."),V["say'"]("Sorry I did not understand what you said."));});V.set_ClientState(N.ClientReady);return bg.Zero();}))):V.ClientState().$==0?p.error("Client is not initialized."):V["say'"]("I'm still trying to understand what you said before.");}W.CUI=P.New(null,null,null,(a.SDK.applicationId="4277115329081938617",bq=new a.SDKConnection(),br=new a.WebAvatar(),br.version=8.5,br.connection=bq,br.avatar="22225225",br.voice="cmu-slt",br.voiceMod="default",br.nativeVoice=true,br.nativeVoiceName="Microsoft David Desktop - English (United States)",br.width=300,br.createBox(),br.addMessage(""),br.processMessages(0),br),false);W.MicState=M.MicNotInitialized;W.ClientState=N.ClientNotInitialzed;W.Utterances=[];W.Questions=[];W.Responses=[];W.Props=new bp.New$5();W.synth=a.speechSynthesis;W.Main=new O({$:0,$0:function(bv){return function(bw){return bt(bv,bw);};},$1:[function(bv){return function(bw){return bu(bv,bw);};},(bs={},bs.name="Main",bs.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bs.prompt=">",bs)]});};X.p$8=function(bq){return"Question ("+_2.prettyPrint(bq.$0)+", "+_2.prettyPrint(bq.$1)+")";};X.p$9=function(bq){return bq==null?"null":"Some "+_2.prettyPrint(bq.$0);};X.p$2=function(bq){return bq==null?"null":"Some "+_2.prettyPrint(bq.$0);};X.p$1=function(bq){return"Intent ("+_2.prettyPrint(bq.$0)+", "+X.p$2(bq.$1)+")";};X.p=function(bq){return bq==null?"null":"Some "+X.p$1(bq.$0);};X.p$4=function(bq){return"Trait ("+_2.prettyPrint(bq.$0)+", "+_2.prettyPrint(bq.$1)+", "+X.p$2(bq.$2)+")";};X.p$3=function(bq){return bq==null?"null":"Some "+_2.printList(function(br){return X.p$4(br);},bq.$0);};X.p$6=function(bq){return"Entity ("+_2.prettyPrint(bq.$0)+", "+_2.prettyPrint(bq.$1)+", "+X.p$2(bq.$2)+")";};X.p$5=function(bq){return bq==null?"null":"Some "+_2.printList(function(br){return X.p$6(br);},bq.$0);};X.p$7=function(bq){return"Utterance ("+X.p(bq.$0)+", "+X.p$3(bq.$1)+", "+X.p$5(bq.$2)+")";};}());
