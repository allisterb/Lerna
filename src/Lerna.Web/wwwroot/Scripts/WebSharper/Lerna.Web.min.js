(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.StudyJournalEntry=c.StudyJournalEntry||{};j=c.Message=c.Message||{};k=c.Wit=c.Wit||{};l=k.NLUResponse=k.NLUResponse||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=b.Web=b.Web||{};p=o.ClientExtensions=o.ClientExtensions||{};q=o._Html=o._Html||{};r=o.htmModule=o.htmModule||{};s=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};t=b.Bootstrap=b.Bootstrap||{};u=t.Controls=t.Controls||{};v=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};w=o.NLU=o.NLU||{};x=w.Intent=w.Intent||{};y=w.Trait=w.Trait||{};z=w.Entity=w.Entity||{};A=w.Utterance=w.Utterance||{};B=w.Question=w.Question||{};C=w.Voice=w.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=w.Text=w.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=w.Domain=w.Domain||{};K=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};L=o.CUI=o.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};R=o.Main=o.Main||{};S=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};T=o.Study=o.Study||{};U=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};V=o.Client=o.Client||{};W=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};X=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};Y=a.IntelliFactory;Z=Y&&Y.Runtime;_0=a.WebSharper;_1=_0&&_0.Strings;_2=_0&&_0.Utils;_3=a.console;_4=a.jQuery;_5=_0&&_0.Arrays;_6=_0&&_0.List;_7=_0&&_0.Seq;_8=_0&&_0.UI;_9=_8&&_8.Doc;_=_8&&_8.AttrModule;$=_0&&_0.JavaScript;ba=$&&$.Pervasives;bb=_0&&_0.Collections;bc=bb&&bb.Map;bd=b&&b.NLU;be=bd&&bd.Wit;bf=be&&be.WitApi;bg=_0&&_0.Concurrency;bh=a.SDK;bi=_0&&_0.Random;bj=_0&&_0.Operators;bk=_0&&_0.Remoting;bl=bk&&bk.AjaxRemotingProvider;bm=bd&&bd.QnAMaker;bn=a.Wit;bo=a.document;bp=_0&&_0.Unchecked;bq=bb&&bb.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(br,bs){return{Street:br,Town:bs};};f.New=function(br,bs,bt){return{Full:br,First:bs,Last:bt};};g=c.User=Z.Class({toString:function(){return this.Name;}},null,g);g.New=function(br,bs){return new g({Name:br,LastLoggedIn:bs});};h.New=function(br,bs,bt,bu,bv){return{Id:br,Sex:bs,Name:bt,BirthDate:bu,Address:bv};};i.New=function(br,bs,bt,bu){return{UserName:br,Date:bs,Subject:bt,Duration:bu};};j.New=function(br,bs,bt,bu){return{UserName:br,Date:bs,Text:bt,IsRead:bu};};l.New=function(br,bs,bt,bu,bv,bw){return{type:br,msg:bs,action:bt,traits:bu,entities:bv,confidence:bw};};m.New=function(br,bs,bt){return{id:br,value:bs,confidence:bt};};n.New=function(br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB){return{id:br,name:bs,role:bt,start:bu,end:bv,body:bw,confidence:bx,entities:by,suggested:bz,value:bA,type:bB};};p.speechSynthesis=function(){return a.speechSynthesis;};p.replace_tok=function(br,bs,bt){return _1.Replace(bt,br,bs);};p.toLower=function(br){return br.toLowerCase();};p.debug=function(br,bs){p.info((((Z.Curried3(function(bt,bu,bv){return bt("DEBUG: "+_2.toSafe(bu)+": "+_2.prettyPrint(bv));}))(a.id))(br.toUpperCase()))(bs));};p.error=function(br){_3.error(br);};p.info=function(br){_3.info(br);};p.jserror=function(br){_4.error(br);};p.toArray=function(br){return _5.map(a.id,_4.makeArray(br));};p["Terminal.EchoHtml'"]=function(br,bs){br.pause();br.echo(bs,p.rawOpt());br.resume();};p["Terminal.Echo'"]=function(br,bs){br.pause();br.echo(bs);br.resume();};p.rawOpt=function(){s.$cctor();return s.rawOpt;};q=o._Html=Z.Class({toString:function(){return q.toString(this);}},null,q);q.toString=function(br){function bs(bt){return function(bu){var bv,bw,bx,by,bz,bA,bB;bw=_1.replicate(bt," ");switch(bu.$==0?bu.$1.$==1?bu.$1.$0.$==2?bu.$1.$1.$==0?(bv=[bu.$1.$0.$0,bu.$0],1):(bv=[bu.$1,bu.$0],2):(bv=[bu.$1,bu.$0],2):(bv=[bu.$1,bu.$0],2):bu.$==2?(bv=bu.$0,3):(bv=[bu.$0,bu.$1],0)){case 0:return bv[0]+"=\""+bv[1]+"\"";case 1:bx=bv[1];return bw+"<"+bx+">"+bv[0]+"</"+bx+">\r\n";case 2:by=bv[1];bz=_6.partition(function(bC){return bC.$==1;},bv[0]);bA=bz[1];bB=bz[0];return bA.$==0?bw+"<"+by+(bB.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bC){return(bs(0))(bC);},bB);}))))+"/>\r\n":bw+"<"+by+(bB.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bC){return(bs(0))(bC);},bB);}))))+">\r\n"+_1.concat("",_6.ofSeq(_7.delay(function(){return _7.map(function(bC){return(bs(bt+1))(bC);},bA);})))+bw+"</"+by+">\r\n";case 3:return bw+bv+"\r\n";}};}return(bs(0))(br);};r.alt=function(br){return new q({$:1,$0:"alt",$1:br});};r.src=function(br){return new q({$:1,$0:"src",$1:br});};r.cls=function(br){return new q({$:1,$0:"class",$1:br});};r.str=function(br){return q.toString(br);};r.op_PercentEquals=function(br,bs){return new q({$:1,$0:br,$1:bs});};r.op_Splice=function(br){var bs;return _6.ofArray([new q({$:2,$0:(bs=br,a.String(bs))})]);};r.strong=function(){s.$cctor();return s.strong;};r.h4=function(){s.$cctor();return s.h4;};r.h3=function(){s.$cctor();return s.h3;};r.h2=function(){s.$cctor();return s.h2;};r.h1=function(){s.$cctor();return s.h1;};r.li=function(){s.$cctor();return s.li;};r.ul=function(){s.$cctor();return s.ul;};r.th=function(){s.$cctor();return s.th;};r.td=function(){s.$cctor();return s.td;};r.tr=function(){s.$cctor();return s.tr;};r.a=function(){s.$cctor();return s.a;};r.p=function(){s.$cctor();return s.p;};r.area=function(){s.$cctor();return s.area;};r.map=function(){s.$cctor();return s.map;};r.img=function(){s.$cctor();return s.img;};r.tfoot=function(){s.$cctor();return s.tfoot;};r.tbody=function(){s.$cctor();return s.tbody;};r.thead=function(){s.$cctor();return s.thead;};r.table=function(){s.$cctor();return s.table;};r.span=function(){s.$cctor();return s.span;};r.section=function(){s.$cctor();return s.section;};r.br=function(){s.$cctor();return s.br;};r.div=function(){s.$cctor();return s.div;};r.body=function(){s.$cctor();return s.body;};r.style=function(){s.$cctor();return s.style;};r.title=function(){s.$cctor();return s.title;};r.head=function(){s.$cctor();return s.head;};r.html=function(){s.$cctor();return s.html;};r.elem=function(br,bs){return new q({$:0,$0:br,$1:bs});};s.$cctor=function(){var br;s.$cctor=a.ignore;s.rawOpt=(br={},br.raw=true,br);s.html=function(bs){return r.elem("html",bs);};s.head=function(bs){return r.elem("head",bs);};s.title=function(bs){return r.elem("title",bs);};s.style=function(bs){return r.elem("style",bs);};s.body=function(bs){return r.elem("body",bs);};s.div=function(bs){return r.elem("div",bs);};s.br=function(bs){return r.elem("br",bs);};s.section=function(bs){return r.elem("section",bs);};s.span=function(bs){return r.elem("span",bs);};s.table=function(bs){return r.elem("table",bs);};s.thead=function(bs){return r.elem("thead",bs);};s.tbody=function(bs){return r.elem("tbody",bs);};s.tfoot=function(bs){return r.elem("tfoot",bs);};s.img=function(bs){return r.elem("img",bs);};s.map=function(bs){return r.elem("map",bs);};s.area=function(bs){return r.elem("area",bs);};s.p=function(bs){return r.elem("p",bs);};s.a=function(bs){return r.elem("a",bs);};s.tr=function(bs){return r.elem("tr",bs);};s.td=function(bs){return r.elem("td",bs);};s.th=function(bs){return r.elem("th",bs);};s.ul=function(bs){return r.elem("ul",bs);};s.li=function(bs){return r.elem("li",bs);};s.h1=function(bs){return r.elem("h1",bs);};s.h2=function(bs){return r.elem("h1",bs);};s.h3=function(bs){return r.elem("h1",bs);};s.h4=function(bs){return r.elem("h1",bs);};s.strong=function(bs){return r.elem("strong",bs);};};u.Radio=function(br,bs,bt,bu,bv){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("radio"),$1:bs}),[_9.Element("label",bu,[_9.Radio(bv,true,bt),_9.TextNode(br)])]);};u.Checkbox=function(br,bs,bt,bu,bv){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("checkbox"),$1:bs}),[_9.Element("label",bu,[_9.CheckBox(bv,bt),_9.TextNode(br)])]);};u.TextArea=function(br,bs,bt,bu,bv){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bs}),[_9.Element("label",bu,[_9.TextNode(br)]),_9.InputArea(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bv}),bt)]);};u.InputPassword=function(br,bs,bt,bu,bv){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bs}),[_9.Element("label",bu,[_9.TextNode(br)]),_9.PasswordBox(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bv}),bt)]);};u.Input=function(br,bs,bt,bu,bv){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bs}),[_9.Element("label",bu,[_9.TextNode(br)]),_9.Input(new _6.T({$:1,$0:(u.cls())("form-control"),$1:bv}),bt)]);};u.Container=function(br){return _9.Element("div",[(u.cls())("container")],br);};u.Class=function(){v.$cctor();return v.Class;};u.cls=function(){v.$cctor();return v.cls;};v.$cctor=function(){v.$cctor=a.ignore;v.cls=_.Class;v.Class=_.Class;};x=w.Intent=Z.Class({toString:function(){return(((Z.Curried3(function(br,bs,bt){return br("Intent("+_2.toSafe(bs)+", "+X.p$2(bt)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=w.Trait=Z.Class({toString:function(){return(((Z.Curried3(function(br,bs,bt){return br("Trait("+_2.toSafe(bs)+", "+_2.prettyPrint(bt)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,y);z=w.Entity=Z.Class({toString:function(){return((((Z.Curried(function(br,bs,bt,bu){return br("Entity("+_2.toSafe(bs)+", "+_2.toSafe(bt)+", "+X.p$2(bu)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);A=w.Utterance=Z.Class({toString:function(){return((((Z.Curried(function(br,bs,bt,bu){return br(X.p(bs)+" "+X.p$3(bt)+" "+X.p$5(bu));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var br;br=this.$2;return br!=null?{$:1,$0:_6.sortBy(function(bs){return bs.get_Name();},br.$0)}:null;},get_Traits:function(){var br;br=this.$1;return br!=null?{$:1,$0:_6.sortBy(function(bs){return bs.get_Name();},br.$0)}:null;},get_Intent:function(){return this.$0;}},null,A);B=w.Question=Z.Class({toString:function(){return(((Z.Curried3(function(br,bs,bt){return br("Name: "+_2.toSafe(bs)+" Text: "+_2.toSafe(bt));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);D.New=function(br,bs,bt,bu,bv){return{body:br,end:bs,start:bt,suggested:bu,value:bv};};C["Intent'"]=function(br,bs){return!(bs.intent==null)?{$:1,$0:new x({$:0,$0:p.toLower(bs.intent.value),$1:null})}:null;};C["Trait'"]=function(br){return!(br.domain==null)?{$:1,$0:new y({$:0,$0:"domain",$1:p.toLower(br.domain.value),$2:null})}:!(br.dialogue_act==null)?{$:1,$0:new y({$:0,$0:"dialogue_act",$1:p.toLower(br.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(br){return!(br.contact==null)?{$:1,$0:new z({$:0,$0:"contact",$1:p.toLower(br.contact.value),$2:null})}:null;};F=E["Utterance'"]=Z.Class({get_TopIntent:function(){return _6.head(_6.sortBy(function(br){return br.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,F);G=E["Intent'"]=Z.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(br){var bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF;return br!=null&&br.$==1&&(br.$0.$0.$==0&&(br.$0.$1.get_Length()>0&&(bs=[br.$0.$1,br.$0.$2],true)))?(bt=_6.map(function(bG){return new z({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bs[0])),{$:1,$0:new A({$:0,$0:null,$1:{$:1,$0:_6.map(function(bG){return new y({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bs[1]))},$2:{$:1,$0:bt}})}):br!=null&&br.$==1&&(br.$0.$1.$==0&&(br.$0.$2.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bu=[br.$0.$0,br],true))))?(bv=bu[1],{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bv.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bv.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):br!=null&&br.$==1&&(br.$0.$2.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bw=[br.$0.$0,br],true)))?(bx=bw[1],(by=_6.map(function(bG){return new z({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bx.$0.get_Entities())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bx.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bx.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:by}})})):br!=null&&br.$==1&&(br.$0.$1.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bz=[br.$0.$0,br],true)))?(bA=bz[1],(bB=_6.map(function(bG){return new y({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bA.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bB},$2:null})})):br!=null&&br.$==1&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bC=[br.$0.$0,br],true))?(bD=bC[1],(bE=_6.map(function(bG){return new z({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bD.$0.get_Entities())),(bF=_6.map(function(bG){return new y({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_6.filter(function(bG){return bG.get_Confidence()>E.entityConfidenceThreshold();},bD.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bD.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bD.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bF},$2:{$:1,$0:bE}})}))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(br){K.$cctor();K.entityConfidenceThreshold=br;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(br){K.$cctor();K.intentConfidenceThreshold=br;};E.getUtterance=function(br,bs){E.witapi().getMeaning(br,function(bt){var bu,bv;p.debug("NLU",(function(bw){return function(bx){return bw("Wit.ai returned: "+_2.prettyPrint(bx));};}(a.id))(bt));bu=!(bt.intents==null)?_6.ofArray(_5.map(function(bw){return new G({$:0,$0:bw.name,$1:bw.confidence});},bt.intents)):_6.T.Empty;bv=!(bt.traits==null)?_6.ofSeq(_7.concat(_6.map(function(bw){return _5.map(function(bx){return new I({$:0,$0:bw,$1:bx.confidence,$2:bx.value});},ba.GetJS(bt.traits,[bw]));},_6.filter(function(bw){return!(ba.GetJS(bt.traits,[bw])==null);},E.trait_types())))):_6.T.Empty;return bs({$:1,$0:new F({$:0,$0:bu,$1:!(bt.intents==null)?_6.ofSeq(_7.concat(_6.map(function(bw){return _5.map(function(bx){return new H({$:0,$0:bx.name,$1:bx.confidence,$2:bx.role,$3:bx.value});},ba.GetJS(bt.entities,[bw]));},_6.filter(function(bw){return!(ba.GetJS(bt.entities,[bw])==null);},E.entity_types())))):_6.T.Empty,$2:bv})});},function(bt,bu,bv){p.error((((Z.Curried3(function(bw,bx,by){return bw("Wit.ai returned: "+_2.prettyPrint(bx)+" "+_2.prettyPrint(by));}))(a.id))(bu))(bv));return bs(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.witapi=function(){K.$cctor();return K.witapi;};E.QuickPrograms=function(br){return br==="programs"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};E.QuickNumber=function(br){var bs,bt,bu;return(bt=E.One(br),bt!=null&&bt.$==1?(bs=bt.$0,true):(bu=E.Two(br),bu!=null&&bu.$==1&&(bs=bu.$0,true)))?{$:1,$0:bs}:null;};E.Three=function(br){var bs;return br==="3"||br==="three"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};E.Two=function(br){var bs;return br==="2"||br==="two"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};E.One=function(br){var bs;return br==="1"||br==="one"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(br){var bs;return br==="no"||(br==="NO"||(br==="No"||(br==="nope"||(br==="no way"||(br==="nah"||(br==="don't do it"||br==="stop"))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickYes=function(br){var bs;return br==="yes"||(br==="YES"||(br==="Yes"||(br==="YEs"||(br==="ok"||(br==="sure"||(br==="yeah"||(br==="yep"||(br==="uh huh"||(br==="go ahead"||br==="go")))))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHelp=function(br){var bs;return br==="help"||(br==="help me"||(br==="what's this?"||br==="huh"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHello=function(br){var bs;return br==="hello"||(br==="hey"||(br==="yo"||br==="hi"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.Voices=function(br){return br==="voices"?{$:1,$0:null}:null;};E.Debug=function(br){return br==="debug"?{$:1,$0:null}:null;};E.Blank=function(br){return br===""?{$:1,$0:null}:null;};J.Study=function(br){return br.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};w.No=function(br){var bs,bt,bu,bv,bw,bx;return(bt=w.Intent$1("no",br),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=br,true))))?{$:1,$0:bs}:(bv=w.Intent$1("noresponse",br),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=br,true))))?{$:1,$0:bu}:(bx=w.Intent$1("NoResponse",br),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=br,true))))?{$:1,$0:bw}:null;};w.Yes=function(br){var bs,bt,bu,bv,bw,bx;return(bt=w.Intent$1("yes",br),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=br,true))))?{$:1,$0:bs}:(bv=w.Intent$1("yesresponse",br),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=br,true))))?{$:1,$0:bu}:(bx=w.Intent$1("YesResponse",br),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=br,true))))?{$:1,$0:bw}:null;};w.EntityManyofMany=function(br,bs){return{$:1,$0:bc.OfArray(_5.ofSeq(_6.map(function(bt){return _6.exists(function(bu){return bu.get_Name()===bt;},bs)?[bt,{$:1,$0:_6.filter(function(bu){return bu.get_Name()===bt;},bs)}]:[bt,null];},br)))};};w.EntityManyOf1=function(br,bs){var bt;return bs!=null&&bs.$==1&&(_6.exists(function(bu){return bu.get_Name()===br;},bs.$0)&&(bt=bs.$0,true))?{$:1,$0:_6.filter(function(bu){return bu.get_Name()===br;},bt)}:null;};w.Entity1OfAny=function(br,bs){var bt;return bs!=null&&bs.$==1&&(_6.exists(function(bu){return bu.get_Name()===br;},bs.$0)&&(bt=bs.$0,true))?{$:1,$0:_6.head(_6.sortBy(function(bu){return bu.get_Name();},_6.filter(function(bu){return bu.get_Name()===br;},bt)))}:null;};w.Entity1Of1=function(br,bs){var bt;return bs!=null&&bs.$==1&&(bs.$0.$==1&&(bs.$0.$1.$==0&&(bs.$0.$0.get_Name()===br&&(bt=bs.$0.$0,true))))?{$:1,$0:bt}:null;};w.Intent$1=function(br,bs){return bs.get_Intent()!=null&&bs.get_Intent().$0.get_Name()===br?{$:1,$0:[bs.get_Traits(),bs.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.witapi=new bf.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");K.entity_types=_6.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);K.trait_types=_6.ofArray(["domain","dialogue_act"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=Z.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=Z.Class({SayVoices:function(){var br,bs,bt;br=this;bs=a.speechSynthesis.getVoices();!(bs==null)?(bt=p.toArray(bs),br.Say((function(bu){return function(bv){return bu("There are currently "+a.String(bv)+" voices installed on this computer or device.");};}(a.id))(_5.length(bt))),_5.iteri(function(bu,bv){return br.Say(((((Z.Curried(function(bw,bx,by,bz){return bw("Voice "+a.String(bx)+". Name: "+_2.toSafe(by)+", Local: "+_2.prettyPrint(bz)+".");},4))(a.id))(bu))(bv.name))(bv.localService));},bt)):void 0;},Wait:function(br){this.Wait$1(function(){bg.Start(br,null);});},Wait$1:function(br){this["Echo'"]("please wait...");this.Term.pause();br();this.Term.resume();},sayRandom:function(br,bs){this.Say(L.getRandomPhrase(br,bs));},Say:function(br){var bs,bt;bs=this;bg.Start((bt=null,bg.Delay(function(){var bu;bu=p.speechSynthesis();return bg.Combine(bu.speaking?(bu.cancel(),bh.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){bs.Avatar.addMessage(br);bs.Avatar.processMessages(0);return bg.Zero();}));})),null);},Debug:function(br,bs){p.debug(br,bs);},"EchoHtml'":function(br){var bs,bt;bs=(bt={},bt.raw=true,bt);this.Term.disable();this.Term.echo(br,bs);this.Term.enable();},"Echo'":function(br){this.Term.disable();this.Term.echo(br);this.Term.enable();}},null,P);P.New=function(br,bs,bt,bu,bv){return new P({Voice:br,Mic:bs,Term:bt,Avatar:bu,Caption:bv});};L.waitAddPhrases=function(){Q.$cctor();return Q.waitAddPhrases;};L.waitRetrievePhrases=function(){Q.$cctor();return Q.waitRetrievePhrases;};L.helpPhrases=function(){Q.$cctor();return Q.helpPhrases;};L.helloUserPhrases=function(){Q.$cctor();return Q.helloUserPhrases;};L.helloPhrases=function(){Q.$cctor();return Q.helloPhrases;};L["getRandomPhrase'"]=function(br){return p.replace_tok("$0","",_7.nth(L.rng().Next(0,br.get_Length()),br));};L.getRandomPhrase=function(br,bs){return p.replace_tok("$0",bs,_7.nth(L.rng().Next(0,br.get_Length()),br));};L.rng=function(){Q.$cctor();return Q.rng;};Q.$cctor=function(){Q.$cctor=a.ignore;Q.rng=new bi.New();Q.helloPhrases=_6.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);Q.helloUserPhrases=_6.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);Q.helpPhrases=_6.ofArray(["What can I help you with $0?"]);Q.waitRetrievePhrases=_6.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);Q.waitAddPhrases=_6.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};R.update=function(br,bs,bt,bu,bv){var bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;function co(cG){br["EchoHtml'"](cG);}function cp(cG){br.Say(cG);}function cq(cG){bu.unshift(cG);cp(cG);}function cr(cG,cH){var cI;cI=L.getRandomPhrase(cG,cH);bu.unshift(cI);return br.Say(cI);}function cs(cG){return bs.ContainsKey(cG);}function ct(cG,cH){return bs.Add(cG,cH);}function cu(cG){bs.Remove(cG);}function cv(){bv.shift();}function cw(){bt.shift();}function cx(cG){var cH;cH=R.getQuestion(cG);cH==null?(function(cI){return function(cJ){return cI("No such question: "+_2.toSafe(cJ));};}(bj.FailWith))(cG):bt.unshift(cH.$0);}function cy(cG,cH){ct(cG,cH);cx(cG);R.debug((function(cI){return function(cJ){return cI("Added question: "+X.p$8(cJ)+".");};}(a.id))(bt[0]));return cq(p.replace_tok("$0",cH,R.getQuestion(cG).$0.get_Text()));}function cz(cG,cH){return cs(cG)?{$:1,$0:cH}:null;}function cA(cG,cH){return!cs(cG)?{$:1,$0:cH}:null;}function cB(cG){var cH,cI;return(cI=cz("user",cG),cI!=null&&cI.$==1&&(bt.length===0&&(cH=cI.$0,true)))?(cv(),{$:1,$0:cH}):null;}function cC(cG,cH){var cI,cJ,cK;return(cJ=cz("user",cH),cJ!=null&&cJ.$==1&&(R.haveQuestion(cG)&&bt.length>0&&bt[0].get_Name()===cG&&(cI=cJ.$0,true)))?(cv(),cw(),cs(cG)?(cK=bs.get_Item(cG),(cu(cG),{$:1,$0:[cI,{$:1,$0:cK}]})):{$:1,$0:[cI,null]}):null;}function cD(cG,cH){var cI,cJ,cK;return(cJ=cA("user",cH),cJ!=null&&cJ.$==1&&(R.haveQuestion(cG)&&bt.length>0&&bt[0].get_Name()===cG&&(cI=cJ.$0,true)))?(cv(),cw(),cs(cG)?(cK=bs.get_Item(cG),(cu(cG),{$:1,$0:[cI,{$:1,$0:cK}]})):{$:1,$0:[cI,null]}):null;}function cE(cG){var cH,cI;return(cI=cA("user",cG),cI!=null&&cI.$==1&&(bt.length===0&&(cH=cI.$0,true)))?(cv(),{$:1,$0:cH}):null;}function cF(cG){var cH;return cG!=null&&cG.$==1&&(typeof cG.$0=="string"&&(cH=cG.$0,true))?{$:1,$0:cH}:null;}R.debug((((Z.Curried3(function(cG,cH,cI){return cG("Starting utterances:"+_2.prettyPrint(cH)+". Starting questions: "+_2.prettyPrint(cI)+".");}))(a.id))(bv))(bt));bw=_6.ofSeq(_7.take(bv.length>=5?5:bv.length,bv));bw.$==1&&(by=(bz=cA("started",bw.$0),bz!=null&&bz.$==1?{$:1,$0:bz.$0}:null),by!=null&&by.$==1&&(bA=cE(by.$0),bA!=null&&bA.$==1&&(bB=w.Intent$1("hello",bA.$0),bB!=null&&bB.$==1&&(bB.$0[1]==null&&bw.$1.$==0))))?(bs.Add("started",true),cr(L.helloPhrases(),"")):bw.$==1&&(bD=cE(bw.$0),bD!=null&&bD.$==1&&(bE=w.Intent$1("hello",bD.$0),bE!=null&&bE.$==1&&(bE.$0[1]==null&&bw.$1.$==0)))?cq("Hello, tell me your name to get started."):bw.$==1&&(bG=cE(bw.$0),bG!=null&&bG.$==1&&(bH=w.Intent$1("hello",bG.$0),bH!=null&&bH.$==1&&(bI=w.Entity1Of1("contact",bH.$0[1]),bI!=null&&bI.$==1&&(bw.$1.$==0&&(bF=bI.$0,true)))))?(bJ=bF.get_Value(),cr(L.waitRetrievePhrases(),"user name"),bg.Start((bK=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1472416806",[bJ]),function(cG){var cH;return cG==null?(cq((function(cI){return function(cJ){return cI("I did not find a user with the name "+_2.toSafe(cJ)+".");};}(a.id))(bJ)),cy("addUser",bJ),bg.Zero()):(cH=cG.$0,(cr(L.helloUserPhrases(),(function(cI){return function(cJ){return cI(_2.prettyPrint(cJ));};}(a.id))(bs.get_Item("user"))),bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:2105536908",[cH.Name]),function(){bs.Add("user",cH);return bg.Combine(cH.LastLoggedIn!=null?bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-59674622",[cH.LastLoggedIn.$0]),function(cI){cq((function(cJ){return function(cK){return cJ("You last logged in "+_2.toSafe(cK)+".");};}(a.id))(cI));return bg.Zero();}):bg.Zero(),bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:822033284",[cH.Name]),function(cI){bs.Add("msgs",cI);return cI!=null&&cI.$0.get_Length()>0?(cq((function(cJ){return function(cK){return cJ("You have "+a.String(cK)+" new messages.");};}(a.id))(cI.$0.get_Length())),cq(cI.$0.get_Item(0).Text),co((function(cJ){return function(cK){return cJ("Message: "+_2.toSafe(cK));};}(a.id))(cI.$0.get_Item(0).Text)),bg.Zero()):bg.Zero();});}));})));});})),null)):bw.$==1&&(bM=w.Yes(bw.$0),bM!=null&&bM.$==1&&(bN=cD("addUser",bM.$0),bN!=null&&bN.$==1&&(bO=cF(bN.$0[1]),bO!=null&&bO.$==1&&(bw.$1.$==0&&(bL=bO.$0,true)))))?bg.Start((bP=null,bg.Delay(function(){cr(L.waitAddPhrases(),"user");return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:2105536908",[bL]),function(cG){return cG==null?(cq((function(cH){return function(cI){return cH("Sorry I was not able to add the user "+_2.toSafe(cI)+" to the system.");};}(a.id))(bL)),bg.Zero()):(ct("user",bL),bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addMessage:-800967020",[bL,"Welcome to Lerna."]),function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:822033284",[bL]),function(cH){ct("msgs",cH);cq((function(cI){return function(cJ){return cI("Hello "+_2.prettyPrint(cJ)+", nice to meet you.");};}(a.id))(bs.get_Item("user")));return cH!=null&&cH.$0.get_Length()>0?(cq((function(cI){return function(cJ){return cI("You have "+a.String(cJ)+" new messages.");};}(a.id))(cH.$0.get_Length())),bg.Zero()):bg.Zero();});}));});})),null):bw.$==1&&(bR=w.No(bw.$0),bR!=null&&bR.$==1&&(bS=cD("addUser",bR.$0),bS!=null&&bS.$==1&&(bT=cF(bS.$0[1]),bT!=null&&bT.$==1&&(bw.$1.$==0&&(bQ=bT.$0,true)))))?cq((function(cG){return function(cH){return cG("Ok I did not add the user "+_2.toSafe(cH)+". But you must login for me to help you.");};}(a.id))(bQ)):bw.$==1&&((bV=cE(bw.$0),bV!=null&&bV.$==1)&&bw.$1.$==0)?cq("Could you introduce yourself so we can get started?"):bw.$==1&&(bX=cB(bw.$0),bX!=null&&bX.$==1&&(bY=w.Intent$1("hello",bX.$0),bY!=null&&bY.$==1&&(bY.$0[0]==null&&(bZ=w.Entity1Of1("contact",bY.$0[1]),bZ!=null&&bZ.$==1&&(bw.$1.$==0&&(bW=bZ.$0,true))))))?bg.Start((b0=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1472416806",[bW.get_Value()]),function(cG){return cG==null?(cq((function(cH){return function(cI){return cH("Sorry, the user "+_2.toSafe(cI)+" does not exist.");};}(a.id))(bW.get_Value())),bg.Zero()):(cy("switchUser",cG.$0.Name),bg.Zero());});})),null):bw.$==1&&(b2=w.Yes(bw.$0),b2!=null&&b2.$==1&&(b3=cC("switchUser",b2.$0),b3!=null&&b3.$==1&&(b4=cF(b3.$0[1]),b4!=null&&b4.$==1&&(bw.$1.$==0&&(b1=b4.$0,true)))))?(bs.set_Item("user",b1),cq((function(cG){return function(cH){return cG("Ok I switched to user "+_2.prettyPrint(cH)+".");};}(a.id))(b1))):bw.$==1&&(b6=w.No(bw.$0),b6!=null&&b6.$==1&&(b7=cC("switchUser",b6.$0),b7!=null&&b7.$==1&&(b8=cF(b7.$0[1]),b8!=null&&b8.$==1&&(bw.$1.$==0&&(b5=b8.$0,true)))))?cq((function(cG){return function(cH){return cG("Ok I did not switch to user "+_2.toSafe(cH)+".");};}(a.id))(b5)):bw.$==1&&(b_=cB(bw.$0),b_!=null&&b_.$==1&&((b$=w.Intent$1("studyjournal",b_.$0),b$!=null&&b$.$==1)&&bw.$1.$==0))?(co("<img src=\"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.YSxy_C2rlS83dQdUOq9MqwHaFB%26pid%3DApi&f=1\"/>"),cq("Good job! You are right on track with the rest of students in your cohort. Keep it up.")):bw.$==1&&(cb=cB(bw.$0),cb!=null&&cb.$==1&&((cc=w.Intent$1("nextclass",cb.$0),cc!=null&&cc.$==1)&&bw.$1.$==0))?(co("<iframe src=\"https://calendar.google.com/calendar/embed?src=cocnrm4290919hobq1f5he7leg%40group.calendar.google.com&ctz=America%2FPort_of_Spain\" style=\"border: 0\" width=\"800\" height=\"600\" frameborder=\"0\" scrolling=\"no\"></iframe>"),cq("Your next chemistry class is on Monday at 8:30AM.")):bw.$==1&&(ce=cB(bw.$0),ce!=null&&ce.$==1&&(cf=w.Intent$1("reference",ce.$0),cf!=null&&cf.$==1&&(cg=w.Entity1Of1("term",cf.$0[1]),cg!=null&&cg.$==1&&(bw.$1.$==0&&(cd=cg.$0,true)))))?bg.Start((ch=null,bg.Delay(function(){return bg.Bind(bm.getAnswer(cd.get_Value()),function(cG){var cH;cH=_5.get(cG.answers,0).answer;return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtohtml:-108568750",[cH]),function(cI){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtotext:-108568750",[cH]),function(cJ){co(cI);cq(cJ);return bg.Zero();});});});})),null):bw.$==1&&(cj=cB(bw.$0),cj!=null&&cj.$==1&&(ck=w.Intent$1("quiz",cj.$0),ck!=null&&ck.$==1&&(cl=w.Entity1Of1("term",ck.$0[1]),cl!=null&&cl.$==1&&(bw.$1.$==0&&(ci=cl.$0,true)))))?bg.Start((cm=null,bg.Delay(function(){co("What is the most accurate definition of an element?<br>1. A bond between molecules<br>2. A substance that cannot be broken down into simpler components.<br>3. A combination of atoms.<br> 4. A part of water.");cq("What is the most accurate definition of an element? 1. A bond between molecules. 2. A substance that cannot be broken down into simpler components. 3. A combination of atoms 4. A part of water.");return bg.Zero();})),null):(cv(),R.debug("Main interpreter did not understand utterance."),cq("Sorry I didn't understand what you meant."),bt.length>0?(cn=_7.nth(0,bt),cs(cn.get_Name())?cq(p.replace_tok("$0",bs.get_Item(cn.get_Name()),cn.get_Text())):cq(cn.get_Text())):void 0);R.debug((((Z.Curried3(function(cG,cH,cI){return cG("Ending utterances: "+_2.prettyPrint(cH)+". Ending questions:"+_2.prettyPrint(cI)+".");}))(a.id))(bv))(bt));};R.haveQuestion=function(br){return _6.exists(function(bs){return bs.get_Name()===br;},R.questions());};R.getQuestion=function(br){return _7.tryFind(function(bs){return bs.get_Name()===br;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(br){p.debug("Main",br);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_6.ofArray([new B({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new B({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"})]);};T.update=function(br,bs,bt,bu,bv){T.debug((((Z.Curried3(function(bw,bx,by){return bw("Starting utterances:"+_2.prettyPrint(bx)+". Starting questions: "+_2.prettyPrint(by)+".");}))(a.id))(bv))(bt));};T.haveQuestion=function(br){return _6.exists(function(bs){return bs.get_Name()===br;},T.questions());};T.getQuestion=function(br){return _7.tryFind(function(bs){return bs.get_Name()===br;},T.questions());};T.questions=function(){U.$cctor();return U.questions;};T.debug=function(br){p.debug("Study",br);};U.$cctor=function(){U.$cctor=a.ignore;U.questions=_6.ofArray([new B({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new B({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new B({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};V.run=function(){var br,bs,bt;V.set_CUI((br=(bs=Z.ThisFunc(function(bu,bv){return((V.Main().get_Text())(bu))(bv);}),(bt=V.Main().get_Options(),void a.$("#main").terminal(bs,bt))),P.New(V.CUI().Voice,V.CUI().Mic,br,V.CUI().Avatar,V.CUI().Caption)));return _9.get_Empty();};V.Main=function(){W.$cctor();return W.Main;};V.initMic=function(br){var bs,bt;V.set_CUI((bs={$:1,$0:new bn.Microphone(bo.getElementById("microphone"))},P.New(V.CUI().Voice,bs,V.CUI().Term,V.CUI().Avatar,V.CUI().Caption)));bt=V.CUI().Mic.$0;bt.onconnecting=function(){V.set_MicState(M.MicConnecting);return V.debug("Mic connecting...");};bt.ondisconnected=function(){V.set_MicState(M.MicDisconnected);return V.debug("Mic disconnected.");};bt.onaudiostart=function(){V.set_MicState(M.MicAudioStart);return V.debug("Mic audio start...");};bt.onaudioend=function(){V.set_MicState(M.MicAudioEnd);return V.debug("Mic audio end.");};bt.onerror=function(bu){V.set_MicState({$:6,$0:bu});return V.debug((function(bv){return function(bw){return bv("Mic error : "+_2.toSafe(bw)+".");};}(a.id))(bu));};bt.onready=function(){V.set_MicState(M.MicReady);return V.debug("Mic ready.");};bt.onresult=function(bu,bv){return V.ClientState().$==2?V.echo("I'm still trying to understand what you said before."):V.ClientState().$==0?p.error("Client is not intialized."):!(bu==null||bv==null)?(V.set_MicState({$:7,$0:bu,$1:bv}),V.debug((((Z.Curried3(function(bw,bx,by){return bw("Mic result: "+_2.prettyPrint(bx)+" "+_2.prettyPrint(by)+".");}))(a.id))(bu))(bv)),br(bt,[bu,bv])):V.debug("Mic: No result returned.");};bt.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};V.sayRandom=function(br,bs){V.say(L.getRandomPhrase(bs,br));};V.sayVoices=function(){var br;br=p.toArray(p.speechSynthesis().getVoices());V["say'"]((function(bs){return function(bt){return bs("There are currently "+a.String(bt)+" voices installed on this computer or device.");};}(a.id))(_5.length(br)));_5.iteri(function(bs,bt){return V["say'"](((((Z.Curried(function(bu,bv,bw,bx){return bu("Voice "+a.String(bv)+". Name: "+_2.toSafe(bw)+", Local: "+_2.prettyPrint(bx)+".");},4))(a.id))(bs))(bt.name))(bt.localService));},br);};V.say=function(br){V.Responses().unshift(br);V["say'"](br);};V["say'"]=function(br){V.CUI().Say(br);};V.initSpeech=function(){var br,bs;br=p.toArray(V.synth().getVoices());_5.length(br)>0?(bs=_5.find(function(bt){return bt["default"];},br),V.set_CUI(P.New({$:1,$0:bs},V.CUI().Mic,V.CUI().Term,V.CUI().Avatar,V.CUI().Caption)),V.debug((function(bt){return function(bu){return bt("Using default voice "+_2.toSafe(bu)+".");};}(a.id))(V.CUI().Voice.$0.name)),V.CUI().Avatar.nativeVoice=true,V.CUI().Avatar.nativeVoiceName=bs.name):V.echo("No speech synthesis voice is available.");};V.synth=function(){W.$cctor();return W.synth;};V.push=function(br){V.Utterances().unshift(br);return V.Utterances();};V.Props=function(){W.$cctor();return W.Props;};V.Responses=function(){W.$cctor();return W.Responses;};V.Questions=function(){W.$cctor();return W.Questions;};V.Utterances=function(){W.$cctor();return W.Utterances;};V.wait=function(br){p["Terminal.Echo'"](V.CUI().Term,"please wait");V.CUI().Term.pause();br();V.CUI().Term.resume();};V.debug=function(br){p.debug("CLIENT",br);};V.echo=function(br){if(!(V.CUI().Term==null))p["Terminal.EchoHtml'"](V.CUI().Term,(function(bs){return function(bt){return bs(_2.prettyPrint(bt));};}(a.id))(br));};V.ClientState=function(){W.$cctor();return W.ClientState;};V.set_ClientState=function(br){W.$cctor();W.ClientState=br;};V.MicState=function(){W.$cctor();return W.MicState;};V.set_MicState=function(br){W.$cctor();W.MicState=br;};V.CUI=function(){W.$cctor();return W.CUI;};V.set_CUI=function(br){W.$cctor();W.CUI=br;};W.$cctor=function(){var br,bs,bt;W.$cctor=a.ignore;function bu(bw,bx){var by,bz,bA,bB,bC,bD,bE,bF,bG,bH;by=bx[0];bz=bx[1];V.debug((((Z.Curried3(function(bI,bJ,bK){return bI("Voice: "+_2.prettyPrint(bJ)+" "+_2.prettyPrint(bK));}))(a.id))(by))(bz));bA=(bB=C["Intent'"](by,bz),bB!=null&&bB.$==1?{$:1,$0:bB.$0}:null);bC=(bD=C["Trait'"](bz),bD!=null&&bD.$==1?{$:1,$0:_6.ofArray([bD.$0])}:null);bE=(bF=C["Entity'$1"](bz),bF!=null&&bF.$==1?{$:1,$0:_6.ofArray([bF.$0])}:null);return bA==null&&(bC==null&&bE==null)?null:(V.debug(((((Z.Curried(function(bI,bJ,bK,bL){return bI("Voice: "+X.p(bJ)+" "+X.p$3(bK)+" "+X.p$5(bL));},4))(a.id))(bA))(bC))(bE)),bH=V.push(new A({$:0,$0:bA,$1:bC,$2:bE})),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bH));}function bv(bw,bx){var by,bz,bA,bB,bC,bD,bE,bF,bG,bH;V.set_CUI(P.New(V.CUI().Voice,V.CUI().Mic,bw,V.CUI().Avatar,V.CUI().Caption));bp.Equals(V.CUI().Mic,null)?V.initMic(bu):void 0;bp.Equals(V.CUI().Voice,null)?V.initSpeech():void 0;V.ClientState().$===0?V.set_ClientState(N.ClientReady):void 0;return(by=E.Blank(bx),by!=null&&by.$==1)?V["say'"]("Tell me what you want me to do or ask me a question."):(bz=E.Debug(bx),bz!=null&&bz.$==1)?(V.debug((function(bI){return function(bJ){return bI("Utterances: "+_2.prettyPrint(bJ));};}(a.id))(V.Utterances())),V.debug((function(bI){return function(bJ){return bI("Questions: "+_2.prettyPrint(bJ));};}(a.id))(V.Questions()))):(bA=E.Voices(bx),bA!=null&&bA.$==1)?V.sayVoices():V.ClientState().$==1?(bC=E.QuickHello(bx),bC!=null&&bC.$==1?(bB=bC.$0,true):(bD=E.QuickHelp(bx),bD!=null&&bD.$==1?(bB=bD.$0,true):(bE=E.QuickYes(bx),bE!=null&&bE.$==1?(bB=bE.$0,true):(bF=E.QuickNo(bx),bF!=null&&bF.$==1&&(bB=bF.$0,true)))))?(V.debug((function(bI){return function(bJ){return bI("Quick Text: "+X.p$7(bJ)+".");};}(a.id))(bB)),bG=V.push(bB),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bG),V.set_ClientState(N.ClientReady)):V.CUI().Wait((bH=null,bg.Delay(function(){V.set_ClientState(N.ClientUnderstand);E.getUtterance(bx,function(bI){var bJ,bK,bL;bJ=E.HasUtterance(bI);bJ!=null&&bJ.$==1?(bK=bJ.$0,V.debug(((((Z.Curried(function(bM,bN,bO,bP){return bM("Text: Intent: "+X.p(bN)+", Traits: "+X.p$3(bO)+", Entities: "+X.p$5(bP));},4))(a.id))(bK.get_Intent()))(bK.get_Traits()))(bK.get_Entities())),bL=V.push(bK),R.update(V.CUI(),V.Props(),V.Questions(),V.Responses(),bL)):(V.debug("Text: Did not receive a meaning from the server."),V["say'"]("Sorry I did not understand what you said."));});V.set_ClientState(N.ClientReady);return bg.Zero();}))):V.ClientState().$==0?p.error("Client is not initialized."):V["say'"]("I'm still trying to understand what you said before.");}W.CUI=P.New(null,null,null,(bh.applicationId="4277115329081938617",br=new a.SDKConnection(),bs=new a.WebAvatar(),bs.version=8.5,bs.connection=br,bs.avatar="22225225",bs.voice="cmu-slt",bs.voiceMod="default",bs.nativeVoice=true,bs.nativeVoiceName="Microsoft David Desktop - English (United States)",bs.width=300,bs.createBox(),bs.addMessage(""),bs.processMessages(0),bs),false);W.MicState=M.MicNotInitialized;W.ClientState=N.ClientNotInitialzed;W.Utterances=[];W.Questions=[];W.Responses=[];W.Props=new bq.New$5();W.synth=a.speechSynthesis;bh.chime();W.Main=new O({$:0,$0:function(bw){return function(bx){return bu(bw,bx);};},$1:[function(bw){return function(bx){return bv(bw,bx);};},(bt={},bt.name="Main",bt.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bt.prompt=">",bt)]});};X.p$8=function(br){return"Question ("+_2.prettyPrint(br.$0)+", "+_2.prettyPrint(br.$1)+")";};X.p$9=function(br){return br==null?"null":"Some "+_2.prettyPrint(br.$0);};X.p$2=function(br){return br==null?"null":"Some "+_2.prettyPrint(br.$0);};X.p$1=function(br){return"Intent ("+_2.prettyPrint(br.$0)+", "+X.p$2(br.$1)+")";};X.p=function(br){return br==null?"null":"Some "+X.p$1(br.$0);};X.p$4=function(br){return"Trait ("+_2.prettyPrint(br.$0)+", "+_2.prettyPrint(br.$1)+", "+X.p$2(br.$2)+")";};X.p$3=function(br){return br==null?"null":"Some "+_2.printList(function(bs){return X.p$4(bs);},br.$0);};X.p$6=function(br){return"Entity ("+_2.prettyPrint(br.$0)+", "+_2.prettyPrint(br.$1)+", "+X.p$2(br.$2)+")";};X.p$5=function(br){return br==null?"null":"Some "+_2.printList(function(bs){return X.p$6(bs);},br.$0);};X.p$7=function(br){return"Utterance ("+X.p(br.$0)+", "+X.p$3(br.$1)+", "+X.p$5(br.$2)+")";};}());
