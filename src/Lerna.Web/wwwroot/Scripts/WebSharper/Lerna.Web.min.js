(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.SymptomEntry=c.SymptomEntry||{};j=b.Web=b.Web||{};k=j.ClientExtensions=j.ClientExtensions||{};l=j._Html=j._Html||{};m=j.htmModule=j.htmModule||{};n=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};o=b.Bootstrap=b.Bootstrap||{};p=o.Controls=o.Controls||{};q=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};r=j.NLU=j.NLU||{};s=r.Intent=r.Intent||{};t=r.Trait=r.Trait||{};u=r.Entity=r.Entity||{};v=r.Utterance=r.Utterance||{};w=r.Question=r.Question||{};x=r.Voice=r.Voice||{};y=x["Entity'"]=x["Entity'"]||{};z=r.Text=r.Text||{};A=z["Utterance'"]=z["Utterance'"]||{};B=z["Intent'"]=z["Intent'"]||{};C=z["Entity'"]=z["Entity'"]||{};D=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};E=j.CUI=j.CUI||{};F=E.MicState=E.MicState||{};G=E.ClientState=E.ClientState||{};H=E.Interpreter=E.Interpreter||{};I=E.CUI=E.CUI||{};J=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};K=j.Main=j.Main||{};L=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};M=j.Client=j.Client||{};N=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};O=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};P=a.IntelliFactory;Q=P&&P.Runtime;R=a.WebSharper;S=R&&R.Strings;T=R&&R.Utils;U=a.console;V=a.jQuery;W=R&&R.Arrays;X=R&&R.List;Y=R&&R.Seq;Z=R&&R.UI;_0=Z&&Z.Doc;_1=Z&&Z.AttrModule;_2=R&&R.JavaScript;_3=_2&&_2.Pervasives;_4=R&&R.Collections;_5=_4&&_4.Map;_6=b&&b.NLU;_7=_6&&_6.Wit;_8=_7&&_7.WitApi;_9=R&&R.Concurrency;_=R&&R.Random;$=R&&R.Operators;ba=R&&R.Remoting;bb=ba&&ba.AjaxRemotingProvider;bc=a.Wit;bd=a.document;be=R&&R.Unchecked;bf=_6&&_6.QnAMaker;bg=_4&&_4.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(bh,bi){return{Street:bh,Town:bi};};f.New=function(bh,bi,bj){return{Full:bh,First:bi,Last:bj};};g=c.User=Q.Class({toString:function(){return this.Name;}},null,g);g.New=function(bh,bi){return new g({Name:bh,LastLoggedIn:bi});};h.New=function(bh,bi,bj,bk,bl){return{Id:bh,Sex:bi,Name:bj,BirthDate:bk,Address:bl};};i.New=function(bh,bi,bj,bk){return{UserName:bh,Date:bi,Magnitude:bj,Location:bk};};k.s=function(){n.$cctor();return n.s;};k.mdbold=function(){n.$cctor();return n.mdbold;};k.mdbblockquote=function(){n.$cctor();return n.mdbblockquote;};k.mdh3=function(){n.$cctor();return n.mdh3;};k.mdh2=function(){n.$cctor();return n.mdh2;};k.mdh1=function(){n.$cctor();return n.mdh1;};k.replace_tok=function(bh,bi,bj){return S.Replace(bj,bh,bi);};k.toLower=function(bh){return bh.toLowerCase();};k.debug=function(bh,bi){k.info((((Q.Curried3(function(bj,bk,bl){return bj("DEBUG: "+T.toSafe(bk)+": "+T.prettyPrint(bl));}))(a.id))(bh.toUpperCase()))(bi));};k.error=function(bh){U.error(bh);};k.info=function(bh){U.info(bh);};k.jserror=function(bh){V.error(bh);};k.toArray=function(bh){return W.map(a.id,V.makeArray(bh));};k["Terminal.EchoHtml'"]=function(bh,bi){bh.pause();bh.echo(bi,k.rawOpt());bh.resume();};k["Terminal.Echo'"]=function(bh,bi){bh.pause();bh.echo(bi);bh.resume();};k.rawOpt=function(){n.$cctor();return n.rawOpt;};l=j._Html=Q.Class({toString:function(){return l.toString(this);}},null,l);l.toString=function(bh){function bi(bj){return function(bk){var bl,bm,bn,bo,bp,bq,br;bm=S.replicate(bj," ");switch(bk.$==0?bk.$1.$==1?bk.$1.$0.$==2?bk.$1.$1.$==0?(bl=[bk.$1.$0.$0,bk.$0],1):(bl=[bk.$1,bk.$0],2):(bl=[bk.$1,bk.$0],2):(bl=[bk.$1,bk.$0],2):bk.$==2?(bl=bk.$0,3):(bl=[bk.$0,bk.$1],0)){case 0:return bl[0]+"=\""+bl[1]+"\"";case 1:bn=bl[1];return bm+"<"+bn+">"+bl[0]+"</"+bn+">\r\n";case 2:bo=bl[1];bp=X.partition(function(bs){return bs.$==1;},bl[0]);bq=bp[1];br=bp[0];return bq.$==0?bm+"<"+bo+(br.$===0?"":" "+S.concat(" ",X.ofSeq(Y.delay(function(){return Y.map(function(bs){return(bi(0))(bs);},br);}))))+"/>\r\n":bm+"<"+bo+(br.$===0?"":" "+S.concat(" ",X.ofSeq(Y.delay(function(){return Y.map(function(bs){return(bi(0))(bs);},br);}))))+">\r\n"+S.concat("",X.ofSeq(Y.delay(function(){return Y.map(function(bs){return(bi(bj+1))(bs);},bq);})))+bm+"</"+bo+">\r\n";case 3:return bm+bl+"\r\n";}};}return(bi(0))(bh);};m.alt=function(bh){return new l({$:1,$0:"alt",$1:bh});};m.src=function(bh){return new l({$:1,$0:"src",$1:bh});};m.cls=function(bh){return new l({$:1,$0:"class",$1:bh});};m.str=function(bh){return l.toString(bh);};m.op_PercentEquals=function(bh,bi){return new l({$:1,$0:bh,$1:bi});};m.op_Splice=function(bh){var bi;return X.ofArray([new l({$:2,$0:(bi=bh,a.String(bi))})]);};m.strong=function(){n.$cctor();return n.strong;};m.h4=function(){n.$cctor();return n.h4;};m.h3=function(){n.$cctor();return n.h3;};m.h2=function(){n.$cctor();return n.h2;};m.h1=function(){n.$cctor();return n.h1;};m.li=function(){n.$cctor();return n.li;};m.ul=function(){n.$cctor();return n.ul;};m.th=function(){n.$cctor();return n.th;};m.td=function(){n.$cctor();return n.td;};m.tr=function(){n.$cctor();return n.tr;};m.a=function(){n.$cctor();return n.a;};m.p=function(){n.$cctor();return n.p;};m.area=function(){n.$cctor();return n.area;};m.map=function(){n.$cctor();return n.map;};m.img=function(){n.$cctor();return n.img;};m.tfoot=function(){n.$cctor();return n.tfoot;};m.tbody=function(){n.$cctor();return n.tbody;};m.thead=function(){n.$cctor();return n.thead;};m.table=function(){n.$cctor();return n.table;};m.span=function(){n.$cctor();return n.span;};m.section=function(){n.$cctor();return n.section;};m.br=function(){n.$cctor();return n.br;};m.div=function(){n.$cctor();return n.div;};m.body=function(){n.$cctor();return n.body;};m.style=function(){n.$cctor();return n.style;};m.title=function(){n.$cctor();return n.title;};m.head=function(){n.$cctor();return n.head;};m.html=function(){n.$cctor();return n.html;};m.elem=function(bh,bi){return new l({$:0,$0:bh,$1:bi});};n.$cctor=function(){var bh;n.$cctor=a.ignore;n.rawOpt=(bh={},bh.raw=true,bh);n.mdh1=new a.RegExp("^# (.*$)","gim");n.mdh2=new a.RegExp("^## (.*$)","gim");n.mdh3=new a.RegExp("^### (.*$)","gim");n.mdbblockquote=new a.RegExp("/^\\> (.*$)/","gim");n.mdbold=new a.RegExp("/^\\> (.*$)/","gim");n.s="function parseMarkdown(markdownText) {\r\n        const htmlText = markdownText\r\n        \u0009.replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n        \u0009.replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n        \u0009.replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n        \u0009.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\r\n        \u0009.replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\r\n        \u0009.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\r\n        \u0009.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\r\n        \u0009.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2'>$1</a>\")\r\n        \u0009.replace(/\\n$/gim, '<br />')\r\n        \r\n        return htmlText.trim()\r\n    }\r\n    ";n.html=function(bi){return m.elem("html",bi);};n.head=function(bi){return m.elem("head",bi);};n.title=function(bi){return m.elem("title",bi);};n.style=function(bi){return m.elem("style",bi);};n.body=function(bi){return m.elem("body",bi);};n.div=function(bi){return m.elem("div",bi);};n.br=function(bi){return m.elem("br",bi);};n.section=function(bi){return m.elem("section",bi);};n.span=function(bi){return m.elem("span",bi);};n.table=function(bi){return m.elem("table",bi);};n.thead=function(bi){return m.elem("thead",bi);};n.tbody=function(bi){return m.elem("tbody",bi);};n.tfoot=function(bi){return m.elem("tfoot",bi);};n.img=function(bi){return m.elem("img",bi);};n.map=function(bi){return m.elem("map",bi);};n.area=function(bi){return m.elem("area",bi);};n.p=function(bi){return m.elem("p",bi);};n.a=function(bi){return m.elem("a",bi);};n.tr=function(bi){return m.elem("tr",bi);};n.td=function(bi){return m.elem("td",bi);};n.th=function(bi){return m.elem("th",bi);};n.ul=function(bi){return m.elem("ul",bi);};n.li=function(bi){return m.elem("li",bi);};n.h1=function(bi){return m.elem("h1",bi);};n.h2=function(bi){return m.elem("h1",bi);};n.h3=function(bi){return m.elem("h1",bi);};n.h4=function(bi){return m.elem("h1",bi);};n.strong=function(bi){return m.elem("strong",bi);};};p.Radio=function(bh,bi,bj,bk,bl){return _0.Element("div",new X.T({$:1,$0:(p.cls())("radio"),$1:bi}),[_0.Element("label",bk,[_0.Radio(bl,true,bj),_0.TextNode(bh)])]);};p.Checkbox=function(bh,bi,bj,bk,bl){return _0.Element("div",new X.T({$:1,$0:(p.cls())("checkbox"),$1:bi}),[_0.Element("label",bk,[_0.CheckBox(bl,bj),_0.TextNode(bh)])]);};p.TextArea=function(bh,bi,bj,bk,bl){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bi}),[_0.Element("label",bk,[_0.TextNode(bh)]),_0.InputArea(new X.T({$:1,$0:(p.cls())("form-control"),$1:bl}),bj)]);};p.InputPassword=function(bh,bi,bj,bk,bl){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bi}),[_0.Element("label",bk,[_0.TextNode(bh)]),_0.PasswordBox(new X.T({$:1,$0:(p.cls())("form-control"),$1:bl}),bj)]);};p.Input=function(bh,bi,bj,bk,bl){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bi}),[_0.Element("label",bk,[_0.TextNode(bh)]),_0.Input(new X.T({$:1,$0:(p.cls())("form-control"),$1:bl}),bj)]);};p.Container=function(bh){return _0.Element("div",[(p.cls())("container")],bh);};p.Class=function(){q.$cctor();return q.Class;};p.cls=function(){q.$cctor();return q.cls;};q.$cctor=function(){q.$cctor=a.ignore;q.cls=_1.Class;q.Class=_1.Class;};s=r.Intent=Q.Class({toString:function(){return(((Q.Curried3(function(bh,bi,bj){return bh("Intent("+T.toSafe(bi)+", "+O.p$2(bj)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,s);t=r.Trait=Q.Class({toString:function(){return(((Q.Curried3(function(bh,bi,bj){return bh("Trait("+T.toSafe(bi)+", "+T.prettyPrint(bj)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,t);u=r.Entity=Q.Class({toString:function(){return((((Q.Curried(function(bh,bi,bj,bk){return bh("Entity("+T.toSafe(bi)+", "+T.toSafe(bj)+", "+O.p$2(bk)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,u);v=r.Utterance=Q.Class({toString:function(){return((((Q.Curried(function(bh,bi,bj,bk){return bh(O.p(bi)+" "+O.p$3(bj)+" "+O.p$5(bk));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){var bh;bh=this.$2;return bh!=null?{$:1,$0:X.sortBy(function(bi){return bi.get_Name();},bh.$0)}:null;},get_Trait:function(){return this.$1;},get_Intent:function(){return this.$0;}},null,v);w=r.Question=Q.Class({toString:function(){return(((Q.Curried3(function(bh,bi,bj){return bh("Name: "+T.toSafe(bi)+" Text: "+T.toSafe(bj));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);y.New=function(bh,bi,bj,bk,bl){return{body:bh,end:bi,start:bj,suggested:bk,value:bl};};x["Intent'"]=function(bh,bi){return!(bi.intent==null)?{$:1,$0:new s({$:0,$0:k.toLower(bi.intent.value),$1:null})}:null;};x["Trait'"]=function(bh){return!(bh.greetings==null)?{$:1,$0:new t({$:0,$0:"greetings",$1:k.toLower(bh.contact.value)})}:null;};x["Entity'$1"]=function(bh){return!(bh.contact==null)?{$:1,$0:new u({$:0,$0:"contact",$1:k.toLower(bh.contact.value),$2:null})}:null;};A=z["Utterance'"]=Q.Class({get_TopIntent:function(){return X.head(X.sortBy(function(bh){return bh.get_Confidence();},this.get_Intents()));},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,A);B=z["Intent'"]=Q.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);C=z["Entity'"]=Q.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,C);z.HasUtterance=function(bh){var bi,bj,bk,bl,bm,bn;return bh!=null&&bh.$==1&&(bh.$0.$0.$==0&&(bh.$0.$1.get_Length()>0&&(bi=bh.$0.$1,true)))?{$:1,$0:new v({$:0,$0:null,$1:null,$2:{$:1,$0:X.map(function(bo){return new u({$:0,$0:k.toLower(bo.get_Role()),$1:bo.get_Value(),$2:{$:1,$0:bo.get_Confidence()}});},X.filter(function(bo){return bo.get_Confidence()>z.entityConfidenceThreshold();},bi))}})}:bh!=null&&bh.$==1&&(bh.$0.$1.$==0&&(bh.$0.$0.get_Length()>0&&bh.$0.get_TopIntent().get_Confidence()>z.intentConfidenceThreshold()&&(bj=[bh.$0.$0,bh],true)))?(bk=bj[1],{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:k.toLower(bk.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bk.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bh!=null&&bh.$==1&&(bh.$0.$0.get_Length()>0&&bh.$0.$1.get_Length()>0&&bh.$0.get_TopIntent().get_Confidence()>z.intentConfidenceThreshold()&&(bl=[bh.$0.$1,bh.$0.$0,bh],true))?(bm=bl[2],(bn=X.map(function(bo){return new u({$:0,$0:k.toLower(bo.get_Role()),$1:bo.get_Value(),$2:{$:1,$0:bo.get_Confidence()}});},X.filter(function(bo){return bo.get_Confidence()>z.entityConfidenceThreshold();},bm.$0.get_Entities())),{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:k.toLower(bm.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bm.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bn}})})):null;};z.entityConfidenceThreshold=function(){D.$cctor();return D.entityConfidenceThreshold;};z.set_entityConfidenceThreshold=function(bh){D.$cctor();D.entityConfidenceThreshold=bh;};z.intentConfidenceThreshold=function(){D.$cctor();return D.intentConfidenceThreshold;};z.set_intentConfidenceThreshold=function(bh){D.$cctor();D.intentConfidenceThreshold=bh;};z.getUtterance=function(bh,bi){z.witapi().getMeaning(bh,function(bj){k.debug("NLU",(function(bk){return function(bl){return bk("Wit.ai returned: "+T.prettyPrint(bl));};}(a.id))(bj));return bi({$:1,$0:new A({$:0,$0:!(bj.intents==null)?X.ofArray(W.map(function(bk){return new B({$:0,$0:bk.name,$1:bk.confidence});},bj.intents)):X.T.Empty,$1:!(bj.intents==null)?X.ofSeq(Y.concat(X.map(function(bk){return W.map(function(bl){return new C({$:0,$0:bl.name,$1:bl.confidence,$2:bl.role,$3:bl.value});},_3.GetJS(bj.entities,[bk]));},X.filter(function(bk){return!(_3.GetJS(bj.entities,[bk])==null);},z.entity_types())))):X.T.Empty})});},function(bj,bk,bl){k.error((((Q.Curried3(function(bm,bn,bo){return bm("Wit.ai returned: "+T.prettyPrint(bn)+" "+T.prettyPrint(bo));}))(a.id))(bk))(bl));return bi(null);});};z.entity_types=function(){D.$cctor();return D.entity_types;};z.witapi=function(){D.$cctor();return D.witapi;};z.QuickPrograms=function(bh){return bh==="programs"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};z.QuickNumber=function(bh){var bi,bj,bk;return(bj=z.One(bh),bj!=null&&bj.$==1?(bi=bj.$0,true):(bk=z.Two(bh),bk!=null&&bk.$==1&&(bi=bk.$0,true)))?{$:1,$0:bi}:null;};z.Three=function(bh){var bi;return bh==="3"||bh==="three"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};z.Two=function(bh){var bi;return bh==="2"||bh==="two"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};z.One=function(bh){var bi;return bh==="1"||bh==="one"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};z.QuickNo=function(bh){var bi;return bh==="no"||(bh==="NO"||(bh==="No"||(bh==="nope"||(bh==="no way"||(bh==="nah"||(bh==="don't do it"||bh==="stop"))))))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickYes=function(bh){var bi;return bh==="yes"||(bh==="YES"||(bh==="Yes"||(bh==="YEs"||(bh==="ok"||(bh==="sure"||(bh==="yeah"||(bh==="yep"||(bh==="uh huh"||(bh==="go ahead"||bh==="go")))))))))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickHelp=function(bh){var bi;return bh==="help"||(bh==="help me"||(bh==="what's this?"||bh==="huh"))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickHello=function(bh){var bi;return bh==="hello"||(bh==="hey"||(bh==="yo"||bh==="hi"))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.Voices=function(bh){return bh==="voices"?{$:1,$0:null}:null;};z.Debug=function(bh){return bh==="debug"?{$:1,$0:null}:null;};z.Blank=function(bh){return bh===""?{$:1,$0:null}:null;};r.No=function(bh){var bi,bj,bk,bl,bm,bn;return(bj=r.Intent$1("no",bh),bj!=null&&bj.$==1&&(bj.$0[0]==null&&(bj.$0[1]==null&&(bi=bh,true))))?{$:1,$0:bi}:(bl=r.Intent$1("noresponse",bh),bl!=null&&bl.$==1&&(bl.$0[0]==null&&(bl.$0[1]==null&&(bk=bh,true))))?{$:1,$0:bk}:(bn=r.Intent$1("NoResponse",bh),bn!=null&&bn.$==1&&(bn.$0[0]==null&&(bn.$0[1]==null&&(bm=bh,true))))?{$:1,$0:bm}:null;};r.Yes=function(bh){var bi,bj,bk,bl,bm,bn;return(bj=r.Intent$1("yes",bh),bj!=null&&bj.$==1&&(bj.$0[0]==null&&(bj.$0[1]==null&&(bi=bh,true))))?{$:1,$0:bi}:(bl=r.Intent$1("yesresponse",bh),bl!=null&&bl.$==1&&(bl.$0[0]==null&&(bl.$0[1]==null&&(bk=bh,true))))?{$:1,$0:bk}:(bn=r.Intent$1("YesResponse",bh),bn!=null&&bn.$==1&&(bn.$0[0]==null&&(bn.$0[1]==null&&(bm=bh,true))))?{$:1,$0:bm}:null;};r.EntityManyofMany=function(bh,bi){return{$:1,$0:_5.OfArray(W.ofSeq(X.map(function(bj){return X.exists(function(bk){return bk.get_Name()===bj;},bi)?[bj,{$:1,$0:X.filter(function(bk){return bk.get_Name()===bj;},bi)}]:[bj,null];},bh)))};};r.EntityManyOf1=function(bh,bi){var bj;return bi!=null&&bi.$==1&&(X.exists(function(bk){return bk.get_Name()===bh;},bi.$0)&&(bj=bi.$0,true))?{$:1,$0:X.filter(function(bk){return bk.get_Name()===bh;},bj)}:null;};r.Entity1OfAny=function(bh,bi){var bj;return bi!=null&&bi.$==1&&(X.exists(function(bk){return bk.get_Name()===bh;},bi.$0)&&(bj=bi.$0,true))?{$:1,$0:X.head(X.sortBy(function(bk){return bk.get_Name();},X.filter(function(bk){return bk.get_Name()===bh;},bj)))}:null;};r.Entity1Of1=function(bh,bi){var bj;return bi!=null&&bi.$==1&&(bi.$0.$==1&&(bi.$0.$1.$==0&&(bi.$0.$0.get_Name()===bh&&(bj=bi.$0.$0,true))))?{$:1,$0:bj}:null;};r.Intent$1=function(bh,bi){return bi.get_Intent()!=null&&bi.get_Intent().$0.get_Name()===bh?{$:1,$0:[bi.get_Trait(),bi.get_Entities()]}:null;};D.$cctor=function(){D.$cctor=a.ignore;D.witapi=new _8.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");D.entity_types=X.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject"]);D.intentConfidenceThreshold=0.85;D.entityConfidenceThreshold=0.85;};F.MicReady={$:5};F.MicAudioEnd={$:4};F.MicAudioStart={$:3};F.MicDisconnected={$:2};F.MicConnecting={$:1};F.MicNotInitialized={$:0};G.ClientUnderstand={$:2};G.ClientReady={$:1};G.ClientNotInitialzed={$:0};H=E.Interpreter=Q.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,H);I=E.CUI=Q.Class({SayVoices:function(){var bh,bi,bj;bh=this;bi=a.speechSynthesis.getVoices();!(bi==null)?(bj=k.toArray(bi),bh.Say((function(bk){return function(bl){return bk("There are currently "+a.String(bl)+" voices installed on this computer or device.");};}(a.id))(W.length(bj))),W.iteri(function(bk,bl){return bh.Say(((((Q.Curried(function(bm,bn,bo,bp){return bm("Voice "+a.String(bn)+". Name: "+T.toSafe(bo)+", Local: "+T.prettyPrint(bp)+".");},4))(a.id))(bk))(bl.name))(bl.localService));},bj)):void 0;},Wait:function(bh){this.Wait$1(function(){_9.Start(bh,null);});},Wait$1:function(bh){this["Echo'"]("please wait...");this.Term.pause();bh();this.Term.resume();},sayRandom:function(bh,bi){this.Say(E.getRandomPhrase(bh,bi));},Say:function(bh){var bi,bj;bi=this;_9.Start((bj=null,_9.Delay(function(){a.speechSynthesis.speaking?a.speechSynthesis.cancel():void 0;bi.Avatar.addMessage(bh);bi.Avatar.processMessages(0);return _9.Zero();})),null);},Debug:function(bh,bi){k.debug(bh,bi);},"EchoHtml'":function(bh){var bi,bj;bi=(bj={},bj.raw=true,bj);this.Term.disable();this.Term.echo(bh,bi);this.Term.enable();},"Echo'":function(bh){this.Term.disable();this.Term.echo(bh);this.Term.enable();}},null,I);I.New=function(bh,bi,bj,bk,bl){return new I({Voice:bh,Mic:bi,Term:bj,Avatar:bk,Caption:bl});};E.waitAddPhrases=function(){J.$cctor();return J.waitAddPhrases;};E.waitRetrievePhrases=function(){J.$cctor();return J.waitRetrievePhrases;};E.helpPhrases=function(){J.$cctor();return J.helpPhrases;};E.helloUserPhrases=function(){J.$cctor();return J.helloUserPhrases;};E.helloPhrases=function(){J.$cctor();return J.helloPhrases;};E["getRandomPhrase'"]=function(bh){return k.replace_tok("$0","",Y.nth(E.rng().Next(0,bh.get_Length()),bh));};E.getRandomPhrase=function(bh,bi){return k.replace_tok("$0",bi,Y.nth(E.rng().Next(0,bh.get_Length()),bh));};E.rng=function(){J.$cctor();return J.rng;};J.$cctor=function(){J.$cctor=a.ignore;J.rng=new _.New();J.helloPhrases=X.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);J.helloUserPhrases=X.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0."]);J.helpPhrases=X.ofArray(["What can I help you with $0?"]);J.waitRetrievePhrases=X.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);J.waitAddPhrases=X.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0."]);};K.update=function(bh,bi,bj,bk,bl){var bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$;function ca(cv){bh.Say(cv);}function cb(cv){bk.unshift(cv);ca(cv);}function cc(cv,cw){var cx;cx=E.getRandomPhrase(cv,cw);bk.unshift(cx);return bh.Say(cx);}function cd(cv){return bi.ContainsKey(cv);}function ce(cv,cw){return bi.Add(cv,cw);}function cf(cv){bi.Remove(cv);}function cg(cv){return bi.get_Item(cv);}function ch(){return cg("user");}function ci(){bl.shift();}function cj(){bj.shift();}function ck(cv){var cw;cw=K.getQuestion(cv);cw==null?(function(cx){return function(cy){return cx("No such question: "+T.toSafe(cy));};}($.FailWith))(cv):bj.unshift(cw.$0);}function cl(cv,cw){ce(cv,cw);ck(cv);K.debug((function(cx){return function(cy){return cx("Added question: "+O.p$8(cy)+".");};}(a.id))(bj[0]));return cb(k.replace_tok("$0",cw,K.getQuestion(cv).$0.get_Text()));}function cm(cv,cw){return cd(cv)?{$:1,$0:cw}:null;}function cn(cv,cw){return!cd(cv)?{$:1,$0:cw}:null;}function co(cv){var cw,cx;return(cx=cm("user",cv),cx!=null&&cx.$==1&&(bj.length===0&&(cw=cx.$0,true)))?(ci(),{$:1,$0:cw}):null;}function cp(cv,cw){var cx,cy,cz;return(cy=cm("user",cw),cy!=null&&cy.$==1&&(K.haveQuestion(cv)&&bj.length>0&&bj[0].get_Name()===cv&&(cx=cy.$0,true)))?(ci(),cj(),cd(cv)?(cz=bi.get_Item(cv),(cf(cv),{$:1,$0:[cx,{$:1,$0:cz}]})):{$:1,$0:[cx,null]}):null;}function cq(cv,cw){var cx,cy,cz;return(cy=cn("user",cw),cy!=null&&cy.$==1&&(K.haveQuestion(cv)&&bj.length>0&&bj[0].get_Name()===cv&&(cx=cy.$0,true)))?(ci(),cj(),cd(cv)?(cz=bi.get_Item(cv),(cf(cv),{$:1,$0:[cx,{$:1,$0:cz}]})):{$:1,$0:[cx,null]}):null;}function cr(cv){var cw,cx;return(cx=cn("user",cv),cx!=null&&cx.$==1&&(bj.length===0&&(cw=cx.$0,true)))?(ci(),{$:1,$0:cw}):null;}function cs(cv){var cw;return cv!=null&&cv.$==1&&(typeof cv.$0=="string"&&(cw=cv.$0,true))?{$:1,$0:cw}:null;}function ct(cv,cw,cx){var cy;return _9.Start((cy=null,_9.Delay(function(){cc(E.waitAddPhrases(),"symptom entry");return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.addSymptomJournalEntry:-1913660547",[ch().Name,cv,cw,cx]),function(cz){return cz==null?(cb(function(cA){return cA("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),_9.Zero()):(cb((function(cA){return function(cB){return cA("OK I added that "+T.toSafe(cB)+" symptom to your journal.");};}(a.id))(cv)),_9.Zero());});})),null);}function cu(cv){var cw;cw=null;return _9.Delay(function(){cc(E.waitRetrievePhrases(),"symptom journal");return(new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getSymptomJournal:425696581",[cv]);});}K.debug((((Q.Curried3(function(cv,cw,cx){return cv("Starting utterances:"+T.prettyPrint(cw)+". Starting questions: "+T.prettyPrint(cx)+".");}))(a.id))(bl))(bj));bm=X.ofSeq(Y.take(bl.length>=5?5:bl.length,bl));bm.$==1&&(bo=(bp=cn("started",bm.$0),bp!=null&&bp.$==1?{$:1,$0:bp.$0}:null),bo!=null&&bo.$==1&&(bq=cr(bo.$0),bq!=null&&bq.$==1&&(br=r.Intent$1("hello",bq.$0),br!=null&&br.$==1&&(br.$0[1]==null&&bm.$1.$==0))))?(bi.Add("started",true),cc(E.helloPhrases(),"")):bm.$==1&&(bt=cr(bm.$0),bt!=null&&bt.$==1&&(bu=r.Intent$1("hello",bt.$0),bu!=null&&bu.$==1&&(bu.$0[1]==null&&bm.$1.$==0)))?cb("Hello, tell me your name to get started."):bm.$==1&&(bw=cr(bm.$0),bw!=null&&bw.$==1&&(bx=r.Intent$1("hello",bw.$0),bx!=null&&bx.$==1&&(by=r.Entity1Of1("contact",bx.$0[1]),by!=null&&by.$==1&&(bm.$1.$==0&&(bv=by.$0,true)))))?(bz=bv.get_Value(),cc(E.waitRetrievePhrases(),"user name"),_9.Start((bA=null,_9.Delay(function(){return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-1671365491",[bz]),function(cv){var cw;return cv==null?(cb((function(cx){return function(cy){return cx("I did not find a user with the name "+T.toSafe(cy)+".");};}(a.id))(bz)),cl("addUser",bz),_9.Zero()):(cw=cv.$0,_9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:972331068",[cw.Name]),function(){bi.Add("user",cw);cc(E.helloUserPhrases(),(function(cx){return function(cy){return cx(T.prettyPrint(cy));};}(a.id))(bi.get_Item("user")));return cw.LastLoggedIn!=null?_9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-1480351",[cw.LastLoggedIn.$0]),function(cx){cb((function(cy){return function(cz){return cy("You last logged in "+T.toSafe(cz)+".");};}(a.id))(cx));return _9.Zero();}):_9.Zero();}));});})),null)):bm.$==1&&(bC=r.Yes(bm.$0),bC!=null&&bC.$==1&&(bD=cq("addUser",bC.$0),bD!=null&&bD.$==1&&(bE=cs(bD.$0[1]),bE!=null&&bE.$==1&&(bm.$1.$==0&&(bB=bE.$0,true)))))?_9.Start((bF=null,_9.Delay(function(){cc(E.waitAddPhrases(),"user");return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:972331068",[bB]),function(cv){return cv==null?(cb((function(cw){return function(cx){return cw("Sorry I was not able to add the user "+T.toSafe(cx)+" to the system.");};}(a.id))(bB)),_9.Zero()):(ce("user",bB),cb((function(cw){return function(cx){return cw("Hello "+T.prettyPrint(cx)+", nice to meet you.");};}(a.id))(bi.get_Item("user"))),_9.Zero());});})),null):bm.$==1&&(bH=r.No(bm.$0),bH!=null&&bH.$==1&&(bI=cq("addUser",bH.$0),bI!=null&&bI.$==1&&(bJ=cs(bI.$0[1]),bJ!=null&&bJ.$==1&&(bm.$1.$==0&&(bG=bJ.$0,true)))))?cb((function(cv){return function(cw){return cv("Ok I did not add the user "+T.toSafe(cw)+". But you must login for me to help you.");};}(a.id))(bG)):bm.$==1&&((bL=cr(bm.$0),bL!=null&&bL.$==1)&&bm.$1.$==0)?cb("Could you introduce yourself so we can get started?"):bm.$==1&&(bN=co(bm.$0),bN!=null&&bN.$==1&&(bO=r.Intent$1("hello",bN.$0),bO!=null&&bO.$==1&&(bO.$0[0]==null&&(bP=r.Entity1Of1("contact",bO.$0[1]),bP!=null&&bP.$==1&&(bm.$1.$==0&&(bM=bP.$0,true))))))?_9.Start((bQ=null,_9.Delay(function(){return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-1671365491",[bM.get_Value()]),function(cv){return cv==null?(cb((function(cw){return function(cx){return cw("Sorry, the user "+T.toSafe(cx)+" does not exist.");};}(a.id))(bM.get_Value())),_9.Zero()):(cl("switchUser",cv.$0.Name),_9.Zero());});})),null):bm.$==1&&(bS=r.Yes(bm.$0),bS!=null&&bS.$==1&&(bT=cp("switchUser",bS.$0),bT!=null&&bT.$==1&&(bU=cs(bT.$0[1]),bU!=null&&bU.$==1&&(bm.$1.$==0&&(bR=bU.$0,true)))))?(bi.set_Item("user",bR),cb((function(cv){return function(cw){return cv("Ok I switched to user "+T.prettyPrint(cw)+".");};}(a.id))(bR))):bm.$==1&&(bW=r.No(bm.$0),bW!=null&&bW.$==1&&(bX=cp("switchUser",bW.$0),bX!=null&&bX.$==1&&(bY=cs(bX.$0[1]),bY!=null&&bY.$==1&&(bm.$1.$==0&&(bV=bY.$0,true)))))?cb((function(cv){return function(cw){return cv("Ok I did not switch to user "+T.toSafe(cw)+".");};}(a.id))(bV)):bm.$==1&&(b0=co(bm.$0),b0!=null&&b0.$==1&&(b1=r.Intent$1("symptom",b0.$0),b1!=null&&b1.$==1&&(b2=r.Entity1OfAny("symptom_name",b1.$0[1]),b2!=null&&b2.$==1&&(bm.$1.$==0&&(bZ=b2.$0,true)))))?_9.Start((b3=null,_9.Delay(function(){cb("Ok I'll add that entry to your symptom journal");ct(bZ.get_Value(),null,null);return _9.Bind(cu(ch().Name),function(){cl("painVideo","");return _9.Zero();});})),null):bm.$==1&&(b5=r.Yes(bm.$0),b5!=null&&b5.$==1&&((b6=cp("painVideo",b5.$0),b6!=null&&b6.$==1)&&bm.$1.$==0))?bh["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bm.$==1&&(b8=co(bm.$0),b8!=null&&b8.$==1&&(b9=r.Intent$1("medjournal",b8.$0),b9!=null&&b9.$==1&&((b_=b9.$0[1],b_!=null&&b_.$==1)&&(bm.$1.$==0&&(b7=b9.$0[1].$0,true)))))?(cb("ok I added that entry to your medication journal."),cb("You should be careful not to take too many painkillers over a short period of time.")):(ci(),K.debug("Main interpreter did not understand utterance."),cb("Sorry I didn't understand what you meant."),bj.length>0?(b$=Y.nth(0,bj),cd(b$.get_Name())?cb(k.replace_tok("$0",bi.get_Item(b$.get_Name()),b$.get_Text())):cb(b$.get_Text())):void 0);K.debug((((Q.Curried3(function(cv,cw,cx){return cv("Ending utterances: "+T.prettyPrint(cw)+". Ending questions:"+T.prettyPrint(cx)+".");}))(a.id))(bl))(bj));};K.haveQuestion=function(bh){return X.exists(function(bi){return bi.get_Name()===bh;},K.questions());};K.getQuestion=function(bh){return Y.tryFind(function(bi){return bi.get_Name()===bh;},K.questions());};K.questions=function(){L.$cctor();return L.questions;};K.debug=function(bh){k.debug("Main",bh);};L.$cctor=function(){L.$cctor=a.ignore;L.questions=X.ofArray([new w({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new w({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new w({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new w({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new w({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};M.run=function(){var bh,bi,bj;M.set_CUI((bh=(bi=Q.ThisFunc(function(bk,bl){return((M.Main().get_Text())(bk))(bl);}),(bj=M.Main().get_Options(),void a.$("#main").terminal(bi,bj))),I.New(M.CUI().Voice,M.CUI().Mic,bh,M.CUI().Avatar,M.CUI().Caption)));return _0.get_Empty();};M.Main=function(){N.$cctor();return N.Main;};M.initMic=function(bh){var bi,bj;M.set_CUI((bi={$:1,$0:new bc.Microphone(bd.getElementById("microphone"))},I.New(M.CUI().Voice,bi,M.CUI().Term,M.CUI().Avatar,M.CUI().Caption)));bj=M.CUI().Mic.$0;bj.onconnecting=function(){M.set_MicState(F.MicConnecting);return M.debug("Mic connecting...");};bj.ondisconnected=function(){M.set_MicState(F.MicDisconnected);return M.debug("Mic disconnected.");};bj.onaudiostart=function(){M.set_MicState(F.MicAudioStart);return M.debug("Mic audio start...");};bj.onaudioend=function(){M.set_MicState(F.MicAudioEnd);return M.debug("Mic audio end.");};bj.onerror=function(bk){M.set_MicState({$:6,$0:bk});return M.debug((function(bl){return function(bm){return bl("Mic error : "+T.toSafe(bm)+".");};}(a.id))(bk));};bj.onready=function(){M.set_MicState(F.MicReady);return M.debug("Mic ready.");};bj.onresult=function(bk,bl){return M.ClientState().$==2?M.echo("I'm still trying to understand what you said before."):M.ClientState().$==0?k.error("Client is not intialized."):!(bk==null||bl==null)?(M.set_MicState({$:7,$0:bk,$1:bl}),M.debug((((Q.Curried3(function(bm,bn,bo){return bm("Mic result: "+T.prettyPrint(bn)+" "+T.prettyPrint(bo)+".");}))(a.id))(bk))(bl)),bh(bj,[bk,bl])):M.debug("Mic: No result returned.");};bj.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};M.sayRandom=function(bh,bi){M.say(E.getRandomPhrase(bi,bh));};M.sayVoices=function(){var bh;bh=k.toArray(a.speechSynthesis.getVoices());M["say'"]((function(bi){return function(bj){return bi("There are currently "+a.String(bj)+" voices installed on this computer or device.");};}(a.id))(W.length(bh)));W.iteri(function(bi,bj){return M["say'"](((((Q.Curried(function(bk,bl,bm,bn){return bk("Voice "+a.String(bl)+". Name: "+T.toSafe(bm)+", Local: "+T.prettyPrint(bn)+".");},4))(a.id))(bi))(bj.name))(bj.localService));},bh);};M.say=function(bh){M.Responses().unshift(bh);M["say'"](bh);};M["say'"]=function(bh){M.CUI().Say(bh);};M.initSpeech=function(){var bh,bi;bh=k.toArray(M.synth().getVoices());W.length(bh)>0?(bi=W.find(function(bj){return bj["default"];},bh),M.set_CUI(I.New({$:1,$0:bi},M.CUI().Mic,M.CUI().Term,M.CUI().Avatar,M.CUI().Caption)),M.debug((function(bj){return function(bk){return bj("Using default voice "+T.toSafe(bk)+".");};}(a.id))(M.CUI().Voice.$0.name)),M.CUI().Avatar.nativeVoice=true,M.CUI().Avatar.nativeVoiceName=bi.name):M.echo("No speech synthesis voice is available.");};M.synth=function(){N.$cctor();return N.synth;};M.push=function(bh){M.Utterances().unshift(bh);return M.Utterances();};M.Props=function(){N.$cctor();return N.Props;};M.Responses=function(){N.$cctor();return N.Responses;};M.Questions=function(){N.$cctor();return N.Questions;};M.Utterances=function(){N.$cctor();return N.Utterances;};M.wait=function(bh){k["Terminal.Echo'"](M.CUI().Term,"please wait");M.CUI().Term.pause();bh();M.CUI().Term.resume();};M.debug=function(bh){k.debug("CLIENT",bh);};M.echo=function(bh){if(!(M.CUI().Term==null))k["Terminal.EchoHtml'"](M.CUI().Term,(function(bi){return function(bj){return bi(T.prettyPrint(bj));};}(a.id))(bh));};M.ClientState=function(){N.$cctor();return N.ClientState;};M.set_ClientState=function(bh){N.$cctor();N.ClientState=bh;};M.MicState=function(){N.$cctor();return N.MicState;};M.set_MicState=function(bh){N.$cctor();N.MicState=bh;};M.CUI=function(){N.$cctor();return N.CUI;};M.set_CUI=function(bh){N.$cctor();N.CUI=bh;};N.$cctor=function(){var bh,bi,bj;N.$cctor=a.ignore;function bk(bm,bn){var bo,bp,bq,br,bs,bt,bu,bv,bw,bx;bo=bn[0];bp=bn[1];M.debug((((Q.Curried3(function(by,bz,bA){return by("Voice: "+T.prettyPrint(bz)+" "+T.prettyPrint(bA));}))(a.id))(bo))(bp));bq=(br=x["Intent'"](bo,bp),br!=null&&br.$==1?{$:1,$0:br.$0}:null);bs=(bt=x["Trait'"](bp),bt!=null&&bt.$==1?{$:1,$0:bt.$0}:null);bu=(bv=x["Entity'$1"](bp),bv!=null&&bv.$==1?{$:1,$0:X.ofArray([bv.$0])}:null);return bq==null&&(bs==null&&bu==null)?null:(M.debug(((((Q.Curried(function(by,bz,bA,bB){return by("Voice: "+O.p(bz)+" "+O.p$3(bA)+" "+O.p$5(bB));},4))(a.id))(bq))(bs))(bu)),bx=M.push(new v({$:0,$0:bq,$1:bs,$2:bu})),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bx));}function bl(bm,bn){var bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by;M.set_CUI(I.New(M.CUI().Voice,M.CUI().Mic,bm,M.CUI().Avatar,M.CUI().Caption));be.Equals(M.CUI().Mic,null)?M.initMic(bk):void 0;be.Equals(M.CUI().Voice,null)?M.initSpeech():void 0;M.ClientState().$===0?M.set_ClientState(G.ClientReady):void 0;return(bo=z.Blank(bn),bo!=null&&bo.$==1)?M["say'"]("Tell me what you want me to do or ask me a question."):(bp=z.Debug(bn),bp!=null&&bp.$==1)?(M.debug((function(bz){return function(bA){return bz("Utterances: "+T.prettyPrint(bA));};}(a.id))(M.Utterances())),M.debug((function(bz){return function(bA){return bz("Questions: "+T.prettyPrint(bA));};}(a.id))(M.Questions()))):(bq=z.Voices(bn),bq!=null&&bq.$==1)?M.sayVoices():M.ClientState().$==1?(bs=z.QuickHello(bn),bs!=null&&bs.$==1?(br=bs.$0,true):(bt=z.QuickHelp(bn),bt!=null&&bt.$==1?(br=bt.$0,true):(bu=z.QuickYes(bn),bu!=null&&bu.$==1?(br=bu.$0,true):(bv=z.QuickNo(bn),bv!=null&&bv.$==1&&(br=bv.$0,true)))))?(_9.Start((bw=null,_9.Delay(function(){return _9.Bind(bf.getAnswer("What is an element?"),function(bz){M.debug(W.get(bz.answers,0).answer);return _9.Zero();});})),null),M.debug((function(bz){return function(bA){return bz("Quick Text: "+O.p$7(bA)+".");};}(a.id))(br)),bx=M.push(br),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bx),M.set_ClientState(G.ClientReady)):M.CUI().Wait((by=null,_9.Delay(function(){M.set_ClientState(G.ClientUnderstand);z.getUtterance(bn,function(bz){var bA,bB,bC;bA=z.HasUtterance(bz);bA!=null&&bA.$==1?(bB=bA.$0,M.debug(((((Q.Curried(function(bD,bE,bF,bG){return bD("Text: "+O.p(bE)+" "+O.p$3(bF)+" "+O.p$5(bG));},4))(a.id))(bB.get_Intent()))(bB.get_Trait()))(bB.get_Entities())),bC=M.push(bB),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bC)):(M.debug("Text: Did not receive a meaning from the server."),M["say'"]("Sorry I did not understand what you said."));});M.set_ClientState(G.ClientReady);return _9.Zero();}))):M.ClientState().$==0?k.error("Client is not initialized."):M["say'"]("I'm still trying to understand what you said before.");}N.CUI=I.New(null,null,null,(a.SDK.applicationId="4277115329081938617",bh=new a.SDKConnection(),bi=new a.WebAvatar(),bi.version=8.5,bi.connection=bh,bi.avatar="22225225",bi.voice="cmu-slt",bi.voiceMod="default",bi.nativeVoice=true,bi.nativeVoiceName="Microsoft David Desktop - English (United States)",bi.width=300,bi.createBox(),bi.addMessage(""),bi.processMessages(0),bi),false);N.MicState=F.MicNotInitialized;N.ClientState=G.ClientNotInitialzed;N.Utterances=[];N.Questions=[];N.Responses=[];N.Props=new bg.New$5();N.synth=a.speechSynthesis;N.Main=new H({$:0,$0:function(bm){return function(bn){return bk(bm,bn);};},$1:[function(bm){return function(bn){return bl(bm,bn);};},(bj={},bj.name="Main",bj.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech recognition, or enter help for more assistance.",bj.prompt=">",bj)]});};O.p$8=function(bh){return"Question ("+T.prettyPrint(bh.$0)+", "+T.prettyPrint(bh.$1)+")";};O.p$2=function(bh){return bh==null?"null":"Some "+T.prettyPrint(bh.$0);};O.p$1=function(bh){return"Intent ("+T.prettyPrint(bh.$0)+", "+O.p$2(bh.$1)+")";};O.p=function(bh){return bh==null?"null":"Some "+O.p$1(bh.$0);};O.p$4=function(bh){return"Trait ("+T.prettyPrint(bh.$0)+", "+T.prettyPrint(bh.$1)+")";};O.p$3=function(bh){return bh==null?"null":"Some "+O.p$4(bh.$0);};O.p$6=function(bh){return"Entity ("+T.prettyPrint(bh.$0)+", "+T.prettyPrint(bh.$1)+", "+O.p$2(bh.$2)+")";};O.p$5=function(bh){return bh==null?"null":"Some "+T.printList(function(bi){return O.p$6(bi);},bh.$0);};O.p$7=function(bh){return"Utterance ("+O.p(bh.$0)+", "+O.p$3(bh.$1)+", "+O.p$5(bh.$2)+")";};}());
