(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.StudyJournalEntry=c.StudyJournalEntry||{};j=c.Message=c.Message||{};k=c.Wit=c.Wit||{};l=k.NLUResponse=k.NLUResponse||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=b.Web=b.Web||{};p=o.ClientExtensions=o.ClientExtensions||{};q=o._Html=o._Html||{};r=o.htmModule=o.htmModule||{};s=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};t=o.Bs=o.Bs||{};u=o.NLU=o.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.Question=u.Question||{};A=u.Voice=u.Voice||{};B=A["Entity'"]=A["Entity'"]||{};C=u.Text=u.Text||{};D=C["Utterance'"]=C["Utterance'"]||{};E=C["Intent'"]=C["Intent'"]||{};F=C["Entity'"]=C["Entity'"]||{};G=C["Trait'"]=C["Trait'"]||{};H=u.Domain=u.Domain||{};I=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};J=o.CUI=o.CUI||{};K=J.MicState=J.MicState||{};L=J.ClientState=J.ClientState||{};M=J.Interpreter=J.Interpreter||{};N=J.CUI=J.CUI||{};O=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};P=o.Main=o.Main||{};Q=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};R=o.Study=o.Study||{};S=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};T=o.Client=o.Client||{};U=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};V=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};W=a.IntelliFactory;X=W&&W.Runtime;Y=a.WebSharper;Z=Y&&Y.UI;_0=Z&&Z.Client;_1=_0&&_0.Templates;_2=Z&&Z.Doc;_3=Y&&Y.Strings;_4=Y&&Y.Utils;_5=a.console;_6=a.jQuery;_7=Y&&Y.Arrays;_8=Y&&Y.List;_9=Y&&Y.Seq;_=Z&&Z.AttrProxy;$=Y&&Y.JavaScript;ba=$&&$.Pervasives;bb=Y&&Y.Collections;bc=bb&&bb.Map;bd=b&&b.NLU;be=bd&&bd.Wit;bf=be&&be.WitApi;bg=Y&&Y.Concurrency;bh=a.SDK;bi=Y&&Y.Random;bj=Y&&Y.Operators;bk=Y&&Y.Remoting;bl=bk&&bk.AjaxRemotingProvider;bm=bd&&bd.QnAMaker;bn=a.Wit;bo=a.document;bp=Y&&Y.Unchecked;bq=bb&&bb.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(br,bs){return{Street:br,Town:bs};};f.New=function(br,bs,bt){return{Full:br,First:bs,Last:bt};};g=c.User=X.Class({toString:function(){return this.Name;}},null,g);g.New=function(br,bs){return new g({Name:br,LastLoggedIn:bs});};h.New=function(br,bs,bt,bu,bv){return{Id:br,Sex:bs,Name:bt,BirthDate:bu,Address:bv};};i.New=function(br,bs,bt,bu){return{UserName:br,Date:bs,Subject:bt,Duration:bu};};j.New=function(br,bs,bt,bu){return{UserName:br,Date:bs,Text:bt,IsRead:bu};};l.New=function(br,bs,bt,bu,bv,bw){return{type:br,msg:bs,action:bt,traits:bu,entities:bv,confidence:bw};};m.New=function(br,bs,bt){return{id:br,value:bs,confidence:bt};};n.New=function(br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB){return{id:br,name:bs,role:bt,start:bu,end:bv,body:bw,confidence:bx,entities:by,suggested:bz,value:bA,type:bB};};p.speechSynthesis=function(){return a.speechSynthesis;};p.elementHTML=function(br){return br.innerHTML;};p.createElement=function(br,bs){var bt;bt=self.document.createElement(br);_1.LoadLocalTemplates("");_2.RunAppend(bt,bs);return bt;};p.replace_tok=function(br,bs,bt){return _3.Replace(bt,br,bs);};p.toLower=function(br){return br.toLowerCase();};p.debug=function(br,bs){p.info((((X.Curried3(function(bt,bu,bv){return bt("DEBUG: "+_4.toSafe(bu)+": "+_4.prettyPrint(bv));}))(a.id))(br.toUpperCase()))(bs));};p.error=function(br){_5.error(br);};p.info=function(br){_5.info(br);};p.jserror=function(br){_6.error(br);};p.toArray=function(br){return _7.map(a.id,_6.makeArray(br));};p["Terminal.EchoHtml'"]=function(br,bs){br.pause();br.echo(bs,p.rawOpt());br.resume();};p["Terminal.Echo'"]=function(br,bs){br.pause();br.echo(bs);br.resume();};p.rawOpt=function(){s.$cctor();return s.rawOpt;};q=o._Html=X.Class({toString:function(){return q.toString(this);}},null,q);q.toString=function(br){function bs(bt){return function(bu){var bv,bw,bx,by,bz,bA,bB;bw=_3.replicate(bt," ");switch(bu.$==0?bu.$1.$==1?bu.$1.$0.$==2?bu.$1.$1.$==0?(bv=[bu.$1.$0.$0,bu.$0],1):(bv=[bu.$1,bu.$0],2):(bv=[bu.$1,bu.$0],2):(bv=[bu.$1,bu.$0],2):bu.$==2?(bv=bu.$0,3):(bv=[bu.$0,bu.$1],0)){case 0:return bv[0]+"=\""+bv[1]+"\"";case 1:bx=bv[1];return bw+"<"+bx+">"+bv[0]+"</"+bx+">\r\n";case 2:by=bv[1];bz=_8.partition(function(bC){return bC.$==1;},bv[0]);bA=bz[1];bB=bz[0];return bA.$==0?bw+"<"+by+(bB.$===0?"":" "+_3.concat(" ",_8.ofSeq(_9.delay(function(){return _9.map(function(bC){return(bs(0))(bC);},bB);}))))+"/>\r\n":bw+"<"+by+(bB.$===0?"":" "+_3.concat(" ",_8.ofSeq(_9.delay(function(){return _9.map(function(bC){return(bs(0))(bC);},bB);}))))+">\r\n"+_3.concat("",_8.ofSeq(_9.delay(function(){return _9.map(function(bC){return(bs(bt+1))(bC);},bA);})))+bw+"</"+by+">\r\n";case 3:return bw+bv+"\r\n";}};}return(bs(0))(br);};r.alt=function(br){return new q({$:1,$0:"alt",$1:br});};r.src=function(br){return new q({$:1,$0:"src",$1:br});};r.cls=function(br){return new q({$:1,$0:"class",$1:br});};r.str=function(br){return q.toString(br);};r.op_PercentEquals=function(br,bs){return new q({$:1,$0:br,$1:bs});};r.op_Splice=function(br){var bs;return _8.ofArray([new q({$:2,$0:(bs=br,a.String(bs))})]);};r.strong=function(){s.$cctor();return s.strong;};r.h4=function(){s.$cctor();return s.h4;};r.h3=function(){s.$cctor();return s.h3;};r.h2=function(){s.$cctor();return s.h2;};r.h1=function(){s.$cctor();return s.h1;};r.li=function(){s.$cctor();return s.li;};r.ul=function(){s.$cctor();return s.ul;};r.th=function(){s.$cctor();return s.th;};r.td=function(){s.$cctor();return s.td;};r.tr=function(){s.$cctor();return s.tr;};r.a=function(){s.$cctor();return s.a;};r.p=function(){s.$cctor();return s.p;};r.area=function(){s.$cctor();return s.area;};r.map=function(){s.$cctor();return s.map;};r.img=function(){s.$cctor();return s.img;};r.tfoot=function(){s.$cctor();return s.tfoot;};r.tbody=function(){s.$cctor();return s.tbody;};r.thead=function(){s.$cctor();return s.thead;};r.table=function(){s.$cctor();return s.table;};r.span=function(){s.$cctor();return s.span;};r.section=function(){s.$cctor();return s.section;};r.br=function(){s.$cctor();return s.br;};r.div=function(){s.$cctor();return s.div;};r.body=function(){s.$cctor();return s.body;};r.style=function(){s.$cctor();return s.style;};r.title=function(){s.$cctor();return s.title;};r.head=function(){s.$cctor();return s.head;};r.html=function(){s.$cctor();return s.html;};r.elem=function(br,bs){return new q({$:0,$0:br,$1:bs});};s.$cctor=function(){var br;s.$cctor=a.ignore;s.rawOpt=(br={},br.raw=true,br);s.html=function(bs){return r.elem("html",bs);};s.head=function(bs){return r.elem("head",bs);};s.title=function(bs){return r.elem("title",bs);};s.style=function(bs){return r.elem("style",bs);};s.body=function(bs){return r.elem("body",bs);};s.div=function(bs){return r.elem("div",bs);};s.br=function(bs){return r.elem("br",bs);};s.section=function(bs){return r.elem("section",bs);};s.span=function(bs){return r.elem("span",bs);};s.table=function(bs){return r.elem("table",bs);};s.thead=function(bs){return r.elem("thead",bs);};s.tbody=function(bs){return r.elem("tbody",bs);};s.tfoot=function(bs){return r.elem("tfoot",bs);};s.img=function(bs){return r.elem("img",bs);};s.map=function(bs){return r.elem("map",bs);};s.area=function(bs){return r.elem("area",bs);};s.p=function(bs){return r.elem("p",bs);};s.a=function(bs){return r.elem("a",bs);};s.tr=function(bs){return r.elem("tr",bs);};s.td=function(bs){return r.elem("td",bs);};s.th=function(bs){return r.elem("th",bs);};s.ul=function(bs){return r.elem("ul",bs);};s.li=function(bs){return r.elem("li",bs);};s.h1=function(bs){return r.elem("h1",bs);};s.h2=function(bs){return r.elem("h1",bs);};s.h3=function(bs){return r.elem("h1",bs);};s.h4=function(bs){return r.elem("h1",bs);};s.strong=function(bs){return r.elem("strong",bs);};};t.Radio=function(br,bs,bt,bu,bv){return _2.Element("div",new _8.T({$:1,$0:t.cls("radio"),$1:bs}),[_2.Element("label",bu,[_2.Radio(bv,true,bt),_2.TextNode(br)])]);};t.checkbox=function(br,bs,bt,bu,bv){return _2.Element("div",new _8.T({$:1,$0:t.cls("checkbox"),$1:bs}),[_2.Element("label",bu,[_2.CheckBox(bv,bt),_2.TextNode(br)])]);};t.textArea=function(br,bs,bt,bu,bv){return _2.Element("div",new _8.T({$:1,$0:t.cls("form-group"),$1:bs}),[_2.Element("label",bu,[_2.TextNode(br)]),_2.InputArea(new _8.T({$:1,$0:t.cls("form-control"),$1:bv}),bt)]);};t.inputPassword=function(br,bs,bt,bu,bv){return _2.Element("div",new _8.T({$:1,$0:t.cls("form-group"),$1:bs}),[_2.Element("label",bu,[_2.TextNode(br)]),_2.PasswordBox(new _8.T({$:1,$0:t.cls("form-control"),$1:bv}),bt)]);};t.input=function(br,bs,bt,bu,bv){return _2.Element("div",new _8.T({$:1,$0:t.cls("form-group"),$1:bs}),[_2.Element("label",bu,[_2.TextNode(br)]),_2.Input([t.cls("form-control"),bv],bt)]);};t.btn=function(br){return _2.Element("button",[t.eid(br),t.cls("btn")],[]);};t.container=function(br){return _2.Element("div",[t.cls("container")],br);};t.cls=function(br){return _.Create("class",br);};t.eid=function(br){return _.Create("id",br);};v=u.Intent=X.Class({toString:function(){return(((X.Curried3(function(br,bs,bt){return br("Intent("+_4.toSafe(bs)+", "+V.p$2(bt)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=X.Class({toString:function(){return(((X.Curried3(function(br,bs,bt){return br("Trait("+_4.toSafe(bs)+", "+_4.prettyPrint(bt)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=X.Class({toString:function(){return((((X.Curried(function(br,bs,bt,bu){return br("Entity("+_4.toSafe(bs)+", "+_4.toSafe(bt)+", "+V.p$2(bu)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=X.Class({toString:function(){return((((X.Curried(function(br,bs,bt,bu){return br(V.p(bs)+" "+V.p$3(bt)+" "+V.p$5(bu));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var br;br=this.$2;return br!=null?{$:1,$0:_8.sortBy(function(bs){return bs.get_Name();},br.$0)}:null;},get_Traits:function(){var br;br=this.$1;return br!=null?{$:1,$0:_8.sortBy(function(bs){return bs.get_Name();},br.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.Question=X.Class({toString:function(){return(((X.Curried3(function(br,bs,bt){return br("Name: "+_4.toSafe(bs)+" Text: "+_4.toSafe(bt));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);B.New=function(br,bs,bt,bu,bv){return{body:br,end:bs,start:bt,suggested:bu,value:bv};};A["Intent'"]=function(br,bs){return!(bs.intent==null)?{$:1,$0:new v({$:0,$0:p.toLower(bs.intent.value),$1:null})}:null;};A["Trait'"]=function(br){return!(br.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:p.toLower(br.domain.value),$2:null})}:!(br.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:p.toLower(br.dialogue_act.value),$2:null})}:null;};A["Entity'$1"]=function(br){return!(br.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:p.toLower(br.contact.value),$2:null})}:null;};D=C["Utterance'"]=X.Class({get_TopIntent:function(){return _8.head(_8.sortBy(function(br){return br.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,D);E=C["Intent'"]=X.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=C["Entity'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,F);G=C["Trait'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,G);C.HasUtterance=function(br){var bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF;return br!=null&&br.$==1&&(br.$0.$0.$==0&&(br.$0.$1.get_Length()>0&&(bs=[br.$0.$1,br.$0.$2],true)))?(bt=_8.map(function(bG){return new x({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bs[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_8.map(function(bG){return new w({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bs[1]))},$2:{$:1,$0:bt}})}):br!=null&&br.$==1&&(br.$0.$1.$==0&&(br.$0.$2.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bu=[br.$0.$0,br],true))))?(bv=bu[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bv.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bv.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):br!=null&&br.$==1&&(br.$0.$2.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bw=[br.$0.$0,br],true)))?(bx=bw[1],(by=_8.map(function(bG){return new x({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bx.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bx.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bx.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:by}})})):br!=null&&br.$==1&&(br.$0.$1.$==0&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bz=[br.$0.$0,br],true)))?(bA=bz[1],(bB=_8.map(function(bG){return new w({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bA.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bB},$2:null})})):br!=null&&br.$==1&&(br.$0.$0.get_Length()>0&&br.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bC=[br.$0.$0,br],true))?(bD=bC[1],(bE=_8.map(function(bG){return new x({$:0,$0:p.toLower(bG.get_Role()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bD.$0.get_Entities())),(bF=_8.map(function(bG){return new w({$:0,$0:p.toLower(bG.get_Name()),$1:bG.get_Value(),$2:{$:1,$0:bG.get_Confidence()}});},_8.filter(function(bG){return bG.get_Confidence()>C.entityConfidenceThreshold();},bD.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bD.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bD.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bF},$2:{$:1,$0:bE}})}))):null;};C.entityConfidenceThreshold=function(){I.$cctor();return I.entityConfidenceThreshold;};C.set_entityConfidenceThreshold=function(br){I.$cctor();I.entityConfidenceThreshold=br;};C.intentConfidenceThreshold=function(){I.$cctor();return I.intentConfidenceThreshold;};C.set_intentConfidenceThreshold=function(br){I.$cctor();I.intentConfidenceThreshold=br;};C.getUtterance=function(br,bs){C.witapi().getMeaning(br,function(bt){var bu,bv;p.debug("NLU",(function(bw){return function(bx){return bw("Wit.ai returned: "+_4.prettyPrint(bx));};}(a.id))(bt));bu=!(bt.intents==null)?_8.ofArray(_7.map(function(bw){return new E({$:0,$0:bw.name,$1:bw.confidence});},bt.intents)):_8.T.Empty;bv=!(bt.traits==null)?_8.ofSeq(_9.concat(_8.map(function(bw){return _7.map(function(bx){return new G({$:0,$0:bw,$1:bx.confidence,$2:bx.value});},ba.GetJS(bt.traits,[bw]));},_8.filter(function(bw){return!(ba.GetJS(bt.traits,[bw])==null);},C.trait_types())))):_8.T.Empty;return bs({$:1,$0:new D({$:0,$0:bu,$1:!(bt.intents==null)?_8.ofSeq(_9.concat(_8.map(function(bw){return _7.map(function(bx){return new F({$:0,$0:bx.name,$1:bx.confidence,$2:bx.role,$3:bx.value});},ba.GetJS(bt.entities,[bw]));},_8.filter(function(bw){return!(ba.GetJS(bt.entities,[bw])==null);},C.entity_types())))):_8.T.Empty,$2:bv})});},function(bt,bu,bv){p.error((((X.Curried3(function(bw,bx,by){return bw("Wit.ai returned: "+_4.prettyPrint(bx)+" "+_4.prettyPrint(by));}))(a.id))(bu))(bv));return bs(null);});};C.trait_types=function(){I.$cctor();return I.trait_types;};C.entity_types=function(){I.$cctor();return I.entity_types;};C.witapi=function(){I.$cctor();return I.witapi;};C.QuickPrograms=function(br){return br==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};C.QuickNumber=function(br){var bs,bt,bu;return(bt=C.One(br),bt!=null&&bt.$==1?(bs=bt.$0,true):(bu=C.Two(br),bu!=null&&bu.$==1&&(bs=bu.$0,true)))?{$:1,$0:bs}:null;};C.Three=function(br){var bs;return br==="3"||br==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_8.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};C.Two=function(br){var bs;return br==="2"||br==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_8.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};C.One=function(br){var bs;return br==="1"||br==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_8.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};C.QuickNo=function(br){var bs;return br==="no"||(br==="NO"||(br==="No"||(br==="nope"||(br==="no way"||(br==="nah"||(br==="don't do it"||br==="stop"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickYes=function(br){var bs;return br==="yes"||(br==="YES"||(br==="Yes"||(br==="YEs"||(br==="ok"||(br==="sure"||(br==="yeah"||(br==="yep"||(br==="uh huh"||(br==="go ahead"||br==="go")))))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHelp=function(br){var bs;return br==="help"||(br==="help me"||(br==="what's this?"||br==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHello=function(br){var bs;return br==="hello"||(br==="hey"||(br==="yo"||br==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.Voices=function(br){return br==="voices"?{$:1,$0:null}:null;};C.Debug=function(br){return br==="debug"?{$:1,$0:null}:null;};C.Blank=function(br){return br===""?{$:1,$0:null}:null;};H.Study=function(br){return br.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(br){var bs,bt,bu,bv,bw,bx;return(bt=u.Intent$1("no",br),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=br,true))))?{$:1,$0:bs}:(bv=u.Intent$1("noresponse",br),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=br,true))))?{$:1,$0:bu}:(bx=u.Intent$1("NoResponse",br),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=br,true))))?{$:1,$0:bw}:null;};u.Yes=function(br){var bs,bt,bu,bv,bw,bx;return(bt=u.Intent$1("yes",br),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=br,true))))?{$:1,$0:bs}:(bv=u.Intent$1("yesresponse",br),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=br,true))))?{$:1,$0:bu}:(bx=u.Intent$1("YesResponse",br),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=br,true))))?{$:1,$0:bw}:null;};u.EntityManyofMany=function(br,bs){return{$:1,$0:bc.OfArray(_7.ofSeq(_8.map(function(bt){return _8.exists(function(bu){return bu.get_Name()===bt;},bs)?[bt,{$:1,$0:_8.filter(function(bu){return bu.get_Name()===bt;},bs)}]:[bt,null];},br)))};};u.EntityManyOf1=function(br,bs){var bt;return bs!=null&&bs.$==1&&(_8.exists(function(bu){return bu.get_Name()===br;},bs.$0)&&(bt=bs.$0,true))?{$:1,$0:_8.filter(function(bu){return bu.get_Name()===br;},bt)}:null;};u.Entity1OfAny=function(br,bs){var bt;return bs!=null&&bs.$==1&&(_8.exists(function(bu){return bu.get_Name()===br;},bs.$0)&&(bt=bs.$0,true))?{$:1,$0:_8.head(_8.sortBy(function(bu){return bu.get_Name();},_8.filter(function(bu){return bu.get_Name()===br;},bt)))}:null;};u.Entity1Of1=function(br,bs){var bt;return bs!=null&&bs.$==1&&(bs.$0.$==1&&(bs.$0.$1.$==0&&(bs.$0.$0.get_Name()===br&&(bt=bs.$0.$0,true))))?{$:1,$0:bt}:null;};u.Intent$1=function(br,bs){return bs.get_Intent()!=null&&bs.get_Intent().$0.get_Name()===br?{$:1,$0:[bs.get_Traits(),bs.get_Entities()]}:null;};I.$cctor=function(){I.$cctor=a.ignore;I.witapi=new bf.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");I.entity_types=_8.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);I.trait_types=_8.ofArray(["domain","dialogue_act"]);I.intentConfidenceThreshold=0.85;I.entityConfidenceThreshold=0.85;};K.MicReady={$:5};K.MicAudioEnd={$:4};K.MicAudioStart={$:3};K.MicDisconnected={$:2};K.MicConnecting={$:1};K.MicNotInitialized={$:0};L.ClientUnderstand={$:2};L.ClientReady={$:1};L.ClientNotInitialzed={$:0};M=J.Interpreter=X.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,M);N=J.CUI=X.Class({SayVoices:function(){var br,bs,bt;br=this;bs=a.speechSynthesis.getVoices();!(bs==null)?(bt=p.toArray(bs),br.Say((function(bu){return function(bv){return bu("There are currently "+a.String(bv)+" voices installed on this computer or device.");};}(a.id))(_7.length(bt))),_7.iteri(function(bu,bv){return br.Say(((((X.Curried(function(bw,bx,by,bz){return bw("Voice "+a.String(bx)+". Name: "+_4.toSafe(by)+", Local: "+_4.prettyPrint(bz)+".");},4))(a.id))(bu))(bv.name))(bv.localService));},bt)):void 0;},Wait:function(br){this.Wait$1(function(){bg.Start(br,null);});},Wait$1:function(br){this["Echo'"]("please wait...");this.Term.pause();br();this.Term.resume();},sayRandom:function(br,bs){this.Say(J.getRandomPhrase(br,bs));},SayAngry:function(br){var bs,bt;bs=this;bg.Start((bt=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bh.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){a.addMessage(bs.Avatar,br,"","");bs.Avatar.processMessages(0);return bg.Zero();}));})),null);},Say:function(br){var bs,bt;bs=this;bg.Start((bt=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(bh.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){bs.Avatar.addMessage(br);bs.Avatar.processMessages(0);return bg.Zero();}));})),null);},Debug:function(br,bs){p.debug(br,bs);},"EchoHtml'":function(br){var bs,bt;bs=(bt={},bt.raw=true,bt);this.Term.disable();this.Term.echo(br,bs);this.Term.enable();},"Echo'":function(br){this.Term.disable();this.Term.echo(br);this.Term.enable();}},null,N);N.New=function(br,bs,bt,bu,bv){return new N({Voice:br,Mic:bs,Term:bt,Avatar:bu,Caption:bv});};J.waitAddPhrases=function(){O.$cctor();return O.waitAddPhrases;};J.waitRetrievePhrases=function(){O.$cctor();return O.waitRetrievePhrases;};J.helpPhrases=function(){O.$cctor();return O.helpPhrases;};J.helloUserPhrases=function(){O.$cctor();return O.helloUserPhrases;};J.helloPhrases=function(){O.$cctor();return O.helloPhrases;};J["getRandomPhrase'"]=function(br){return p.replace_tok("$0","",_9.nth(J.rng().Next(0,br.get_Length()),br));};J.getRandomPhrase=function(br,bs){return p.replace_tok("$0",bs,_9.nth(J.rng().Next(0,br.get_Length()),br));};J.rng=function(){O.$cctor();return O.rng;};O.$cctor=function(){O.$cctor=a.ignore;O.rng=new bi.New();O.helloPhrases=_8.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);O.helloUserPhrases=_8.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);O.helpPhrases=_8.ofArray(["What can I help you with $0?"]);O.waitRetrievePhrases=_8.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);O.waitAddPhrases=_8.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};P.update=function(br,bs,bt,bu,bv){var bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;function co(cH){br["EchoHtml'"](cH);}function cp(cH){br.Say(cH);}function cq(cH){bu.unshift(cH);cp(cH);}function cr(cH,cI){var cJ;cJ=J.getRandomPhrase(cH,cI);bu.unshift(cJ);return br.Say(cJ);}function cs(cH){return bs.ContainsKey(cH);}function ct(cH,cI){return bs.Add(cH,cI);}function cu(cH){bs.Remove(cH);}function cv(){bv.shift();}function cw(){bt.shift();}function cx(cH){var cI;cI=P.getQuestion(cH);cI==null?(function(cJ){return function(cK){return cJ("No such question: "+_4.toSafe(cK));};}(bj.FailWith))(cH):bt.unshift(cI.$0);}function cy(cH,cI){ct(cH,cI);cx(cH);P.debug((function(cJ){return function(cK){return cJ("Added question: "+V.p$8(cK)+".");};}(a.id))(bt[0]));return cq(p.replace_tok("$0",cI,P.getQuestion(cH).$0.get_Text()));}function cz(cH,cI){return cs(cH)?{$:1,$0:cI}:null;}function cA(cH,cI){return!cs(cH)?{$:1,$0:cI}:null;}function cB(cH){var cI,cJ;return(cJ=cz("user",cH),cJ!=null&&cJ.$==1&&(bt.length===0&&(cI=cJ.$0,true)))?(cv(),{$:1,$0:cI}):null;}function cC(cH,cI){var cJ,cK,cL;return(cK=cz("user",cI),cK!=null&&cK.$==1&&(P.haveQuestion(cH)&&bt.length>0&&bt[0].get_Name()===cH&&(cJ=cK.$0,true)))?(cv(),cw(),cs(cH)?(cL=bs.get_Item(cH),(cu(cH),{$:1,$0:[cJ,{$:1,$0:cL}]})):{$:1,$0:[cJ,null]}):null;}function cD(cH,cI){var cJ,cK,cL;return(cK=cA("user",cI),cK!=null&&cK.$==1&&(P.haveQuestion(cH)&&bt.length>0&&bt[0].get_Name()===cH&&(cJ=cK.$0,true)))?(cv(),cw(),cs(cH)?(cL=bs.get_Item(cH),(cu(cH),{$:1,$0:[cJ,{$:1,$0:cL}]})):{$:1,$0:[cJ,null]}):null;}function cE(cH){var cI,cJ;return(cJ=cA("user",cH),cJ!=null&&cJ.$==1&&(bt.length===0&&(cI=cJ.$0,true)))?(cv(),{$:1,$0:cI}):null;}function cF(cH){var cI;return cH!=null&&cH.$==1&&(typeof cH.$0=="string"&&(cI=cH.$0,true))?{$:1,$0:cI}:null;}function cG(cH){var cI;cI=null;return bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:-1363715696",[cH]),function(cJ){bs.Add("msgs",cJ);return cJ!=null&&cJ.$0.get_Length()>0?(cq((((X.Curried3(function(cK,cL,cM){return cK("You have "+a.String(cL)+" new message"+_4.toSafe(cM)+".");}))(a.id))(cJ.$0.get_Length()))(cJ.$0.get_Length()>1?"s":"")),bg.Zero()):bg.Zero();});});}P.debug((((X.Curried3(function(cH,cI,cJ){return cH("Starting utterances:"+_4.prettyPrint(cI)+". Starting questions: "+_4.prettyPrint(cJ)+".");}))(a.id))(bv))(bt));bw=_8.ofSeq(_9.take(bv.length>=5?5:bv.length,bv));bw.$==1&&(by=(bz=cA("started",bw.$0),bz!=null&&bz.$==1?{$:1,$0:bz.$0}:null),by!=null&&by.$==1&&(bA=cE(by.$0),bA!=null&&bA.$==1&&(bB=u.Intent$1("hello",bA.$0),bB!=null&&bB.$==1&&(bB.$0[1]==null&&bw.$1.$==0))))?(bs.Add("started",true),cr(J.helloPhrases(),"")):bw.$==1&&(bD=cE(bw.$0),bD!=null&&bD.$==1&&(bE=u.Intent$1("hello",bD.$0),bE!=null&&bE.$==1&&(bE.$0[1]==null&&bw.$1.$==0)))?cq("Hello, tell me your name to get started."):bw.$==1&&(bG=cE(bw.$0),bG!=null&&bG.$==1&&(bH=u.Intent$1("hello",bG.$0),bH!=null&&bH.$==1&&(bI=u.Entity1Of1("contact",bH.$0[1]),bI!=null&&bI.$==1&&(bw.$1.$==0&&(bF=bI.$0,true)))))?(bJ=bF.get_Value(),cr(J.waitRetrievePhrases(),"user name"),bg.Start((bK=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-959026379",[bJ]),function(cH){var cI;return cH==null?(cq((function(cJ){return function(cK){return cJ("I did not find a user with the name "+_4.toSafe(cK)+".");};}(a.id))(bJ)),cy("addUser",bJ),bg.Zero()):(cI=cH.$0,(cr(J.helloUserPhrases(),(function(cJ){return function(cK){return cJ(_4.prettyPrint(cK));};}(a.id))(cI.Name)),bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:-884410062",[cI.Name]),function(){bs.Add("user",cI);return bg.Combine(cI.LastLoggedIn!=null?bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:1564480768",[cI.LastLoggedIn.$0]),function(cJ){cq((function(cK){return function(cL){return cK("You last logged in "+_4.toSafe(cL)+".");};}(a.id))(cJ));return bg.Zero();}):bg.Zero(),bg.Delay(function(){return bg.Bind(cG(cI.Name),function(){return bg.Return(null);});}));})));});})),null)):bw.$==1&&(bM=u.Yes(bw.$0),bM!=null&&bM.$==1&&(bN=cD("addUser",bM.$0),bN!=null&&bN.$==1&&(bO=cF(bN.$0[1]),bO!=null&&bO.$==1&&(bw.$1.$==0&&(bL=bO.$0,true)))))?bg.Start((bP=null,bg.Delay(function(){cr(J.waitAddPhrases(),"user");return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:-884410062",[bL]),function(cH){return cH==null?(cq((function(cI){return function(cJ){return cI("Sorry I was not able to add the user "+_4.toSafe(cJ)+" to the system.");};}(a.id))(bL)),bg.Zero()):bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-959026379",[bL]),function(cI){ct("user",cI);cq((function(cJ){return function(cK){return cJ("Hello "+_4.prettyPrint(cK)+", nice to meet you.");};}(a.id))(bL));return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addMessage:-743437660",[bL,"Welcome to Lerna."]),function(){return bg.Bind(cG(bL),function(){return bg.Return(null);});});});});})),null):bw.$==1&&(bR=u.No(bw.$0),bR!=null&&bR.$==1&&(bS=cD("addUser",bR.$0),bS!=null&&bS.$==1&&(bT=cF(bS.$0[1]),bT!=null&&bT.$==1&&(bw.$1.$==0&&(bQ=bT.$0,true)))))?cq((function(cH){return function(cI){return cH("Ok I did not add the user "+_4.toSafe(cI)+". But you must login for me to help you.");};}(a.id))(bQ)):bw.$==1&&((bV=cE(bw.$0),bV!=null&&bV.$==1)&&bw.$1.$==0)?cq("Could you introduce yourself so we can get started?"):bw.$==1&&(bX=cB(bw.$0),bX!=null&&bX.$==1&&(bY=u.Intent$1("hello",bX.$0),bY!=null&&bY.$==1&&(bY.$0[0]==null&&(bZ=u.Entity1Of1("contact",bY.$0[1]),bZ!=null&&bZ.$==1&&(bw.$1.$==0&&(bW=bZ.$0,true))))))?bg.Start((b0=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-959026379",[bW.get_Value()]),function(cH){return cH==null?(cq((function(cI){return function(cJ){return cI("Sorry, the user "+_4.toSafe(cJ)+" does not exist.");};}(a.id))(bW.get_Value())),bg.Zero()):(cy("switchUser",cH.$0.Name),bg.Zero());});})),null):bw.$==1&&(b2=u.Yes(bw.$0),b2!=null&&b2.$==1&&(b3=cC("switchUser",b2.$0),b3!=null&&b3.$==1&&(b4=cF(b3.$0[1]),b4!=null&&b4.$==1&&(bw.$1.$==0&&(b1=b4.$0,true)))))?(bs.set_Item("user",b1),cq((function(cH){return function(cI){return cH("Ok I switched to user "+_4.prettyPrint(cI)+".");};}(a.id))(b1))):bw.$==1&&(b6=u.No(bw.$0),b6!=null&&b6.$==1&&(b7=cC("switchUser",b6.$0),b7!=null&&b7.$==1&&(b8=cF(b7.$0[1]),b8!=null&&b8.$==1&&(bw.$1.$==0&&(b5=b8.$0,true)))))?cq((function(cH){return function(cI){return cH("Ok I did not switch to user "+_4.toSafe(cI)+".");};}(a.id))(b5)):bw.$==1&&(b_=cB(bw.$0),b_!=null&&b_.$==1&&((b$=u.Intent$1("studyjournal",b_.$0),b$!=null&&b$.$==1)&&bw.$1.$==0))?(co("<img src=\"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.YSxy_C2rlS83dQdUOq9MqwHaFB%26pid%3DApi&f=1\"/>"),cq("Good job! You are right on track with the rest of students in your cohort. Keep it up.")):bw.$==1&&(cb=cB(bw.$0),cb!=null&&cb.$==1&&((cc=u.Intent$1("nextclass",cb.$0),cc!=null&&cc.$==1)&&bw.$1.$==0))?(co("<iframe src=\"https://calendar.google.com/calendar/embed?src=cocnrm4290919hobq1f5he7leg%40group.calendar.google.com&ctz=America%2FPort_of_Spain\" style=\"border: 0\" width=\"800\" height=\"600\" frameborder=\"0\" scrolling=\"no\"></iframe>"),cq("Your next chemistry class is on Monday at 8:30AM.")):bw.$==1&&(ce=cB(bw.$0),ce!=null&&ce.$==1&&(cf=u.Intent$1("reference",ce.$0),cf!=null&&cf.$==1&&(cg=u.Entity1Of1("term",cf.$0[1]),cg!=null&&cg.$==1&&(bw.$1.$==0&&(cd=cg.$0,true)))))?bg.Start((ch=null,bg.Delay(function(){return bg.Bind(bm.getAnswer(cd.get_Value()),function(cH){var cI;cI=_7.get(cH.answers,0).answer;return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtohtml:42527766",[cI]),function(cJ){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtotext:42527766",[cI]),function(cK){co(cJ);cq(cK);return bg.Zero();});});});})),null):bw.$==1&&(cj=cB(bw.$0),cj!=null&&cj.$==1&&(ck=u.Intent$1("quiz",cj.$0),ck!=null&&ck.$==1&&(cl=u.Entity1Of1("term",ck.$0[1]),cl!=null&&cl.$==1&&(bw.$1.$==0&&(ci=cl.$0,true)))))?bg.Start((cm=null,bg.Delay(function(){co("What is the most accurate definition of an element?<br>1. A bond between molecules<br>2. A substance that cannot be broken down into simpler components.<br>3. A combination of atoms.<br> 4. A part of water.");cq("What is the most accurate definition of an element? 1. A bond between molecules. 2. A substance that cannot be broken down into simpler components. 3. A combination of atoms 4. A part of water.");return bg.Zero();})),null):(cv(),P.debug("Main interpreter did not understand utterance."),cq("Sorry I didn't understand what you meant."),bt.length>0?(cn=_9.nth(0,bt),cs(cn.get_Name())?cq(p.replace_tok("$0",bs.get_Item(cn.get_Name()),cn.get_Text())):cq(cn.get_Text())):void 0);P.debug((((X.Curried3(function(cH,cI,cJ){return cH("Ending utterances: "+_4.prettyPrint(cI)+". Ending questions:"+_4.prettyPrint(cJ)+".");}))(a.id))(bv))(bt));};P.haveQuestion=function(br){return _8.exists(function(bs){return bs.get_Name()===br;},P.questions());};P.getQuestion=function(br){return _9.tryFind(function(bs){return bs.get_Name()===br;},P.questions());};P.questions=function(){Q.$cctor();return Q.questions;};P.debug=function(br){p.debug("Main",br);};Q.$cctor=function(){Q.$cctor=a.ignore;Q.questions=_8.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"})]);};R.update=function(br,bs,bt,bu,bv){R.debug((((X.Curried3(function(bw,bx,by){return bw("Starting utterances:"+_4.prettyPrint(bx)+". Starting questions: "+_4.prettyPrint(by)+".");}))(a.id))(bv))(bt));};R.haveQuestion=function(br){return _8.exists(function(bs){return bs.get_Name()===br;},R.questions());};R.getQuestion=function(br){return _9.tryFind(function(bs){return bs.get_Name()===br;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(br){p.debug("Study",br);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_8.ofArray([new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};T.run=function(){var br,bs;br=X.ThisFunc(function(bt,bu){return((T.Main().get_Text())(bt))(bu);});bs=T.Main().get_Options();a.$("#term").terminal(br,bs);return _2.get_Empty();};T.Main=function(){U.$cctor();return U.Main;};T.initMic=function(br,bs){var bt,bu;br[0]=(bt=br[0],N.New(bt.Voice,{$:1,$0:new bn.Microphone(bo.getElementById("microphone"))},bt.Term,bt.Avatar,bt.Caption));bu=br[0].Mic.$0;bu.onconnecting=function(){T.set_MicState(K.MicConnecting);return T.debug("Mic connecting...");};bu.ondisconnected=function(){T.set_MicState(K.MicDisconnected);return T.debug("Mic disconnected.");};bu.onaudiostart=function(){T.set_MicState(K.MicAudioStart);return T.debug("Mic audio start...");};bu.onaudioend=function(){T.set_MicState(K.MicAudioEnd);return T.debug("Mic audio end.");};bu.onerror=function(bv){T.set_MicState({$:6,$0:bv});return T.debug((function(bw){return function(bx){return bw("Mic error : "+_4.toSafe(bx)+".");};}(a.id))(bv));};bu.onready=function(){T.set_MicState(K.MicReady);return T.debug("Mic ready.");};bu.onresult=function(bv,bw){return T.ClientState().$==2?T.echo("I'm still trying to understand what you said before."):T.ClientState().$==0?p.error("Client is not intialized."):!(bv==null||bw==null)?(T.set_MicState({$:7,$0:bv,$1:bw}),T.debug((((X.Curried3(function(bx,by,bz){return bx("Mic result: "+_4.prettyPrint(by)+" "+_4.prettyPrint(bz)+".");}))(a.id))(bv))(bw)),bs(br,bu,[bv,bw])):T.debug("Mic: No result returned.");};bu.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};T.sayRandom=function(br,bs){T.say(J.getRandomPhrase(bs,br));};T.sayVoices=function(){var br;br=p.toArray(p.speechSynthesis().getVoices());T["say'"]((function(bs){return function(bt){return bs("There are currently "+a.String(bt)+" voices installed on this computer or device.");};}(a.id))(_7.length(br)));_7.iteri(function(bs,bt){return T["say'"](((((X.Curried(function(bu,bv,bw,bx){return bu("Voice "+a.String(bv)+". Name: "+_4.toSafe(bw)+", Local: "+_4.prettyPrint(bx)+".");},4))(a.id))(bs))(bt.name))(bt.localService));},br);};T.say=function(br){T.Responses().unshift(br);T["say'"](br);};T["say'"]=function(br){T.CUI().Say(br);};T.initSpeech=function(br){var bs,bt,bu,bv;bs=p.toArray(T.synth().getVoices());_7.length(bs)>0?(bt=_7.find(function(bw){return bw["default"];},bs),br[0]=(bu=br[0],N.New({$:1,$0:bt},bu.Mic,bu.Term,bu.Avatar,bu.Caption)),bv=br[0],T.debug((function(bw){return function(bx){return bw("Using browser speech synthesis voice "+_4.toSafe(bx)+".");};}(a.id))(bv.Voice.$0.name)),bv.Avatar.nativeVoice=true,bv.Avatar.nativeVoiceName=bt.name):T.echo("No browser speech synthesis voice is available. Falling back to CMU TTS.");};T.synth=function(){U.$cctor();return U.synth;};T.push=function(br){T.Utterances().unshift(br);return T.Utterances();};T.Props=function(){U.$cctor();return U.Props;};T.Responses=function(){U.$cctor();return U.Responses;};T.Questions=function(){U.$cctor();return U.Questions;};T.Utterances=function(){U.$cctor();return U.Utterances;};T.wait=function(br){p["Terminal.Echo'"](T.CUI().Term,"please wait");T.CUI().Term.pause();br();T.CUI().Term.resume();};T.debug=function(br){p.debug("CLIENT",br);};T.echo=function(br){if(!(T.CUI().Term==null))p["Terminal.EchoHtml'"](T.CUI().Term,(function(bs){return function(bt){return bs(_4.prettyPrint(bt));};}(a.id))(br));};T.ClientState=function(){U.$cctor();return U.ClientState;};T.set_ClientState=function(br){U.$cctor();U.ClientState=br;};T.MicState=function(){U.$cctor();return U.MicState;};T.set_MicState=function(br){U.$cctor();U.MicState=br;};T.CUI=function(){U.$cctor();return U.CUI;};T.set_CUI=function(br){U.$cctor();U.CUI=br;};U.$cctor=function(){var br,bs,bt,bu,bv,bw;U.$cctor=a.ignore;function bx(bz,bA,bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL;bC=bB[0];bD=bB[1];T.debug((((X.Curried3(function(bM,bN,bO){return bM("Voice: "+_4.prettyPrint(bN)+" "+_4.prettyPrint(bO));}))(a.id))(bC))(bD));bE=(bF=A["Intent'"](bC,bD),bF!=null&&bF.$==1?{$:1,$0:bF.$0}:null);bG=(bH=A["Trait'"](bD),bH!=null&&bH.$==1?{$:1,$0:_8.ofArray([bH.$0])}:null);bI=(bJ=A["Entity'$1"](bD),bJ!=null&&bJ.$==1?{$:1,$0:_8.ofArray([bJ.$0])}:null);return bE==null&&(bG==null&&bI==null)?null:(T.debug(((((X.Curried(function(bM,bN,bO,bP){return bM("Voice: "+V.p(bN)+" "+V.p$3(bO)+" "+V.p$5(bP));},4))(a.id))(bE))(bG))(bI)),bL=T.push(new y({$:0,$0:bE,$1:bG,$2:bI})),P.update(bz[0],T.Props(),T.Questions(),T.Responses(),bL));}function by(bz,bA,bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;bz[0]=N.New(T.CUI().Voice,T.CUI().Mic,bA,T.CUI().Avatar,T.CUI().Caption);bp.Equals(bz[0].Mic,null)?T.initMic(bz,bx):void 0;bp.Equals(bz[0].Voice,null)?T.initSpeech(bz):void 0;bC=bz[0];T.ClientState().$===0?T.set_ClientState(L.ClientReady):void 0;return(bD=C.Blank(bB),bD!=null&&bD.$==1)?T["say'"]("Tell me what you want me to do or ask me a question."):(bE=C.Debug(bB),bE!=null&&bE.$==1)?(T.debug((new bl.New()).Sync("Lerna.Web:Lerna.Web.Server.tag:-2011173339",[])),T.debug((function(bN){return function(bO){return bN("Utterances: "+_4.prettyPrint(bO));};}(a.id))(T.Utterances())),T.debug((function(bN){return function(bO){return bN("Questions: "+_4.prettyPrint(bO));};}(a.id))(T.Questions()))):(bF=C.Voices(bB),bF!=null&&bF.$==1)?T.sayVoices():T.ClientState().$==1?(bH=C.QuickHello(bB),bH!=null&&bH.$==1?(bG=bH.$0,true):(bI=C.QuickHelp(bB),bI!=null&&bI.$==1?(bG=bI.$0,true):(bJ=C.QuickYes(bB),bJ!=null&&bJ.$==1?(bG=bJ.$0,true):(bK=C.QuickNo(bB),bK!=null&&bK.$==1&&(bG=bK.$0,true)))))?(T.debug((function(bN){return function(bO){return bN("Quick Text: "+V.p$7(bO)+".");};}(a.id))(bG)),bL=T.push(bG),P.update(bC,T.Props(),T.Questions(),T.Responses(),bL),T.set_ClientState(L.ClientReady)):bC.Wait((bM=null,bg.Delay(function(){T.set_ClientState(L.ClientUnderstand);C.getUtterance(bB,function(bN){var bO,bP,bQ;bO=C.HasUtterance(bN);bO!=null&&bO.$==1?(bP=bO.$0,T.debug(((((X.Curried(function(bR,bS,bT,bU){return bR("Text: Intent: "+V.p(bS)+", Traits: "+V.p$3(bT)+", Entities: "+V.p$5(bU));},4))(a.id))(bP.get_Intent()))(bP.get_Traits()))(bP.get_Entities())),bQ=T.push(bP),P.update(bC,T.Props(),T.Questions(),T.Responses(),bQ)):(T.debug("Text: Did not receive a meaning from the server."),T["say'"]("Sorry I did not understand what you said."));});T.set_ClientState(L.ClientReady);return bg.Zero();}))):T.ClientState().$==0?p.error("Client is not initialized."):T["say'"]("I'm still trying to understand what you said before.");}U.CUI=N.New(null,null,null,(bh.applicationId="4277115329081938617",br=new a.SDKConnection(),bs=new a.WebAvatar(),bs.version=8.5,bs.connection=br,bs.avatar="22225225",bs.voice="cmu-slt",bs.voiceMod="default",bs.nativeVoice=true,bs.nativeVoiceName="Microsoft David Desktop - English (United States)",bs.width=300,bs.createBox(),bs.addMessage(""),bs.processMessages(0),bs),false);U.MicState=K.MicNotInitialized;U.ClientState=L.ClientNotInitialzed;U.Utterances=[];U.Questions=[];U.Responses=[];U.Props=new bq.New$5();U.synth=a.speechSynthesis;U.Main=(bt=(bu={},bu.name="Main",bu.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bu.prompt=">",bu),new M({$:0,$0:(bv=[T.CUI()],(X.Curried3(bx))(bv)),$1:[(bw=[T.CUI()],(X.Curried3(by))(bw)),bt]}));};V.p$8=function(br){return"Question ("+_4.prettyPrint(br.$0)+", "+_4.prettyPrint(br.$1)+")";};V.p$9=function(br){return br==null?"null":"Some "+_4.prettyPrint(br.$0);};V.p$2=function(br){return br==null?"null":"Some "+_4.prettyPrint(br.$0);};V.p$1=function(br){return"Intent ("+_4.prettyPrint(br.$0)+", "+V.p$2(br.$1)+")";};V.p=function(br){return br==null?"null":"Some "+V.p$1(br.$0);};V.p$4=function(br){return"Trait ("+_4.prettyPrint(br.$0)+", "+_4.prettyPrint(br.$1)+", "+V.p$2(br.$2)+")";};V.p$3=function(br){return br==null?"null":"Some "+_4.printList(function(bs){return V.p$4(bs);},br.$0);};V.p$6=function(br){return"Entity ("+_4.prettyPrint(br.$0)+", "+_4.prettyPrint(br.$1)+", "+V.p$2(br.$2)+")";};V.p$5=function(br){return br==null?"null":"Some "+_4.printList(function(bs){return V.p$6(bs);},br.$0);};V.p$7=function(br){return"Utterance ("+V.p(br.$0)+", "+V.p$3(br.$1)+", "+V.p$5(br.$2)+")";};}());
