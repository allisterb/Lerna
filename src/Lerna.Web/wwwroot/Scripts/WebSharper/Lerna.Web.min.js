(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.NLUResponse=c.NLUResponse||{};e=c.Trait=c.Trait||{};f=c.Entity=c.Entity||{};g=c.Sex=c.Sex||{};h=c.Address=c.Address||{};i=c.Name=c.Name||{};j=c.User=c.User||{};k=c.Student=c.Student||{};l=c.StudyJournalEntry=c.StudyJournalEntry||{};m=b.Web=b.Web||{};n=m.ClientExtensions=m.ClientExtensions||{};o=m._Html=m._Html||{};p=m.htmModule=m.htmModule||{};q=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};r=b.Bootstrap=b.Bootstrap||{};s=r.Controls=r.Controls||{};t=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};u=m.NLU=m.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.Question=u.Question||{};A=u.Voice=u.Voice||{};B=A["Entity'"]=A["Entity'"]||{};C=u.Text=u.Text||{};D=C["Utterance'"]=C["Utterance'"]||{};E=C["Intent'"]=C["Intent'"]||{};F=C["Entity'"]=C["Entity'"]||{};G=C["Trait'"]=C["Trait'"]||{};H=u.Domain=u.Domain||{};I=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};J=m.CUI=m.CUI||{};K=J.MicState=J.MicState||{};L=J.ClientState=J.ClientState||{};M=J.Interpreter=J.Interpreter||{};N=J.CUI=J.CUI||{};O=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};P=m.Main=m.Main||{};Q=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};R=m.Study=m.Study||{};S=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};T=m.Client=m.Client||{};U=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};V=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};W=a.IntelliFactory;X=W&&W.Runtime;Y=a.WebSharper;Z=Y&&Y.Strings;_0=Y&&Y.Utils;_1=a.console;_2=a.jQuery;_3=Y&&Y.Arrays;_4=Y&&Y.List;_5=Y&&Y.Seq;_6=Y&&Y.UI;_7=_6&&_6.Doc;_8=_6&&_6.AttrModule;_9=Y&&Y.JavaScript;_=_9&&_9.Pervasives;$=Y&&Y.Collections;ba=$&&$.Map;bb=b&&b.NLU;bc=bb&&bb.Wit;bd=bc&&bc.WitApi;be=Y&&Y.Concurrency;bf=Y&&Y.Random;bg=Y&&Y.Operators;bh=Y&&Y.Remoting;bi=bh&&bh.AjaxRemotingProvider;bj=a.Wit;bk=a.document;bl=Y&&Y.Unchecked;bm=bb&&bb.QnAMaker;bn=$&&$.Dictionary;d.New=function(bo,bp,bq,br,bs,bt){return{type:bo,msg:bp,action:bq,traits:br,entities:bs,confidence:bt};};e.New=function(bo,bp,bq){return{id:bo,value:bp,confidence:bq};};f.New=function(bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by){return{id:bo,name:bp,role:bq,start:br,end:bs,body:bt,confidence:bu,entities:bv,suggested:bw,value:bx,type:by};};g.Intersex={$:2};g.Female={$:1};g.Male={$:0};h.New=function(bo,bp){return{Street:bo,Town:bp};};i.New=function(bo,bp,bq){return{Full:bo,First:bp,Last:bq};};j=c.User=X.Class({toString:function(){return this.Name;}},null,j);j.New=function(bo,bp){return new j({Name:bo,LastLoggedIn:bp});};k.New=function(bo,bp,bq,br,bs){return{Id:bo,Sex:bp,Name:bq,BirthDate:br,Address:bs};};l.New=function(bo,bp,bq,br){return{UserName:bo,Date:bp,Subject:bq,Duration:br};};n.scriptmd=function(){q.$cctor();return q.scriptmd;};n.mdbold=function(){q.$cctor();return q.mdbold;};n.mdbblockquote=function(){q.$cctor();return q.mdbblockquote;};n.mdh3=function(){q.$cctor();return q.mdh3;};n.mdh2=function(){q.$cctor();return q.mdh2;};n.mdh1=function(){q.$cctor();return q.mdh1;};n.replace_tok=function(bo,bp,bq){return Z.Replace(bq,bo,bp);};n.toLower=function(bo){return bo.toLowerCase();};n.debug=function(bo,bp){n.info((((X.Curried3(function(bq,br,bs){return bq("DEBUG: "+_0.toSafe(br)+": "+_0.prettyPrint(bs));}))(a.id))(bo.toUpperCase()))(bp));};n.error=function(bo){_1.error(bo);};n.info=function(bo){_1.info(bo);};n.jserror=function(bo){_2.error(bo);};n.toArray=function(bo){return _3.map(a.id,_2.makeArray(bo));};n["Terminal.EchoHtml'"]=function(bo,bp){bo.pause();bo.echo(bp,n.rawOpt());bo.resume();};n["Terminal.Echo'"]=function(bo,bp){bo.pause();bo.echo(bp);bo.resume();};n.rawOpt=function(){q.$cctor();return q.rawOpt;};o=m._Html=X.Class({toString:function(){return o.toString(this);}},null,o);o.toString=function(bo){function bp(bq){return function(br){var bs,bt,bu,bv,bw,bx,by;bt=Z.replicate(bq," ");switch(br.$==0?br.$1.$==1?br.$1.$0.$==2?br.$1.$1.$==0?(bs=[br.$1.$0.$0,br.$0],1):(bs=[br.$1,br.$0],2):(bs=[br.$1,br.$0],2):(bs=[br.$1,br.$0],2):br.$==2?(bs=br.$0,3):(bs=[br.$0,br.$1],0)){case 0:return bs[0]+"=\""+bs[1]+"\"";case 1:bu=bs[1];return bt+"<"+bu+">"+bs[0]+"</"+bu+">\r\n";case 2:bv=bs[1];bw=_4.partition(function(bz){return bz.$==1;},bs[0]);bx=bw[1];by=bw[0];return bx.$==0?bt+"<"+bv+(by.$===0?"":" "+Z.concat(" ",_4.ofSeq(_5.delay(function(){return _5.map(function(bz){return(bp(0))(bz);},by);}))))+"/>\r\n":bt+"<"+bv+(by.$===0?"":" "+Z.concat(" ",_4.ofSeq(_5.delay(function(){return _5.map(function(bz){return(bp(0))(bz);},by);}))))+">\r\n"+Z.concat("",_4.ofSeq(_5.delay(function(){return _5.map(function(bz){return(bp(bq+1))(bz);},bx);})))+bt+"</"+bv+">\r\n";case 3:return bt+bs+"\r\n";}};}return(bp(0))(bo);};p.alt=function(bo){return new o({$:1,$0:"alt",$1:bo});};p.src=function(bo){return new o({$:1,$0:"src",$1:bo});};p.cls=function(bo){return new o({$:1,$0:"class",$1:bo});};p.str=function(bo){return o.toString(bo);};p.op_PercentEquals=function(bo,bp){return new o({$:1,$0:bo,$1:bp});};p.op_Splice=function(bo){var bp;return _4.ofArray([new o({$:2,$0:(bp=bo,a.String(bp))})]);};p.strong=function(){q.$cctor();return q.strong;};p.h4=function(){q.$cctor();return q.h4;};p.h3=function(){q.$cctor();return q.h3;};p.h2=function(){q.$cctor();return q.h2;};p.h1=function(){q.$cctor();return q.h1;};p.li=function(){q.$cctor();return q.li;};p.ul=function(){q.$cctor();return q.ul;};p.th=function(){q.$cctor();return q.th;};p.td=function(){q.$cctor();return q.td;};p.tr=function(){q.$cctor();return q.tr;};p.a=function(){q.$cctor();return q.a;};p.p=function(){q.$cctor();return q.p;};p.area=function(){q.$cctor();return q.area;};p.map=function(){q.$cctor();return q.map;};p.img=function(){q.$cctor();return q.img;};p.tfoot=function(){q.$cctor();return q.tfoot;};p.tbody=function(){q.$cctor();return q.tbody;};p.thead=function(){q.$cctor();return q.thead;};p.table=function(){q.$cctor();return q.table;};p.span=function(){q.$cctor();return q.span;};p.section=function(){q.$cctor();return q.section;};p.br=function(){q.$cctor();return q.br;};p.div=function(){q.$cctor();return q.div;};p.body=function(){q.$cctor();return q.body;};p.style=function(){q.$cctor();return q.style;};p.title=function(){q.$cctor();return q.title;};p.head=function(){q.$cctor();return q.head;};p.html=function(){q.$cctor();return q.html;};p.elem=function(bo,bp){return new o({$:0,$0:bo,$1:bp});};q.$cctor=function(){var bo;q.$cctor=a.ignore;q.rawOpt=(bo={},bo.raw=true,bo);q.mdh1=new a.RegExp("^# (.*$)","gim");q.mdh2=new a.RegExp("^## (.*$)","gim");q.mdh3=new a.RegExp("^### (.*$)","gim");q.mdbblockquote=new a.RegExp("/^\\> (.*$)/","gim");q.mdbold=new a.RegExp("/^\\> (.*$)/","gim");q.scriptmd="function parseMarkdown(markdownText) {\r\n        const htmlText = markdownText\r\n        \u0009.replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n        \u0009.replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n        \u0009.replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n        \u0009.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\r\n        \u0009.replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\r\n        \u0009.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\r\n        \u0009.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\r\n        \u0009.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2'>$1</a>\")\r\n        \u0009.replace(/\\n$/gim, '<br />')\r\n        \r\n        return htmlText.trim()\r\n    }\r\n    ";q.html=function(bp){return p.elem("html",bp);};q.head=function(bp){return p.elem("head",bp);};q.title=function(bp){return p.elem("title",bp);};q.style=function(bp){return p.elem("style",bp);};q.body=function(bp){return p.elem("body",bp);};q.div=function(bp){return p.elem("div",bp);};q.br=function(bp){return p.elem("br",bp);};q.section=function(bp){return p.elem("section",bp);};q.span=function(bp){return p.elem("span",bp);};q.table=function(bp){return p.elem("table",bp);};q.thead=function(bp){return p.elem("thead",bp);};q.tbody=function(bp){return p.elem("tbody",bp);};q.tfoot=function(bp){return p.elem("tfoot",bp);};q.img=function(bp){return p.elem("img",bp);};q.map=function(bp){return p.elem("map",bp);};q.area=function(bp){return p.elem("area",bp);};q.p=function(bp){return p.elem("p",bp);};q.a=function(bp){return p.elem("a",bp);};q.tr=function(bp){return p.elem("tr",bp);};q.td=function(bp){return p.elem("td",bp);};q.th=function(bp){return p.elem("th",bp);};q.ul=function(bp){return p.elem("ul",bp);};q.li=function(bp){return p.elem("li",bp);};q.h1=function(bp){return p.elem("h1",bp);};q.h2=function(bp){return p.elem("h1",bp);};q.h3=function(bp){return p.elem("h1",bp);};q.h4=function(bp){return p.elem("h1",bp);};q.strong=function(bp){return p.elem("strong",bp);};};s.Radio=function(bo,bp,bq,br,bs){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("radio"),$1:bp}),[_7.Element("label",br,[_7.Radio(bs,true,bq),_7.TextNode(bo)])]);};s.Checkbox=function(bo,bp,bq,br,bs){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("checkbox"),$1:bp}),[_7.Element("label",br,[_7.CheckBox(bs,bq),_7.TextNode(bo)])]);};s.TextArea=function(bo,bp,bq,br,bs){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:bp}),[_7.Element("label",br,[_7.TextNode(bo)]),_7.InputArea(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bs}),bq)]);};s.InputPassword=function(bo,bp,bq,br,bs){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:bp}),[_7.Element("label",br,[_7.TextNode(bo)]),_7.PasswordBox(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bs}),bq)]);};s.Input=function(bo,bp,bq,br,bs){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:bp}),[_7.Element("label",br,[_7.TextNode(bo)]),_7.Input(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bs}),bq)]);};s.Container=function(bo){return _7.Element("div",[(s.cls())("container")],bo);};s.Class=function(){t.$cctor();return t.Class;};s.cls=function(){t.$cctor();return t.cls;};t.$cctor=function(){t.$cctor=a.ignore;t.cls=_8.Class;t.Class=_8.Class;};v=u.Intent=X.Class({toString:function(){return(((X.Curried3(function(bo,bp,bq){return bo("Intent("+_0.toSafe(bp)+", "+V.p$2(bq)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=X.Class({toString:function(){return(((X.Curried3(function(bo,bp,bq){return bo("Trait("+_0.toSafe(bp)+", "+_0.prettyPrint(bq)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=X.Class({toString:function(){return((((X.Curried(function(bo,bp,bq,br){return bo("Entity("+_0.toSafe(bp)+", "+_0.toSafe(bq)+", "+V.p$2(br)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=X.Class({toString:function(){return((((X.Curried(function(bo,bp,bq,br){return bo(V.p(bp)+" "+V.p$3(bq)+" "+V.p$5(br));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bo;bo=this.$2;return bo!=null?{$:1,$0:_4.sortBy(function(bp){return bp.get_Name();},bo.$0)}:null;},get_Traits:function(){var bo;bo=this.$1;return bo!=null?{$:1,$0:_4.sortBy(function(bp){return bp.get_Name();},bo.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.Question=X.Class({toString:function(){return(((X.Curried3(function(bo,bp,bq){return bo("Name: "+_0.toSafe(bp)+" Text: "+_0.toSafe(bq));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);B.New=function(bo,bp,bq,br,bs){return{body:bo,end:bp,start:bq,suggested:br,value:bs};};A["Intent'"]=function(bo,bp){return!(bp.intent==null)?{$:1,$0:new v({$:0,$0:n.toLower(bp.intent.value),$1:null})}:null;};A["Trait'"]=function(bo){return!(bo.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:n.toLower(bo.domain.value),$2:null})}:!(bo.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:n.toLower(bo.dialogue_act.value),$2:null})}:null;};A["Entity'$1"]=function(bo){return!(bo.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:n.toLower(bo.contact.value),$2:null})}:null;};D=C["Utterance'"]=X.Class({get_TopIntent:function(){return _4.head(_4.sortBy(function(bo){return bo.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,D);E=C["Intent'"]=X.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=C["Entity'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,F);G=C["Trait'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,G);C.HasUtterance=function(bo){var bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;return bo!=null&&bo.$==1&&(bo.$0.$0.$==0&&(bo.$0.$1.get_Length()>0&&(bp=[bo.$0.$1,bo.$0.$2],true)))?(bq=_4.map(function(bD){return new x({$:0,$0:n.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bp[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_4.map(function(bD){return new w({$:0,$0:n.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bp[1]))},$2:{$:1,$0:bq}})}):bo!=null&&bo.$==1&&(bo.$0.$1.$==0&&(bo.$0.$2.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(br=[bo.$0.$0,bo],true))))?(bs=br[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bs.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bs.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bo!=null&&bo.$==1&&(bo.$0.$2.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bt=[bo.$0.$0,bo],true)))?(bu=bt[1],(bv=_4.map(function(bD){return new x({$:0,$0:n.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bu.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bu.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bu.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bv}})})):bo!=null&&bo.$==1&&(bo.$0.$1.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bw=[bo.$0.$0,bo],true)))?(bx=bw[1],(by=_4.map(function(bD){return new w({$:0,$0:n.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bx.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bx.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bx.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:by},$2:null})})):bo!=null&&bo.$==1&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bz=[bo.$0.$0,bo],true))?(bA=bz[1],(bB=_4.map(function(bD){return new x({$:0,$0:n.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bA.$0.get_Entities())),(bC=_4.map(function(bD){return new w({$:0,$0:n.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_4.filter(function(bD){return bD.get_Confidence()>C.entityConfidenceThreshold();},bA.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bC},$2:{$:1,$0:bB}})}))):null;};C.entityConfidenceThreshold=function(){I.$cctor();return I.entityConfidenceThreshold;};C.set_entityConfidenceThreshold=function(bo){I.$cctor();I.entityConfidenceThreshold=bo;};C.intentConfidenceThreshold=function(){I.$cctor();return I.intentConfidenceThreshold;};C.set_intentConfidenceThreshold=function(bo){I.$cctor();I.intentConfidenceThreshold=bo;};C.getUtterance=function(bo,bp){C.witapi().getMeaning(bo,function(bq){var br,bs;n.debug("NLU",(function(bt){return function(bu){return bt("Wit.ai returned: "+_0.prettyPrint(bu));};}(a.id))(bq));br=!(bq.intents==null)?_4.ofArray(_3.map(function(bt){return new E({$:0,$0:bt.name,$1:bt.confidence});},bq.intents)):_4.T.Empty;bs=!(bq.traits==null)?_4.ofSeq(_5.concat(_4.map(function(bt){return _3.map(function(bu){return new G({$:0,$0:bt,$1:bu.confidence,$2:bu.value});},_.GetJS(bq.traits,[bt]));},_4.filter(function(bt){return!(_.GetJS(bq.traits,[bt])==null);},C.trait_types())))):_4.T.Empty;return bp({$:1,$0:new D({$:0,$0:br,$1:!(bq.intents==null)?_4.ofSeq(_5.concat(_4.map(function(bt){return _3.map(function(bu){return new F({$:0,$0:bu.name,$1:bu.confidence,$2:bu.role,$3:bu.value});},_.GetJS(bq.entities,[bt]));},_4.filter(function(bt){return!(_.GetJS(bq.entities,[bt])==null);},C.entity_types())))):_4.T.Empty,$2:bs})});},function(bq,br,bs){n.error((((X.Curried3(function(bt,bu,bv){return bt("Wit.ai returned: "+_0.prettyPrint(bu)+" "+_0.prettyPrint(bv));}))(a.id))(br))(bs));return bp(null);});};C.trait_types=function(){I.$cctor();return I.trait_types;};C.entity_types=function(){I.$cctor();return I.entity_types;};C.witapi=function(){I.$cctor();return I.witapi;};C.QuickPrograms=function(bo){return bo==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};C.QuickNumber=function(bo){var bp,bq,br;return(bq=C.One(bo),bq!=null&&bq.$==1?(bp=bq.$0,true):(br=C.Two(bo),br!=null&&br.$==1&&(bp=br.$0,true)))?{$:1,$0:bp}:null;};C.Three=function(bo){var bp;return bo==="3"||bo==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};C.Two=function(bo){var bp;return bo==="2"||bo==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};C.One=function(bo){var bp;return bo==="1"||bo==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};C.QuickNo=function(bo){var bp;return bo==="no"||(bo==="NO"||(bo==="No"||(bo==="nope"||(bo==="no way"||(bo==="nah"||(bo==="don't do it"||bo==="stop"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickYes=function(bo){var bp;return bo==="yes"||(bo==="YES"||(bo==="Yes"||(bo==="YEs"||(bo==="ok"||(bo==="sure"||(bo==="yeah"||(bo==="yep"||(bo==="uh huh"||(bo==="go ahead"||bo==="go")))))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHelp=function(bo){var bp;return bo==="help"||(bo==="help me"||(bo==="what's this?"||bo==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHello=function(bo){var bp;return bo==="hello"||(bo==="hey"||(bo==="yo"||bo==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.Voices=function(bo){return bo==="voices"?{$:1,$0:null}:null;};C.Debug=function(bo){return bo==="debug"?{$:1,$0:null}:null;};C.Blank=function(bo){return bo===""?{$:1,$0:null}:null;};H.Study=function(bo){return bo.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bo){var bp,bq,br,bs,bt,bu;return(bq=u.Intent$1("no",bo),bq!=null&&bq.$==1&&(bq.$0[0]==null&&(bq.$0[1]==null&&(bp=bo,true))))?{$:1,$0:bp}:(bs=u.Intent$1("noresponse",bo),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bo,true))))?{$:1,$0:br}:(bu=u.Intent$1("NoResponse",bo),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bo,true))))?{$:1,$0:bt}:null;};u.Yes=function(bo){var bp,bq,br,bs,bt,bu;return(bq=u.Intent$1("yes",bo),bq!=null&&bq.$==1&&(bq.$0[0]==null&&(bq.$0[1]==null&&(bp=bo,true))))?{$:1,$0:bp}:(bs=u.Intent$1("yesresponse",bo),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bo,true))))?{$:1,$0:br}:(bu=u.Intent$1("YesResponse",bo),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bo,true))))?{$:1,$0:bt}:null;};u.EntityManyofMany=function(bo,bp){return{$:1,$0:ba.OfArray(_3.ofSeq(_4.map(function(bq){return _4.exists(function(br){return br.get_Name()===bq;},bp)?[bq,{$:1,$0:_4.filter(function(br){return br.get_Name()===bq;},bp)}]:[bq,null];},bo)))};};u.EntityManyOf1=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(_4.exists(function(br){return br.get_Name()===bo;},bp.$0)&&(bq=bp.$0,true))?{$:1,$0:_4.filter(function(br){return br.get_Name()===bo;},bq)}:null;};u.Entity1OfAny=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(_4.exists(function(br){return br.get_Name()===bo;},bp.$0)&&(bq=bp.$0,true))?{$:1,$0:_4.head(_4.sortBy(function(br){return br.get_Name();},_4.filter(function(br){return br.get_Name()===bo;},bq)))}:null;};u.Entity1Of1=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(bp.$0.$==1&&(bp.$0.$1.$==0&&(bp.$0.$0.get_Name()===bo&&(bq=bp.$0.$0,true))))?{$:1,$0:bq}:null;};u.Intent$1=function(bo,bp){return bp.get_Intent()!=null&&bp.get_Intent().$0.get_Name()===bo?{$:1,$0:[bp.get_Traits(),bp.get_Entities()]}:null;};I.$cctor=function(){I.$cctor=a.ignore;I.witapi=new bd.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");I.entity_types=_4.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject"]);I.trait_types=_4.ofArray(["domain","dialogue_act"]);I.intentConfidenceThreshold=0.85;I.entityConfidenceThreshold=0.85;};K.MicReady={$:5};K.MicAudioEnd={$:4};K.MicAudioStart={$:3};K.MicDisconnected={$:2};K.MicConnecting={$:1};K.MicNotInitialized={$:0};L.ClientUnderstand={$:2};L.ClientReady={$:1};L.ClientNotInitialzed={$:0};M=J.Interpreter=X.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,M);N=J.CUI=X.Class({SayVoices:function(){var bo,bp,bq;bo=this;bp=a.speechSynthesis.getVoices();!(bp==null)?(bq=n.toArray(bp),bo.Say((function(br){return function(bs){return br("There are currently "+a.String(bs)+" voices installed on this computer or device.");};}(a.id))(_3.length(bq))),_3.iteri(function(br,bs){return bo.Say(((((X.Curried(function(bt,bu,bv,bw){return bt("Voice "+a.String(bu)+". Name: "+_0.toSafe(bv)+", Local: "+_0.prettyPrint(bw)+".");},4))(a.id))(br))(bs.name))(bs.localService));},bq)):void 0;},Wait:function(bo){this.Wait$1(function(){be.Start(bo,null);});},Wait$1:function(bo){this["Echo'"]("please wait...");this.Term.pause();bo();this.Term.resume();},sayRandom:function(bo,bp){this.Say(J.getRandomPhrase(bo,bp));},Say:function(bo){var bp,bq;bp=this;be.Start((bq=null,be.Delay(function(){a.speechSynthesis.speaking?a.speechSynthesis.cancel():void 0;bp.Avatar.addMessage(bo);bp.Avatar.processMessages(0);return be.Zero();})),null);},Debug:function(bo,bp){n.debug(bo,bp);},"EchoHtml'":function(bo){var bp,bq;bp=(bq={},bq.raw=true,bq);this.Term.disable();this.Term.echo(bo,bp);this.Term.enable();},"Echo'":function(bo){this.Term.disable();this.Term.echo(bo);this.Term.enable();}},null,N);N.New=function(bo,bp,bq,br,bs){return new N({Voice:bo,Mic:bp,Term:bq,Avatar:br,Caption:bs});};J.waitAddPhrases=function(){O.$cctor();return O.waitAddPhrases;};J.waitRetrievePhrases=function(){O.$cctor();return O.waitRetrievePhrases;};J.helpPhrases=function(){O.$cctor();return O.helpPhrases;};J.helloUserPhrases=function(){O.$cctor();return O.helloUserPhrases;};J.helloPhrases=function(){O.$cctor();return O.helloPhrases;};J["getRandomPhrase'"]=function(bo){return n.replace_tok("$0","",_5.nth(J.rng().Next(0,bo.get_Length()),bo));};J.getRandomPhrase=function(bo,bp){return n.replace_tok("$0",bp,_5.nth(J.rng().Next(0,bo.get_Length()),bo));};J.rng=function(){O.$cctor();return O.rng;};O.$cctor=function(){O.$cctor=a.ignore;O.rng=new bf.New();O.helloPhrases=_4.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);O.helloUserPhrases=_4.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);O.helpPhrases=_4.ofArray(["What can I help you with $0?"]);O.waitRetrievePhrases=_4.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);O.waitAddPhrases=_4.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};P.update=function(bo,bp,bq,br,bs){var bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8;function b9(cn){bo.Say(cn);}function b_(cn){br.unshift(cn);b9(cn);}function b$(cn,co){var cp;cp=J.getRandomPhrase(cn,co);br.unshift(cp);return bo.Say(cp);}function ca(cn){return bp.ContainsKey(cn);}function cb(cn,co){return bp.Add(cn,co);}function cc(cn){bp.Remove(cn);}function cd(){bs.shift();}function ce(){bq.shift();}function cf(cn){var co;co=P.getQuestion(cn);co==null?(function(cp){return function(cq){return cp("No such question: "+_0.toSafe(cq));};}(bg.FailWith))(cn):bq.unshift(co.$0);}function cg(cn,co){cb(cn,co);cf(cn);P.debug((function(cp){return function(cq){return cp("Added question: "+V.p$8(cq)+".");};}(a.id))(bq[0]));return b_(n.replace_tok("$0",co,P.getQuestion(cn).$0.get_Text()));}function ch(cn,co){return ca(cn)?{$:1,$0:co}:null;}function ci(cn,co){return!ca(cn)?{$:1,$0:co}:null;}function cj(cn,co){var cp,cq,cr;return(cq=ch("user",co),cq!=null&&cq.$==1&&(P.haveQuestion(cn)&&bq.length>0&&bq[0].get_Name()===cn&&(cp=cq.$0,true)))?(cd(),ce(),ca(cn)?(cr=bp.get_Item(cn),(cc(cn),{$:1,$0:[cp,{$:1,$0:cr}]})):{$:1,$0:[cp,null]}):null;}function ck(cn,co){var cp,cq,cr;return(cq=ci("user",co),cq!=null&&cq.$==1&&(P.haveQuestion(cn)&&bq.length>0&&bq[0].get_Name()===cn&&(cp=cq.$0,true)))?(cd(),ce(),ca(cn)?(cr=bp.get_Item(cn),(cc(cn),{$:1,$0:[cp,{$:1,$0:cr}]})):{$:1,$0:[cp,null]}):null;}function cl(cn){var co,cp;return(cp=ci("user",cn),cp!=null&&cp.$==1&&(bq.length===0&&(co=cp.$0,true)))?(cd(),{$:1,$0:co}):null;}function cm(cn){var co;return cn!=null&&cn.$==1&&(typeof cn.$0=="string"&&(co=cn.$0,true))?{$:1,$0:co}:null;}P.debug((((X.Curried3(function(cn,co,cp){return cn("Starting utterances:"+_0.prettyPrint(co)+". Starting questions: "+_0.prettyPrint(cp)+".");}))(a.id))(bs))(bq));bt=_4.ofSeq(_5.take(bs.length>=5?5:bs.length,bs));bt.$==1&&(bv=(bw=ci("started",bt.$0),bw!=null&&bw.$==1?{$:1,$0:bw.$0}:null),bv!=null&&bv.$==1&&(bx=cl(bv.$0),bx!=null&&bx.$==1&&(by=u.Intent$1("hello",bx.$0),by!=null&&by.$==1&&(by.$0[1]==null&&bt.$1.$==0))))?(bp.Add("started",true),b$(J.helloPhrases(),"")):bt.$==1&&(bA=cl(bt.$0),bA!=null&&bA.$==1&&(bB=u.Intent$1("hello",bA.$0),bB!=null&&bB.$==1&&(bB.$0[1]==null&&bt.$1.$==0)))?b_("Hello, tell me your name to get started."):bt.$==1&&(bD=cl(bt.$0),bD!=null&&bD.$==1&&(bE=u.Intent$1("hello",bD.$0),bE!=null&&bE.$==1&&(bF=u.Entity1Of1("contact",bE.$0[1]),bF!=null&&bF.$==1&&(bt.$1.$==0&&(bC=bF.$0,true)))))?(bG=bC.get_Value(),b$(J.waitRetrievePhrases(),"user name"),be.Start((bH=null,be.Delay(function(){return be.Bind((new bi.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-172269885",[bG]),function(cn){var co;return cn==null?(b_((function(cp){return function(cq){return cp("I did not find a user with the name "+_0.toSafe(cq)+".");};}(a.id))(bG)),cg("addUser",bG),be.Zero()):(co=cn.$0,be.Bind((new bi.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:-2126081244",[co.Name]),function(){bp.Add("user",co);b$(J.helloUserPhrases(),(function(cp){return function(cq){return cp(_0.prettyPrint(cq));};}(a.id))(bp.get_Item("user")));return co.LastLoggedIn!=null?be.Bind((new bi.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-340119042",[co.LastLoggedIn.$0]),function(cp){b_((function(cq){return function(cr){return cq("You last logged in "+_0.toSafe(cr)+".");};}(a.id))(cp));return be.Zero();}):be.Zero();}));});})),null)):bt.$==1&&(bJ=u.Yes(bt.$0),bJ!=null&&bJ.$==1&&(bK=ck("addUser",bJ.$0),bK!=null&&bK.$==1&&(bL=cm(bK.$0[1]),bL!=null&&bL.$==1&&(bt.$1.$==0&&(bI=bL.$0,true)))))?be.Start((bM=null,be.Delay(function(){b$(J.waitAddPhrases(),"user");return be.Bind((new bi.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:-2126081244",[bI]),function(cn){return cn==null?(b_((function(co){return function(cp){return co("Sorry I was not able to add the user "+_0.toSafe(cp)+" to the system.");};}(a.id))(bI)),be.Zero()):(cb("user",bI),b_((function(co){return function(cp){return co("Hello "+_0.prettyPrint(cp)+", nice to meet you.");};}(a.id))(bp.get_Item("user"))),be.Zero());});})),null):bt.$==1&&(bO=u.No(bt.$0),bO!=null&&bO.$==1&&(bP=ck("addUser",bO.$0),bP!=null&&bP.$==1&&(bQ=cm(bP.$0[1]),bQ!=null&&bQ.$==1&&(bt.$1.$==0&&(bN=bQ.$0,true)))))?b_((function(cn){return function(co){return cn("Ok I did not add the user "+_0.toSafe(co)+". But you must login for me to help you.");};}(a.id))(bN)):bt.$==1&&((bS=cl(bt.$0),bS!=null&&bS.$==1)&&bt.$1.$==0)?b_("Could you introduce yourself so we can get started?"):bt.$==1&&(bU=(bW=ch("user",bt.$0),bW!=null&&bW.$==1&&(bq.length===0&&(bV=bW.$0,true)))?(cd(),{$:1,$0:bV}):null,bU!=null&&bU.$==1&&(bX=u.Intent$1("hello",bU.$0),bX!=null&&bX.$==1&&(bX.$0[0]==null&&(bY=u.Entity1Of1("contact",bX.$0[1]),bY!=null&&bY.$==1&&(bt.$1.$==0&&(bT=bY.$0,true))))))?be.Start((bZ=null,be.Delay(function(){return be.Bind((new bi.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-172269885",[bT.get_Value()]),function(cn){return cn==null?(b_((function(co){return function(cp){return co("Sorry, the user "+_0.toSafe(cp)+" does not exist.");};}(a.id))(bT.get_Value())),be.Zero()):(cg("switchUser",cn.$0.Name),be.Zero());});})),null):bt.$==1&&(b1=u.Yes(bt.$0),b1!=null&&b1.$==1&&(b2=cj("switchUser",b1.$0),b2!=null&&b2.$==1&&(b3=cm(b2.$0[1]),b3!=null&&b3.$==1&&(bt.$1.$==0&&(b0=b3.$0,true)))))?(bp.set_Item("user",b0),b_((function(cn){return function(co){return cn("Ok I switched to user "+_0.prettyPrint(co)+".");};}(a.id))(b0))):bt.$==1&&(b5=u.No(bt.$0),b5!=null&&b5.$==1&&(b6=cj("switchUser",b5.$0),b6!=null&&b6.$==1&&(b7=cm(b6.$0[1]),b7!=null&&b7.$==1&&(bt.$1.$==0&&(b4=b7.$0,true)))))?b_((function(cn){return function(co){return cn("Ok I did not switch to user "+_0.toSafe(co)+".");};}(a.id))(b4)):(cd(),P.debug("Main interpreter did not understand utterance."),b_("Sorry I didn't understand what you meant."),bq.length>0?(b8=_5.nth(0,bq),ca(b8.get_Name())?b_(n.replace_tok("$0",bp.get_Item(b8.get_Name()),b8.get_Text())):b_(b8.get_Text())):void 0);P.debug((((X.Curried3(function(cn,co,cp){return cn("Ending utterances: "+_0.prettyPrint(co)+". Ending questions:"+_0.prettyPrint(cp)+".");}))(a.id))(bs))(bq));};P.haveQuestion=function(bo){return _4.exists(function(bp){return bp.get_Name()===bo;},P.questions());};P.getQuestion=function(bo){return _5.tryFind(function(bp){return bp.get_Name()===bo;},P.questions());};P.questions=function(){Q.$cctor();return Q.questions;};P.debug=function(bo){n.debug("Main",bo);};Q.$cctor=function(){Q.$cctor=a.ignore;Q.questions=_4.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};R.update=function(bo,bp,bq,br,bs){R.debug((((X.Curried3(function(bt,bu,bv){return bt("Starting utterances:"+_0.prettyPrint(bu)+". Starting questions: "+_0.prettyPrint(bv)+".");}))(a.id))(bs))(bq));};R.haveQuestion=function(bo){return _4.exists(function(bp){return bp.get_Name()===bo;},R.questions());};R.getQuestion=function(bo){return _5.tryFind(function(bp){return bp.get_Name()===bo;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(bo){n.debug("Study",bo);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_4.ofArray([new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};T.run=function(){var bo,bp,bq;T.set_CUI((bo=(bp=X.ThisFunc(function(br,bs){return((T.Main().get_Text())(br))(bs);}),(bq=T.Main().get_Options(),void a.$("#main").terminal(bp,bq))),N.New(T.CUI().Voice,T.CUI().Mic,bo,T.CUI().Avatar,T.CUI().Caption)));return _7.get_Empty();};T.Main=function(){U.$cctor();return U.Main;};T.initMic=function(bo){var bp,bq;T.set_CUI((bp={$:1,$0:new bj.Microphone(bk.getElementById("microphone"))},N.New(T.CUI().Voice,bp,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)));bq=T.CUI().Mic.$0;bq.onconnecting=function(){T.set_MicState(K.MicConnecting);return T.debug("Mic connecting...");};bq.ondisconnected=function(){T.set_MicState(K.MicDisconnected);return T.debug("Mic disconnected.");};bq.onaudiostart=function(){T.set_MicState(K.MicAudioStart);return T.debug("Mic audio start...");};bq.onaudioend=function(){T.set_MicState(K.MicAudioEnd);return T.debug("Mic audio end.");};bq.onerror=function(br){T.set_MicState({$:6,$0:br});return T.debug((function(bs){return function(bt){return bs("Mic error : "+_0.toSafe(bt)+".");};}(a.id))(br));};bq.onready=function(){T.set_MicState(K.MicReady);return T.debug("Mic ready.");};bq.onresult=function(br,bs){return T.ClientState().$==2?T.echo("I'm still trying to understand what you said before."):T.ClientState().$==0?n.error("Client is not intialized."):!(br==null||bs==null)?(T.set_MicState({$:7,$0:br,$1:bs}),T.debug((((X.Curried3(function(bt,bu,bv){return bt("Mic result: "+_0.prettyPrint(bu)+" "+_0.prettyPrint(bv)+".");}))(a.id))(br))(bs)),bo(bq,[br,bs])):T.debug("Mic: No result returned.");};bq.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};T.sayRandom=function(bo,bp){T.say(J.getRandomPhrase(bp,bo));};T.sayVoices=function(){var bo;bo=n.toArray(T.synth().getVoices());T["say'"]((function(bp){return function(bq){return bp("There are currently "+a.String(bq)+" voices installed on this computer or device.");};}(a.id))(_3.length(bo)));_3.iteri(function(bp,bq){return T["say'"](((((X.Curried(function(br,bs,bt,bu){return br("Voice "+a.String(bs)+". Name: "+_0.toSafe(bt)+", Local: "+_0.prettyPrint(bu)+".");},4))(a.id))(bp))(bq.name))(bq.localService));},bo);};T.say=function(bo){T.Responses().unshift(bo);T["say'"](bo);};T["say'"]=function(bo){T.CUI().Say(bo);};T.initSpeech=function(){var bo,bp;bo=n.toArray(T.synth().getVoices());_3.length(bo)>0?(bp=_3.find(function(bq){return bq["default"];},bo),T.set_CUI(N.New({$:1,$0:bp},T.CUI().Mic,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)),T.debug((function(bq){return function(br){return bq("Using default voice "+_0.toSafe(br)+".");};}(a.id))(T.CUI().Voice.$0.name)),T.CUI().Avatar.nativeVoice=true,T.CUI().Avatar.nativeVoiceName=bp.name):T.echo("No speech synthesis voice is available.");};T.synth=function(){U.$cctor();return U.synth;};T.push=function(bo){T.Utterances().unshift(bo);return T.Utterances();};T.Props=function(){U.$cctor();return U.Props;};T.Responses=function(){U.$cctor();return U.Responses;};T.Questions=function(){U.$cctor();return U.Questions;};T.Utterances=function(){U.$cctor();return U.Utterances;};T.wait=function(bo){n["Terminal.Echo'"](T.CUI().Term,"please wait");T.CUI().Term.pause();bo();T.CUI().Term.resume();};T.debug=function(bo){n.debug("CLIENT",bo);};T.echo=function(bo){if(!(T.CUI().Term==null))n["Terminal.EchoHtml'"](T.CUI().Term,(function(bp){return function(bq){return bp(_0.prettyPrint(bq));};}(a.id))(bo));};T.ClientState=function(){U.$cctor();return U.ClientState;};T.set_ClientState=function(bo){U.$cctor();U.ClientState=bo;};T.MicState=function(){U.$cctor();return U.MicState;};T.set_MicState=function(bo){U.$cctor();U.MicState=bo;};T.CUI=function(){U.$cctor();return U.CUI;};T.set_CUI=function(bo){U.$cctor();U.CUI=bo;};U.$cctor=function(){var bo,bp,bq;U.$cctor=a.ignore;function br(bt,bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE;bv=bu[0];bw=bu[1];T.debug((((X.Curried3(function(bF,bG,bH){return bF("Voice: "+_0.prettyPrint(bG)+" "+_0.prettyPrint(bH));}))(a.id))(bv))(bw));bx=(by=A["Intent'"](bv,bw),by!=null&&by.$==1?{$:1,$0:by.$0}:null);bz=(bA=A["Trait'"](bw),bA!=null&&bA.$==1?{$:1,$0:_4.ofArray([bA.$0])}:null);bB=(bC=A["Entity'$1"](bw),bC!=null&&bC.$==1?{$:1,$0:_4.ofArray([bC.$0])}:null);return bx==null&&(bz==null&&bB==null)?null:(T.debug(((((X.Curried(function(bF,bG,bH,bI){return bF("Voice: "+V.p(bG)+" "+V.p$3(bH)+" "+V.p$5(bI));},4))(a.id))(bx))(bz))(bB)),bE=T.push(new y({$:0,$0:bx,$1:bz,$2:bB})),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bE));}function bs(bt,bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF;T.set_CUI(N.New(T.CUI().Voice,T.CUI().Mic,bt,T.CUI().Avatar,T.CUI().Caption));bl.Equals(T.CUI().Mic,null)?T.initMic(br):void 0;bl.Equals(T.CUI().Voice,null)?T.initSpeech():void 0;T.ClientState().$===0?T.set_ClientState(L.ClientReady):void 0;return(bv=C.Blank(bu),bv!=null&&bv.$==1)?T["say'"]("Tell me what you want me to do or ask me a question."):(bw=C.Debug(bu),bw!=null&&bw.$==1)?(T.debug((function(bG){return function(bH){return bG("Utterances: "+_0.prettyPrint(bH));};}(a.id))(T.Utterances())),T.debug((function(bG){return function(bH){return bG("Questions: "+_0.prettyPrint(bH));};}(a.id))(T.Questions()))):(bx=C.Voices(bu),bx!=null&&bx.$==1)?T.sayVoices():T.ClientState().$==1?(bz=C.QuickHello(bu),bz!=null&&bz.$==1?(by=bz.$0,true):(bA=C.QuickHelp(bu),bA!=null&&bA.$==1?(by=bA.$0,true):(bB=C.QuickYes(bu),bB!=null&&bB.$==1?(by=bB.$0,true):(bC=C.QuickNo(bu),bC!=null&&bC.$==1&&(by=bC.$0,true)))))?(be.Start((bD=null,be.Delay(function(){return be.Bind(bm.getAnswer("What is an element?"),function(bG){T.debug(_3.get(bG.answers,0).answer);return be.Zero();});})),null),T.debug((function(bG){return function(bH){return bG("Quick Text: "+V.p$7(bH)+".");};}(a.id))(by)),bE=T.push(by),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bE),T.set_ClientState(L.ClientReady)):T.CUI().Wait((bF=null,be.Delay(function(){T.set_ClientState(L.ClientUnderstand);C.getUtterance(bu,function(bG){var bH,bI,bJ;bH=C.HasUtterance(bG);bH!=null&&bH.$==1?(bI=bH.$0,T.debug(((((X.Curried(function(bK,bL,bM,bN){return bK("Text: Intent: "+V.p(bL)+", Traits: "+V.p$3(bM)+", Entities: "+V.p$5(bN));},4))(a.id))(bI.get_Intent()))(bI.get_Traits()))(bI.get_Entities())),bJ=T.push(bI),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bJ)):(T.debug("Text: Did not receive a meaning from the server."),T["say'"]("Sorry I did not understand what you said."));});T.set_ClientState(L.ClientReady);return be.Zero();}))):T.ClientState().$==0?n.error("Client is not initialized."):T["say'"]("I'm still trying to understand what you said before.");}U.CUI=N.New(null,null,null,(a.SDK.applicationId="4277115329081938617",bo=new a.SDKConnection(),bp=new a.WebAvatar(),bp.version=8.5,bp.connection=bo,bp.avatar="22225225",bp.voice="cmu-slt",bp.voiceMod="default",bp.nativeVoice=true,bp.nativeVoiceName="Microsoft David Desktop - English (United States)",bp.width=300,bp.createBox(),bp.addMessage(""),bp.processMessages(0),bp),false);U.MicState=K.MicNotInitialized;U.ClientState=L.ClientNotInitialzed;U.Utterances=[];U.Questions=[];U.Responses=[];U.Props=new bn.New$5();U.synth=a.speechSynthesis;U.Main=new M({$:0,$0:function(bt){return function(bu){return br(bt,bu);};},$1:[function(bt){return function(bu){return bs(bt,bu);};},(bq={},bq.name="Main",bq.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bq.prompt=">",bq)]});};V.p$8=function(bo){return"Question ("+_0.prettyPrint(bo.$0)+", "+_0.prettyPrint(bo.$1)+")";};V.p$9=function(bo){return bo==null?"null":"Some "+_0.prettyPrint(bo.$0);};V.p$2=function(bo){return bo==null?"null":"Some "+_0.prettyPrint(bo.$0);};V.p$1=function(bo){return"Intent ("+_0.prettyPrint(bo.$0)+", "+V.p$2(bo.$1)+")";};V.p=function(bo){return bo==null?"null":"Some "+V.p$1(bo.$0);};V.p$4=function(bo){return"Trait ("+_0.prettyPrint(bo.$0)+", "+_0.prettyPrint(bo.$1)+", "+V.p$2(bo.$2)+")";};V.p$3=function(bo){return bo==null?"null":"Some "+_0.printList(function(bp){return V.p$4(bp);},bo.$0);};V.p$6=function(bo){return"Entity ("+_0.prettyPrint(bo.$0)+", "+_0.prettyPrint(bo.$1)+", "+V.p$2(bo.$2)+")";};V.p$5=function(bo){return bo==null?"null":"Some "+_0.printList(function(bp){return V.p$6(bp);},bo.$0);};V.p$7=function(bo){return"Utterance ("+V.p(bo.$0)+", "+V.p$3(bo.$1)+", "+V.p$5(bo.$2)+")";};}());
