(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.StudyJournalEntry=c.StudyJournalEntry||{};j=c.Message=c.Message||{};k=c.Wit=c.Wit||{};l=k.NLUResponse=k.NLUResponse||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=b.Web=b.Web||{};p=o.ClientExtensions=o.ClientExtensions||{};q=o._Html=o._Html||{};r=o.htmModule=o.htmModule||{};s=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};t=b.Bootstrap=b.Bootstrap||{};u=t.Controls=t.Controls||{};v=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};w=o.NLU=o.NLU||{};x=w.Intent=w.Intent||{};y=w.Trait=w.Trait||{};z=w.Entity=w.Entity||{};A=w.Utterance=w.Utterance||{};B=w.Question=w.Question||{};C=w.Voice=w.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=w.Text=w.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=w.Domain=w.Domain||{};K=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};L=o.CUI=o.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};R=o.Main=o.Main||{};S=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};T=o.Study=o.Study||{};U=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};V=o.Client=o.Client||{};W=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};X=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};Y=a.IntelliFactory;Z=Y&&Y.Runtime;_0=a.WebSharper;_1=_0&&_0.Strings;_2=_0&&_0.Utils;_3=a.console;_4=a.jQuery;_5=_0&&_0.Arrays;_6=_0&&_0.List;_7=_0&&_0.Seq;_8=_0&&_0.UI;_9=_8&&_8.Doc;_=_8&&_8.AttrModule;$=_0&&_0.JavaScript;ba=$&&$.Pervasives;bb=_0&&_0.Collections;bc=bb&&bb.Map;bd=b&&b.NLU;be=bd&&bd.Wit;bf=be&&be.WitApi;bg=_0&&_0.Concurrency;bh=a.SDK;bi=_0&&_0.Random;bj=_0&&_0.Operators;bk=_0&&_0.Remoting;bl=bk&&bk.AjaxRemotingProvider;bm=bd&&bd.QnAMaker;bn=_8&&_8.AttrProxy;bo=_8&&_8.Client;bp=bo&&bo.Templates;bq=a.Wit;br=a.document;bs=_0&&_0.Unchecked;bt=bb&&bb.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(bu,bv){return{Street:bu,Town:bv};};f.New=function(bu,bv,bw){return{Full:bu,First:bv,Last:bw};};g=c.User=Z.Class({toString:function(){return this.Name;}},null,g);g.New=function(bu,bv){return new g({Name:bu,LastLoggedIn:bv});};h.New=function(bu,bv,bw,bx,by){return{Id:bu,Sex:bv,Name:bw,BirthDate:bx,Address:by};};i.New=function(bu,bv,bw,bx){return{UserName:bu,Date:bv,Subject:bw,Duration:bx};};j.New=function(bu,bv,bw,bx){return{UserName:bu,Date:bv,Text:bw,IsRead:bx};};l.New=function(bu,bv,bw,bx,by,bz){return{type:bu,msg:bv,action:bw,traits:bx,entities:by,confidence:bz};};m.New=function(bu,bv,bw){return{id:bu,value:bv,confidence:bw};};n.New=function(bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE){return{id:bu,name:bv,role:bw,start:bx,end:by,body:bz,confidence:bA,entities:bB,suggested:bC,value:bD,type:bE};};p.speechSynthesis=function(){return a.speechSynthesis;};p.replace_tok=function(bu,bv,bw){return _1.Replace(bw,bu,bv);};p.toLower=function(bu){return bu.toLowerCase();};p.debug=function(bu,bv){p.info((((Z.Curried3(function(bw,bx,by){return bw("DEBUG: "+_2.toSafe(bx)+": "+_2.prettyPrint(by));}))(a.id))(bu.toUpperCase()))(bv));};p.error=function(bu){_3.error(bu);};p.info=function(bu){_3.info(bu);};p.jserror=function(bu){_4.error(bu);};p.toArray=function(bu){return _5.map(a.id,_4.makeArray(bu));};p["Terminal.EchoHtml'"]=function(bu,bv){bu.pause();bu.echo(bv,p.rawOpt());bu.resume();};p["Terminal.Echo'"]=function(bu,bv){bu.pause();bu.echo(bv);bu.resume();};p.rawOpt=function(){s.$cctor();return s.rawOpt;};q=o._Html=Z.Class({toString:function(){return q.toString(this);}},null,q);q.toString=function(bu){function bv(bw){return function(bx){var by,bz,bA,bB,bC,bD,bE;bz=_1.replicate(bw," ");switch(bx.$==0?bx.$1.$==1?bx.$1.$0.$==2?bx.$1.$1.$==0?(by=[bx.$1.$0.$0,bx.$0],1):(by=[bx.$1,bx.$0],2):(by=[bx.$1,bx.$0],2):(by=[bx.$1,bx.$0],2):bx.$==2?(by=bx.$0,3):(by=[bx.$0,bx.$1],0)){case 0:return by[0]+"=\""+by[1]+"\"";case 1:bA=by[1];return bz+"<"+bA+">"+by[0]+"</"+bA+">\r\n";case 2:bB=by[1];bC=_6.partition(function(bF){return bF.$==1;},by[0]);bD=bC[1];bE=bC[0];return bD.$==0?bz+"<"+bB+(bE.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bF){return(bv(0))(bF);},bE);}))))+"/>\r\n":bz+"<"+bB+(bE.$===0?"":" "+_1.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bF){return(bv(0))(bF);},bE);}))))+">\r\n"+_1.concat("",_6.ofSeq(_7.delay(function(){return _7.map(function(bF){return(bv(bw+1))(bF);},bD);})))+bz+"</"+bB+">\r\n";case 3:return bz+by+"\r\n";}};}return(bv(0))(bu);};r.alt=function(bu){return new q({$:1,$0:"alt",$1:bu});};r.src=function(bu){return new q({$:1,$0:"src",$1:bu});};r.cls=function(bu){return new q({$:1,$0:"class",$1:bu});};r.str=function(bu){return q.toString(bu);};r.op_PercentEquals=function(bu,bv){return new q({$:1,$0:bu,$1:bv});};r.op_Splice=function(bu){var bv;return _6.ofArray([new q({$:2,$0:(bv=bu,a.String(bv))})]);};r.strong=function(){s.$cctor();return s.strong;};r.h4=function(){s.$cctor();return s.h4;};r.h3=function(){s.$cctor();return s.h3;};r.h2=function(){s.$cctor();return s.h2;};r.h1=function(){s.$cctor();return s.h1;};r.li=function(){s.$cctor();return s.li;};r.ul=function(){s.$cctor();return s.ul;};r.th=function(){s.$cctor();return s.th;};r.td=function(){s.$cctor();return s.td;};r.tr=function(){s.$cctor();return s.tr;};r.a=function(){s.$cctor();return s.a;};r.p=function(){s.$cctor();return s.p;};r.area=function(){s.$cctor();return s.area;};r.map=function(){s.$cctor();return s.map;};r.img=function(){s.$cctor();return s.img;};r.tfoot=function(){s.$cctor();return s.tfoot;};r.tbody=function(){s.$cctor();return s.tbody;};r.thead=function(){s.$cctor();return s.thead;};r.table=function(){s.$cctor();return s.table;};r.span=function(){s.$cctor();return s.span;};r.section=function(){s.$cctor();return s.section;};r.br=function(){s.$cctor();return s.br;};r.div=function(){s.$cctor();return s.div;};r.body=function(){s.$cctor();return s.body;};r.style=function(){s.$cctor();return s.style;};r.title=function(){s.$cctor();return s.title;};r.head=function(){s.$cctor();return s.head;};r.html=function(){s.$cctor();return s.html;};r.elem=function(bu,bv){return new q({$:0,$0:bu,$1:bv});};s.$cctor=function(){var bu;s.$cctor=a.ignore;s.rawOpt=(bu={},bu.raw=true,bu);s.html=function(bv){return r.elem("html",bv);};s.head=function(bv){return r.elem("head",bv);};s.title=function(bv){return r.elem("title",bv);};s.style=function(bv){return r.elem("style",bv);};s.body=function(bv){return r.elem("body",bv);};s.div=function(bv){return r.elem("div",bv);};s.br=function(bv){return r.elem("br",bv);};s.section=function(bv){return r.elem("section",bv);};s.span=function(bv){return r.elem("span",bv);};s.table=function(bv){return r.elem("table",bv);};s.thead=function(bv){return r.elem("thead",bv);};s.tbody=function(bv){return r.elem("tbody",bv);};s.tfoot=function(bv){return r.elem("tfoot",bv);};s.img=function(bv){return r.elem("img",bv);};s.map=function(bv){return r.elem("map",bv);};s.area=function(bv){return r.elem("area",bv);};s.p=function(bv){return r.elem("p",bv);};s.a=function(bv){return r.elem("a",bv);};s.tr=function(bv){return r.elem("tr",bv);};s.td=function(bv){return r.elem("td",bv);};s.th=function(bv){return r.elem("th",bv);};s.ul=function(bv){return r.elem("ul",bv);};s.li=function(bv){return r.elem("li",bv);};s.h1=function(bv){return r.elem("h1",bv);};s.h2=function(bv){return r.elem("h1",bv);};s.h3=function(bv){return r.elem("h1",bv);};s.h4=function(bv){return r.elem("h1",bv);};s.strong=function(bv){return r.elem("strong",bv);};};u.Radio=function(bu,bv,bw,bx,by){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("radio"),$1:bv}),[_9.Element("label",bx,[_9.Radio(by,true,bw),_9.TextNode(bu)])]);};u.Checkbox=function(bu,bv,bw,bx,by){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("checkbox"),$1:bv}),[_9.Element("label",bx,[_9.CheckBox(by,bw),_9.TextNode(bu)])]);};u.TextArea=function(bu,bv,bw,bx,by){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bv}),[_9.Element("label",bx,[_9.TextNode(bu)]),_9.InputArea(new _6.T({$:1,$0:(u.cls())("form-control"),$1:by}),bw)]);};u.InputPassword=function(bu,bv,bw,bx,by){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bv}),[_9.Element("label",bx,[_9.TextNode(bu)]),_9.PasswordBox(new _6.T({$:1,$0:(u.cls())("form-control"),$1:by}),bw)]);};u.Input=function(bu,bv,bw,bx,by){return _9.Element("div",new _6.T({$:1,$0:(u.cls())("form-group"),$1:bv}),[_9.Element("label",bx,[_9.TextNode(bu)]),_9.Input(new _6.T({$:1,$0:(u.cls())("form-control"),$1:by}),bw)]);};u.Container=function(bu){return _9.Element("div",[(u.cls())("container")],bu);};u.Class=function(){v.$cctor();return v.Class;};u.cls=function(){v.$cctor();return v.cls;};v.$cctor=function(){v.$cctor=a.ignore;v.cls=_.Class;v.Class=_.Class;};x=w.Intent=Z.Class({toString:function(){return(((Z.Curried3(function(bu,bv,bw){return bu("Intent("+_2.toSafe(bv)+", "+X.p$2(bw)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=w.Trait=Z.Class({toString:function(){return(((Z.Curried3(function(bu,bv,bw){return bu("Trait("+_2.toSafe(bv)+", "+_2.prettyPrint(bw)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,y);z=w.Entity=Z.Class({toString:function(){return((((Z.Curried(function(bu,bv,bw,bx){return bu("Entity("+_2.toSafe(bv)+", "+_2.toSafe(bw)+", "+X.p$2(bx)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);A=w.Utterance=Z.Class({toString:function(){return((((Z.Curried(function(bu,bv,bw,bx){return bu(X.p(bv)+" "+X.p$3(bw)+" "+X.p$5(bx));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bu;bu=this.$2;return bu!=null?{$:1,$0:_6.sortBy(function(bv){return bv.get_Name();},bu.$0)}:null;},get_Traits:function(){var bu;bu=this.$1;return bu!=null?{$:1,$0:_6.sortBy(function(bv){return bv.get_Name();},bu.$0)}:null;},get_Intent:function(){return this.$0;}},null,A);B=w.Question=Z.Class({toString:function(){return(((Z.Curried3(function(bu,bv,bw){return bu("Name: "+_2.toSafe(bv)+" Text: "+_2.toSafe(bw));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);D.New=function(bu,bv,bw,bx,by){return{body:bu,end:bv,start:bw,suggested:bx,value:by};};C["Intent'"]=function(bu,bv){return!(bv.intent==null)?{$:1,$0:new x({$:0,$0:p.toLower(bv.intent.value),$1:null})}:null;};C["Trait'"]=function(bu){return!(bu.domain==null)?{$:1,$0:new y({$:0,$0:"domain",$1:p.toLower(bu.domain.value),$2:null})}:!(bu.dialogue_act==null)?{$:1,$0:new y({$:0,$0:"dialogue_act",$1:p.toLower(bu.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(bu){return!(bu.contact==null)?{$:1,$0:new z({$:0,$0:"contact",$1:p.toLower(bu.contact.value),$2:null})}:null;};F=E["Utterance'"]=Z.Class({get_TopIntent:function(){return _6.head(_6.sortBy(function(bu){return bu.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,F);G=E["Intent'"]=Z.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=Z.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI;return bu!=null&&bu.$==1&&(bu.$0.$0.$==0&&(bu.$0.$1.get_Length()>0&&(bv=[bu.$0.$1,bu.$0.$2],true)))?(bw=_6.map(function(bJ){return new z({$:0,$0:p.toLower(bJ.get_Role()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bv[0])),{$:1,$0:new A({$:0,$0:null,$1:{$:1,$0:_6.map(function(bJ){return new y({$:0,$0:p.toLower(bJ.get_Name()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bv[1]))},$2:{$:1,$0:bw}})}):bu!=null&&bu.$==1&&(bu.$0.$1.$==0&&(bu.$0.$2.$==0&&(bu.$0.$0.get_Length()>0&&bu.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bx=[bu.$0.$0,bu],true))))?(by=bx[1],{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(by.$0.get_TopIntent().get_Name()),$1:{$:1,$0:by.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bu!=null&&bu.$==1&&(bu.$0.$2.$==0&&(bu.$0.$0.get_Length()>0&&bu.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bz=[bu.$0.$0,bu],true)))?(bA=bz[1],(bB=_6.map(function(bJ){return new z({$:0,$0:p.toLower(bJ.get_Role()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bA.$0.get_Entities())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bB}})})):bu!=null&&bu.$==1&&(bu.$0.$1.$==0&&(bu.$0.$0.get_Length()>0&&bu.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bC=[bu.$0.$0,bu],true)))?(bD=bC[1],(bE=_6.map(function(bJ){return new y({$:0,$0:p.toLower(bJ.get_Name()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bD.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bD.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bD.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bE},$2:null})})):bu!=null&&bu.$==1&&(bu.$0.$0.get_Length()>0&&bu.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bF=[bu.$0.$0,bu],true))?(bG=bF[1],(bH=_6.map(function(bJ){return new z({$:0,$0:p.toLower(bJ.get_Role()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bG.$0.get_Entities())),(bI=_6.map(function(bJ){return new y({$:0,$0:p.toLower(bJ.get_Name()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},_6.filter(function(bJ){return bJ.get_Confidence()>E.entityConfidenceThreshold();},bG.$0.get_Traits())),{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:p.toLower(bG.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bG.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bI},$2:{$:1,$0:bH}})}))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(bu){K.$cctor();K.entityConfidenceThreshold=bu;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(bu){K.$cctor();K.intentConfidenceThreshold=bu;};E.getUtterance=function(bu,bv){E.witapi().getMeaning(bu,function(bw){var bx,by;p.debug("NLU",(function(bz){return function(bA){return bz("Wit.ai returned: "+_2.prettyPrint(bA));};}(a.id))(bw));bx=!(bw.intents==null)?_6.ofArray(_5.map(function(bz){return new G({$:0,$0:bz.name,$1:bz.confidence});},bw.intents)):_6.T.Empty;by=!(bw.traits==null)?_6.ofSeq(_7.concat(_6.map(function(bz){return _5.map(function(bA){return new I({$:0,$0:bz,$1:bA.confidence,$2:bA.value});},ba.GetJS(bw.traits,[bz]));},_6.filter(function(bz){return!(ba.GetJS(bw.traits,[bz])==null);},E.trait_types())))):_6.T.Empty;return bv({$:1,$0:new F({$:0,$0:bx,$1:!(bw.intents==null)?_6.ofSeq(_7.concat(_6.map(function(bz){return _5.map(function(bA){return new H({$:0,$0:bA.name,$1:bA.confidence,$2:bA.role,$3:bA.value});},ba.GetJS(bw.entities,[bz]));},_6.filter(function(bz){return!(ba.GetJS(bw.entities,[bz])==null);},E.entity_types())))):_6.T.Empty,$2:by})});},function(bw,bx,by){p.error((((Z.Curried3(function(bz,bA,bB){return bz("Wit.ai returned: "+_2.prettyPrint(bA)+" "+_2.prettyPrint(bB));}))(a.id))(bx))(by));return bv(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.witapi=function(){K.$cctor();return K.witapi;};E.QuickPrograms=function(bu){return bu==="programs"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};E.QuickNumber=function(bu){var bv,bw,bx;return(bw=E.One(bu),bw!=null&&bw.$==1?(bv=bw.$0,true):(bx=E.Two(bu),bx!=null&&bx.$==1&&(bv=bx.$0,true)))?{$:1,$0:bv}:null;};E.Three=function(bu){var bv;return bu==="3"||bu==="three"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};E.Two=function(bu){var bv;return bu==="2"||bu==="two"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};E.One=function(bu){var bv;return bu==="1"||bu==="one"?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new z({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(bu){var bv;return bu==="no"||(bu==="NO"||(bu==="No"||(bu==="nope"||(bu==="no way"||(bu==="nah"||(bu==="don't do it"||bu==="stop"))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickYes=function(bu){var bv;return bu==="yes"||(bu==="YES"||(bu==="Yes"||(bu==="YEs"||(bu==="ok"||(bu==="sure"||(bu==="yeah"||(bu==="yep"||(bu==="uh huh"||(bu==="go ahead"||bu==="go")))))))))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHelp=function(bu){var bv;return bu==="help"||(bu==="help me"||(bu==="what's this?"||bu==="huh"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHello=function(bu){var bv;return bu==="hello"||(bu==="hey"||(bu==="yo"||bu==="hi"))?{$:1,$0:new A({$:0,$0:{$:1,$0:new x({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.Voices=function(bu){return bu==="voices"?{$:1,$0:null}:null;};E.Debug=function(bu){return bu==="debug"?{$:1,$0:null}:null;};E.Blank=function(bu){return bu===""?{$:1,$0:null}:null;};J.Study=function(bu){return bu.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};w.No=function(bu){var bv,bw,bx,by,bz,bA;return(bw=w.Intent$1("no",bu),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bu,true))))?{$:1,$0:bv}:(by=w.Intent$1("noresponse",bu),by!=null&&by.$==1&&(by.$0[0]==null&&(by.$0[1]==null&&(bx=bu,true))))?{$:1,$0:bx}:(bA=w.Intent$1("NoResponse",bu),bA!=null&&bA.$==1&&(bA.$0[0]==null&&(bA.$0[1]==null&&(bz=bu,true))))?{$:1,$0:bz}:null;};w.Yes=function(bu){var bv,bw,bx,by,bz,bA;return(bw=w.Intent$1("yes",bu),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bu,true))))?{$:1,$0:bv}:(by=w.Intent$1("yesresponse",bu),by!=null&&by.$==1&&(by.$0[0]==null&&(by.$0[1]==null&&(bx=bu,true))))?{$:1,$0:bx}:(bA=w.Intent$1("YesResponse",bu),bA!=null&&bA.$==1&&(bA.$0[0]==null&&(bA.$0[1]==null&&(bz=bu,true))))?{$:1,$0:bz}:null;};w.EntityManyofMany=function(bu,bv){return{$:1,$0:bc.OfArray(_5.ofSeq(_6.map(function(bw){return _6.exists(function(bx){return bx.get_Name()===bw;},bv)?[bw,{$:1,$0:_6.filter(function(bx){return bx.get_Name()===bw;},bv)}]:[bw,null];},bu)))};};w.EntityManyOf1=function(bu,bv){var bw;return bv!=null&&bv.$==1&&(_6.exists(function(bx){return bx.get_Name()===bu;},bv.$0)&&(bw=bv.$0,true))?{$:1,$0:_6.filter(function(bx){return bx.get_Name()===bu;},bw)}:null;};w.Entity1OfAny=function(bu,bv){var bw;return bv!=null&&bv.$==1&&(_6.exists(function(bx){return bx.get_Name()===bu;},bv.$0)&&(bw=bv.$0,true))?{$:1,$0:_6.head(_6.sortBy(function(bx){return bx.get_Name();},_6.filter(function(bx){return bx.get_Name()===bu;},bw)))}:null;};w.Entity1Of1=function(bu,bv){var bw;return bv!=null&&bv.$==1&&(bv.$0.$==1&&(bv.$0.$1.$==0&&(bv.$0.$0.get_Name()===bu&&(bw=bv.$0.$0,true))))?{$:1,$0:bw}:null;};w.Intent$1=function(bu,bv){return bv.get_Intent()!=null&&bv.get_Intent().$0.get_Name()===bu?{$:1,$0:[bv.get_Traits(),bv.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.witapi=new bf.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");K.entity_types=_6.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);K.trait_types=_6.ofArray(["domain","dialogue_act"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=Z.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=Z.Class({SayVoices:function(){var bu,bv,bw;bu=this;bv=a.speechSynthesis.getVoices();!(bv==null)?(bw=p.toArray(bv),bu.Say((function(bx){return function(by){return bx("There are currently "+a.String(by)+" voices installed on this computer or device.");};}(a.id))(_5.length(bw))),_5.iteri(function(bx,by){return bu.Say(((((Z.Curried(function(bz,bA,bB,bC){return bz("Voice "+a.String(bA)+". Name: "+_2.toSafe(bB)+", Local: "+_2.prettyPrint(bC)+".");},4))(a.id))(bx))(by.name))(by.localService));},bw)):void 0;},Wait:function(bu){this.Wait$1(function(){bg.Start(bu,null);});},Wait$1:function(bu){this["Echo'"]("please wait...");this.Term.pause();bu();this.Term.resume();},sayRandom:function(bu,bv){this.Say(L.getRandomPhrase(bu,bv));},SayAngry:function(bu){var bv,bw;bv=this;bg.Start((bw=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bh.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){a.addMessage(bv.Avatar,bu,"","");bv.Avatar.processMessages(0);return bg.Zero();}));})),null);},Say:function(bu){var bv,bw;bv=this;bg.Start((bw=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(bh.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){bv.Avatar.addMessage(bu);bv.Avatar.processMessages(0);return bg.Zero();}));})),null);},Debug:function(bu,bv){p.debug(bu,bv);},"EchoHtml'":function(bu){var bv,bw;bv=(bw={},bw.raw=true,bw);this.Term.disable();this.Term.echo(bu,bv);this.Term.enable();},"Echo'":function(bu){this.Term.disable();this.Term.echo(bu);this.Term.enable();}},null,P);P.New=function(bu,bv,bw,bx,by){return new P({Voice:bu,Mic:bv,Term:bw,Avatar:bx,Caption:by});};L.waitAddPhrases=function(){Q.$cctor();return Q.waitAddPhrases;};L.waitRetrievePhrases=function(){Q.$cctor();return Q.waitRetrievePhrases;};L.helpPhrases=function(){Q.$cctor();return Q.helpPhrases;};L.helloUserPhrases=function(){Q.$cctor();return Q.helloUserPhrases;};L.helloPhrases=function(){Q.$cctor();return Q.helloPhrases;};L["getRandomPhrase'"]=function(bu){return p.replace_tok("$0","",_7.nth(L.rng().Next(0,bu.get_Length()),bu));};L.getRandomPhrase=function(bu,bv){return p.replace_tok("$0",bv,_7.nth(L.rng().Next(0,bu.get_Length()),bu));};L.rng=function(){Q.$cctor();return Q.rng;};Q.$cctor=function(){Q.$cctor=a.ignore;Q.rng=new bi.New();Q.helloPhrases=_6.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);Q.helloUserPhrases=_6.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);Q.helpPhrases=_6.ofArray(["What can I help you with $0?"]);Q.waitRetrievePhrases=_6.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);Q.waitAddPhrases=_6.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};R.update=function(bu,bv,bw,bx,by){var bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq;function cr(cK){bu["EchoHtml'"](cK);}function cs(cK){bu.Say(cK);}function ct(cK){bx.unshift(cK);cs(cK);}function cu(cK,cL){var cM;cM=L.getRandomPhrase(cK,cL);bx.unshift(cM);return bu.Say(cM);}function cv(cK){return bv.ContainsKey(cK);}function cw(cK,cL){return bv.Add(cK,cL);}function cx(cK){bv.Remove(cK);}function cy(){by.shift();}function cz(){bw.shift();}function cA(cK){var cL;cL=R.getQuestion(cK);cL==null?(function(cM){return function(cN){return cM("No such question: "+_2.toSafe(cN));};}(bj.FailWith))(cK):bw.unshift(cL.$0);}function cB(cK,cL){cw(cK,cL);cA(cK);R.debug((function(cM){return function(cN){return cM("Added question: "+X.p$8(cN)+".");};}(a.id))(bw[0]));return ct(p.replace_tok("$0",cL,R.getQuestion(cK).$0.get_Text()));}function cC(cK,cL){return cv(cK)?{$:1,$0:cL}:null;}function cD(cK,cL){return!cv(cK)?{$:1,$0:cL}:null;}function cE(cK){var cL,cM;return(cM=cC("user",cK),cM!=null&&cM.$==1&&(bw.length===0&&(cL=cM.$0,true)))?(cy(),{$:1,$0:cL}):null;}function cF(cK,cL){var cM,cN,cO;return(cN=cC("user",cL),cN!=null&&cN.$==1&&(R.haveQuestion(cK)&&bw.length>0&&bw[0].get_Name()===cK&&(cM=cN.$0,true)))?(cy(),cz(),cv(cK)?(cO=bv.get_Item(cK),(cx(cK),{$:1,$0:[cM,{$:1,$0:cO}]})):{$:1,$0:[cM,null]}):null;}function cG(cK,cL){var cM,cN,cO;return(cN=cD("user",cL),cN!=null&&cN.$==1&&(R.haveQuestion(cK)&&bw.length>0&&bw[0].get_Name()===cK&&(cM=cN.$0,true)))?(cy(),cz(),cv(cK)?(cO=bv.get_Item(cK),(cx(cK),{$:1,$0:[cM,{$:1,$0:cO}]})):{$:1,$0:[cM,null]}):null;}function cH(cK){var cL,cM;return(cM=cD("user",cK),cM!=null&&cM.$==1&&(bw.length===0&&(cL=cM.$0,true)))?(cy(),{$:1,$0:cL}):null;}function cI(cK){var cL;return cK!=null&&cK.$==1&&(typeof cK.$0=="string"&&(cL=cK.$0,true))?{$:1,$0:cL}:null;}function cJ(cK){var cL;cL=null;return bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:-2143638334",[cK]),function(cM){bv.Add("msgs",cM);return cM!=null&&cM.$0.get_Length()>0?(ct((((Z.Curried3(function(cN,cO,cP){return cN("You have "+a.String(cO)+" new message"+_2.toSafe(cP)+".");}))(a.id))(cM.$0.get_Length()))(cM.$0.get_Length()>1?"s":"")),bg.Zero()):bg.Zero();});});}R.debug((((Z.Curried3(function(cK,cL,cM){return cK("Starting utterances:"+_2.prettyPrint(cL)+". Starting questions: "+_2.prettyPrint(cM)+".");}))(a.id))(by))(bw));bz=_6.ofSeq(_7.take(by.length>=5?5:by.length,by));bz.$==1&&(bB=(bC=cD("started",bz.$0),bC!=null&&bC.$==1?{$:1,$0:bC.$0}:null),bB!=null&&bB.$==1&&(bD=cH(bB.$0),bD!=null&&bD.$==1&&(bE=w.Intent$1("hello",bD.$0),bE!=null&&bE.$==1&&(bE.$0[1]==null&&bz.$1.$==0))))?(bv.Add("started",true),cu(L.helloPhrases(),"")):bz.$==1&&(bG=cH(bz.$0),bG!=null&&bG.$==1&&(bH=w.Intent$1("hello",bG.$0),bH!=null&&bH.$==1&&(bH.$0[1]==null&&bz.$1.$==0)))?ct("Hello, tell me your name to get started."):bz.$==1&&(bJ=cH(bz.$0),bJ!=null&&bJ.$==1&&(bK=w.Intent$1("hello",bJ.$0),bK!=null&&bK.$==1&&(bL=w.Entity1Of1("contact",bK.$0[1]),bL!=null&&bL.$==1&&(bz.$1.$==0&&(bI=bL.$0,true)))))?(bM=bI.get_Value(),cu(L.waitRetrievePhrases(),"user name"),bg.Start((bN=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-1770432647",[bM]),function(cK){var cL;return cK==null?(ct((function(cM){return function(cN){return cM("I did not find a user with the name "+_2.toSafe(cN)+".");};}(a.id))(bM)),cB("addUser",bM),bg.Zero()):(cL=cK.$0,(cu(L.helloUserPhrases(),(function(cM){return function(cN){return cM(_2.prettyPrint(cN));};}(a.id))(cL.Name)),bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:1069356353",[cL.Name]),function(){bv.Add("user",cL);return bg.Combine(cL.LastLoggedIn!=null?bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:474564834",[cL.LastLoggedIn.$0]),function(cM){ct((function(cN){return function(cO){return cN("You last logged in "+_2.toSafe(cO)+".");};}(a.id))(cM));return bg.Zero();}):bg.Zero(),bg.Delay(function(){return bg.Bind(cJ(cL.Name),function(){return bg.Return(null);});}));})));});})),null)):bz.$==1&&(bP=w.Yes(bz.$0),bP!=null&&bP.$==1&&(bQ=cG("addUser",bP.$0),bQ!=null&&bQ.$==1&&(bR=cI(bQ.$0[1]),bR!=null&&bR.$==1&&(bz.$1.$==0&&(bO=bR.$0,true)))))?bg.Start((bS=null,bg.Delay(function(){cu(L.waitAddPhrases(),"user");return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:1069356353",[bO]),function(cK){return cK==null?(ct((function(cL){return function(cM){return cL("Sorry I was not able to add the user "+_2.toSafe(cM)+" to the system.");};}(a.id))(bO)),bg.Zero()):bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-1770432647",[bO]),function(cL){cw("user",cL);ct((function(cM){return function(cN){return cM("Hello "+_2.prettyPrint(cN)+", nice to meet you.");};}(a.id))(bO));return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.addMessage:-1924313785",[bO,"Welcome to Lerna."]),function(){return bg.Bind(cJ(bO),function(){return bg.Return(null);});});});});})),null):bz.$==1&&(bU=w.No(bz.$0),bU!=null&&bU.$==1&&(bV=cG("addUser",bU.$0),bV!=null&&bV.$==1&&(bW=cI(bV.$0[1]),bW!=null&&bW.$==1&&(bz.$1.$==0&&(bT=bW.$0,true)))))?ct((function(cK){return function(cL){return cK("Ok I did not add the user "+_2.toSafe(cL)+". But you must login for me to help you.");};}(a.id))(bT)):bz.$==1&&((bY=cH(bz.$0),bY!=null&&bY.$==1)&&bz.$1.$==0)?ct("Could you introduce yourself so we can get started?"):bz.$==1&&(b0=cE(bz.$0),b0!=null&&b0.$==1&&(b1=w.Intent$1("hello",b0.$0),b1!=null&&b1.$==1&&(b1.$0[0]==null&&(b2=w.Entity1Of1("contact",b1.$0[1]),b2!=null&&b2.$==1&&(bz.$1.$==0&&(bZ=b2.$0,true))))))?bg.Start((b3=null,bg.Delay(function(){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:-1770432647",[bZ.get_Value()]),function(cK){return cK==null?(ct((function(cL){return function(cM){return cL("Sorry, the user "+_2.toSafe(cM)+" does not exist.");};}(a.id))(bZ.get_Value())),bg.Zero()):(cB("switchUser",cK.$0.Name),bg.Zero());});})),null):bz.$==1&&(b5=w.Yes(bz.$0),b5!=null&&b5.$==1&&(b6=cF("switchUser",b5.$0),b6!=null&&b6.$==1&&(b7=cI(b6.$0[1]),b7!=null&&b7.$==1&&(bz.$1.$==0&&(b4=b7.$0,true)))))?(bv.set_Item("user",b4),ct((function(cK){return function(cL){return cK("Ok I switched to user "+_2.prettyPrint(cL)+".");};}(a.id))(b4))):bz.$==1&&(b9=w.No(bz.$0),b9!=null&&b9.$==1&&(b_=cF("switchUser",b9.$0),b_!=null&&b_.$==1&&(b$=cI(b_.$0[1]),b$!=null&&b$.$==1&&(bz.$1.$==0&&(b8=b$.$0,true)))))?ct((function(cK){return function(cL){return cK("Ok I did not switch to user "+_2.toSafe(cL)+".");};}(a.id))(b8)):bz.$==1&&(cb=cE(bz.$0),cb!=null&&cb.$==1&&((cc=w.Intent$1("studyjournal",cb.$0),cc!=null&&cc.$==1)&&bz.$1.$==0))?(cr("<img src=\"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.YSxy_C2rlS83dQdUOq9MqwHaFB%26pid%3DApi&f=1\"/>"),ct("Good job! You are right on track with the rest of students in your cohort. Keep it up.")):bz.$==1&&(ce=cE(bz.$0),ce!=null&&ce.$==1&&((cf=w.Intent$1("nextclass",ce.$0),cf!=null&&cf.$==1)&&bz.$1.$==0))?(cr("<iframe src=\"https://calendar.google.com/calendar/embed?src=cocnrm4290919hobq1f5he7leg%40group.calendar.google.com&ctz=America%2FPort_of_Spain\" style=\"border: 0\" width=\"800\" height=\"600\" frameborder=\"0\" scrolling=\"no\"></iframe>"),ct("Your next chemistry class is on Monday at 8:30AM.")):bz.$==1&&(ch=cE(bz.$0),ch!=null&&ch.$==1&&(ci=w.Intent$1("reference",ch.$0),ci!=null&&ci.$==1&&(cj=w.Entity1Of1("term",ci.$0[1]),cj!=null&&cj.$==1&&(bz.$1.$==0&&(cg=cj.$0,true)))))?bg.Start((ck=null,bg.Delay(function(){return bg.Bind(bm.getAnswer(cg.get_Value()),function(cK){var cL;cL=_5.get(cK.answers,0).answer;return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtohtml:-497996132",[cL]),function(cM){return bg.Bind((new bl.New()).Async("Lerna.Web:Lerna.Web.Server.mdtotext:-497996132",[cL]),function(cN){cr(cM);ct(cN);return bg.Zero();});});});})),null):bz.$==1&&(cm=cE(bz.$0),cm!=null&&cm.$==1&&(cn=w.Intent$1("quiz",cm.$0),cn!=null&&cn.$==1&&(co=w.Entity1Of1("term",cn.$0[1]),co!=null&&co.$==1&&(bz.$1.$==0&&(cl=co.$0,true)))))?bg.Start((cp=null,bg.Delay(function(){cr("What is the most accurate definition of an element?<br>1. A bond between molecules<br>2. A substance that cannot be broken down into simpler components.<br>3. A combination of atoms.<br> 4. A part of water.");ct("What is the most accurate definition of an element? 1. A bond between molecules. 2. A substance that cannot be broken down into simpler components. 3. A combination of atoms 4. A part of water.");return bg.Zero();})),null):(cy(),R.debug("Main interpreter did not understand utterance."),ct("Sorry I didn't understand what you meant."),bw.length>0?(cq=_7.nth(0,bw),cv(cq.get_Name())?ct(p.replace_tok("$0",bv.get_Item(cq.get_Name()),cq.get_Text())):ct(cq.get_Text())):void 0);R.debug((((Z.Curried3(function(cK,cL,cM){return cK("Ending utterances: "+_2.prettyPrint(cL)+". Ending questions:"+_2.prettyPrint(cM)+".");}))(a.id))(by))(bw));};R.haveQuestion=function(bu){return _6.exists(function(bv){return bv.get_Name()===bu;},R.questions());};R.getQuestion=function(bu){return _7.tryFind(function(bv){return bv.get_Name()===bu;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(bu){p.debug("Main",bu);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_6.ofArray([new B({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new B({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"})]);};T.update=function(bu,bv,bw,bx,by){T.debug((((Z.Curried3(function(bz,bA,bB){return bz("Starting utterances:"+_2.prettyPrint(bA)+". Starting questions: "+_2.prettyPrint(bB)+".");}))(a.id))(by))(bw));};T.haveQuestion=function(bu){return _6.exists(function(bv){return bv.get_Name()===bu;},T.questions());};T.getQuestion=function(bu){return _7.tryFind(function(bv){return bv.get_Name()===bu;},T.questions());};T.questions=function(){U.$cctor();return U.questions;};T.debug=function(bu){p.debug("Study",bu);};U.$cctor=function(){U.$cctor=a.ignore;U.questions=_6.ofArray([new B({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new B({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new B({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};V.run=function(){var bu,bv,bw;bu=Z.ThisFunc(function(bx,by){return((V.Main().get_Text())(bx))(by);});bv=V.Main().get_Options();a.$("#main").terminal(bu,bv);bw=_9.Element("button",[bn.Create("type","button"),bn.Create("class","btn btn-primary"),bn.Create("id","bar"),bn.Create("text","hello")],[]);bp.LoadLocalTemplates("");_9.RunById("left",bw);return _9.get_Empty();};V.Main=function(){W.$cctor();return W.Main;};V.initMic=function(bu,bv){var bw,bx;bu[0]=(bw=bu[0],P.New(bw.Voice,{$:1,$0:new bq.Microphone(br.getElementById("microphone"))},bw.Term,bw.Avatar,bw.Caption));bx=bu[0].Mic.$0;bx.onconnecting=function(){V.set_MicState(M.MicConnecting);return V.debug("Mic connecting...");};bx.ondisconnected=function(){V.set_MicState(M.MicDisconnected);return V.debug("Mic disconnected.");};bx.onaudiostart=function(){V.set_MicState(M.MicAudioStart);return V.debug("Mic audio start...");};bx.onaudioend=function(){V.set_MicState(M.MicAudioEnd);return V.debug("Mic audio end.");};bx.onerror=function(by){V.set_MicState({$:6,$0:by});return V.debug((function(bz){return function(bA){return bz("Mic error : "+_2.toSafe(bA)+".");};}(a.id))(by));};bx.onready=function(){V.set_MicState(M.MicReady);return V.debug("Mic ready.");};bx.onresult=function(by,bz){return V.ClientState().$==2?V.echo("I'm still trying to understand what you said before."):V.ClientState().$==0?p.error("Client is not intialized."):!(by==null||bz==null)?(V.set_MicState({$:7,$0:by,$1:bz}),V.debug((((Z.Curried3(function(bA,bB,bC){return bA("Mic result: "+_2.prettyPrint(bB)+" "+_2.prettyPrint(bC)+".");}))(a.id))(by))(bz)),bv(bu,bx,[by,bz])):V.debug("Mic: No result returned.");};bx.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};V.sayRandom=function(bu,bv){V.say(L.getRandomPhrase(bv,bu));};V.sayVoices=function(){var bu;bu=p.toArray(p.speechSynthesis().getVoices());V["say'"]((function(bv){return function(bw){return bv("There are currently "+a.String(bw)+" voices installed on this computer or device.");};}(a.id))(_5.length(bu)));_5.iteri(function(bv,bw){return V["say'"](((((Z.Curried(function(bx,by,bz,bA){return bx("Voice "+a.String(by)+". Name: "+_2.toSafe(bz)+", Local: "+_2.prettyPrint(bA)+".");},4))(a.id))(bv))(bw.name))(bw.localService));},bu);};V.say=function(bu){V.Responses().unshift(bu);V["say'"](bu);};V["say'"]=function(bu){V.CUI().Say(bu);};V.initSpeech=function(bu){var bv,bw,bx,by;bv=p.toArray(V.synth().getVoices());_5.length(bv)>0?(bw=_5.find(function(bz){return bz["default"];},bv),bu[0]=(bx=bu[0],P.New({$:1,$0:bw},bx.Mic,bx.Term,bx.Avatar,bx.Caption)),by=bu[0],V.debug((function(bz){return function(bA){return bz("Using browser speech synthesis voice "+_2.toSafe(bA)+".");};}(a.id))(by.Voice.$0.name)),by.Avatar.nativeVoice=true,by.Avatar.nativeVoiceName=bw.name):V.echo("No browser speech synthesis voice is available. Falling back to CMU TTS.");};V.synth=function(){W.$cctor();return W.synth;};V.push=function(bu){V.Utterances().unshift(bu);return V.Utterances();};V.Props=function(){W.$cctor();return W.Props;};V.Responses=function(){W.$cctor();return W.Responses;};V.Questions=function(){W.$cctor();return W.Questions;};V.Utterances=function(){W.$cctor();return W.Utterances;};V.wait=function(bu){p["Terminal.Echo'"](V.CUI().Term,"please wait");V.CUI().Term.pause();bu();V.CUI().Term.resume();};V.debug=function(bu){p.debug("CLIENT",bu);};V.echo=function(bu){if(!(V.CUI().Term==null))p["Terminal.EchoHtml'"](V.CUI().Term,(function(bv){return function(bw){return bv(_2.prettyPrint(bw));};}(a.id))(bu));};V.ClientState=function(){W.$cctor();return W.ClientState;};V.set_ClientState=function(bu){W.$cctor();W.ClientState=bu;};V.MicState=function(){W.$cctor();return W.MicState;};V.set_MicState=function(bu){W.$cctor();W.MicState=bu;};V.CUI=function(){W.$cctor();return W.CUI;};V.set_CUI=function(bu){W.$cctor();W.CUI=bu;};W.$cctor=function(){var bu,bv,bw,bx,by,bz;W.$cctor=a.ignore;function bA(bC,bD,bE){var bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;bF=bE[0];bG=bE[1];V.debug((((Z.Curried3(function(bP,bQ,bR){return bP("Voice: "+_2.prettyPrint(bQ)+" "+_2.prettyPrint(bR));}))(a.id))(bF))(bG));bH=(bI=C["Intent'"](bF,bG),bI!=null&&bI.$==1?{$:1,$0:bI.$0}:null);bJ=(bK=C["Trait'"](bG),bK!=null&&bK.$==1?{$:1,$0:_6.ofArray([bK.$0])}:null);bL=(bM=C["Entity'$1"](bG),bM!=null&&bM.$==1?{$:1,$0:_6.ofArray([bM.$0])}:null);return bH==null&&(bJ==null&&bL==null)?null:(V.debug(((((Z.Curried(function(bP,bQ,bR,bS){return bP("Voice: "+X.p(bQ)+" "+X.p$3(bR)+" "+X.p$5(bS));},4))(a.id))(bH))(bJ))(bL)),bO=V.push(new A({$:0,$0:bH,$1:bJ,$2:bL})),R.update(bC[0],V.Props(),V.Questions(),V.Responses(),bO));}function bB(bC,bD,bE){var bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;bC[0]=P.New(V.CUI().Voice,V.CUI().Mic,bD,V.CUI().Avatar,V.CUI().Caption);bs.Equals(bC[0].Mic,null)?V.initMic(bC,bA):void 0;bs.Equals(bC[0].Voice,null)?V.initSpeech(bC):void 0;bF=bC[0];V.ClientState().$===0?V.set_ClientState(N.ClientReady):void 0;return(bG=E.Blank(bE),bG!=null&&bG.$==1)?V["say'"]("Tell me what you want me to do or ask me a question."):(bH=E.Debug(bE),bH!=null&&bH.$==1)?(V.debug((function(bQ){return function(bR){return bQ("Utterances: "+_2.prettyPrint(bR));};}(a.id))(V.Utterances())),V.debug((function(bQ){return function(bR){return bQ("Questions: "+_2.prettyPrint(bR));};}(a.id))(V.Questions()))):(bI=E.Voices(bE),bI!=null&&bI.$==1)?V.sayVoices():V.ClientState().$==1?(bK=E.QuickHello(bE),bK!=null&&bK.$==1?(bJ=bK.$0,true):(bL=E.QuickHelp(bE),bL!=null&&bL.$==1?(bJ=bL.$0,true):(bM=E.QuickYes(bE),bM!=null&&bM.$==1?(bJ=bM.$0,true):(bN=E.QuickNo(bE),bN!=null&&bN.$==1&&(bJ=bN.$0,true)))))?(V.debug((function(bQ){return function(bR){return bQ("Quick Text: "+X.p$7(bR)+".");};}(a.id))(bJ)),bO=V.push(bJ),R.update(bF,V.Props(),V.Questions(),V.Responses(),bO),V.set_ClientState(N.ClientReady)):bF.Wait((bP=null,bg.Delay(function(){V.set_ClientState(N.ClientUnderstand);E.getUtterance(bE,function(bQ){var bR,bS,bT;bR=E.HasUtterance(bQ);bR!=null&&bR.$==1?(bS=bR.$0,V.debug(((((Z.Curried(function(bU,bV,bW,bX){return bU("Text: Intent: "+X.p(bV)+", Traits: "+X.p$3(bW)+", Entities: "+X.p$5(bX));},4))(a.id))(bS.get_Intent()))(bS.get_Traits()))(bS.get_Entities())),bT=V.push(bS),R.update(bF,V.Props(),V.Questions(),V.Responses(),bT)):(V.debug("Text: Did not receive a meaning from the server."),V["say'"]("Sorry I did not understand what you said."));});V.set_ClientState(N.ClientReady);return bg.Zero();}))):V.ClientState().$==0?p.error("Client is not initialized."):V["say'"]("I'm still trying to understand what you said before.");}W.CUI=P.New(null,null,null,(bh.applicationId="4277115329081938617",bu=new a.SDKConnection(),bv=new a.WebAvatar(),bv.version=8.5,bv.connection=bu,bv.avatar="22225225",bv.voice="cmu-slt",bv.voiceMod="default",bv.nativeVoice=true,bv.nativeVoiceName="Microsoft David Desktop - English (United States)",bv.width=300,bv.createBox(),bv.addMessage(""),bv.processMessages(0),bv),false);W.MicState=M.MicNotInitialized;W.ClientState=N.ClientNotInitialzed;W.Utterances=[];W.Questions=[];W.Responses=[];W.Props=new bt.New$5();W.synth=a.speechSynthesis;W.Main=(bw=(bx={},bx.name="Main",bx.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bx.prompt=">",bx),new O({$:0,$0:(by=[V.CUI()],(Z.Curried3(bA))(by)),$1:[(bz=[V.CUI()],(Z.Curried3(bB))(bz)),bw]}));};X.p$8=function(bu){return"Question ("+_2.prettyPrint(bu.$0)+", "+_2.prettyPrint(bu.$1)+")";};X.p$9=function(bu){return bu==null?"null":"Some "+_2.prettyPrint(bu.$0);};X.p$2=function(bu){return bu==null?"null":"Some "+_2.prettyPrint(bu.$0);};X.p$1=function(bu){return"Intent ("+_2.prettyPrint(bu.$0)+", "+X.p$2(bu.$1)+")";};X.p=function(bu){return bu==null?"null":"Some "+X.p$1(bu.$0);};X.p$4=function(bu){return"Trait ("+_2.prettyPrint(bu.$0)+", "+_2.prettyPrint(bu.$1)+", "+X.p$2(bu.$2)+")";};X.p$3=function(bu){return bu==null?"null":"Some "+_2.printList(function(bv){return X.p$4(bv);},bu.$0);};X.p$6=function(bu){return"Entity ("+_2.prettyPrint(bu.$0)+", "+_2.prettyPrint(bu.$1)+", "+X.p$2(bu.$2)+")";};X.p$5=function(bu){return bu==null?"null":"Some "+_2.printList(function(bv){return X.p$6(bv);},bu.$0);};X.p$7=function(bu){return"Utterance ("+X.p(bu.$0)+", "+X.p$3(bu.$1)+", "+X.p$5(bu.$2)+")";};}());
