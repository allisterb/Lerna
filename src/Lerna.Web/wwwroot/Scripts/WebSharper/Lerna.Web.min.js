(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.StudyJournalEntry=c.StudyJournalEntry||{};j=c.Message=c.Message||{};k=c.Wit=c.Wit||{};l=k.NLUResponse=k.NLUResponse||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=b.Web=b.Web||{};p=o.ClientExtensions=o.ClientExtensions||{};q=o._Html=o._Html||{};r=o.htmModule=o.htmModule||{};s=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};t=o.Bs=o.Bs||{};u=o.NLU=o.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.Question=u.Question||{};A=u.Voice=u.Voice||{};B=A["Entity'"]=A["Entity'"]||{};C=u.Text=u.Text||{};D=C["Utterance'"]=C["Utterance'"]||{};E=C["Intent'"]=C["Intent'"]||{};F=C["Entity'"]=C["Entity'"]||{};G=C["Trait'"]=C["Trait'"]||{};H=u.Domain=u.Domain||{};I=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};J=o.NLG=o.NLG||{};K=a.StartupCode$Lerna_Web$NLG=a.StartupCode$Lerna_Web$NLG||{};L=o.CUI=o.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=o.Dialogue=o.Dialogue||{};R=Q.Dialogue=Q.Dialogue||{};S=o.ITSTutorial=o.ITSTutorial||{};T=a.StartupCode$Lerna_Web$ITSTutorial=a.StartupCode$Lerna_Web$ITSTutorial||{};U=o.Main=o.Main||{};V=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};W=o.Study=o.Study||{};X=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};Y=o.Client=o.Client||{};Z=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};_0=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};_1=a.IntelliFactory;_2=_1&&_1.Runtime;_3=a.WebSharper;_4=_3&&_3.UI;_5=_4&&_4.Client;_6=_5&&_5.Templates;_7=_4&&_4.Doc;_8=_4&&_4.AttrProxy;_9=_3&&_3.Arrays;_=_3&&_3.Utils;$=a.console;ba=a.jQuery;bb=_3&&_3.Strings;bc=_3&&_3.List;bd=_3&&_3.Seq;be=_4&&_4.AttrModule;bf=_3&&_3.JavaScript;bg=bf&&bf.Pervasives;bh=_3&&_3.Collections;bi=bh&&bh.Map;bj=b&&b.NLU;bk=bj&&bj.Wit;bl=bk&&bk.WitApi;bm=_3&&_3.Random;bn=_3&&_3.Concurrency;bo=a.SDK;bp=_3&&_3.Operators;bq=_3&&_3.Remoting;br=bq&&bq.AjaxRemotingProvider;bs=bj&&bj.QnAMaker;bt=a.Wit;bu=a.document;bv=_3&&_3.Unchecked;bw=bh&&bh.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(bx,by){return{Street:bx,Town:by};};f.New=function(bx,by,bz){return{Full:bx,First:by,Last:bz};};g=c.User=_2.Class({toString:function(){return this.Name;}},null,g);g.New=function(bx,by){return new g({Name:bx,LastLoggedIn:by});};h.New=function(bx,by,bz,bA,bB){return{Id:bx,Sex:by,Name:bz,BirthDate:bA,Address:bB};};i.New=function(bx,by,bz,bA){return{UserName:bx,Date:by,Subject:bz,Duration:bA};};j.New=function(bx,by,bz,bA){return{UserName:bx,Date:by,Text:bz,IsRead:bA};};l.New=function(bx,by,bz,bA,bB,bC){return{type:bx,msg:by,action:bz,traits:bA,entities:bB,confidence:bC};};m.New=function(bx,by,bz){return{id:bx,value:by,confidence:bz};};n.New=function(bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH){return{id:bx,name:by,role:bz,start:bA,end:bB,body:bC,confidence:bD,entities:bE,suggested:bF,value:bG,type:bH};};p.speechSynthesis=function(){return a.speechSynthesis;};p.elementHTML=function(bx){return bx.innerHTML;};p.createElement=function(bx){var by;by=self.document.createElement("div");_6.LoadLocalTemplates("");_7.RunAppend(by,bx);};p.container=function(bx){return _7.Element("div",[p.cls("container")],bx);};p.dindex=function(bx){return _8.Create("data-index",a.String(bx));};p.cls=function(bx){return _8.Create("class",bx);};p.eid=function(bx){return _8.Create("id",bx);};p.termOutput=function(){return _9.get(a.jQuery(".terminal-output").get(),0);};p.toLower=function(bx){return bx.toLowerCase();};p.debug=function(bx,by){p.info((((_2.Curried3(function(bz,bA,bB){return bz("DEBUG: "+_.toSafe(bA)+": "+_.prettyPrint(bB));}))(a.id))(bx.toUpperCase()))(by));};p.error=function(bx){$.error(bx);};p.info=function(bx){$.info(bx);};p.jserror=function(bx){ba.error(bx);};p.toArray=function(bx){return _9.map(a.id,ba.makeArray(bx));};p["Terminal.EchoHtml'"]=function(bx,by){bx.pause();bx.echo(by,p.rawOpt());bx.resume();};p["Terminal.Echo'"]=function(bx,by){bx.pause();bx.echo(by);bx.resume();};p.rawOpt=function(){s.$cctor();return s.rawOpt;};q=o._Html=_2.Class({toString:function(){return q.toString(this);}},null,q);q.toString=function(bx){function by(bz){return function(bA){var bB,bC,bD,bE,bF,bG,bH;bC=bb.replicate(bz," ");switch(bA.$==0?bA.$1.$==1?bA.$1.$0.$==2?bA.$1.$1.$==0?(bB=[bA.$1.$0.$0,bA.$0],1):(bB=[bA.$1,bA.$0],2):(bB=[bA.$1,bA.$0],2):(bB=[bA.$1,bA.$0],2):bA.$==2?(bB=bA.$0,3):(bB=[bA.$0,bA.$1],0)){case 0:return bB[0]+"=\""+bB[1]+"\"";case 1:bD=bB[1];return bC+"<"+bD+">"+bB[0]+"</"+bD+">\r\n";case 2:bE=bB[1];bF=bc.partition(function(bI){return bI.$==1;},bB[0]);bG=bF[1];bH=bF[0];return bG.$==0?bC+"<"+bE+(bH.$===0?"":" "+bb.concat(" ",bc.ofSeq(bd.delay(function(){return bd.map(function(bI){return(by(0))(bI);},bH);}))))+"/>\r\n":bC+"<"+bE+(bH.$===0?"":" "+bb.concat(" ",bc.ofSeq(bd.delay(function(){return bd.map(function(bI){return(by(0))(bI);},bH);}))))+">\r\n"+bb.concat("",bc.ofSeq(bd.delay(function(){return bd.map(function(bI){return(by(bz+1))(bI);},bG);})))+bC+"</"+bE+">\r\n";case 3:return bC+bB+"\r\n";}};}return(by(0))(bx);};r.alt=function(bx){return new q({$:1,$0:"alt",$1:bx});};r.src=function(bx){return new q({$:1,$0:"src",$1:bx});};r.cls=function(bx){return new q({$:1,$0:"class",$1:bx});};r.str=function(bx){return q.toString(bx);};r.op_PercentEquals=function(bx,by){return new q({$:1,$0:bx,$1:by});};r.op_Splice=function(bx){var by;return bc.ofArray([new q({$:2,$0:(by=bx,a.String(by))})]);};r.strong=function(){s.$cctor();return s.strong;};r.h4=function(){s.$cctor();return s.h4;};r.h3=function(){s.$cctor();return s.h3;};r.h2=function(){s.$cctor();return s.h2;};r.h1=function(){s.$cctor();return s.h1;};r.li=function(){s.$cctor();return s.li;};r.ul=function(){s.$cctor();return s.ul;};r.th=function(){s.$cctor();return s.th;};r.td=function(){s.$cctor();return s.td;};r.tr=function(){s.$cctor();return s.tr;};r.a=function(){s.$cctor();return s.a;};r.p=function(){s.$cctor();return s.p;};r.area=function(){s.$cctor();return s.area;};r.map=function(){s.$cctor();return s.map;};r.img=function(){s.$cctor();return s.img;};r.tfoot=function(){s.$cctor();return s.tfoot;};r.tbody=function(){s.$cctor();return s.tbody;};r.thead=function(){s.$cctor();return s.thead;};r.table=function(){s.$cctor();return s.table;};r.span=function(){s.$cctor();return s.span;};r.section=function(){s.$cctor();return s.section;};r.br=function(){s.$cctor();return s.br;};r.div=function(){s.$cctor();return s.div;};r.body=function(){s.$cctor();return s.body;};r.style=function(){s.$cctor();return s.style;};r.title=function(){s.$cctor();return s.title;};r.head=function(){s.$cctor();return s.head;};r.html=function(){s.$cctor();return s.html;};r.elem=function(bx,by){return new q({$:0,$0:bx,$1:by});};s.$cctor=function(){var bx;s.$cctor=a.ignore;s.rawOpt=(bx={},bx.raw=true,bx);s.html=function(by){return r.elem("html",by);};s.head=function(by){return r.elem("head",by);};s.title=function(by){return r.elem("title",by);};s.style=function(by){return r.elem("style",by);};s.body=function(by){return r.elem("body",by);};s.div=function(by){return r.elem("div",by);};s.br=function(by){return r.elem("br",by);};s.section=function(by){return r.elem("section",by);};s.span=function(by){return r.elem("span",by);};s.table=function(by){return r.elem("table",by);};s.thead=function(by){return r.elem("thead",by);};s.tbody=function(by){return r.elem("tbody",by);};s.tfoot=function(by){return r.elem("tfoot",by);};s.img=function(by){return r.elem("img",by);};s.map=function(by){return r.elem("map",by);};s.area=function(by){return r.elem("area",by);};s.p=function(by){return r.elem("p",by);};s.a=function(by){return r.elem("a",by);};s.tr=function(by){return r.elem("tr",by);};s.td=function(by){return r.elem("td",by);};s.th=function(by){return r.elem("th",by);};s.ul=function(by){return r.elem("ul",by);};s.li=function(by){return r.elem("li",by);};s.h1=function(by){return r.elem("h1",by);};s.h2=function(by){return r.elem("h1",by);};s.h3=function(by){return r.elem("h1",by);};s.h4=function(by){return r.elem("h1",by);};s.strong=function(by){return r.elem("strong",by);};};t.Radio=function(bx,by,bz,bA,bB){return _7.Element("div",new bc.T({$:1,$0:p.cls("radio"),$1:by}),[_7.Element("label",bA,[_7.Radio(bB,true,bz),_7.TextNode(bx)])]);};t.checkbox=function(bx,by,bz,bA,bB){return _7.Element("div",new bc.T({$:1,$0:p.cls("checkbox"),$1:by}),[_7.Element("label",bA,[_7.CheckBox(bB,bz),_7.TextNode(bx)])]);};t.textArea=function(bx,by,bz,bA,bB){return _7.Element("div",new bc.T({$:1,$0:p.cls("form-group"),$1:by}),[_7.Element("label",bA,[_7.TextNode(bx)]),_7.InputArea(new bc.T({$:1,$0:p.cls("form-control"),$1:bB}),bz)]);};t.inputPassword=function(bx,by,bz,bA,bB){return _7.Element("div",new bc.T({$:1,$0:p.cls("form-group"),$1:by}),[_7.Element("label",bA,[_7.TextNode(bx)]),_7.PasswordBox(new bc.T({$:1,$0:p.cls("form-control"),$1:bB}),bz)]);};t.input=function(bx,by,bz,bA,bB){return _7.Element("div",new bc.T({$:1,$0:p.cls("form-group"),$1:by}),[_7.Element("label",bA,[_7.TextNode(bx)]),_7.Input([p.cls("form-control"),bB],bz)]);};t.btnSecondary=function(bx,by,bz){return _7.Element("button",[p.eid(bx),p.cls("btn btn-secondary"),be.Handler("click",bz)],[_7.TextNode(by)]);};t.btnPrimary=function(bx,by,bz){return _7.Element("button",[p.eid(bx),p.cls("btn btn-primary"),be.Handler("click",bz)],[_7.TextNode(by)]);};v=u.Intent=_2.Class({toString:function(){return(((_2.Curried3(function(bx,by,bz){return bx("Intent("+_.toSafe(by)+", "+_0.p$2(bz)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=_2.Class({toString:function(){return(((_2.Curried3(function(bx,by,bz){return bx("Trait("+_.toSafe(by)+", "+_.prettyPrint(bz)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=_2.Class({toString:function(){return(((((_2.Curried(function(bx,by,bz,bA,bB){return bx("Entity("+_.toSafe(by)+", "+_.toSafe(bz)+", "+_.toSafe(bA)+", "+_0.p$2(bB)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=_2.Class({toString:function(){return((((_2.Curried(function(bx,by,bz,bA){return bx(_0.p(by)+" "+_0.p$3(bz)+" "+_0.p$5(bA));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bx;bx=this.$2;return bx!=null?{$:1,$0:bc.sortBy(function(by){return by.get_Role();},bx.$0)}:null;},get_Traits:function(){var bx;bx=this.$1;return bx!=null?{$:1,$0:bc.sortBy(function(by){return by.get_Name();},bx.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.Question=_2.Class({toString:function(){return(((_2.Curried3(function(bx,by,bz){return bx("Name: "+_.toSafe(by)+" Text: "+_.toSafe(bz));}))(a.id))(this.get_Name()))(this.get_Text());},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);B.New=function(bx,by,bz,bA,bB){return{body:bx,end:by,start:bz,suggested:bA,value:bB};};A["Intent'"]=function(bx,by){return!(by.intent==null)?{$:1,$0:new v({$:0,$0:p.toLower(by.intent.value),$1:null})}:null;};A["Trait'"]=function(bx){return!(bx.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:p.toLower(bx.domain.value),$2:null})}:!(bx.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:p.toLower(bx.dialogue_act.value),$2:null})}:null;};A["Entity'$1"]=function(bx){return!(bx.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:"",$2:p.toLower(bx.contact.value),$3:null})}:null;};D=C["Utterance'"]=_2.Class({get_TopIntent:function(){return bc.head(bc.sortBy(function(bx){return bx.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,D);E=C["Intent'"]=_2.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=C["Entity'"]=_2.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,F);G=C["Trait'"]=_2.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,G);C.HasUtterance=function(bx){var by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL;return bx!=null&&bx.$==1&&(bx.$0.$0.$==0&&(bx.$0.$1.get_Length()>0&&(by=[bx.$0.$1,bx.$0.$2],true)))?(bz=bc.map(function(bM){return new x({$:0,$0:bM.get_Name(),$1:p.toLower(bM.get_Role()),$2:bM.get_Value(),$3:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},by[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:bc.map(function(bM){return new w({$:0,$0:p.toLower(bM.get_Name()),$1:bM.get_Value(),$2:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},by[1]))},$2:{$:1,$0:bz}})}):bx!=null&&bx.$==1&&(bx.$0.$1.$==0&&(bx.$0.$2.$==0&&(bx.$0.$0.get_Length()>0&&bx.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bA=[bx.$0.$0,bx],true))))?(bB=bA[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bB.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bB.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bx!=null&&bx.$==1&&(bx.$0.$2.$==0&&(bx.$0.$0.get_Length()>0&&bx.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bC=[bx.$0.$0,bx],true)))?(bD=bC[1],(bE=bc.map(function(bM){return new x({$:0,$0:bM.get_Name(),$1:p.toLower(bM.get_Role()),$2:bM.get_Value(),$3:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},bD.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bD.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bD.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bE}})})):bx!=null&&bx.$==1&&(bx.$0.$1.$==0&&(bx.$0.$0.get_Length()>0&&bx.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bF=[bx.$0.$0,bx],true)))?(bG=bF[1],(bH=bc.map(function(bM){return new w({$:0,$0:p.toLower(bM.get_Name()),$1:bM.get_Value(),$2:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},bG.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bG.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bG.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bH},$2:null})})):bx!=null&&bx.$==1&&(bx.$0.$0.get_Length()>0&&bx.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bI=[bx.$0.$0,bx],true))?(bJ=bI[1],(bK=bc.map(function(bM){return new x({$:0,$0:bM.get_Name(),$1:p.toLower(bM.get_Role()),$2:bM.get_Value(),$3:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},bJ.$0.get_Entities())),(bL=bc.map(function(bM){return new w({$:0,$0:p.toLower(bM.get_Name()),$1:bM.get_Value(),$2:{$:1,$0:bM.get_Confidence()}});},bc.filter(function(bM){return bM.get_Confidence()>C.entityConfidenceThreshold();},bJ.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:p.toLower(bJ.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bJ.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bL},$2:{$:1,$0:bK}})}))):null;};C.entityConfidenceThreshold=function(){I.$cctor();return I.entityConfidenceThreshold;};C.set_entityConfidenceThreshold=function(bx){I.$cctor();I.entityConfidenceThreshold=bx;};C.intentConfidenceThreshold=function(){I.$cctor();return I.intentConfidenceThreshold;};C.set_intentConfidenceThreshold=function(bx){I.$cctor();I.intentConfidenceThreshold=bx;};C.getUtterance=function(bx,by){C.witapi().getMeaning(bx,function(bz){var bA,bB;p.debug("NLU",(function(bC){return function(bD){return bC("Wit.ai returned: "+_.prettyPrint(bD));};}(a.id))(bz));bA=!(bz.intents==null)?bc.ofArray(_9.map(function(bC){return new E({$:0,$0:bC.name,$1:bC.confidence});},bz.intents)):bc.T.Empty;bB=!(bz.traits==null)?bc.ofSeq(bd.concat(bc.map(function(bC){return _9.map(function(bD){return new G({$:0,$0:bC,$1:bD.confidence,$2:bD.value});},bg.GetJS(bz.traits,[bC]));},bc.filter(function(bC){return!(bg.GetJS(bz.traits,[bC])==null);},C.trait_types())))):bc.T.Empty;return by({$:1,$0:new D({$:0,$0:bA,$1:!(bz.intents==null)?bc.ofSeq(bd.concat(bc.map(function(bC){return _9.map(function(bD){return new F({$:0,$0:bD.name,$1:bD.confidence,$2:bD.role,$3:bD.value});},bg.GetJS(bz.entities,[bC]));},bc.filter(function(bC){return!(bg.GetJS(bz.entities,[bC])==null);},C.entity_types())))):bc.T.Empty,$2:bB})});},function(bz,bA,bB){p.error((((_2.Curried3(function(bC,bD,bE){return bC("Wit.ai returned: "+_.prettyPrint(bD)+" "+_.prettyPrint(bE));}))(a.id))(bA))(bB));return by(null);});};C.trait_types=function(){I.$cctor();return I.trait_types;};C.entity_types=function(){I.$cctor();return I.entity_types;};C.witapi=function(){I.$cctor();return I.witapi;};C.QuickPrograms=function(bx){return bx==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};C.QuickNumber=function(bx){var by,bz,bA;return(bz=C.One(bx),bz!=null&&bz.$==1?(by=bz.$0,true):(bA=C.Two(bx),bA!=null&&bA.$==1&&(by=bA.$0,true)))?{$:1,$0:by}:null;};C.Three=function(bx){var by;return bx==="3"||bx==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:bc.ofArray([new x({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};C.Two=function(bx){var by;return bx==="2"||bx==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:bc.ofArray([new x({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};C.One=function(bx){var by;return bx==="1"||bx==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:bc.ofArray([new x({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};C.QuickNo=function(bx){var by;return bx==="no"||(bx==="NO"||(bx==="No"||(bx==="nope"||(bx==="no way"||(bx==="nah"||(bx==="don't do it"||bx==="stop"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickYes=function(bx){var by;return bx==="yes"||(bx==="YES"||(bx==="Yes"||(bx==="YEs"||(bx==="ok"||(bx==="sure"||(bx==="yeah"||(bx==="yep"||(bx==="uh huh"||(bx==="go ahead"||bx==="go")))))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHelp=function(bx){var by;return bx==="help"||(bx==="help me"||(bx==="what's this?"||bx==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHello=function(bx){var by;return bx==="hello"||(bx==="hey"||(bx==="yo"||bx==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.Voices=function(bx){return bx==="voices"?{$:1,$0:null}:null;};C.Debug=function(bx){return bx==="debug"?{$:1,$0:null}:null;};C.Blank=function(bx){return bx===""?{$:1,$0:null}:null;};H.Study=function(bx){return bx.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bx){var by,bz,bA,bB;return(bz=u.Intent$1("no",bx),bz!=null&&bz.$==1&&(bz.$0[0]==null&&(bz.$0[1]==null&&(by=bx,true))))?{$:1,$0:by}:(bB=u.Intent$1("reject",bx),bB!=null&&bB.$==1&&(bB.$0[0]==null&&(bB.$0[1]==null&&(bA=bx,true))))?{$:1,$0:bA}:null;};u.Yes=function(bx){var by,bz,bA,bB;return(bz=u.Intent$1("yes",bx),bz!=null&&bz.$==1&&(bz.$0[0]==null&&(bz.$0[1]==null&&(by=bx,true))))?{$:1,$0:by}:(bB=u.Intent$1("verify",bx),bB!=null&&bB.$==1&&(bB.$0[0]==null&&(bB.$0[1]==null&&(bA=bx,true))))?{$:1,$0:bA}:null;};u.EntityManyofMany=function(bx,by){return{$:1,$0:bi.OfArray(_9.ofSeq(bc.map(function(bz){return bc.exists(function(bA){return bA.get_Role()===bz;},by)?[bz,{$:1,$0:bc.filter(function(bA){return bA.get_Role()===bz;},by)}]:[bz,null];},bx)))};};u.EntityManyOf1=function(bx,by){var bz;return by!=null&&by.$==1&&(bc.exists(function(bA){return bA.get_Role()===bx;},by.$0)&&(bz=by.$0,true))?{$:1,$0:bc.filter(function(bA){return bA.get_Role()===bx;},bz)}:null;};u.Entity1OfAny=function(bx,by){var bz;return by!=null&&by.$==1&&(bc.exists(function(bA){return bA.get_Role()===bx;},by.$0)&&(bz=by.$0,true))?{$:1,$0:bc.head(bc.sortBy(function(bA){return bA.get_Role();},bc.filter(function(bA){return bA.get_Role()===bx;},bz)))}:null;};u.Entity1Of1=function(bx,by){var bz;return by!=null&&by.$==1&&(by.$0.$==1&&(by.$0.$1.$==0&&(by.$0.$0.get_Role()===bx&&(bz=by.$0.$0,true))))?{$:1,$0:bz}:null;};u.Intent$1=function(bx,by){return by.get_Intent()!=null&&by.get_Intent().$0.get_Name()===bx?{$:1,$0:[by.get_Traits(),by.get_Entities()]}:null;};I.$cctor=function(){I.$cctor=a.ignore;I.witapi=new bl.New("Y7GDBZV33TW2MLC3BQB2CJHZV5MKWXQU");I.entity_types=bc.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);I.trait_types=bc.ofArray(["domain","dialogue_act"]);I.intentConfidenceThreshold=0.85;I.entityConfidenceThreshold=0.85;};J.waitAddPhrases=function(){K.$cctor();return K.waitAddPhrases;};J.waitRetrievePhrases=function(){K.$cctor();return K.waitRetrievePhrases;};J.helpPhrases=function(){K.$cctor();return K.helpPhrases;};J.helloUserPhrases=function(){K.$cctor();return K.helloUserPhrases;};J.helloPhrases=function(){K.$cctor();return K.helloPhrases;};J["getRandomPhrase'"]=function(bx){return J.replace_tok("$0","",bd.nth(J.rng().Next(0,bx.get_Length()),bx));};J.getRandomPhrase=function(bx,by){return J.replace_tok("$0",by,bd.nth(J.rng().Next(0,bx.get_Length()),bx));};J.replace_tok=function(bx,by,bz){return bb.Replace(bz,bx,by);};J.rng=function(){K.$cctor();return K.rng;};K.$cctor=function(){K.$cctor=a.ignore;K.rng=new bm.New();K.helloPhrases=bc.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);K.helloUserPhrases=bc.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);K.helpPhrases=bc.ofArray(["What can I help you with $0?"]);K.waitRetrievePhrases=bc.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);K.waitAddPhrases=bc.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=_2.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=_2.Class({SayVoices:function(){var bx,by,bz;bx=this;by=a.speechSynthesis.getVoices();!(by==null)?(bz=p.toArray(by),bx.Say((function(bA){return function(bB){return bA("There are currently "+a.String(bB)+" voices installed on this computer or device.");};}(a.id))(_9.length(bz))),_9.iteri(function(bA,bB){return bx.Say(((((_2.Curried(function(bC,bD,bE,bF){return bC("Voice "+a.String(bD)+". Name: "+_.toSafe(bE)+", Local: "+_.prettyPrint(bF)+".");},4))(a.id))(bA))(bB.name))(bB.localService));},bz)):void 0;},Wait:function(bx){this.Wait$1(function(){bn.Start(bx,null);});},Wait$1:function(bx){this["Echo'"]("please wait...");this.Term.pause();bx();this.Term.resume();},sayRandom:function(bx,by){this.Say(J.getRandomPhrase(bx,by));},SayAngry:function(bx){var by,bz;by=this;bn.Start((bz=null,bn.Delay(function(){return bn.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bo.chime(),bn.Zero()):bn.Zero(),bn.Delay(function(){a.addMessage(by.Avatar,bx,"","");by.Avatar.processMessages(0);return bn.Zero();}));})),null);},SayDoc:function(bx){var by,bz,bA;by=_9.get(ba(".terminal-output").get(),0).childNodes.length;bz=_7.Element("div",[p.cls("terminal-command"),p.dindex(by+1)],[bx]);bA=p.termOutput();_6.LoadLocalTemplates("");_7.RunAppend(bA,bz);},Say:function(bx){var by,bz;by=this;bn.Start((bz=null,bn.Delay(function(){return bn.Combine(a.speechSynthesis.speaking?(bo.chime(),bn.Zero()):bn.Zero(),bn.Delay(function(){by.Avatar.addMessage(bx);by.Avatar.processMessages(0);return bn.Zero();}));})),null);},Debug:function(bx,by){p.debug(bx,by);},"EchoHtml'":function(bx){var by,bz;by=(bz={},bz.raw=true,bz);this.Term.disable();this.Term.echo(bx,by);this.Term.enable();},"Echo'":function(bx){this.Term.disable();this.Term.echo(bx);this.Term.enable();}},null,P);P.New=function(bx,by,bz,bA,bB){return new P({Voice:bx,Mic:by,Term:bz,Avatar:bA,Caption:bB});};R=Q.Dialogue=_2.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,R);Q["Response'_"]=function(bx,by,bz,bA){var bB,bC,bD;return(bC=Q.PropNotSet_(bx,"user",bA),bC!=null&&bC.$==1&&(Q.haveQuestion(by,bz)&&bx.get_DialogueQuestions().length>0&&(bx.get_DialogueQuestions())[0].get_Name()===bz&&(bB=bC.$0,true)))?(Q.popu(bx),Q.popq(bx),Q.haveProp(bx,bz)?(bD=bx.get_Props().get_Item(bz),(Q.deleteProp(bx,bz),{$:1,$0:[bB,{$:1,$0:bD}]})):{$:1,$0:[bB,null]}):null;};Q.Response_=function(bx,by,bz,bA){var bB,bC,bD;return(bC=Q.PropSet_(bx,"user",bA),bC!=null&&bC.$==1&&(Q.haveQuestion(by,bz)&&bx.get_DialogueQuestions().length>0&&(bx.get_DialogueQuestions())[0].get_Name()===bz&&(bB=bC.$0,true)))?(Q.popu(bx),Q.popq(bx),Q.haveProp(bx,bz)?(bD=bx.get_Props().get_Item(bz),(Q.deleteProp(bx,bz),{$:1,$0:[bB,{$:1,$0:bD}]})):{$:1,$0:[bB,null]}):null;};Q["User'_"]=function(bx,by){var bz,bA;return(bA=Q.PropNotSet_(bx,"user",by),bA!=null&&bA.$==1&&(bx.get_DialogueQuestions().length===0&&(bz=bA.$0,true)))?(Q.popu(bx),{$:1,$0:bz}):null;};Q.User_=function(bx,by){var bz,bA;return(bA=Q.PropSet_(bx,"user",by),bA!=null&&bA.$==1&&(bx.get_DialogueQuestions().length===0&&(bz=bA.$0,true)))?(Q.popu(bx),{$:1,$0:bz}):null;};Q.PropNotSet_=function(bx,by,bz){return!Q.haveProp(bx,by)?{$:1,$0:bz}:null;};Q.PropSet_=function(bx,by,bz){return Q.haveProp(bx,by)?{$:1,$0:bz}:null;};Q.noUnderstand=function(bx,by,bz){var bA;by((function(bB){return function(bC){return bB(_.toSafe(bC)+" interpreter did not understand utterance.");};}(a.id))(bz));Q.say(bx,"Sorry I didn't understand what you meant.");bx.get_DialogueQuestions().length>0?(bA=bd.nth(0,bx.get_DialogueQuestions()),Q.haveProp(bx,bA.get_Name())?Q.say(bx,J.replace_tok("$0",bx.get_Props().get_Item(bA.get_Name()),bA.get_Text())):Q.say(bx,bA.get_Text())):void 0;};Q.ask=function(bx,by,bz,bA){Q.addProp(bx,bz,bA);Q.pushq(bx,by,bz);Q.say(bx,J.replace_tok("$0",bA,Q.getQuestion(by,bz).$0.get_Text()));};Q.pushq=function(bx,by,bz){var bA;bA=Q.getQuestion(by,bz);bA==null?(function(bB){return function(bC){return bB("No such question: "+_.toSafe(bC));};}(bp.FailWith))(bz):bx.get_DialogueQuestions().unshift(bA.$0);};Q.popq=function(bx){bx.get_DialogueQuestions().shift();};Q.popu=function(bx){bx.get_Utterances().shift();};Q.pushu=function(bx,by){bx.get_Utterances().unshift(by);};Q.haveQuestion=function(bx,by){return bc.exists(function(bz){return bz.get_Name()===by;},bx);};Q.getQuestion=function(bx,by){return bd.tryFind(function(bz){return bz.get_Name()===by;},bx);};Q.prop=function(bx,by){return bx.get_Props().get_Item(by);};Q.deleteProp=function(bx,by){bx.get_Props().Remove(by);};Q.addProp=function(bx,by,bz){bx.get_Props().Add(by,bz);};Q.haveProp=function(bx,by){return bx.get_Props().ContainsKey(by);};Q["sayRandom'"]=function(bx,by){Q.sayRandom(bx,by,"");};Q.sayRandom=function(bx,by,bz){var bA;bA=J.getRandomPhrase(by,bz);bx.get_Output().unshift(bA);bx.get_Cui().Say(bA);};Q.say=function(bx,by){bx.get_Output().unshift(by);Q["say'"](bx,by);};Q["say'"]=function(bx,by){bx.get_Cui().Say(by);};Q.echo=function(bx,by){(bx.get_Cui())["EchoHtml'"](by);};S.update=function(bx){var by,bz,bA,bB,bC,bD,bE,bF,bG,bH;function bI(bK){Q.say(bx,bK);}function bJ(bK){return Q["User'_"](bx,bK);}by=bx.$4;bz=bx.$2;S.debug((((_2.Curried3(function(bK,bL,bM){return bK("Starting utterances:"+_.prettyPrint(bL)+". Starting questions: "+_.prettyPrint(bM)+".");}))(a.id))(by))(bz));bA=bc.ofSeq(bd.take(by.length>=5?5:by.length,by));bA.$==1&&(bC=bJ(bA.$0),bC!=null&&bC.$==1&&((bD=u.Intent$1("start_module",bC.$0),bD!=null&&bD.$==1)&&(bA.$1.$==1&&(bE=bJ(bA.$1.$0),bE!=null&&bE.$==1&&(bF=u.Intent$1("select_module",bE.$0),bF!=null&&bF.$==1&&(bG=u.Entity1OfAny("term",bF.$0[1]),bG!=null&&bG.$==1&&(bB=bG.$0,true)))))))?bI("starting tutorial"):(Q.popu(bx),S.debug("Main interpreter did not understand utterance."),bI("Sorry I didn't understand what you meant."),bz.length>0?(bH=bd.nth(0,bx.get_DialogueQuestions()),Q.haveProp(bx,bH.get_Name())?bI(J.replace_tok("$0",bx.get_Props().get_Item(bH.get_Name()),bH.get_Text())):bI(bH.get_Text())):void 0);S.debug((((_2.Curried3(function(bK,bL,bM){return bK("Ending utterances: "+_.prettyPrint(bL)+". Ending questions:"+_.prettyPrint(bM)+".");}))(a.id))(by))(bz));};S.haveQuestion=function(){T.$cctor();return T.haveQuestion;};S.getQuestion=function(){T.$cctor();return T.getQuestion;};S.moduleQuestions=function(){T.$cctor();return T.moduleQuestions;};S.debug=function(bx){p.debug(S.name(),bx);};S.name=function(){T.$cctor();return T.name;};T.$cctor=function(){T.$cctor=a.ignore;T.name="Tutorial";T.moduleQuestions=bc.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:{$:0,$0:true}}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:{$:0,$0:true}})]);T.getQuestion=function(bx){return Q.getQuestion(S.moduleQuestions(),bx);};T.haveQuestion=function(bx){return Q.haveQuestion(S.moduleQuestions(),bx);};};U.update=function(bx){var by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;function cw(cH){Q.echo(bx,cH);}function cx(cH){Q.say(bx,cH);}function cy(cH,cI){return Q.sayRandom(bx,cH,cI);}function cz(cH,cI){return Q.addProp(bx,cH,cI);}function cA(cH,cI){return Q.ask(bx,U.moduleQuestions(),cH,cI);}function cB(cH){return Q.User_(bx,cH);}function cC(cH){return Q["User'_"](bx,cH);}function cD(cH,cI){return Q.Response_(bx,U.moduleQuestions(),cH,cI);}function cE(cH,cI){return Q["Response'_"](bx,U.moduleQuestions(),cH,cI);}function cF(cH){var cI;return cH!=null&&cH.$==1&&(typeof cH.$0=="string"&&(cI=cH.$0,true))?{$:1,$0:cI}:null;}function cG(cH){var cI;cI=null;return bn.Delay(function(){return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.getMessages:-1083527296",[cH]),function(cJ){bz.Add("msgs",cJ);return cJ!=null&&cJ.$0.get_Length()>0?(cx((((_2.Curried3(function(cK,cL,cM){return cK("You have "+a.String(cL)+" new message"+_.toSafe(cM)+".");}))(a.id))(cJ.$0.get_Length()))(cJ.$0.get_Length()>1?"s":"")),bn.Zero()):bn.Zero();});});}by=bx.$4;bz=bx.$1;bA=bx.$2;U.debug((((_2.Curried3(function(cH,cI,cJ){return cH("Starting utterances:"+_.prettyPrint(cI)+". Starting questions: "+_.prettyPrint(cJ)+".");}))(a.id))(by))(bA));bB=bc.ofSeq(bd.take(by.length>=5?5:by.length,by));bB.$==1&&(bD=(bE=Q.PropNotSet_(bx,"started",bB.$0),bE!=null&&bE.$==1?{$:1,$0:bE.$0}:null),bD!=null&&bD.$==1&&(bF=cC(bD.$0),bF!=null&&bF.$==1&&(bG=u.Intent$1("greet",bF.$0),bG!=null&&bG.$==1&&(bG.$0[1]==null&&bB.$1.$==0))))?(bz.Add("started",true),Q["sayRandom'"](bx,J.helloPhrases())):bB.$==1&&(bI=cC(bB.$0),bI!=null&&bI.$==1&&(bJ=u.Intent$1("greet",bI.$0),bJ!=null&&bJ.$==1&&(bJ.$0[1]==null&&bB.$1.$==0)))?cx("Hello, tell me your name to get started."):bB.$==1&&(bL=cC(bB.$0),bL!=null&&bL.$==1&&(bM=u.Intent$1("greet",bL.$0),bM!=null&&bM.$==1&&(bN=u.Entity1Of1("name",bM.$0[1]),bN!=null&&bN.$==1&&(bB.$1.$==0&&(bK=bN.$0,true)))))?(bO=bK.get_Value(),cy(J.waitRetrievePhrases(),"user name"),bn.Start((bP=null,bn.Delay(function(){return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1024691543",[bO]),function(cH){var cI;return cH==null?(cx((function(cJ){return function(cK){return cJ("I did not find a user with the name "+_.toSafe(cK)+".");};}(a.id))(bO)),cA("addUser",bO),bn.Zero()):(cI=cH.$0,(cy(J.helloUserPhrases(),(function(cJ){return function(cK){return cJ(_.prettyPrint(cK));};}(a.id))(cI.Name)),bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:374529640",[cI.Name]),function(){bz.Add("user",cI);return bn.Combine(cI.LastLoggedIn!=null?bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-1528427223",[cI.LastLoggedIn.$0]),function(cJ){cx((function(cK){return function(cL){return cK("You last logged in "+_.toSafe(cL)+".");};}(a.id))(cJ));return bn.Zero();}):bn.Zero(),bn.Delay(function(){return bn.Bind(cG(cI.Name),function(){return bn.Return(null);});}));})));});})),null)):bB.$==1&&(bR=u.Yes(bB.$0),bR!=null&&bR.$==1&&(bS=cE("addUser",bR.$0),bS!=null&&bS.$==1&&(bT=cF(bS.$0[1]),bT!=null&&bT.$==1&&(bB.$1.$==0&&(bQ=bT.$0,true)))))?bn.Start((bU=null,bn.Delay(function(){cy(J.waitAddPhrases(),"user");return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:374529640",[bQ]),function(cH){return cH==null?(cx((function(cI){return function(cJ){return cI("Sorry I was not able to add the user "+_.toSafe(cJ)+" to the system.");};}(a.id))(bQ)),bn.Zero()):bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1024691543",[bQ]),function(cI){cz("user",cI);cx((function(cJ){return function(cK){return cJ("Hello "+_.prettyPrint(cK)+", nice to meet you.");};}(a.id))(bQ));return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.addMessage:1026747299",[bQ,"Welcome to Lerna."]),function(){return bn.Bind(cG(bQ),function(){return bn.Return(null);});});});});})),null):bB.$==1&&(bW=u.No(bB.$0),bW!=null&&bW.$==1&&(bX=cE("addUser",bW.$0),bX!=null&&bX.$==1&&(bY=cF(bX.$0[1]),bY!=null&&bY.$==1&&(bB.$1.$==0&&(bV=bY.$0,true)))))?cx((function(cH){return function(cI){return cH("Ok I did not add the user "+_.toSafe(cI)+". But you must login for me to help you.");};}(a.id))(bV)):bB.$==1&&((b0=cC(bB.$0),b0!=null&&b0.$==1)&&bB.$1.$==0)?cx("Could you introduce yourself so we can get started?"):bB.$==1&&(b2=cB(bB.$0),b2!=null&&b2.$==1&&(b3=u.Intent$1("hello",b2.$0),b3!=null&&b3.$==1&&(b3.$0[0]==null&&(b4=u.Entity1Of1("name",b3.$0[1]),b4!=null&&b4.$==1&&(bB.$1.$==0&&(b1=b4.$0,true))))))?bn.Start((b5=null,bn.Delay(function(){return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1024691543",[b1.get_Value()]),function(cH){return cH==null?(cx((function(cI){return function(cJ){return cI("Sorry, the user "+_.toSafe(cJ)+" does not exist.");};}(a.id))(b1.get_Value())),bn.Zero()):(cA("switchUser",cH.$0.Name),bn.Zero());});})),null):bB.$==1&&(b7=u.Yes(bB.$0),b7!=null&&b7.$==1&&(b8=cD("switchUser",b7.$0),b8!=null&&b8.$==1&&(b9=cF(b8.$0[1]),b9!=null&&b9.$==1&&(bB.$1.$==0&&(b6=b9.$0,true)))))?(bz.set_Item("user",b6),cx((function(cH){return function(cI){return cH("Ok I switched to user "+_.prettyPrint(cI)+".");};}(a.id))(b6))):bB.$==1&&(b$=u.No(bB.$0),b$!=null&&b$.$==1&&(ca=cD("switchUser",b$.$0),ca!=null&&ca.$==1&&(cb=cF(ca.$0[1]),cb!=null&&cb.$==1&&(bB.$1.$==0&&(b_=cb.$0,true)))))?cx((function(cH){return function(cI){return cH("Ok I did not switch to user "+_.toSafe(cI)+".");};}(a.id))(b_)):bB.$==1&&(cd=cB(bB.$0),cd!=null&&cd.$==1&&((ce=u.Intent$1("studyjournal",cd.$0),ce!=null&&ce.$==1)&&bB.$1.$==0))?(cw("<img src=\"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.YSxy_C2rlS83dQdUOq9MqwHaFB%26pid%3DApi&f=1\"/>"),cx("Good job! You are right on track with the rest of students in your cohort. Keep it up.")):bB.$==1&&(cg=cC(bB.$0),cg!=null&&cg.$==1&&(ch=u.Intent$1("select_module",cg.$0),ch!=null&&ch.$==1&&(ci=u.Entity1OfAny("term",ch.$0[1]),ci!=null&&ci.$==1&&(bB.$1.$==0&&(cf=ci.$0,true)))))?(by.unshift(new y({$:0,$0:{$:1,$0:new v({$:0,$0:"start_module",$1:{$:1,$0:1}})},$1:null,$2:null})),S.update(bx)):bB.$==1&&(ck=cB(bB.$0),ck!=null&&ck.$==1&&((cl=u.Intent$1("nextclass",ck.$0),cl!=null&&cl.$==1)&&bB.$1.$==0))?(cw("<iframe src=\"https://calendar.google.com/calendar/embed?src=cocnrm4290919hobq1f5he7leg%40group.calendar.google.com&ctz=America%2FPort_of_Spain\" style=\"border: 0\" width=\"800\" height=\"600\" frameborder=\"0\" scrolling=\"no\"></iframe>"),cx("Your next chemistry class is on Monday at 8:30AM.")):bB.$==1&&(cn=cB(bB.$0),cn!=null&&cn.$==1&&(co=u.Intent$1("reference",cn.$0),co!=null&&co.$==1&&(cp=u.Entity1Of1("term",co.$0[1]),cp!=null&&cp.$==1&&(bB.$1.$==0&&(cm=cp.$0,true)))))?bn.Start((cq=null,bn.Delay(function(){return bn.Bind(bs.getAnswer(cm.get_Value()),function(cH){var cI;cI=_9.get(cH.answers,0).answer;return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.mdtohtml:-885650300",[cI]),function(cJ){return bn.Bind((new br.New()).Async("Lerna.Web:Lerna.Web.Server.mdtotext:-885650300",[cI]),function(cK){cw(cJ);cx(cK);return bn.Zero();});});});})),null):bB.$==1&&(cs=cB(bB.$0),cs!=null&&cs.$==1&&(ct=u.Intent$1("quiz",cs.$0),ct!=null&&ct.$==1&&(cu=u.Entity1Of1("term",ct.$0[1]),cu!=null&&cu.$==1&&(bB.$1.$==0&&(cr=cu.$0,true)))))?bn.Start((cv=null,bn.Delay(function(){cw("What is the most accurate definition of an element?<br>1. A bond between molecules<br>2. A substance that cannot be broken down into simpler components.<br>3. A combination of atoms.<br> 4. A part of water.");cx("What is the most accurate definition of an element? 1. A bond between molecules. 2. A substance that cannot be broken down into simpler components. 3. A combination of atoms 4. A part of water.");return bn.Zero();})),null):(Q.popu(bx),Q.noUnderstand(bx,function(cH){U.debug(cH);},U.name()));U.debug((((_2.Curried3(function(cH,cI,cJ){return cH("Ending utterances: "+_.prettyPrint(cI)+". Ending questions:"+_.prettyPrint(cJ)+".");}))(a.id))(by))(bA));};U.haveQuestion=function(bx){return function(by){return Q.haveQuestion(U.moduleQuestions(),by);};};U.getQuestion=function(bx){return function(by){return Q.getQuestion(U.moduleQuestions(),by);};};U.moduleQuestions=function(){V.$cctor();return V.moduleQuestions;};U.debug=function(bx){p.debug(U.name(),bx);};U.name=function(){V.$cctor();return V.name;};V.$cctor=function(){V.$cctor=a.ignore;V.name="Main";V.moduleQuestions=bc.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:{$:0,$0:true}}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:{$:0,$0:true}})]);};W.update=function(bx,by,bz,bA,bB){W.debug((((_2.Curried3(function(bC,bD,bE){return bC("Starting utterances:"+_.prettyPrint(bD)+". Starting questions: "+_.prettyPrint(bE)+".");}))(a.id))(bB))(bA));};W.haveQuestion=function(bx){return bc.exists(function(by){return by.get_Name()===bx;},W.questions());};W.getQuestion=function(bx){return bd.tryFind(function(by){return by.get_Name()===bx;},W.questions());};W.questions=function(){X.$cctor();return X.questions;};W.debug=function(bx){p.debug("Study",bx);};X.$cctor=function(){X.$cctor=a.ignore;X.questions=bc.ofArray([new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better.",$2:{$:0,$0:true}}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?",$2:{$:0,$0:true}}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?",$2:{$:0,$0:true}})]);};Y.run=function(){var bx,by;bx=_2.ThisFunc(function(bz,bA){return((Y.Main().get_Text())(bz))(bA);});by=Y.Main().get_Options();a.$("#term").terminal(bx,by);return _7.get_Empty();};Y.Main=function(){Z.$cctor();return Z.Main;};Y.initMic=function(bx){var by,bz;Y.set_CUI((by={$:1,$0:new bt.Microphone(bu.getElementById("microphone"))},P.New(Y.CUI().Voice,by,Y.CUI().Term,Y.CUI().Avatar,Y.CUI().Caption)));bz=Y.CUI().Mic.$0;bz.onconnecting=function(){Y.set_MicState(M.MicConnecting);return Y.debug("Mic connecting...");};bz.ondisconnected=function(){Y.set_MicState(M.MicDisconnected);return Y.debug("Mic disconnected.");};bz.onaudiostart=function(){Y.set_MicState(M.MicAudioStart);return Y.debug("Mic audio start...");};bz.onaudioend=function(){Y.set_MicState(M.MicAudioEnd);return Y.debug("Mic audio end.");};bz.onerror=function(bA){Y.set_MicState({$:6,$0:bA});return Y.debug((function(bB){return function(bC){return bB("Mic error : "+_.toSafe(bC)+".");};}(a.id))(bA));};bz.onready=function(){Y.set_MicState(M.MicReady);return Y.debug("Mic ready.");};bz.onresult=function(bA,bB){return Y.ClientState().$==2?Y.echo("I'm still trying to understand what you said before."):Y.ClientState().$==0?p.error("Client is not intialized."):!(bA==null||bB==null)?(Y.set_MicState({$:7,$0:bA,$1:bB}),Y.debug((((_2.Curried3(function(bC,bD,bE){return bC("Mic result: "+_.prettyPrint(bD)+" "+_.prettyPrint(bE)+".");}))(a.id))(bA))(bB)),bx(bA,bB)):Y.debug("Mic: No result returned.");};bz.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};Y.sayRandom=function(bx,by){Y.say(J.getRandomPhrase(by,bx));};Y.sayVoices=function(){var bx;bx=p.toArray(p.speechSynthesis().getVoices());Y["say'"]((function(by){return function(bz){return by("There are currently "+a.String(bz)+" voices installed on this computer or device.");};}(a.id))(_9.length(bx)));_9.iteri(function(by,bz){return Y["say'"](((((_2.Curried(function(bA,bB,bC,bD){return bA("Voice "+a.String(bB)+". Name: "+_.toSafe(bC)+", Local: "+_.prettyPrint(bD)+".");},4))(a.id))(by))(bz.name))(bz.localService));},bx);};Y.say=function(bx){Y.Output().unshift(bx);Y["say'"](bx);};Y["say'"]=function(bx){Y.CUI().Say(bx);};Y.initSpeech=function(){var bx,by;bx=p.toArray(Y.synth().getVoices());_9.length(bx)>0?(by=_9.find(function(bz){return bz["default"];},bx),Y.set_CUI(P.New({$:1,$0:by},Y.CUI().Mic,Y.CUI().Term,Y.CUI().Avatar,Y.CUI().Caption)),Y.debug((function(bz){return function(bA){return bz("Using browser speech synthesis voice "+_.toSafe(bA)+".");};}(a.id))(Y.CUI().Voice.$0.name)),Y.CUI().Avatar.nativeVoice=true,Y.CUI().Avatar.nativeVoiceName=by.name):Y.echo("No browser speech synthesis voice is available. Falling back to CMU TTS.");};Y.synth=function(){Z.$cctor();return Z.synth;};Y.push=function(bx){Y.Utterances().unshift(bx);return Y.Dialogue();};Y.Dialogue=function(){Z.$cctor();return Z.Dialogue;};Y.Utterances=function(){Z.$cctor();return Z.Utterances;};Y.Questions=function(){Z.$cctor();return Z.Questions;};Y.Output=function(){Z.$cctor();return Z.Output;};Y.Props=function(){Z.$cctor();return Z.Props;};Y.wait=function(bx){p["Terminal.Echo'"](Y.CUI().Term,"please wait");Y.CUI().Term.pause();bx();Y.CUI().Term.resume();};Y.debug=function(bx){p.debug("CLIENT",bx);};Y.echo=function(bx){if(!(Y.CUI().Term==null))p["Terminal.EchoHtml'"](Y.CUI().Term,(function(by){return function(bz){return by(_.prettyPrint(bz));};}(a.id))(bx));};Y.ClientState=function(){Z.$cctor();return Z.ClientState;};Y.set_ClientState=function(bx){Z.$cctor();Z.ClientState=bx;};Y.MicState=function(){Z.$cctor();return Z.MicState;};Y.set_MicState=function(bx){Z.$cctor();Z.MicState=bx;};Y.CUI=function(){Z.$cctor();return Z.CUI;};Y.set_CUI=function(bx){Z.$cctor();Z.CUI=bx;};Z.$cctor=function(){var bx,by,bz;Z.$cctor=a.ignore;function bA(bC,bD){var bE,bF,bG,bH,bI,bJ,bK;Y.debug((((_2.Curried3(function(bL,bM,bN){return bL("Voice: "+_.prettyPrint(bM)+" "+_.prettyPrint(bN));}))(a.id))(bC))(bD));bE=(bF=A["Intent'"](bC,bD),bF!=null&&bF.$==1?{$:1,$0:bF.$0}:null);bG=(bH=A["Trait'"](bD),bH!=null&&bH.$==1?{$:1,$0:bc.ofArray([bH.$0])}:null);bI=(bJ=A["Entity'$1"](bD),bJ!=null&&bJ.$==1?{$:1,$0:bc.ofArray([bJ.$0])}:null);bE==null&&(bG==null&&bI==null)?void 0:(Y.debug(((((_2.Curried(function(bL,bM,bN,bO){return bL("Voice: "+_0.p(bM)+" "+_0.p$3(bN)+" "+_0.p$5(bO));},4))(a.id))(bE))(bG))(bI)),U.update(Y.push(new y({$:0,$0:bE,$1:bG,$2:bI}))));}function bB(bC,bD){var bE,bF,bG,bH,bI,bJ,bK,bL,bM;Y.set_CUI(P.New(Y.CUI().Voice,Y.CUI().Mic,bC,Y.CUI().Avatar,Y.CUI().Caption));bv.Equals(Y.CUI().Mic,null)?Y.initMic(bA):void 0;bv.Equals(Y.CUI().Voice,null)?Y.initSpeech():void 0;Y.ClientState().$===0?Y.set_ClientState(N.ClientReady):void 0;return(bE=C.Blank(bD),bE!=null&&bE.$==1)?Y["say'"]("Tell me what you want me to do or ask me a question."):(bF=C.Debug(bD),bF!=null&&bF.$==1)?(Y.debug((new br.New()).Sync("Lerna.Web:Lerna.Web.Server.tag:-1869235185",[])),Y.debug((function(bN){return function(bO){return bN("Utterances: "+_.prettyPrint(bO));};}(a.id))(Y.Utterances())),Y.debug((function(bN){return function(bO){return bN("Questions: "+_.prettyPrint(bO));};}(a.id))(Y.Questions()))):(bG=C.Voices(bD),bG!=null&&bG.$==1)?Y.sayVoices():Y.ClientState().$==1?(bI=C.QuickHello(bD),bI!=null&&bI.$==1?(bH=bI.$0,true):(bJ=C.QuickHelp(bD),bJ!=null&&bJ.$==1?(bH=bJ.$0,true):(bK=C.QuickYes(bD),bK!=null&&bK.$==1?(bH=bK.$0,true):(bL=C.QuickNo(bD),bL!=null&&bL.$==1&&(bH=bL.$0,true)))))?(Y.debug((function(bN){return function(bO){return bN("Quick Text: "+_0.p$7(bO)+".");};}(a.id))(bH)),U.update(Y.push(bH)),Y.set_ClientState(N.ClientReady)):Y.CUI().Wait((bM=null,bn.Delay(function(){Y.set_ClientState(N.ClientUnderstand);C.getUtterance(bD,function(bN){var bO,bP;bO=C.HasUtterance(bN);bO!=null&&bO.$==1?(bP=bO.$0,Y.debug(((((_2.Curried(function(bQ,bR,bS,bT){return bQ("Text: Intent: "+_0.p(bR)+", Traits: "+_0.p$3(bS)+", Entities: "+_0.p$5(bT));},4))(a.id))(bP.get_Intent()))(bP.get_Traits()))(bP.get_Entities())),U.update(Y.push(bP))):(Y.debug("Text: Did not receive a meaning from the NLU service."),Y["say'"]("Sorry I did not understand what you said."));});Y.set_ClientState(N.ClientReady);return bn.Zero();}))):Y.ClientState().$==0?p.error("Client is not initialized."):Y["say'"]("I'm still trying to understand what you said before.");}Z.CUI=P.New(null,null,null,(bo.applicationId="4277115329081938617",bx=new a.SDKConnection(),by=new a.WebAvatar(),by.version=8.5,by.connection=bx,by.avatar="22225225",by.voice="cmu-slt",by.voiceMod="default",by.nativeVoice=true,by.nativeVoiceName="Microsoft David Desktop - English (United States)",by.width=300,by.createBox(),by.addMessage(""),by.processMessages(0),by),false);Z.MicState=M.MicNotInitialized;Z.ClientState=N.ClientNotInitialzed;Z.Props=new bw.New$5();Z.Output=[];Z.Questions=[];Z.Utterances=[];Z.Dialogue=new R({$:0,$0:Y.CUI(),$1:Y.Props(),$2:Y.Questions(),$3:Y.Output(),$4:Y.Utterances()});Z.synth=a.speechSynthesis;Z.Main=new O({$:0,$0:function(bC){return bA(bC[0],bC[1]);},$1:[function(bC){return function(bD){return bB(bC,bD);};},(bz={},bz.name="Main",bz.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech or say help for more info.",bz.prompt=">",bz)]});};_0.p$10=function(bx){return bx==null?"null":"Some "+_.prettyPrint(bx.$0);};_0.p$8=function(bx){return"Question ("+_.prettyPrint(bx.$0)+", "+_.prettyPrint(bx.$1)+", "+_0.p$9(bx.$2)+")";};_0.p$9=function(bx){return bx.$==2?"ConceptCompletion "+_.prettyPrint(bx.$0):bx.$==1?"Disjunctive ("+_.prettyPrint(bx.$0)+", "+_.prettyPrint(bx.$1)+")":"Verification "+_.prettyPrint(bx.$0);};_0.p$2=function(bx){return bx==null?"null":"Some "+_.prettyPrint(bx.$0);};_0.p$1=function(bx){return"Intent ("+_.prettyPrint(bx.$0)+", "+_0.p$2(bx.$1)+")";};_0.p=function(bx){return bx==null?"null":"Some "+_0.p$1(bx.$0);};_0.p$4=function(bx){return"Trait ("+_.prettyPrint(bx.$0)+", "+_.prettyPrint(bx.$1)+", "+_0.p$2(bx.$2)+")";};_0.p$3=function(bx){return bx==null?"null":"Some "+_.printList(function(by){return _0.p$4(by);},bx.$0);};_0.p$6=function(bx){return"Entity ("+_.prettyPrint(bx.$0)+", "+_.prettyPrint(bx.$1)+", "+_.prettyPrint(bx.$2)+", "+_0.p$2(bx.$3)+")";};_0.p$5=function(bx){return bx==null?"null":"Some "+_.printList(function(by){return _0.p$6(by);},bx.$0);};_0.p$7=function(bx){return"Utterance ("+_0.p(bx.$0)+", "+_0.p$3(bx.$1)+", "+_0.p$5(bx.$2)+")";};}());
