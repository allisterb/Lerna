(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.Sex=c.Sex||{};e=c.Address=c.Address||{};f=c.Name=c.Name||{};g=c.User=c.User||{};h=c.Student=c.Student||{};i=c.SymptomEntry=c.SymptomEntry||{};j=b.Web=b.Web||{};k=j.ClientExtensions=j.ClientExtensions||{};l=j._Html=j._Html||{};m=j.htmModule=j.htmModule||{};n=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};o=b.Bootstrap=b.Bootstrap||{};p=o.Controls=o.Controls||{};q=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};r=j.NLU=j.NLU||{};s=r.Intent=r.Intent||{};t=r.Trait=r.Trait||{};u=r.Entity=r.Entity||{};v=r.Utterance=r.Utterance||{};w=r.Question=r.Question||{};x=r.Voice=r.Voice||{};y=x["Entity'"]=x["Entity'"]||{};z=r.Text=r.Text||{};A=z["Utterance'"]=z["Utterance'"]||{};B=z["Intent'"]=z["Intent'"]||{};C=z["Entity'"]=z["Entity'"]||{};D=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};E=j.CUI=j.CUI||{};F=E.MicState=E.MicState||{};G=E.ClientState=E.ClientState||{};H=E.Interpreter=E.Interpreter||{};I=E.CUI=E.CUI||{};J=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};K=j.Main=j.Main||{};L=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};M=j.Client=j.Client||{};N=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};O=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};P=a.IntelliFactory;Q=P&&P.Runtime;R=a.WebSharper;S=R&&R.Strings;T=R&&R.Utils;U=a.console;V=a.jQuery;W=R&&R.Arrays;X=R&&R.List;Y=R&&R.Seq;Z=R&&R.UI;_0=Z&&Z.Doc;_1=Z&&Z.AttrModule;_2=R&&R.JavaScript;_3=_2&&_2.Pervasives;_4=R&&R.Collections;_5=_4&&_4.Map;_6=b&&b.NLU;_7=_6&&_6.Wit;_8=_7&&_7.WitApi;_9=R&&R.Concurrency;_=R&&R.Random;$=R&&R.Operators;ba=R&&R.Remoting;bb=ba&&ba.AjaxRemotingProvider;bc=a.Wit;bd=a.document;be=R&&R.Unchecked;bf=_4&&_4.Dictionary;d.Intersex={$:2};d.Female={$:1};d.Male={$:0};e.New=function(bg,bh){return{Street:bg,Town:bh};};f.New=function(bg,bh,bi){return{Full:bg,First:bh,Last:bi};};g=c.User=Q.Class({toString:function(){return this.Name;}},null,g);g.New=function(bg,bh){return new g({Name:bg,LastLoggedIn:bh});};h.New=function(bg,bh,bi,bj,bk){return{Id:bg,Sex:bh,Name:bi,BirthDate:bj,Address:bk};};i.New=function(bg,bh,bi,bj){return{UserName:bg,Date:bh,Magnitude:bi,Location:bj};};k.s=function(){n.$cctor();return n.s;};k.mdbold=function(){n.$cctor();return n.mdbold;};k.mdbblockquote=function(){n.$cctor();return n.mdbblockquote;};k.mdh3=function(){n.$cctor();return n.mdh3;};k.mdh2=function(){n.$cctor();return n.mdh2;};k.mdh1=function(){n.$cctor();return n.mdh1;};k.replace_tok=function(bg,bh,bi){return S.Replace(bi,bg,bh);};k.toLower=function(bg){return bg.toLowerCase();};k.debug=function(bg,bh){k.info((((Q.Curried3(function(bi,bj,bk){return bi("DEBUG: "+T.toSafe(bj)+": "+T.prettyPrint(bk));}))(a.id))(bg.toUpperCase()))(bh));};k.error=function(bg){U.error(bg);};k.info=function(bg){U.info(bg);};k.jserror=function(bg){V.error(bg);};k.toArray=function(bg){return W.map(a.id,V.makeArray(bg));};k["Terminal.EchoHtml'"]=function(bg,bh){bg.pause();bg.echo(bh,k.rawOpt());bg.resume();};k["Terminal.Echo'"]=function(bg,bh){bg.pause();bg.echo(bh);bg.resume();};k.rawOpt=function(){n.$cctor();return n.rawOpt;};l=j._Html=Q.Class({toString:function(){return l.toString(this);}},null,l);l.toString=function(bg){function bh(bi){return function(bj){var bk,bl,bm,bn,bo,bp,bq;bl=S.replicate(bi," ");switch(bj.$==0?bj.$1.$==1?bj.$1.$0.$==2?bj.$1.$1.$==0?(bk=[bj.$1.$0.$0,bj.$0],1):(bk=[bj.$1,bj.$0],2):(bk=[bj.$1,bj.$0],2):(bk=[bj.$1,bj.$0],2):bj.$==2?(bk=bj.$0,3):(bk=[bj.$0,bj.$1],0)){case 0:return bk[0]+"=\""+bk[1]+"\"";case 1:bm=bk[1];return bl+"<"+bm+">"+bk[0]+"</"+bm+">\r\n";case 2:bn=bk[1];bo=X.partition(function(br){return br.$==1;},bk[0]);bp=bo[1];bq=bo[0];return bp.$==0?bl+"<"+bn+(bq.$===0?"":" "+S.concat(" ",X.ofSeq(Y.delay(function(){return Y.map(function(br){return(bh(0))(br);},bq);}))))+"/>\r\n":bl+"<"+bn+(bq.$===0?"":" "+S.concat(" ",X.ofSeq(Y.delay(function(){return Y.map(function(br){return(bh(0))(br);},bq);}))))+">\r\n"+S.concat("",X.ofSeq(Y.delay(function(){return Y.map(function(br){return(bh(bi+1))(br);},bp);})))+bl+"</"+bn+">\r\n";case 3:return bl+bk+"\r\n";}};}return(bh(0))(bg);};m.alt=function(bg){return new l({$:1,$0:"alt",$1:bg});};m.src=function(bg){return new l({$:1,$0:"src",$1:bg});};m.cls=function(bg){return new l({$:1,$0:"class",$1:bg});};m.str=function(bg){return l.toString(bg);};m.op_PercentEquals=function(bg,bh){return new l({$:1,$0:bg,$1:bh});};m.op_Splice=function(bg){var bh;return X.ofArray([new l({$:2,$0:(bh=bg,a.String(bh))})]);};m.strong=function(){n.$cctor();return n.strong;};m.h4=function(){n.$cctor();return n.h4;};m.h3=function(){n.$cctor();return n.h3;};m.h2=function(){n.$cctor();return n.h2;};m.h1=function(){n.$cctor();return n.h1;};m.li=function(){n.$cctor();return n.li;};m.ul=function(){n.$cctor();return n.ul;};m.th=function(){n.$cctor();return n.th;};m.td=function(){n.$cctor();return n.td;};m.tr=function(){n.$cctor();return n.tr;};m.a=function(){n.$cctor();return n.a;};m.p=function(){n.$cctor();return n.p;};m.area=function(){n.$cctor();return n.area;};m.map=function(){n.$cctor();return n.map;};m.img=function(){n.$cctor();return n.img;};m.tfoot=function(){n.$cctor();return n.tfoot;};m.tbody=function(){n.$cctor();return n.tbody;};m.thead=function(){n.$cctor();return n.thead;};m.table=function(){n.$cctor();return n.table;};m.span=function(){n.$cctor();return n.span;};m.section=function(){n.$cctor();return n.section;};m.br=function(){n.$cctor();return n.br;};m.div=function(){n.$cctor();return n.div;};m.body=function(){n.$cctor();return n.body;};m.style=function(){n.$cctor();return n.style;};m.title=function(){n.$cctor();return n.title;};m.head=function(){n.$cctor();return n.head;};m.html=function(){n.$cctor();return n.html;};m.elem=function(bg,bh){return new l({$:0,$0:bg,$1:bh});};n.$cctor=function(){var bg;n.$cctor=a.ignore;n.rawOpt=(bg={},bg.raw=true,bg);n.mdh1=new a.RegExp("^# (.*$)","gim");n.mdh2=new a.RegExp("^## (.*$)","gim");n.mdh3=new a.RegExp("^### (.*$)","gim");n.mdbblockquote=new a.RegExp("/^\\> (.*$)/","gim");n.mdbold=new a.RegExp("/^\\> (.*$)/","gim");n.s="function parseMarkdown(markdownText) {\r\n        const htmlText = markdownText\r\n        \u0009.replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n        \u0009.replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n        \u0009.replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n        \u0009.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\r\n        \u0009.replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\r\n        \u0009.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\r\n        \u0009.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\r\n        \u0009.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2'>$1</a>\")\r\n        \u0009.replace(/\\n$/gim, '<br />')\r\n        \r\n        return htmlText.trim()\r\n    }\r\n    ";n.html=function(bh){return m.elem("html",bh);};n.head=function(bh){return m.elem("head",bh);};n.title=function(bh){return m.elem("title",bh);};n.style=function(bh){return m.elem("style",bh);};n.body=function(bh){return m.elem("body",bh);};n.div=function(bh){return m.elem("div",bh);};n.br=function(bh){return m.elem("br",bh);};n.section=function(bh){return m.elem("section",bh);};n.span=function(bh){return m.elem("span",bh);};n.table=function(bh){return m.elem("table",bh);};n.thead=function(bh){return m.elem("thead",bh);};n.tbody=function(bh){return m.elem("tbody",bh);};n.tfoot=function(bh){return m.elem("tfoot",bh);};n.img=function(bh){return m.elem("img",bh);};n.map=function(bh){return m.elem("map",bh);};n.area=function(bh){return m.elem("area",bh);};n.p=function(bh){return m.elem("p",bh);};n.a=function(bh){return m.elem("a",bh);};n.tr=function(bh){return m.elem("tr",bh);};n.td=function(bh){return m.elem("td",bh);};n.th=function(bh){return m.elem("th",bh);};n.ul=function(bh){return m.elem("ul",bh);};n.li=function(bh){return m.elem("li",bh);};n.h1=function(bh){return m.elem("h1",bh);};n.h2=function(bh){return m.elem("h1",bh);};n.h3=function(bh){return m.elem("h1",bh);};n.h4=function(bh){return m.elem("h1",bh);};n.strong=function(bh){return m.elem("strong",bh);};};p.Radio=function(bg,bh,bi,bj,bk){return _0.Element("div",new X.T({$:1,$0:(p.cls())("radio"),$1:bh}),[_0.Element("label",bj,[_0.Radio(bk,true,bi),_0.TextNode(bg)])]);};p.Checkbox=function(bg,bh,bi,bj,bk){return _0.Element("div",new X.T({$:1,$0:(p.cls())("checkbox"),$1:bh}),[_0.Element("label",bj,[_0.CheckBox(bk,bi),_0.TextNode(bg)])]);};p.TextArea=function(bg,bh,bi,bj,bk){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bh}),[_0.Element("label",bj,[_0.TextNode(bg)]),_0.InputArea(new X.T({$:1,$0:(p.cls())("form-control"),$1:bk}),bi)]);};p.InputPassword=function(bg,bh,bi,bj,bk){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bh}),[_0.Element("label",bj,[_0.TextNode(bg)]),_0.PasswordBox(new X.T({$:1,$0:(p.cls())("form-control"),$1:bk}),bi)]);};p.Input=function(bg,bh,bi,bj,bk){return _0.Element("div",new X.T({$:1,$0:(p.cls())("form-group"),$1:bh}),[_0.Element("label",bj,[_0.TextNode(bg)]),_0.Input(new X.T({$:1,$0:(p.cls())("form-control"),$1:bk}),bi)]);};p.Container=function(bg){return _0.Element("div",[(p.cls())("container")],bg);};p.Class=function(){q.$cctor();return q.Class;};p.cls=function(){q.$cctor();return q.cls;};q.$cctor=function(){q.$cctor=a.ignore;q.cls=_1.Class;q.Class=_1.Class;};s=r.Intent=Q.Class({toString:function(){return(((Q.Curried3(function(bg,bh,bi){return bg("Intent("+T.toSafe(bh)+", "+O.p$2(bi)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,s);t=r.Trait=Q.Class({toString:function(){return(((Q.Curried3(function(bg,bh,bi){return bg("Trait("+T.toSafe(bh)+", "+T.prettyPrint(bi)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,t);u=r.Entity=Q.Class({toString:function(){return((((Q.Curried(function(bg,bh,bi,bj){return bg("Entity("+T.toSafe(bh)+", "+T.toSafe(bi)+", "+O.p$2(bj)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,u);v=r.Utterance=Q.Class({toString:function(){return((((Q.Curried(function(bg,bh,bi,bj){return bg(O.p(bh)+" "+O.p$3(bi)+" "+O.p$5(bj));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){var bg;bg=this.$2;return bg!=null?{$:1,$0:X.sortBy(function(bh){return bh.get_Name();},bg.$0)}:null;},get_Trait:function(){return this.$1;},get_Intent:function(){return this.$0;}},null,v);w=r.Question=Q.Class({toString:function(){return(((Q.Curried3(function(bg,bh,bi){return bg("Name: "+T.toSafe(bh)+" Text: "+T.toSafe(bi));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);y.New=function(bg,bh,bi,bj,bk){return{body:bg,end:bh,start:bi,suggested:bj,value:bk};};x["Intent'"]=function(bg,bh){return!(bh.intent==null)?{$:1,$0:new s({$:0,$0:k.toLower(bh.intent.value),$1:null})}:null;};x["Trait'"]=function(bg){return!(bg.greetings==null)?{$:1,$0:new t({$:0,$0:"greetings",$1:k.toLower(bg.contact.value)})}:null;};x["Entity'$1"]=function(bg){return!(bg.contact==null)?{$:1,$0:new u({$:0,$0:"contact",$1:k.toLower(bg.contact.value),$2:null})}:null;};A=z["Utterance'"]=Q.Class({get_TopIntent:function(){return X.head(X.sortBy(function(bg){return bg.get_Confidence();},this.get_Intents()));},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,A);B=z["Intent'"]=Q.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);C=z["Entity'"]=Q.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,C);z.HasUtterance=function(bg){var bh,bi,bj,bk,bl,bm;return bg!=null&&bg.$==1&&(bg.$0.$0.$==0&&(bg.$0.$1.get_Length()>0&&(bh=bg.$0.$1,true)))?{$:1,$0:new v({$:0,$0:null,$1:null,$2:{$:1,$0:X.map(function(bn){return new u({$:0,$0:k.toLower(bn.get_Role()),$1:bn.get_Value(),$2:{$:1,$0:bn.get_Confidence()}});},X.filter(function(bn){return bn.get_Confidence()>z.entityConfidenceThreshold();},bh))}})}:bg!=null&&bg.$==1&&(bg.$0.$1.$==0&&(bg.$0.$0.get_Length()>0&&bg.$0.get_TopIntent().get_Confidence()>z.intentConfidenceThreshold()&&(bi=[bg.$0.$0,bg],true)))?(bj=bi[1],{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:k.toLower(bj.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bj.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bg!=null&&bg.$==1&&(bg.$0.$0.get_Length()>0&&bg.$0.$1.get_Length()>0&&bg.$0.get_TopIntent().get_Confidence()>z.intentConfidenceThreshold()&&(bk=[bg.$0.$1,bg.$0.$0,bg],true))?(bl=bk[2],(bm=X.map(function(bn){return new u({$:0,$0:k.toLower(bn.get_Role()),$1:bn.get_Value(),$2:{$:1,$0:bn.get_Confidence()}});},X.filter(function(bn){return bn.get_Confidence()>z.entityConfidenceThreshold();},bl.$0.get_Entities())),{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:k.toLower(bl.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bl.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bm}})})):null;};z.entityConfidenceThreshold=function(){D.$cctor();return D.entityConfidenceThreshold;};z.set_entityConfidenceThreshold=function(bg){D.$cctor();D.entityConfidenceThreshold=bg;};z.intentConfidenceThreshold=function(){D.$cctor();return D.intentConfidenceThreshold;};z.set_intentConfidenceThreshold=function(bg){D.$cctor();D.intentConfidenceThreshold=bg;};z.getUtterance=function(bg,bh){z.witapi().getMeaning(bg,function(bi){k.debug("NLU",(function(bj){return function(bk){return bj("Wit.ai returned: "+T.prettyPrint(bk));};}(a.id))(bi));return bh({$:1,$0:new A({$:0,$0:!(bi.intents==null)?X.ofArray(W.map(function(bj){return new B({$:0,$0:bj.name,$1:bj.confidence});},bi.intents)):X.T.Empty,$1:!(bi.intents==null)?X.ofSeq(Y.concat(X.map(function(bj){return W.map(function(bk){return new C({$:0,$0:bk.name,$1:bk.confidence,$2:bk.role,$3:bk.value});},_3.GetJS(bi.entities,[bj]));},X.filter(function(bj){return!(_3.GetJS(bi.entities,[bj])==null);},z.entity_types())))):X.T.Empty})});},function(bi,bj,bk){k.error((((Q.Curried3(function(bl,bm,bn){return bl("Wit.ai returned: "+T.prettyPrint(bm)+" "+T.prettyPrint(bn));}))(a.id))(bj))(bk));return bh(null);});};z.entity_types=function(){D.$cctor();return D.entity_types;};z.witapi=function(){D.$cctor();return D.witapi;};z.QuickPrograms=function(bg){return bg==="programs"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};z.QuickNumber=function(bg){var bh,bi,bj;return(bi=z.One(bg),bi!=null&&bi.$==1?(bh=bi.$0,true):(bj=z.Two(bg),bj!=null&&bj.$==1&&(bh=bj.$0,true)))?{$:1,$0:bh}:null;};z.Three=function(bg){var bh;return bg==="3"||bg==="three"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};z.Two=function(bg){var bh;return bg==="2"||bg==="two"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};z.One=function(bg){var bh;return bg==="1"||bg==="one"?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:X.ofArray([new u({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};z.QuickNo=function(bg){var bh;return bg==="no"||(bg==="NO"||(bg==="No"||(bg==="nope"||(bg==="no way"||(bg==="nah"||(bg==="don't do it"||bg==="stop"))))))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickYes=function(bg){var bh;return bg==="yes"||(bg==="YES"||(bg==="Yes"||(bg==="YEs"||(bg==="ok"||(bg==="sure"||(bg==="yeah"||(bg==="yep"||(bg==="uh huh"||(bg==="go ahead"||bg==="go")))))))))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickHelp=function(bg){var bh;return bg==="help"||(bg==="help me"||(bg==="what's this?"||bg==="huh"))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.QuickHello=function(bg){var bh;return bg==="hello"||(bg==="hey"||(bg==="yo"||bg==="hi"))?{$:1,$0:new v({$:0,$0:{$:1,$0:new s({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};z.Voices=function(bg){return bg==="voices"?{$:1,$0:null}:null;};z.Debug=function(bg){return bg==="debug"?{$:1,$0:null}:null;};z.Blank=function(bg){return bg===""?{$:1,$0:null}:null;};r.No=function(bg){var bh,bi,bj,bk,bl,bm;return(bi=r.Intent$1("no",bg),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&(bh=bg,true))))?{$:1,$0:bh}:(bk=r.Intent$1("noresponse",bg),bk!=null&&bk.$==1&&(bk.$0[0]==null&&(bk.$0[1]==null&&(bj=bg,true))))?{$:1,$0:bj}:(bm=r.Intent$1("NoResponse",bg),bm!=null&&bm.$==1&&(bm.$0[0]==null&&(bm.$0[1]==null&&(bl=bg,true))))?{$:1,$0:bl}:null;};r.Yes=function(bg){var bh,bi,bj,bk,bl,bm;return(bi=r.Intent$1("yes",bg),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&(bh=bg,true))))?{$:1,$0:bh}:(bk=r.Intent$1("yesresponse",bg),bk!=null&&bk.$==1&&(bk.$0[0]==null&&(bk.$0[1]==null&&(bj=bg,true))))?{$:1,$0:bj}:(bm=r.Intent$1("YesResponse",bg),bm!=null&&bm.$==1&&(bm.$0[0]==null&&(bm.$0[1]==null&&(bl=bg,true))))?{$:1,$0:bl}:null;};r.EntityManyofMany=function(bg,bh){return{$:1,$0:_5.OfArray(W.ofSeq(X.map(function(bi){return X.exists(function(bj){return bj.get_Name()===bi;},bh)?[bi,{$:1,$0:X.filter(function(bj){return bj.get_Name()===bi;},bh)}]:[bi,null];},bg)))};};r.EntityManyOf1=function(bg,bh){var bi;return bh!=null&&bh.$==1&&(X.exists(function(bj){return bj.get_Name()===bg;},bh.$0)&&(bi=bh.$0,true))?{$:1,$0:X.filter(function(bj){return bj.get_Name()===bg;},bi)}:null;};r.Entity1OfAny=function(bg,bh){var bi;return bh!=null&&bh.$==1&&(X.exists(function(bj){return bj.get_Name()===bg;},bh.$0)&&(bi=bh.$0,true))?{$:1,$0:X.head(X.sortBy(function(bj){return bj.get_Name();},X.filter(function(bj){return bj.get_Name()===bg;},bi)))}:null;};r.Entity1Of1=function(bg,bh){var bi;return bh!=null&&bh.$==1&&(bh.$0.$==1&&(bh.$0.$1.$==0&&(bh.$0.$0.get_Name()===bg&&(bi=bh.$0.$0,true))))?{$:1,$0:bi}:null;};r.Intent$1=function(bg,bh){return bh.get_Intent()!=null&&bh.get_Intent().$0.get_Name()===bg?{$:1,$0:[bh.get_Trait(),bh.get_Entities()]}:null;};D.$cctor=function(){D.$cctor=a.ignore;D.witapi=new _8.New("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");D.entity_types=X.ofArray(["wit$contact:contact","wit$datetime:datetime","symptom_name:symptom_name"]);D.intentConfidenceThreshold=0.85;D.entityConfidenceThreshold=0.85;};F.MicReady={$:5};F.MicAudioEnd={$:4};F.MicAudioStart={$:3};F.MicDisconnected={$:2};F.MicConnecting={$:1};F.MicNotInitialized={$:0};G.ClientUnderstand={$:2};G.ClientReady={$:1};G.ClientNotInitialzed={$:0};H=E.Interpreter=Q.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,H);I=E.CUI=Q.Class({SayVoices:function(){var bg,bh,bi;bg=this;bh=a.speechSynthesis.getVoices();!(bh==null)?(bi=k.toArray(bh),bg.Say((function(bj){return function(bk){return bj("There are currently "+a.String(bk)+" voices installed on this computer or device.");};}(a.id))(W.length(bi))),W.iteri(function(bj,bk){return bg.Say(((((Q.Curried(function(bl,bm,bn,bo){return bl("Voice "+a.String(bm)+". Name: "+T.toSafe(bn)+", Local: "+T.prettyPrint(bo)+".");},4))(a.id))(bj))(bk.name))(bk.localService));},bi)):void 0;},Wait:function(bg){this.Wait$1(function(){_9.Start(bg,null);});},Wait$1:function(bg){this["Echo'"]("please wait...");this.Term.pause();bg();this.Term.resume();},sayRandom:function(bg,bh){this.Say(E.getRandomPhrase(bg,bh));},Say:function(bg){var bh,bi;bh=this;_9.Start((bi=null,_9.Delay(function(){bh.Avatar.addMessage(bg);bh.Avatar.processMessages(0);return _9.Zero();})),null);},Debug:function(bg,bh){k.debug(bg,bh);},"EchoHtml'":function(bg){var bh,bi;bh=(bi={},bi.raw=true,bi);this.Term.disable();this.Term.echo(bg,bh);this.Term.enable();},"Echo'":function(bg){this.Term.disable();this.Term.echo(bg);this.Term.enable();}},null,I);I.New=function(bg,bh,bi,bj,bk){return new I({Voice:bg,Mic:bh,Term:bi,Avatar:bj,Caption:bk});};E.waitAddPhrases=function(){J.$cctor();return J.waitAddPhrases;};E.waitRetrievePhrases=function(){J.$cctor();return J.waitRetrievePhrases;};E.helpPhrases=function(){J.$cctor();return J.helpPhrases;};E.helloUserPhrases=function(){J.$cctor();return J.helloUserPhrases;};E.helloPhrases=function(){J.$cctor();return J.helloPhrases;};E["getRandomPhrase'"]=function(bg){return k.replace_tok("$0","",Y.nth(E.rng().Next(0,bg.get_Length()),bg));};E.getRandomPhrase=function(bg,bh){return k.replace_tok("$0",bh,Y.nth(E.rng().Next(0,bg.get_Length()),bg));};E.rng=function(){J.$cctor();return J.rng;};J.$cctor=function(){J.$cctor=a.ignore;J.rng=new _.New();J.helloPhrases=X.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);J.helloUserPhrases=X.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0."]);J.helpPhrases=X.ofArray(["What can I help you with $0?"]);J.waitRetrievePhrases=X.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);J.waitAddPhrases=X.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0."]);};K.update=function(bg,bh,bi,bj,bk){var bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;function b$(ct){bg.Say(ct);}function ca(ct){bj.unshift(ct);b$(ct);}function cb(ct,cu){var cv;cv=E.getRandomPhrase(ct,cu);bj.unshift(cv);return bg.Say(cv);}function cc(ct){return bh.ContainsKey(ct);}function cd(ct,cu){return bh.Add(ct,cu);}function ce(ct){bh.Remove(ct);}function cf(){return bh.get_Item("user");}function cg(){bk.shift();}function ch(){bi.shift();}function ci(ct){var cu;cu=K.getQuestion(ct);cu==null?(function(cv){return function(cw){return cv("No such question: "+T.toSafe(cw));};}($.FailWith))(ct):bi.unshift(cu.$0);}function cj(ct,cu){cd(ct,cu);ci(ct);K.debug((function(cv){return function(cw){return cv("Added question: "+O.p$8(cw)+".");};}(a.id))(bi[0]));return ca(k.replace_tok("$0",cu,K.getQuestion(ct).$0.get_Text()));}function ck(ct,cu){return cc(ct)?{$:1,$0:cu}:null;}function cl(ct,cu){return!cc(ct)?{$:1,$0:cu}:null;}function cm(ct){var cu,cv;return(cv=ck("user",ct),cv!=null&&cv.$==1&&(bi.length===0&&(cu=cv.$0,true)))?(cg(),{$:1,$0:cu}):null;}function cn(ct,cu){var cv,cw,cx;return(cw=ck("user",cu),cw!=null&&cw.$==1&&(K.haveQuestion(ct)&&bi.length>0&&bi[0].get_Name()===ct&&(cv=cw.$0,true)))?(cg(),ch(),cc(ct)?(cx=bh.get_Item(ct),(ce(ct),{$:1,$0:[cv,{$:1,$0:cx}]})):{$:1,$0:[cv,null]}):null;}function co(ct,cu){var cv,cw,cx;return(cw=cl("user",cu),cw!=null&&cw.$==1&&(K.haveQuestion(ct)&&bi.length>0&&bi[0].get_Name()===ct&&(cv=cw.$0,true)))?(cg(),ch(),cc(ct)?(cx=bh.get_Item(ct),(ce(ct),{$:1,$0:[cv,{$:1,$0:cx}]})):{$:1,$0:[cv,null]}):null;}function cp(ct){var cu,cv;return(cv=cl("user",ct),cv!=null&&cv.$==1&&(bi.length===0&&(cu=cv.$0,true)))?(cg(),{$:1,$0:cu}):null;}function cq(ct){var cu;return ct!=null&&ct.$==1&&(typeof ct.$0=="string"&&(cu=ct.$0,true))?{$:1,$0:cu}:null;}function cr(ct,cu,cv){var cw;return _9.Start((cw=null,_9.Delay(function(){cb(E.waitAddPhrases(),"symptom entry");return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.addSymptomJournalEntry:-1360993005",[cf().Name,ct,cu,cv]),function(cx){return cx==null?(ca(function(cy){return cy("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),_9.Zero()):(ca((function(cy){return function(cz){return cy("OK I added that "+T.toSafe(cz)+" symptom to your journal.");};}(a.id))(ct)),_9.Zero());});})),null);}function cs(ct){var cu;cu=null;return _9.Delay(function(){cb(E.waitRetrievePhrases(),"symptom journal");return(new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getSymptomJournal:957773243",[ct]);});}K.debug((((Q.Curried3(function(ct,cu,cv){return ct("Starting utterances:"+T.prettyPrint(cu)+". Starting questions: "+T.prettyPrint(cv)+".");}))(a.id))(bk))(bi));bl=X.ofSeq(Y.take(bk.length>=5?5:bk.length,bk));bl.$==1&&(bn=(bo=cl("started",bl.$0),bo!=null&&bo.$==1?{$:1,$0:bo.$0}:null),bn!=null&&bn.$==1&&(bp=cp(bn.$0),bp!=null&&bp.$==1&&(bq=r.Intent$1("hello",bp.$0),bq!=null&&bq.$==1&&(bq.$0[1]==null&&bl.$1.$==0))))?(bh.Add("started",true),cb(E.helloPhrases(),"")):bl.$==1&&(bs=cp(bl.$0),bs!=null&&bs.$==1&&(bt=r.Intent$1("hello",bs.$0),bt!=null&&bt.$==1&&(bt.$0[1]==null&&bl.$1.$==0)))?ca("Hello, tell me your name to get started."):bl.$==1&&(bv=cp(bl.$0),bv!=null&&bv.$==1&&(bw=r.Intent$1("hello",bv.$0),bw!=null&&bw.$==1&&(bx=r.Entity1Of1("contact",bw.$0[1]),bx!=null&&bx.$==1&&(bl.$1.$==0&&(bu=bx.$0,true)))))?(by=bu.get_Value(),cb(E.waitRetrievePhrases(),"user name"),_9.Start((bz=null,_9.Delay(function(){return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1592123943",[by]),function(ct){var cu;return ct==null?(ca((function(cv){return function(cw){return cv("I did not find a user with the name "+T.toSafe(cw)+".");};}(a.id))(by)),cj("addUser",by),_9.Zero()):(cu=ct.$0,_9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:-344718190",[cu.Name]),function(){bh.Add("user",cu);cb(E.helloUserPhrases(),(function(cv){return function(cw){return cv(T.prettyPrint(cw));};}(a.id))(bh.get_Item("user")));return cu.LastLoggedIn!=null?_9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:545992213",[cu.LastLoggedIn.$0]),function(cv){ca((function(cw){return function(cx){return cw("You last logged in "+T.toSafe(cx)+".");};}(a.id))(cv));return _9.Zero();}):_9.Zero();}));});})),null)):bl.$==1&&(bB=r.Yes(bl.$0),bB!=null&&bB.$==1&&(bC=co("addUser",bB.$0),bC!=null&&bC.$==1&&(bD=cq(bC.$0[1]),bD!=null&&bD.$==1&&(bl.$1.$==0&&(bA=bD.$0,true)))))?_9.Start((bE=null,_9.Delay(function(){cb(E.waitAddPhrases(),"user");return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:-344718190",[bA]),function(ct){return ct==null?(ca((function(cu){return function(cv){return cu("Sorry I was not able to add the user "+T.toSafe(cv)+" to the system.");};}(a.id))(bA)),_9.Zero()):(cd("user",bA),ca((function(cu){return function(cv){return cu("Hello "+T.prettyPrint(cv)+", nice to meet you.");};}(a.id))(bh.get_Item("user"))),_9.Zero());});})),null):bl.$==1&&(bG=r.No(bl.$0),bG!=null&&bG.$==1&&(bH=co("addUser",bG.$0),bH!=null&&bH.$==1&&(bI=cq(bH.$0[1]),bI!=null&&bI.$==1&&(bl.$1.$==0&&(bF=bI.$0,true)))))?ca((function(ct){return function(cu){return ct("Ok I did not add the user "+T.toSafe(cu)+". But you must login for me to help you.");};}(a.id))(bF)):bl.$==1&&((bK=cp(bl.$0),bK!=null&&bK.$==1)&&bl.$1.$==0)?ca("Could you introduce yourself so we can get started?"):bl.$==1&&(bM=cm(bl.$0),bM!=null&&bM.$==1&&(bN=r.Intent$1("hello",bM.$0),bN!=null&&bN.$==1&&(bN.$0[0]==null&&(bO=r.Entity1Of1("contact",bN.$0[1]),bO!=null&&bO.$==1&&(bl.$1.$==0&&(bL=bO.$0,true))))))?_9.Start((bP=null,_9.Delay(function(){return _9.Bind((new bb.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:1592123943",[bL.get_Value()]),function(ct){return ct==null?(ca((function(cu){return function(cv){return cu("Sorry, the user "+T.toSafe(cv)+" does not exist.");};}(a.id))(bL.get_Value())),_9.Zero()):(cj("switchUser",ct.$0.Name),_9.Zero());});})),null):bl.$==1&&(bR=r.Yes(bl.$0),bR!=null&&bR.$==1&&(bS=cn("switchUser",bR.$0),bS!=null&&bS.$==1&&(bT=cq(bS.$0[1]),bT!=null&&bT.$==1&&(bl.$1.$==0&&(bQ=bT.$0,true)))))?(bh.set_Item("user",bQ),ca((function(ct){return function(cu){return ct("Ok I switched to user "+T.prettyPrint(cu)+".");};}(a.id))(bQ))):bl.$==1&&(bV=r.No(bl.$0),bV!=null&&bV.$==1&&(bW=cn("switchUser",bV.$0),bW!=null&&bW.$==1&&(bX=cq(bW.$0[1]),bX!=null&&bX.$==1&&(bl.$1.$==0&&(bU=bX.$0,true)))))?ca((function(ct){return function(cu){return ct("Ok I did not switch to user "+T.toSafe(cu)+".");};}(a.id))(bU)):bl.$==1&&(bZ=cm(bl.$0),bZ!=null&&bZ.$==1&&(b0=r.Intent$1("symptom",bZ.$0),b0!=null&&b0.$==1&&(b1=r.Entity1OfAny("symptom_name",b0.$0[1]),b1!=null&&b1.$==1&&(bl.$1.$==0&&(bY=b1.$0,true)))))?_9.Start((b2=null,_9.Delay(function(){ca("Ok I'll add that entry to your symptom journal");cr(bY.get_Value(),null,null);return _9.Bind(cs(cf().Name),function(){cj("painVideo","");return _9.Zero();});})),null):bl.$==1&&(b4=r.Yes(bl.$0),b4!=null&&b4.$==1&&((b5=cn("painVideo",b4.$0),b5!=null&&b5.$==1)&&bl.$1.$==0))?bg["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bl.$==1&&(b7=cm(bl.$0),b7!=null&&b7.$==1&&(b8=r.Intent$1("medjournal",b7.$0),b8!=null&&b8.$==1&&((b9=b8.$0[1],b9!=null&&b9.$==1)&&(bl.$1.$==0&&(b6=b8.$0[1].$0,true)))))?(ca("ok I added that entry to your medication journal."),ca("You should be careful not to take too many painkillers over a short period of time.")):(cg(),K.debug("Main interpreter did not understand utterance."),ca("Sorry I didn't understand what you meant."),bi.length>0?(b_=Y.nth(0,bi),cc(b_.get_Name())?ca(k.replace_tok("$0",bh.get_Item(b_.get_Name()),b_.get_Text())):ca(b_.get_Text())):void 0);K.debug((((Q.Curried3(function(ct,cu,cv){return ct("Ending utterances: "+T.prettyPrint(cu)+". Ending questions:"+T.prettyPrint(cv)+".");}))(a.id))(bk))(bi));};K.haveQuestion=function(bg){return X.exists(function(bh){return bh.get_Name()===bg;},K.questions());};K.getQuestion=function(bg){return Y.tryFind(function(bh){return bh.get_Name()===bg;},K.questions());};K.questions=function(){L.$cctor();return L.questions;};K.debug=function(bg){k.debug("Main",bg);};L.$cctor=function(){L.$cctor=a.ignore;L.questions=X.ofArray([new w({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new w({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new w({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new w({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new w({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};M.run=function(){var bg,bh;bg=Q.ThisFunc(function(bi,bj){return((M.Main().get_Text())(bi))(bj);});bh=M.Main().get_Options();a.$("#main").terminal(bg,bh);return _0.get_Empty();};M.Main=function(){N.$cctor();return N.Main;};M.initMic=function(bg){var bh,bi;M.set_CUI((bh={$:1,$0:new bc.Microphone(bd.getElementById("microphone"))},I.New(M.CUI().Voice,bh,M.CUI().Term,M.CUI().Avatar,M.CUI().Caption)));bi=M.CUI().Mic.$0;bi.onconnecting=function(){M.set_MicState(F.MicConnecting);return M.debug("Mic connecting...");};bi.ondisconnected=function(){M.set_MicState(F.MicDisconnected);return M.debug("Mic disconnected.");};bi.onaudiostart=function(){M.set_MicState(F.MicAudioStart);return M.debug("Mic audio start...");};bi.onaudioend=function(){M.set_MicState(F.MicAudioEnd);return M.debug("Mic audio end.");};bi.onerror=function(bj){M.set_MicState({$:6,$0:bj});return M.debug((function(bk){return function(bl){return bk("Mic error : "+T.toSafe(bl)+".");};}(a.id))(bj));};bi.onready=function(){M.set_MicState(F.MicReady);return M.debug("Mic ready.");};bi.onresult=function(bj,bk){return M.ClientState().$==2?M.echo("I'm still trying to understand what you said before."):M.ClientState().$==0?k.error("Client is not intialized."):!(bj==null||bk==null)?(M.set_MicState({$:7,$0:bj,$1:bk}),M.debug((((Q.Curried3(function(bl,bm,bn){return bl("Mic result: "+T.prettyPrint(bm)+" "+T.prettyPrint(bn)+".");}))(a.id))(bj))(bk)),bg(bi,[bj,bk])):M.debug("Mic: No result returned.");};bi.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};M.sayRandom=function(bg,bh){M.say(E.getRandomPhrase(bh,bg));};M.sayVoices=function(){var bg;bg=k.toArray(a.speechSynthesis.getVoices());M["say'"]((function(bh){return function(bi){return bh("There are currently "+a.String(bi)+" voices installed on this computer or device.");};}(a.id))(W.length(bg)));W.iteri(function(bh,bi){return M["say'"](((((Q.Curried(function(bj,bk,bl,bm){return bj("Voice "+a.String(bk)+". Name: "+T.toSafe(bl)+", Local: "+T.prettyPrint(bm)+".");},4))(a.id))(bh))(bi.name))(bi.localService));},bg);};M.say=function(bg){M.Responses().unshift(bg);M["say'"](bg);};M["say'"]=function(bg){M.CUI().Say(bg);};M.initSpeech=function(){var bg,bh;bg=k.toArray(M.synth().getVoices());W.length(bg)>0?(bh=W.find(function(bi){return bi["default"];},bg),M.set_CUI(I.New({$:1,$0:bh},M.CUI().Mic,M.CUI().Term,M.CUI().Avatar,M.CUI().Caption)),M.debug((function(bi){return function(bj){return bi("Using default voice "+T.toSafe(bj)+".");};}(a.id))(M.CUI().Voice.$0.name)),M.CUI().Avatar.nativeVoice=true,M.CUI().Avatar.nativeVoiceName=bh.name):M.echo("No speech synthesis voice is available.");};M.synth=function(){N.$cctor();return N.synth;};M.push=function(bg){M.Utterances().unshift(bg);return M.Utterances();};M.Props=function(){N.$cctor();return N.Props;};M.Responses=function(){N.$cctor();return N.Responses;};M.Questions=function(){N.$cctor();return N.Questions;};M.Utterances=function(){N.$cctor();return N.Utterances;};M.wait=function(bg){k["Terminal.Echo'"](M.CUI().Term,"please wait");M.CUI().Term.pause();bg();M.CUI().Term.resume();};M.debug=function(bg){k.debug("CLIENT",bg);};M.echo=function(bg){if(!(M.CUI().Term==null))k["Terminal.EchoHtml'"](M.CUI().Term,(function(bh){return function(bi){return bh(T.prettyPrint(bi));};}(a.id))(bg));};M.ClientState=function(){N.$cctor();return N.ClientState;};M.set_ClientState=function(bg){N.$cctor();N.ClientState=bg;};M.MicState=function(){N.$cctor();return N.MicState;};M.set_MicState=function(bg){N.$cctor();N.MicState=bg;};M.CUI=function(){N.$cctor();return N.CUI;};M.set_CUI=function(bg){N.$cctor();N.CUI=bg;};N.$cctor=function(){var bg,bh,bi,bj;N.$cctor=a.ignore;function bk(bm,bn){var bo,bp,bq,br,bs,bt,bu,bv,bw,bx;bo=bn[0];bp=bn[1];M.debug((((Q.Curried3(function(by,bz,bA){return by("Voice: "+T.prettyPrint(bz)+" "+T.prettyPrint(bA));}))(a.id))(bo))(bp));bq=(br=x["Intent'"](bo,bp),br!=null&&br.$==1?{$:1,$0:br.$0}:null);bs=(bt=x["Trait'"](bp),bt!=null&&bt.$==1?{$:1,$0:bt.$0}:null);bu=(bv=x["Entity'$1"](bp),bv!=null&&bv.$==1?{$:1,$0:X.ofArray([bv.$0])}:null);return bq==null&&(bs==null&&bu==null)?null:(M.debug(((((Q.Curried(function(by,bz,bA,bB){return by("Voice: "+O.p(bz)+" "+O.p$3(bA)+" "+O.p$5(bB));},4))(a.id))(bq))(bs))(bu)),bx=M.push(new v({$:0,$0:bq,$1:bs,$2:bu})),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bx));}function bl(bm,bn){var bo,bp,bq,br,bs,bt,bu,bv,bw,bx;M.set_CUI(I.New(M.CUI().Voice,M.CUI().Mic,bm,M.CUI().Avatar,M.CUI().Caption));be.Equals(M.CUI().Mic,null)?M.initMic(bk):void 0;be.Equals(M.CUI().Voice,null)?M.initSpeech():void 0;M.ClientState().$===0?M.set_ClientState(G.ClientReady):void 0;return(bo=z.Blank(bn),bo!=null&&bo.$==1)?M["say'"]("Tell me what you want me to do or ask me a question."):(bp=z.Debug(bn),bp!=null&&bp.$==1)?(M.debug((function(by){return function(bz){return by("Utterances: "+T.prettyPrint(bz));};}(a.id))(M.Utterances())),M.debug((function(by){return function(bz){return by("Questions: "+T.prettyPrint(bz));};}(a.id))(M.Questions()))):(bq=z.Voices(bn),bq!=null&&bq.$==1)?M.sayVoices():M.ClientState().$==1?(bs=z.QuickHello(bn),bs!=null&&bs.$==1?(br=bs.$0,true):(bt=z.QuickHelp(bn),bt!=null&&bt.$==1?(br=bt.$0,true):(bu=z.QuickYes(bn),bu!=null&&bu.$==1?(br=bu.$0,true):(bv=z.QuickNo(bn),bv!=null&&bv.$==1&&(br=bv.$0,true)))))?(M.debug((function(by){return function(bz){return by("Quick Text: "+O.p$7(bz)+".");};}(a.id))(br)),bw=M.push(br),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bw),M.set_ClientState(G.ClientReady)):M.CUI().Wait((bx=null,_9.Delay(function(){M.set_ClientState(G.ClientUnderstand);z.getUtterance(bn,function(by){var bz,bA,bB;bz=z.HasUtterance(by);bz!=null&&bz.$==1?(bA=bz.$0,M.debug(((((Q.Curried(function(bC,bD,bE,bF){return bC("Text: "+O.p(bD)+" "+O.p$3(bE)+" "+O.p$5(bF));},4))(a.id))(bA.get_Intent()))(bA.get_Trait()))(bA.get_Entities())),bB=M.push(bA),K.update(M.CUI(),M.Props(),M.Questions(),M.Responses(),bB)):(M.debug("Text: Did not receive a meaning from the server."),M["say'"]("Sorry I did not understand what you said."));});M.set_ClientState(G.ClientReady);return _9.Zero();}))):M.ClientState().$==0?k.error("Client is not initialized."):M["say'"]("I'm still trying to understand what you said before.");}N.CUI=I.New(null,null,null,(a.SDK.applicationId="4277115329081938617",bg=new a.SDKConnection(),bh=new a.WebAvatar(),bh.version=8.5,bh.connection=bg,bh.avatar="22225225",bh.voice="cmu-slt",bh.voiceMod="default",bi=k.toArray(a.speechSynthesis.getVoices()),W.length(bi)>0?U.info(W.find(function(bm){return bm["default"];},bi).name):void 0,bh.width=300,bh.createBox(),bh.addMessage(""),bh.processMessages(0),bh),false);N.MicState=F.MicNotInitialized;N.ClientState=G.ClientNotInitialzed;N.Utterances=[];N.Questions=[];N.Responses=[];N.Props=new bf.New$5();N.synth=a.speechSynthesis;N.Main=new H({$:0,$0:function(bm){return function(bn){return bk(bm,bn);};},$1:[function(bm){return function(bn){return bl(bm,bn);};},(bj={},bj.name="Main",bj.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech recognition, or enter help for more assistance.",bj.prompt=">",bj)]});};O.p$8=function(bg){return"Question ("+T.prettyPrint(bg.$0)+", "+T.prettyPrint(bg.$1)+")";};O.p$2=function(bg){return bg==null?"null":"Some "+T.prettyPrint(bg.$0);};O.p$1=function(bg){return"Intent ("+T.prettyPrint(bg.$0)+", "+O.p$2(bg.$1)+")";};O.p=function(bg){return bg==null?"null":"Some "+O.p$1(bg.$0);};O.p$4=function(bg){return"Trait ("+T.prettyPrint(bg.$0)+", "+T.prettyPrint(bg.$1)+")";};O.p$3=function(bg){return bg==null?"null":"Some "+O.p$4(bg.$0);};O.p$6=function(bg){return"Entity ("+T.prettyPrint(bg.$0)+", "+T.prettyPrint(bg.$1)+", "+O.p$2(bg.$2)+")";};O.p$5=function(bg){return bg==null?"null":"Some "+T.printList(function(bh){return O.p$6(bh);},bg.$0);};O.p$7=function(bg){return"Utterance ("+O.p(bg.$0)+", "+O.p$3(bg.$1)+", "+O.p$5(bg.$2)+")";};}());
