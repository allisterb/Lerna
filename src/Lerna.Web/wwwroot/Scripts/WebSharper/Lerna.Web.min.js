(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp;a=self;b=a.Lerna=a.Lerna||{};c=b.Models=b.Models||{};d=c.NLUResponse=c.NLUResponse||{};e=c.Trait=c.Trait||{};f=c.Entity=c.Entity||{};g=c.Sex=c.Sex||{};h=c.Address=c.Address||{};i=c.Name=c.Name||{};j=c.User=c.User||{};k=c.Student=c.Student||{};l=c.StudyJournalEntry=c.StudyJournalEntry||{};m=b.Web=b.Web||{};n=m.ClientExtensions=m.ClientExtensions||{};o=m._Html=m._Html||{};p=m.htmModule=m.htmModule||{};q=a.StartupCode$Lerna_Web$ClientExtensions=a.StartupCode$Lerna_Web$ClientExtensions||{};r=b.Bootstrap=b.Bootstrap||{};s=r.Controls=r.Controls||{};t=a.StartupCode$Lerna_Web$Bootstrap=a.StartupCode$Lerna_Web$Bootstrap||{};u=m.NLU=m.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.Question=u.Question||{};A=u.Voice=u.Voice||{};B=A["Entity'"]=A["Entity'"]||{};C=u.Text=u.Text||{};D=C["Utterance'"]=C["Utterance'"]||{};E=C["Intent'"]=C["Intent'"]||{};F=C["Entity'"]=C["Entity'"]||{};G=C["Trait'"]=C["Trait'"]||{};H=u.Domain=u.Domain||{};I=a.StartupCode$Lerna_Web$NLU=a.StartupCode$Lerna_Web$NLU||{};J=m.CUI=m.CUI||{};K=J.MicState=J.MicState||{};L=J.ClientState=J.ClientState||{};M=J.Interpreter=J.Interpreter||{};N=J.CUI=J.CUI||{};O=a.StartupCode$Lerna_Web$CUI=a.StartupCode$Lerna_Web$CUI||{};P=m.Main=m.Main||{};Q=a.StartupCode$Lerna_Web$Main=a.StartupCode$Lerna_Web$Main||{};R=m.Study=m.Study||{};S=a.StartupCode$Lerna_Web$Study=a.StartupCode$Lerna_Web$Study||{};T=m.Client=m.Client||{};U=a.StartupCode$Lerna_Web$Client=a.StartupCode$Lerna_Web$Client||{};V=a.Lerna$Web_GeneratedPrintf=a.Lerna$Web_GeneratedPrintf||{};W=a.IntelliFactory;X=W&&W.Runtime;Y=a.WebSharper;Z=Y&&Y.Strings;_0=Y&&Y.Utils;_1=a.console;_2=a.jQuery;_3=Y&&Y.Arrays;_4=Y&&Y.List;_5=Y&&Y.Seq;_6=Y&&Y.UI;_7=_6&&_6.Doc;_8=_6&&_6.AttrModule;_9=Y&&Y.Collections;_=_9&&_9.Map;$=Y&&Y.ClientSideJson;ba=$&&$.Provider;bb=Y&&Y.JavaScript;bc=bb&&bb.Pervasives;bd=b&&b.NLU;be=bd&&bd.Wit;bf=be&&be.WitApi;bg=Y&&Y.Concurrency;bh=Y&&Y.Random;bi=Y&&Y.Operators;bj=Y&&Y.Remoting;bk=bj&&bj.AjaxRemotingProvider;bl=a.Wit;bm=a.document;bn=Y&&Y.Unchecked;bo=bd&&bd.QnAMaker;bp=_9&&_9.Dictionary;d.New=function(bq,br,bs,bt,bu,bv){return{type:bq,msg:br,action:bs,traits:bt,entities:bu,confidence:bv};};e.New=function(bq,br,bs){return{id:bq,value:br,confidence:bs};};f.New=function(bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA){return{id:bq,name:br,role:bs,start:bt,end:bu,body:bv,confidence:bw,entities:bx,suggested:by,value:bz,type:bA};};g.Intersex={$:2};g.Female={$:1};g.Male={$:0};h.New=function(bq,br){return{Street:bq,Town:br};};i.New=function(bq,br,bs){return{Full:bq,First:br,Last:bs};};j=c.User=X.Class({toString:function(){return this.Name;}},null,j);j.New=function(bq,br){return new j({Name:bq,LastLoggedIn:br});};k.New=function(bq,br,bs,bt,bu){return{Id:bq,Sex:br,Name:bs,BirthDate:bt,Address:bu};};l.New=function(bq,br,bs,bt){return{UserName:bq,Date:br,Subject:bs,Duration:bt};};n.scriptmd=function(){q.$cctor();return q.scriptmd;};n.mdbold=function(){q.$cctor();return q.mdbold;};n.mdbblockquote=function(){q.$cctor();return q.mdbblockquote;};n.mdh3=function(){q.$cctor();return q.mdh3;};n.mdh2=function(){q.$cctor();return q.mdh2;};n.mdh1=function(){q.$cctor();return q.mdh1;};n.replace_tok=function(bq,br,bs){return Z.Replace(bs,bq,br);};n.toLower=function(bq){return bq.toLowerCase();};n.debug=function(bq,br){n.info((((X.Curried3(function(bs,bt,bu){return bs("DEBUG: "+_0.toSafe(bt)+": "+_0.prettyPrint(bu));}))(a.id))(bq.toUpperCase()))(br));};n.error=function(bq){_1.error(bq);};n.info=function(bq){_1.info(bq);};n.jserror=function(bq){_2.error(bq);};n.toArray=function(bq){return _3.map(a.id,_2.makeArray(bq));};n["Terminal.EchoHtml'"]=function(bq,br){bq.pause();bq.echo(br,n.rawOpt());bq.resume();};n["Terminal.Echo'"]=function(bq,br){bq.pause();bq.echo(br);bq.resume();};n.rawOpt=function(){q.$cctor();return q.rawOpt;};o=m._Html=X.Class({toString:function(){return o.toString(this);}},null,o);o.toString=function(bq){function br(bs){return function(bt){var bu,bv,bw,bx,by,bz,bA;bv=Z.replicate(bs," ");switch(bt.$==0?bt.$1.$==1?bt.$1.$0.$==2?bt.$1.$1.$==0?(bu=[bt.$1.$0.$0,bt.$0],1):(bu=[bt.$1,bt.$0],2):(bu=[bt.$1,bt.$0],2):(bu=[bt.$1,bt.$0],2):bt.$==2?(bu=bt.$0,3):(bu=[bt.$0,bt.$1],0)){case 0:return bu[0]+"=\""+bu[1]+"\"";case 1:bw=bu[1];return bv+"<"+bw+">"+bu[0]+"</"+bw+">\r\n";case 2:bx=bu[1];by=_4.partition(function(bB){return bB.$==1;},bu[0]);bz=by[1];bA=by[0];return bz.$==0?bv+"<"+bx+(bA.$===0?"":" "+Z.concat(" ",_4.ofSeq(_5.delay(function(){return _5.map(function(bB){return(br(0))(bB);},bA);}))))+"/>\r\n":bv+"<"+bx+(bA.$===0?"":" "+Z.concat(" ",_4.ofSeq(_5.delay(function(){return _5.map(function(bB){return(br(0))(bB);},bA);}))))+">\r\n"+Z.concat("",_4.ofSeq(_5.delay(function(){return _5.map(function(bB){return(br(bs+1))(bB);},bz);})))+bv+"</"+bx+">\r\n";case 3:return bv+bu+"\r\n";}};}return(br(0))(bq);};p.alt=function(bq){return new o({$:1,$0:"alt",$1:bq});};p.src=function(bq){return new o({$:1,$0:"src",$1:bq});};p.cls=function(bq){return new o({$:1,$0:"class",$1:bq});};p.str=function(bq){return o.toString(bq);};p.op_PercentEquals=function(bq,br){return new o({$:1,$0:bq,$1:br});};p.op_Splice=function(bq){var br;return _4.ofArray([new o({$:2,$0:(br=bq,a.String(br))})]);};p.strong=function(){q.$cctor();return q.strong;};p.h4=function(){q.$cctor();return q.h4;};p.h3=function(){q.$cctor();return q.h3;};p.h2=function(){q.$cctor();return q.h2;};p.h1=function(){q.$cctor();return q.h1;};p.li=function(){q.$cctor();return q.li;};p.ul=function(){q.$cctor();return q.ul;};p.th=function(){q.$cctor();return q.th;};p.td=function(){q.$cctor();return q.td;};p.tr=function(){q.$cctor();return q.tr;};p.a=function(){q.$cctor();return q.a;};p.p=function(){q.$cctor();return q.p;};p.area=function(){q.$cctor();return q.area;};p.map=function(){q.$cctor();return q.map;};p.img=function(){q.$cctor();return q.img;};p.tfoot=function(){q.$cctor();return q.tfoot;};p.tbody=function(){q.$cctor();return q.tbody;};p.thead=function(){q.$cctor();return q.thead;};p.table=function(){q.$cctor();return q.table;};p.span=function(){q.$cctor();return q.span;};p.section=function(){q.$cctor();return q.section;};p.br=function(){q.$cctor();return q.br;};p.div=function(){q.$cctor();return q.div;};p.body=function(){q.$cctor();return q.body;};p.style=function(){q.$cctor();return q.style;};p.title=function(){q.$cctor();return q.title;};p.head=function(){q.$cctor();return q.head;};p.html=function(){q.$cctor();return q.html;};p.elem=function(bq,br){return new o({$:0,$0:bq,$1:br});};q.$cctor=function(){var bq;q.$cctor=a.ignore;q.rawOpt=(bq={},bq.raw=true,bq);q.mdh1=new a.RegExp("^# (.*$)","gim");q.mdh2=new a.RegExp("^## (.*$)","gim");q.mdh3=new a.RegExp("^### (.*$)","gim");q.mdbblockquote=new a.RegExp("/^\\> (.*$)/","gim");q.mdbold=new a.RegExp("/^\\> (.*$)/","gim");q.scriptmd="function parseMarkdown(markdownText) {\r\n        const htmlText = markdownText\r\n        \u0009.replace(/^### (.*$)/gim, '<h3>$1</h3>')\r\n        \u0009.replace(/^## (.*$)/gim, '<h2>$1</h2>')\r\n        \u0009.replace(/^# (.*$)/gim, '<h1>$1</h1>')\r\n        \u0009.replace(/^\\> (.*$)/gim, '<blockquote>$1</blockquote>')\r\n        \u0009.replace(/\\*\\*(.*)\\*\\*/gim, '<b>$1</b>')\r\n        \u0009.replace(/\\*(.*)\\*/gim, '<i>$1</i>')\r\n        \u0009.replace(/!\\[(.*?)\\]\\((.*?)\\)/gim, \"<img alt='$1' src='$2' />\")\r\n        \u0009.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, \"<a href='$2'>$1</a>\")\r\n        \u0009.replace(/\\n$/gim, '<br />')\r\n        \r\n        return htmlText.trim()\r\n    }\r\n    ";q.html=function(br){return p.elem("html",br);};q.head=function(br){return p.elem("head",br);};q.title=function(br){return p.elem("title",br);};q.style=function(br){return p.elem("style",br);};q.body=function(br){return p.elem("body",br);};q.div=function(br){return p.elem("div",br);};q.br=function(br){return p.elem("br",br);};q.section=function(br){return p.elem("section",br);};q.span=function(br){return p.elem("span",br);};q.table=function(br){return p.elem("table",br);};q.thead=function(br){return p.elem("thead",br);};q.tbody=function(br){return p.elem("tbody",br);};q.tfoot=function(br){return p.elem("tfoot",br);};q.img=function(br){return p.elem("img",br);};q.map=function(br){return p.elem("map",br);};q.area=function(br){return p.elem("area",br);};q.p=function(br){return p.elem("p",br);};q.a=function(br){return p.elem("a",br);};q.tr=function(br){return p.elem("tr",br);};q.td=function(br){return p.elem("td",br);};q.th=function(br){return p.elem("th",br);};q.ul=function(br){return p.elem("ul",br);};q.li=function(br){return p.elem("li",br);};q.h1=function(br){return p.elem("h1",br);};q.h2=function(br){return p.elem("h1",br);};q.h3=function(br){return p.elem("h1",br);};q.h4=function(br){return p.elem("h1",br);};q.strong=function(br){return p.elem("strong",br);};};s.Radio=function(bq,br,bs,bt,bu){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("radio"),$1:br}),[_7.Element("label",bt,[_7.Radio(bu,true,bs),_7.TextNode(bq)])]);};s.Checkbox=function(bq,br,bs,bt,bu){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("checkbox"),$1:br}),[_7.Element("label",bt,[_7.CheckBox(bu,bs),_7.TextNode(bq)])]);};s.TextArea=function(bq,br,bs,bt,bu){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:br}),[_7.Element("label",bt,[_7.TextNode(bq)]),_7.InputArea(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bu}),bs)]);};s.InputPassword=function(bq,br,bs,bt,bu){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:br}),[_7.Element("label",bt,[_7.TextNode(bq)]),_7.PasswordBox(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bu}),bs)]);};s.Input=function(bq,br,bs,bt,bu){return _7.Element("div",new _4.T({$:1,$0:(s.cls())("form-group"),$1:br}),[_7.Element("label",bt,[_7.TextNode(bq)]),_7.Input(new _4.T({$:1,$0:(s.cls())("form-control"),$1:bu}),bs)]);};s.Container=function(bq){return _7.Element("div",[(s.cls())("container")],bq);};s.Class=function(){t.$cctor();return t.Class;};s.cls=function(){t.$cctor();return t.cls;};t.$cctor=function(){t.$cctor=a.ignore;t.cls=_8.Class;t.Class=_8.Class;};v=u.Intent=X.Class({toString:function(){return(((X.Curried3(function(bq,br,bs){return bq("Intent("+_0.toSafe(br)+", "+V.p$2(bs)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=X.Class({toString:function(){return(((X.Curried3(function(bq,br,bs){return bq("Trait("+_0.toSafe(br)+", "+_0.prettyPrint(bs)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=X.Class({toString:function(){return((((X.Curried(function(bq,br,bs,bt){return bq("Entity("+_0.toSafe(br)+", "+_0.toSafe(bs)+", "+V.p$2(bt)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=X.Class({toString:function(){return((((X.Curried(function(bq,br,bs,bt){return bq(V.p(br)+" "+V.p$3(bs)+" "+V.p$5(bt));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bq;bq=this.$2;return bq!=null?{$:1,$0:_4.sortBy(function(br){return br.get_Name();},bq.$0)}:null;},get_Traits:function(){var bq;bq=this.$1;return bq!=null?{$:1,$0:_4.sortBy(function(br){return br.get_Name();},bq.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.Question=X.Class({toString:function(){return(((X.Curried3(function(bq,br,bs){return bq("Name: "+_0.toSafe(br)+" Text: "+_0.toSafe(bs));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);B.New=function(bq,br,bs,bt,bu){return{body:bq,end:br,start:bs,suggested:bt,value:bu};};A["Intent'"]=function(bq,br){return!(br.intent==null)?{$:1,$0:new v({$:0,$0:n.toLower(br.intent.value),$1:null})}:null;};A["Trait'"]=function(bq){return!(bq.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:n.toLower(bq.domain.value),$2:null})}:!(bq.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:n.toLower(bq.dialogue_act.value),$2:null})}:null;};A["Entity'$1"]=function(bq){return!(bq.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:n.toLower(bq.contact.value),$2:null})}:null;};D=C["Utterance'"]=X.Class({get_TopIntent:function(){return _4.head(_4.sortBy(function(bq){return bq.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,D);E=C["Intent'"]=X.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=C["Entity'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,F);G=C["Trait'"]=X.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,G);C.HasUtterance=function(bq){var br,bs,bt,bu,bv,bw,bx;return bq!=null&&bq.$==1&&(bq.$0.$0.$==0&&(bq.$0.$1.get_Length()>0&&(br=[bq.$0.$1,bq.$0.$2],true)))?(bs=_4.map(function(by){return new x({$:0,$0:n.toLower(by.get_Role()),$1:by.get_Value(),$2:{$:1,$0:by.get_Confidence()}});},_4.filter(function(by){return by.get_Confidence()>C.entityConfidenceThreshold();},br[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_4.map(function(by){return new w({$:0,$0:n.toLower(by.get_Name()),$1:by.get_Value(),$2:{$:1,$0:by.get_Confidence()}});},_4.filter(function(by){return by.get_Confidence()>C.entityConfidenceThreshold();},br[1]))},$2:{$:1,$0:bs}})}):bq!=null&&bq.$==1&&(bq.$0.$1.$==0&&(bq.$0.$0.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bt=[bq.$0.$0,bq,bq.$0.$2],true)))?(bu=bt[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bu.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bu.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bq!=null&&bq.$==1&&(bq.$0.$0.get_Length()>0&&bq.$0.$1.get_Length()>0&&bq.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bv=[bq.$0.$1,bq.$0.$0,bq,bq.$0.$2],true))?(bw=bv[2],(bx=_4.map(function(by){return new x({$:0,$0:n.toLower(by.get_Role()),$1:by.get_Value(),$2:{$:1,$0:by.get_Confidence()}});},_4.filter(function(by){return by.get_Confidence()>C.entityConfidenceThreshold();},bw.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:n.toLower(bw.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bw.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bx}})})):null;};C.entityConfidenceThreshold=function(){I.$cctor();return I.entityConfidenceThreshold;};C.set_entityConfidenceThreshold=function(bq){I.$cctor();I.entityConfidenceThreshold=bq;};C.intentConfidenceThreshold=function(){I.$cctor();return I.intentConfidenceThreshold;};C.set_intentConfidenceThreshold=function(bq){I.$cctor();I.intentConfidenceThreshold=bq;};C.getUtterance=function(bq,br){C.witapi().getMeaning(bq,function(bs){var bt,bu;n.debug("NLU",(function(bv){return function(bw){return bv("Wit.ai returned: "+_0.prettyPrint(bw));};}(a.id))(bs));bt=!(bs.intents==null)?_4.ofArray(_3.map(function(bv){return new E({$:0,$0:bv.name,$1:bv.confidence});},bs.intents)):_4.T.Empty;bu=!(bs.traits==null)?_4.map(function(bv){var bw,bx;bw=bv[0];bx=bv[1];return new G({$:0,$0:bw,$1:bx.confidence,$2:bx.value});},_4.ofSeq(_.ToSeq(((ba.DecodeStringMap(ba.Id()))())(bs.traits)))):_4.T.Empty;return br({$:1,$0:new D({$:0,$0:bt,$1:!(bs.intents==null)?_4.ofSeq(_5.concat(_4.map(function(bv){return _3.map(function(bw){return new F({$:0,$0:bw.name,$1:bw.confidence,$2:bw.role,$3:bw.value});},bc.GetJS(bs.entities,[bv]));},_4.filter(function(bv){return!(bc.GetJS(bs.entities,[bv])==null);},C.entity_types())))):_4.T.Empty,$2:bu})});},function(bs,bt,bu){n.error((((X.Curried3(function(bv,bw,bx){return bv("Wit.ai returned: "+_0.prettyPrint(bw)+" "+_0.prettyPrint(bx));}))(a.id))(bt))(bu));return br(null);});};C.entity_types=function(){I.$cctor();return I.entity_types;};C.witapi=function(){I.$cctor();return I.witapi;};C.QuickPrograms=function(bq){return bq==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};C.QuickNumber=function(bq){var br,bs,bt;return(bs=C.One(bq),bs!=null&&bs.$==1?(br=bs.$0,true):(bt=C.Two(bq),bt!=null&&bt.$==1&&(br=bt.$0,true)))?{$:1,$0:br}:null;};C.Three=function(bq){var br;return bq==="3"||bq==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};C.Two=function(bq){var br;return bq==="2"||bq==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};C.One=function(bq){var br;return bq==="1"||bq==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_4.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};C.QuickNo=function(bq){var br;return bq==="no"||(bq==="NO"||(bq==="No"||(bq==="nope"||(bq==="no way"||(bq==="nah"||(bq==="don't do it"||bq==="stop"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickYes=function(bq){var br;return bq==="yes"||(bq==="YES"||(bq==="Yes"||(bq==="YEs"||(bq==="ok"||(bq==="sure"||(bq==="yeah"||(bq==="yep"||(bq==="uh huh"||(bq==="go ahead"||bq==="go")))))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHelp=function(bq){var br;return bq==="help"||(bq==="help me"||(bq==="what's this?"||bq==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHello=function(bq){var br;return bq==="hello"||(bq==="hey"||(bq==="yo"||bq==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.Voices=function(bq){return bq==="voices"?{$:1,$0:null}:null;};C.Debug=function(bq){return bq==="debug"?{$:1,$0:null}:null;};C.Blank=function(bq){return bq===""?{$:1,$0:null}:null;};H.Study=function(bq){return bq.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bq){var br,bs,bt,bu,bv,bw;return(bs=u.Intent$1("no",bq),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bq,true))))?{$:1,$0:br}:(bu=u.Intent$1("noresponse",bq),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bq,true))))?{$:1,$0:bt}:(bw=u.Intent$1("NoResponse",bq),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bq,true))))?{$:1,$0:bv}:null;};u.Yes=function(bq){var br,bs,bt,bu,bv,bw;return(bs=u.Intent$1("yes",bq),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bq,true))))?{$:1,$0:br}:(bu=u.Intent$1("yesresponse",bq),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bq,true))))?{$:1,$0:bt}:(bw=u.Intent$1("YesResponse",bq),bw!=null&&bw.$==1&&(bw.$0[0]==null&&(bw.$0[1]==null&&(bv=bq,true))))?{$:1,$0:bv}:null;};u.EntityManyofMany=function(bq,br){return{$:1,$0:_.OfArray(_3.ofSeq(_4.map(function(bs){return _4.exists(function(bt){return bt.get_Name()===bs;},br)?[bs,{$:1,$0:_4.filter(function(bt){return bt.get_Name()===bs;},br)}]:[bs,null];},bq)))};};u.EntityManyOf1=function(bq,br){var bs;return br!=null&&br.$==1&&(_4.exists(function(bt){return bt.get_Name()===bq;},br.$0)&&(bs=br.$0,true))?{$:1,$0:_4.filter(function(bt){return bt.get_Name()===bq;},bs)}:null;};u.Entity1OfAny=function(bq,br){var bs;return br!=null&&br.$==1&&(_4.exists(function(bt){return bt.get_Name()===bq;},br.$0)&&(bs=br.$0,true))?{$:1,$0:_4.head(_4.sortBy(function(bt){return bt.get_Name();},_4.filter(function(bt){return bt.get_Name()===bq;},bs)))}:null;};u.Entity1Of1=function(bq,br){var bs;return br!=null&&br.$==1&&(br.$0.$==1&&(br.$0.$1.$==0&&(br.$0.$0.get_Name()===bq&&(bs=br.$0.$0,true))))?{$:1,$0:bs}:null;};u.Intent$1=function(bq,br){return br.get_Intent()!=null&&br.get_Intent().$0.get_Name()===bq?{$:1,$0:[br.get_Traits(),br.get_Entities()]}:null;};I.$cctor=function(){I.$cctor=a.ignore;I.witapi=new bf.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");I.entity_types=_4.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject"]);I.intentConfidenceThreshold=0.85;I.entityConfidenceThreshold=0.85;};K.MicReady={$:5};K.MicAudioEnd={$:4};K.MicAudioStart={$:3};K.MicDisconnected={$:2};K.MicConnecting={$:1};K.MicNotInitialized={$:0};L.ClientUnderstand={$:2};L.ClientReady={$:1};L.ClientNotInitialzed={$:0};M=J.Interpreter=X.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,M);N=J.CUI=X.Class({SayVoices:function(){var bq,br,bs;bq=this;br=a.speechSynthesis.getVoices();!(br==null)?(bs=n.toArray(br),bq.Say((function(bt){return function(bu){return bt("There are currently "+a.String(bu)+" voices installed on this computer or device.");};}(a.id))(_3.length(bs))),_3.iteri(function(bt,bu){return bq.Say(((((X.Curried(function(bv,bw,bx,by){return bv("Voice "+a.String(bw)+". Name: "+_0.toSafe(bx)+", Local: "+_0.prettyPrint(by)+".");},4))(a.id))(bt))(bu.name))(bu.localService));},bs)):void 0;},Wait:function(bq){this.Wait$1(function(){bg.Start(bq,null);});},Wait$1:function(bq){this["Echo'"]("please wait...");this.Term.pause();bq();this.Term.resume();},sayRandom:function(bq,br){this.Say(J.getRandomPhrase(bq,br));},Say:function(bq){var br,bs;br=this;bg.Start((bs=null,bg.Delay(function(){a.speechSynthesis.speaking?a.speechSynthesis.cancel():void 0;br.Avatar.addMessage(bq);br.Avatar.processMessages(0);return bg.Zero();})),null);},Debug:function(bq,br){n.debug(bq,br);},"EchoHtml'":function(bq){var br,bs;br=(bs={},bs.raw=true,bs);this.Term.disable();this.Term.echo(bq,br);this.Term.enable();},"Echo'":function(bq){this.Term.disable();this.Term.echo(bq);this.Term.enable();}},null,N);N.New=function(bq,br,bs,bt,bu){return new N({Voice:bq,Mic:br,Term:bs,Avatar:bt,Caption:bu});};J.waitAddPhrases=function(){O.$cctor();return O.waitAddPhrases;};J.waitRetrievePhrases=function(){O.$cctor();return O.waitRetrievePhrases;};J.helpPhrases=function(){O.$cctor();return O.helpPhrases;};J.helloUserPhrases=function(){O.$cctor();return O.helloUserPhrases;};J.helloPhrases=function(){O.$cctor();return O.helloPhrases;};J["getRandomPhrase'"]=function(bq){return n.replace_tok("$0","",_5.nth(J.rng().Next(0,bq.get_Length()),bq));};J.getRandomPhrase=function(bq,br){return n.replace_tok("$0",br,_5.nth(J.rng().Next(0,bq.get_Length()),bq));};J.rng=function(){O.$cctor();return O.rng;};O.$cctor=function(){O.$cctor=a.ignore;O.rng=new bh.New();O.helloPhrases=_4.ofArray(["Welcome!","Welcome, my name is Lerna.","Welcome to Lerna. How can I help?","Hello this is Lerna, how can I help?","Hello, I am Lerna. How can I help?","Hello, I am Lerna. How may I help you now?","I'm Lerna. Tell me your name so we can get started."]);O.helloUserPhrases=_4.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);O.helpPhrases=_4.ofArray(["What can I help you with $0?"]);O.waitRetrievePhrases=_4.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);O.waitAddPhrases=_4.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};P.update=function(bq,br,bs,bt,bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;function b$(cp){bq.Say(cp);}function ca(cp){bt.unshift(cp);b$(cp);}function cb(cp,cq){var cr;cr=J.getRandomPhrase(cp,cq);bt.unshift(cr);return bq.Say(cr);}function cc(cp){return br.ContainsKey(cp);}function cd(cp,cq){return br.Add(cp,cq);}function ce(cp){br.Remove(cp);}function cf(){bu.shift();}function cg(){bs.shift();}function ch(cp){var cq;cq=P.getQuestion(cp);cq==null?(function(cr){return function(cs){return cr("No such question: "+_0.toSafe(cs));};}(bi.FailWith))(cp):bs.unshift(cq.$0);}function ci(cp,cq){cd(cp,cq);ch(cp);P.debug((function(cr){return function(cs){return cr("Added question: "+V.p$8(cs)+".");};}(a.id))(bs[0]));return ca(n.replace_tok("$0",cq,P.getQuestion(cp).$0.get_Text()));}function cj(cp,cq){return cc(cp)?{$:1,$0:cq}:null;}function ck(cp,cq){return!cc(cp)?{$:1,$0:cq}:null;}function cl(cp,cq){var cr,cs,ct;return(cs=cj("user",cq),cs!=null&&cs.$==1&&(P.haveQuestion(cp)&&bs.length>0&&bs[0].get_Name()===cp&&(cr=cs.$0,true)))?(cf(),cg(),cc(cp)?(ct=br.get_Item(cp),(ce(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function cm(cp,cq){var cr,cs,ct;return(cs=ck("user",cq),cs!=null&&cs.$==1&&(P.haveQuestion(cp)&&bs.length>0&&bs[0].get_Name()===cp&&(cr=cs.$0,true)))?(cf(),cg(),cc(cp)?(ct=br.get_Item(cp),(ce(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function cn(cp){var cq,cr;return(cr=ck("user",cp),cr!=null&&cr.$==1&&(bs.length===0&&(cq=cr.$0,true)))?(cf(),{$:1,$0:cq}):null;}function co(cp){var cq;return cp!=null&&cp.$==1&&(typeof cp.$0=="string"&&(cq=cp.$0,true))?{$:1,$0:cq}:null;}P.debug((((X.Curried3(function(cp,cq,cr){return cp("Starting utterances:"+_0.prettyPrint(cq)+". Starting questions: "+_0.prettyPrint(cr)+".");}))(a.id))(bu))(bs));bv=_4.ofSeq(_5.take(bu.length>=5?5:bu.length,bu));bv.$==1&&(bx=(by=ck("started",bv.$0),by!=null&&by.$==1?{$:1,$0:by.$0}:null),bx!=null&&bx.$==1&&(bz=cn(bx.$0),bz!=null&&bz.$==1&&(bA=u.Intent$1("hello",bz.$0),bA!=null&&bA.$==1&&(bA.$0[1]==null&&bv.$1.$==0))))?(br.Add("started",true),cb(J.helloPhrases(),"")):bv.$==1&&(bC=cn(bv.$0),bC!=null&&bC.$==1&&(bD=u.Intent$1("hello",bC.$0),bD!=null&&bD.$==1&&(bD.$0[1]==null&&bv.$1.$==0)))?ca("Hello, tell me your name to get started."):bv.$==1&&(bF=cn(bv.$0),bF!=null&&bF.$==1&&(bG=u.Intent$1("hello",bF.$0),bG!=null&&bG.$==1&&(bH=u.Entity1Of1("contact",bG.$0[1]),bH!=null&&bH.$==1&&(bv.$1.$==0&&(bE=bH.$0,true)))))?(bI=bE.get_Value(),cb(J.waitRetrievePhrases(),"user name"),bg.Start((bJ=null,bg.Delay(function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:3865784",[bI]),function(cp){var cq;return cp==null?(ca((function(cr){return function(cs){return cr("I did not find a user with the name "+_0.toSafe(cs)+".");};}(a.id))(bI)),ci("addUser",bI),bg.Zero()):(cq=cp.$0,bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.updateUserLastLogin:547765018",[cq.Name]),function(){br.Add("user",cq);cb(J.helloUserPhrases(),(function(cr){return function(cs){return cr(_0.prettyPrint(cs));};}(a.id))(br.get_Item("user")));return cq.LastLoggedIn!=null?bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.humanize:-132231240",[cq.LastLoggedIn.$0]),function(cr){ca((function(cs){return function(ct){return cs("You last logged in "+_0.toSafe(ct)+".");};}(a.id))(cr));return bg.Zero();}):bg.Zero();}));});})),null)):bv.$==1&&(bL=u.Yes(bv.$0),bL!=null&&bL.$==1&&(bM=cm("addUser",bL.$0),bM!=null&&bM.$==1&&(bN=co(bM.$0[1]),bN!=null&&bN.$==1&&(bv.$1.$==0&&(bK=bN.$0,true)))))?bg.Start((bO=null,bg.Delay(function(){cb(J.waitAddPhrases(),"user");return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.addUser:547765018",[bK]),function(cp){return cp==null?(ca((function(cq){return function(cr){return cq("Sorry I was not able to add the user "+_0.toSafe(cr)+" to the system.");};}(a.id))(bK)),bg.Zero()):(cd("user",bK),ca((function(cq){return function(cr){return cq("Hello "+_0.prettyPrint(cr)+", nice to meet you.");};}(a.id))(br.get_Item("user"))),bg.Zero());});})),null):bv.$==1&&(bQ=u.No(bv.$0),bQ!=null&&bQ.$==1&&(bR=cm("addUser",bQ.$0),bR!=null&&bR.$==1&&(bS=co(bR.$0[1]),bS!=null&&bS.$==1&&(bv.$1.$==0&&(bP=bS.$0,true)))))?ca((function(cp){return function(cq){return cp("Ok I did not add the user "+_0.toSafe(cq)+". But you must login for me to help you.");};}(a.id))(bP)):bv.$==1&&((bU=cn(bv.$0),bU!=null&&bU.$==1)&&bv.$1.$==0)?ca("Could you introduce yourself so we can get started?"):bv.$==1&&(bW=(bY=cj("user",bv.$0),bY!=null&&bY.$==1&&(bs.length===0&&(bX=bY.$0,true)))?(cf(),{$:1,$0:bX}):null,bW!=null&&bW.$==1&&(bZ=u.Intent$1("hello",bW.$0),bZ!=null&&bZ.$==1&&(bZ.$0[0]==null&&(b0=u.Entity1Of1("contact",bZ.$0[1]),b0!=null&&b0.$==1&&(bv.$1.$==0&&(bV=b0.$0,true))))))?bg.Start((b1=null,bg.Delay(function(){return bg.Bind((new bk.New()).Async("Lerna.Web:Lerna.Web.Server.getUser:3865784",[bV.get_Value()]),function(cp){return cp==null?(ca((function(cq){return function(cr){return cq("Sorry, the user "+_0.toSafe(cr)+" does not exist.");};}(a.id))(bV.get_Value())),bg.Zero()):(ci("switchUser",cp.$0.Name),bg.Zero());});})),null):bv.$==1&&(b3=u.Yes(bv.$0),b3!=null&&b3.$==1&&(b4=cl("switchUser",b3.$0),b4!=null&&b4.$==1&&(b5=co(b4.$0[1]),b5!=null&&b5.$==1&&(bv.$1.$==0&&(b2=b5.$0,true)))))?(br.set_Item("user",b2),ca((function(cp){return function(cq){return cp("Ok I switched to user "+_0.prettyPrint(cq)+".");};}(a.id))(b2))):bv.$==1&&(b7=u.No(bv.$0),b7!=null&&b7.$==1&&(b8=cl("switchUser",b7.$0),b8!=null&&b8.$==1&&(b9=co(b8.$0[1]),b9!=null&&b9.$==1&&(bv.$1.$==0&&(b6=b9.$0,true)))))?ca((function(cp){return function(cq){return cp("Ok I did not switch to user "+_0.toSafe(cq)+".");};}(a.id))(b6)):(cf(),P.debug("Main interpreter did not understand utterance."),ca("Sorry I didn't understand what you meant."),bs.length>0?(b_=_5.nth(0,bs),cc(b_.get_Name())?ca(n.replace_tok("$0",br.get_Item(b_.get_Name()),b_.get_Text())):ca(b_.get_Text())):void 0);P.debug((((X.Curried3(function(cp,cq,cr){return cp("Ending utterances: "+_0.prettyPrint(cq)+". Ending questions:"+_0.prettyPrint(cr)+".");}))(a.id))(bu))(bs));};P.haveQuestion=function(bq){return _4.exists(function(br){return br.get_Name()===bq;},P.questions());};P.getQuestion=function(bq){return _5.tryFind(function(br){return br.get_Name()===bq;},P.questions());};P.questions=function(){Q.$cctor();return Q.questions;};P.debug=function(bq){n.debug("Main",bq);};Q.$cctor=function(){Q.$cctor=a.ignore;Q.questions=_4.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};R.update=function(bq,br,bs,bt,bu){R.debug((((X.Curried3(function(bv,bw,bx){return bv("Starting utterances:"+_0.prettyPrint(bw)+". Starting questions: "+_0.prettyPrint(bx)+".");}))(a.id))(bu))(bs));};R.haveQuestion=function(bq){return _4.exists(function(br){return br.get_Name()===bq;},R.questions());};R.getQuestion=function(bq){return _5.tryFind(function(br){return br.get_Name()===bq;},R.questions());};R.questions=function(){S.$cctor();return S.questions;};R.debug=function(bq){n.debug("Study",bq);};S.$cctor=function(){S.$cctor=a.ignore;S.questions=_4.ofArray([new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};T.run=function(){var bq,br,bs;T.set_CUI((bq=(br=X.ThisFunc(function(bt,bu){return((T.Main().get_Text())(bt))(bu);}),(bs=T.Main().get_Options(),void a.$("#main").terminal(br,bs))),N.New(T.CUI().Voice,T.CUI().Mic,bq,T.CUI().Avatar,T.CUI().Caption)));return _7.get_Empty();};T.Main=function(){U.$cctor();return U.Main;};T.initMic=function(bq){var br,bs;T.set_CUI((br={$:1,$0:new bl.Microphone(bm.getElementById("microphone"))},N.New(T.CUI().Voice,br,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)));bs=T.CUI().Mic.$0;bs.onconnecting=function(){T.set_MicState(K.MicConnecting);return T.debug("Mic connecting...");};bs.ondisconnected=function(){T.set_MicState(K.MicDisconnected);return T.debug("Mic disconnected.");};bs.onaudiostart=function(){T.set_MicState(K.MicAudioStart);return T.debug("Mic audio start...");};bs.onaudioend=function(){T.set_MicState(K.MicAudioEnd);return T.debug("Mic audio end.");};bs.onerror=function(bt){T.set_MicState({$:6,$0:bt});return T.debug((function(bu){return function(bv){return bu("Mic error : "+_0.toSafe(bv)+".");};}(a.id))(bt));};bs.onready=function(){T.set_MicState(K.MicReady);return T.debug("Mic ready.");};bs.onresult=function(bt,bu){return T.ClientState().$==2?T.echo("I'm still trying to understand what you said before."):T.ClientState().$==0?n.error("Client is not intialized."):!(bt==null||bu==null)?(T.set_MicState({$:7,$0:bt,$1:bu}),T.debug((((X.Curried3(function(bv,bw,bx){return bv("Mic result: "+_0.prettyPrint(bw)+" "+_0.prettyPrint(bx)+".");}))(a.id))(bt))(bu)),bq(bs,[bt,bu])):T.debug("Mic: No result returned.");};bs.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};T.sayRandom=function(bq,br){T.say(J.getRandomPhrase(br,bq));};T.sayVoices=function(){var bq;bq=n.toArray(T.synth().getVoices());T["say'"]((function(br){return function(bs){return br("There are currently "+a.String(bs)+" voices installed on this computer or device.");};}(a.id))(_3.length(bq)));_3.iteri(function(br,bs){return T["say'"](((((X.Curried(function(bt,bu,bv,bw){return bt("Voice "+a.String(bu)+". Name: "+_0.toSafe(bv)+", Local: "+_0.prettyPrint(bw)+".");},4))(a.id))(br))(bs.name))(bs.localService));},bq);};T.say=function(bq){T.Responses().unshift(bq);T["say'"](bq);};T["say'"]=function(bq){T.CUI().Say(bq);};T.initSpeech=function(){var bq,br;bq=n.toArray(T.synth().getVoices());_3.length(bq)>0?(br=_3.find(function(bs){return bs["default"];},bq),T.set_CUI(N.New({$:1,$0:br},T.CUI().Mic,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)),T.debug((function(bs){return function(bt){return bs("Using default voice "+_0.toSafe(bt)+".");};}(a.id))(T.CUI().Voice.$0.name)),T.CUI().Avatar.nativeVoice=true,T.CUI().Avatar.nativeVoiceName=br.name):T.echo("No speech synthesis voice is available.");};T.synth=function(){U.$cctor();return U.synth;};T.push=function(bq){T.Utterances().unshift(bq);return T.Utterances();};T.Props=function(){U.$cctor();return U.Props;};T.Responses=function(){U.$cctor();return U.Responses;};T.Questions=function(){U.$cctor();return U.Questions;};T.Utterances=function(){U.$cctor();return U.Utterances;};T.wait=function(bq){n["Terminal.Echo'"](T.CUI().Term,"please wait");T.CUI().Term.pause();bq();T.CUI().Term.resume();};T.debug=function(bq){n.debug("CLIENT",bq);};T.echo=function(bq){if(!(T.CUI().Term==null))n["Terminal.EchoHtml'"](T.CUI().Term,(function(br){return function(bs){return br(_0.prettyPrint(bs));};}(a.id))(bq));};T.ClientState=function(){U.$cctor();return U.ClientState;};T.set_ClientState=function(bq){U.$cctor();U.ClientState=bq;};T.MicState=function(){U.$cctor();return U.MicState;};T.set_MicState=function(bq){U.$cctor();U.MicState=bq;};T.CUI=function(){U.$cctor();return U.CUI;};T.set_CUI=function(bq){U.$cctor();U.CUI=bq;};U.$cctor=function(){var bq,br,bs;U.$cctor=a.ignore;function bt(bv,bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG;bx=bw[0];by=bw[1];T.debug((((X.Curried3(function(bH,bI,bJ){return bH("Voice: "+_0.prettyPrint(bI)+" "+_0.prettyPrint(bJ));}))(a.id))(bx))(by));bz=(bA=A["Intent'"](bx,by),bA!=null&&bA.$==1?{$:1,$0:bA.$0}:null);bB=(bC=A["Trait'"](by),bC!=null&&bC.$==1?{$:1,$0:_4.ofArray([bC.$0])}:null);bD=(bE=A["Entity'$1"](by),bE!=null&&bE.$==1?{$:1,$0:_4.ofArray([bE.$0])}:null);return bz==null&&(bB==null&&bD==null)?null:(T.debug(((((X.Curried(function(bH,bI,bJ,bK){return bH("Voice: "+V.p(bI)+" "+V.p$3(bJ)+" "+V.p$5(bK));},4))(a.id))(bz))(bB))(bD)),bG=T.push(new y({$:0,$0:bz,$1:bB,$2:bD})),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bG));}function bu(bv,bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;T.set_CUI(N.New(T.CUI().Voice,T.CUI().Mic,bv,T.CUI().Avatar,T.CUI().Caption));bn.Equals(T.CUI().Mic,null)?T.initMic(bt):void 0;bn.Equals(T.CUI().Voice,null)?T.initSpeech():void 0;T.ClientState().$===0?T.set_ClientState(L.ClientReady):void 0;return(bx=C.Blank(bw),bx!=null&&bx.$==1)?T["say'"]("Tell me what you want me to do or ask me a question."):(by=C.Debug(bw),by!=null&&by.$==1)?(T.debug((function(bI){return function(bJ){return bI("Utterances: "+_0.prettyPrint(bJ));};}(a.id))(T.Utterances())),T.debug((function(bI){return function(bJ){return bI("Questions: "+_0.prettyPrint(bJ));};}(a.id))(T.Questions()))):(bz=C.Voices(bw),bz!=null&&bz.$==1)?T.sayVoices():T.ClientState().$==1?(bB=C.QuickHello(bw),bB!=null&&bB.$==1?(bA=bB.$0,true):(bC=C.QuickHelp(bw),bC!=null&&bC.$==1?(bA=bC.$0,true):(bD=C.QuickYes(bw),bD!=null&&bD.$==1?(bA=bD.$0,true):(bE=C.QuickNo(bw),bE!=null&&bE.$==1&&(bA=bE.$0,true)))))?(bg.Start((bF=null,bg.Delay(function(){return bg.Bind(bo.getAnswer("What is an element?"),function(bI){T.debug(_3.get(bI.answers,0).answer);return bg.Zero();});})),null),T.debug((function(bI){return function(bJ){return bI("Quick Text: "+V.p$7(bJ)+".");};}(a.id))(bA)),bG=T.push(bA),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bG),T.set_ClientState(L.ClientReady)):T.CUI().Wait((bH=null,bg.Delay(function(){T.set_ClientState(L.ClientUnderstand);C.getUtterance(bw,function(bI){var bJ,bK,bL;bJ=C.HasUtterance(bI);bJ!=null&&bJ.$==1?(bK=bJ.$0,T.debug(((((X.Curried(function(bM,bN,bO,bP){return bM("Text: "+V.p(bN)+" "+V.p$3(bO)+" "+V.p$5(bP));},4))(a.id))(bK.get_Intent()))(bK.get_Traits()))(bK.get_Entities())),bL=T.push(bK),P.update(T.CUI(),T.Props(),T.Questions(),T.Responses(),bL)):(T.debug("Text: Did not receive a meaning from the server."),T["say'"]("Sorry I did not understand what you said."));});T.set_ClientState(L.ClientReady);return bg.Zero();}))):T.ClientState().$==0?n.error("Client is not initialized."):T["say'"]("I'm still trying to understand what you said before.");}U.CUI=N.New(null,null,null,(a.SDK.applicationId="4277115329081938617",bq=new a.SDKConnection(),br=new a.WebAvatar(),br.version=8.5,br.connection=bq,br.avatar="22225225",br.voice="cmu-slt",br.voiceMod="default",br.nativeVoice=true,br.nativeVoiceName="Microsoft David Desktop - English (United States)",br.width=300,br.createBox(),br.addMessage(""),br.processMessages(0),br),false);U.MicState=K.MicNotInitialized;U.ClientState=L.ClientNotInitialzed;U.Utterances=[];U.Questions=[];U.Responses=[];U.Props=new bp.New$5();U.synth=a.speechSynthesis;U.Main=new M({$:0,$0:function(bv){return function(bw){return bt(bv,bw);};},$1:[function(bv){return function(bw){return bu(bv,bw);};},(bs={},bs.name="Main",bs.greetings="Welcome to Lerna. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bs.prompt=">",bs)]});};V.p$8=function(bq){return"Question ("+_0.prettyPrint(bq.$0)+", "+_0.prettyPrint(bq.$1)+")";};V.p$9=function(bq){return bq==null?"null":"Some "+_0.prettyPrint(bq.$0);};V.p$2=function(bq){return bq==null?"null":"Some "+_0.prettyPrint(bq.$0);};V.p$1=function(bq){return"Intent ("+_0.prettyPrint(bq.$0)+", "+V.p$2(bq.$1)+")";};V.p=function(bq){return bq==null?"null":"Some "+V.p$1(bq.$0);};V.p$4=function(bq){return"Trait ("+_0.prettyPrint(bq.$0)+", "+_0.prettyPrint(bq.$1)+", "+V.p$2(bq.$2)+")";};V.p$3=function(bq){return bq==null?"null":"Some "+_0.printList(function(br){return V.p$4(br);},bq.$0);};V.p$6=function(bq){return"Entity ("+_0.prettyPrint(bq.$0)+", "+_0.prettyPrint(bq.$1)+", "+V.p$2(bq.$2)+")";};V.p$5=function(bq){return bq==null?"null":"Some "+_0.printList(function(br){return V.p$6(br);},bq.$0);};V.p$7=function(bq){return"Utterance ("+V.p(bq.$0)+", "+V.p$3(bq.$1)+", "+V.p$5(bq.$2)+")";};}());
